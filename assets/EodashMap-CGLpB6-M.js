const __vite__fileDeps=["assets/raw-CcGKjn8q-MKTGGSca.js","assets/basedecoder-Qm25PwVp-gdlnpIMU.js","assets/lzw-BOMhmEDy-CRQZVFv2.js","assets/jpeg-DNfUpLwy-CrsOgAb-.js","assets/deflate-Be2Arps5-XLmgg930.js","assets/pako.esm-C3kYPGGQ-DQSVoCko.js","assets/packbits-DaUD6MLm-DnF8Bj-8.js","assets/lerc-_E46UbWQ-CcZaAEsU.js","assets/index-AssLQkKW.js","assets/index-h5EwBJyy.css","assets/_commonjsHelpers-Cpj98o6Y.js","assets/DynamicWebComponent-CE4hyDJK.js","assets/webimage-D2c098k3-CiG7DZmh.js","assets/decoder-HRvnjnEI-BkmEI0my.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{aq as jn,q as tx,as as wi,P as ex,Q as rx,L as nx,at as ix,w as sx,al as ox}from"./index-AssLQkKW.js";import{c as Pi,g as ax}from"./_commonjsHelpers-Cpj98o6Y.js";import lx from"./DynamicWebComponent-CE4hyDJK.js";var Om={exports:{}},vo={exports:{}};/*! https://mths.be/punycode v1.4.0 by @mathias */vo.exports;var Qf;function hx(){return Qf||(Qf=1,function(r,t){(function(e){var n=t&&!t.nodeType&&t,i=r&&!r.nodeType&&r,s=typeof Pi=="object"&&Pi;(s.global===s||s.window===s||s.self===s)&&(e=s);var o,a=2147483647,l=36,h=1,u=26,c=38,f=700,g=72,m=128,_="-",x=/^xn--/,v=/[^\x20-\x7E]/,w=/[\x2E\u3002\uFF0E\uFF61]/g,S={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},E=l-h,T=Math.floor,R=String.fromCharCode,C;function I(L){throw new RangeError(S[L])}function F(L,D){for(var X=L.length,K=[];X--;)K[X]=D(L[X]);return K}function U(L,D){var X=L.split("@"),K="";X.length>1&&(K=X[0]+"@",L=X[1]),L=L.replace(w,".");var G=L.split("."),H=F(G,D).join(".");return K+H}function j(L){for(var D=[],X=0,K=L.length,G,H;X<K;)G=L.charCodeAt(X++),G>=55296&&G<=56319&&X<K?(H=L.charCodeAt(X++),(H&64512)==56320?D.push(((G&1023)<<10)+(H&1023)+65536):(D.push(G),X--)):D.push(G);return D}function B(L){return F(L,function(D){var X="";return D>65535&&(D-=65536,X+=R(D>>>10&1023|55296),D=56320|D&1023),X+=R(D),X}).join("")}function d(L){return L-48<10?L-22:L-65<26?L-65:L-97<26?L-97:l}function p(L,D){return L+22+75*(L<26)-((D!=0)<<5)}function y(L,D,X){var K=0;for(L=X?T(L/f):L>>1,L+=T(L/D);L>E*u>>1;K+=l)L=T(L/E);return T(K+(E+1)*L/(L+c))}function b(L){var D=[],X=L.length,K,G=0,H=m,Q=g,nt,xt,dt,Tt,St,Dt,Yt,ce,Ht;for(nt=L.lastIndexOf(_),nt<0&&(nt=0),xt=0;xt<nt;++xt)L.charCodeAt(xt)>=128&&I("not-basic"),D.push(L.charCodeAt(xt));for(dt=nt>0?nt+1:0;dt<X;){for(Tt=G,St=1,Dt=l;dt>=X&&I("invalid-input"),Yt=d(L.charCodeAt(dt++)),(Yt>=l||Yt>T((a-G)/St))&&I("overflow"),G+=Yt*St,ce=Dt<=Q?h:Dt>=Q+u?u:Dt-Q,!(Yt<ce);Dt+=l)Ht=l-ce,St>T(a/Ht)&&I("overflow"),St*=Ht;K=D.length+1,Q=y(G-Tt,K,Tt==0),T(G/K)>a-H&&I("overflow"),H+=T(G/K),G%=K,D.splice(G++,0,H)}return B(D)}function M(L){var D,X,K,G,H,Q,nt,xt,dt,Tt,St,Dt=[],Yt,ce,Ht,Ke;for(L=j(L),Yt=L.length,D=m,X=0,H=g,Q=0;Q<Yt;++Q)St=L[Q],St<128&&Dt.push(R(St));for(K=G=Dt.length,G&&Dt.push(_);K<Yt;){for(nt=a,Q=0;Q<Yt;++Q)St=L[Q],St>=D&&St<nt&&(nt=St);for(ce=K+1,nt-D>T((a-X)/ce)&&I("overflow"),X+=(nt-D)*ce,D=nt,Q=0;Q<Yt;++Q)if(St=L[Q],St<D&&++X>a&&I("overflow"),St==D){for(xt=X,dt=l;Tt=dt<=H?h:dt>=H+u?u:dt-H,!(xt<Tt);dt+=l)Ke=xt-Tt,Ht=l-Tt,Dt.push(R(p(Tt+Ke%Ht,0))),xt=T(Ke/Ht);Dt.push(R(p(xt,0))),H=y(X,ce,K==G),X=0,++K}++X,++D}return Dt.join("")}function P(L){return U(L,function(D){return x.test(D)?b(D.slice(4).toLowerCase()):D})}function A(L){return U(L,function(D){return v.test(D)?"xn--"+M(D):D})}if(o={version:"1.3.2",ucs2:{decode:j,encode:B},decode:b,encode:M,toASCII:A,toUnicode:P},n&&i)if(r.exports==n)i.exports=o;else for(C in o)o.hasOwnProperty(C)&&(n[C]=o[C]);else e.punycode=o})(Pi)}(vo,vo.exports)),vo.exports}var ru={exports:{}};/*!
 * URI.js - Mutating URLs
 * IPv6 Support
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */var Jf;function ux(){return Jf||(Jf=1,function(r){(function(t,e){r.exports?r.exports=e():t.IPv6=e(t)})(Pi,function(t){var e=t&&t.IPv6;function n(s){var o=s.toLowerCase(),a=o.split(":"),l=a.length,h=8;a[0]===""&&a[1]===""&&a[2]===""?(a.shift(),a.shift()):a[0]===""&&a[1]===""?a.shift():a[l-1]===""&&a[l-2]===""&&a.pop(),l=a.length,a[l-1].indexOf(".")!==-1&&(h=7);var u;for(u=0;u<l&&a[u]!=="";u++);if(u<h)for(a.splice(u,1,"0000");a.length<h;)a.splice(u,0,"0000");for(var c,f=0;f<h;f++){c=a[f].split("");for(var g=0;g<3&&(c[0]==="0"&&c.length>1);g++)c.splice(0,1);a[f]=c.join("")}var m=-1,_=0,x=0,v=-1,w=!1;for(f=0;f<h;f++)w?a[f]==="0"?x+=1:(w=!1,x>_&&(m=v,_=x)):a[f]==="0"&&(w=!0,v=f,x=1);x>_&&(m=v,_=x),_>1&&a.splice(m,_,""),l=a.length;var S="";for(a[0]===""&&(S=":"),f=0;f<l&&(S+=a[f],f!==l-1);f++)S+=":";return a[l-1]===""&&(S+=":"),S}function i(){return t.IPv6===this&&(t.IPv6=e),this}return{best:n,noConflict:i}})}(ru)),ru.exports}var nu={exports:{}};/*!
 * URI.js - Mutating URLs
 * Second Level Domain (SLD) Support
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */var tg;function cx(){return tg||(tg=1,function(r){(function(t,e){r.exports?r.exports=e():t.SecondLevelDomains=e(t)})(Pi,function(t){var e=t&&t.SecondLevelDomains,n={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ",do:" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",hu:" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ",in:" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch ",com:"ar br cn de eu gb gr hu jpn kr no qc ru sa se uk us uy za ",net:"gb jp se uk ",org:"ae",de:"com "},has:function(i){var s=i.lastIndexOf(".");if(s<=0||s>=i.length-1)return!1;var o=i.lastIndexOf(".",s-1);if(o<=0||o>=s-1)return!1;var a=n.list[i.slice(s+1)];return a?a.indexOf(" "+i.slice(o+1,s)+" ")>=0:!1},is:function(i){var s=i.lastIndexOf(".");if(s<=0||s>=i.length-1)return!1;var o=i.lastIndexOf(".",s-1);if(o>=0)return!1;var a=n.list[i.slice(s+1)];return a?a.indexOf(" "+i.slice(0,s)+" ")>=0:!1},get:function(i){var s=i.lastIndexOf(".");if(s<=0||s>=i.length-1)return null;var o=i.lastIndexOf(".",s-1);if(o<=0||o>=s-1)return null;var a=n.list[i.slice(s+1)];return!a||a.indexOf(" "+i.slice(o+1,s)+" ")<0?null:i.slice(o+1)},noConflict:function(){return t.SecondLevelDomains===this&&(t.SecondLevelDomains=e),this}};return n})}(nu)),nu.exports}/*!
 * URI.js - Mutating URLs
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */(function(r){(function(t,e){r.exports?r.exports=e(hx(),ux(),cx()):t.URI=e(t.punycode,t.IPv6,t.SecondLevelDomains,t)})(Pi,function(t,e,n,i){var s=i&&i.URI;function o(d,p){var y=arguments.length>=1,b=arguments.length>=2;if(!(this instanceof o))return y?b?new o(d,p):new o(d):new o;if(d===void 0){if(y)throw new TypeError("undefined is not a valid argument for URI");typeof location<"u"?d=location.href+"":d=""}if(d===null&&y)throw new TypeError("null is not a valid argument for URI");return this.href(d),p!==void 0?this.absoluteTo(p):this}function a(d){return/^[0-9]+$/.test(d)}o.version="1.19.11";var l=o.prototype,h=Object.prototype.hasOwnProperty;function u(d){return d.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function c(d){return d===void 0?"Undefined":String(Object.prototype.toString.call(d)).slice(8,-1)}function f(d){return c(d)==="Array"}function g(d,p){var y={},b,M;if(c(p)==="RegExp")y=null;else if(f(p))for(b=0,M=p.length;b<M;b++)y[p[b]]=!0;else y[p]=!0;for(b=0,M=d.length;b<M;b++){var P=y&&y[d[b]]!==void 0||!y&&p.test(d[b]);P&&(d.splice(b,1),M--,b--)}return d}function m(d,p){var y,b;if(f(p)){for(y=0,b=p.length;y<b;y++)if(!m(d,p[y]))return!1;return!0}var M=c(p);for(y=0,b=d.length;y<b;y++)if(M==="RegExp"){if(typeof d[y]=="string"&&d[y].match(p))return!0}else if(d[y]===p)return!0;return!1}function _(d,p){if(!f(d)||!f(p)||d.length!==p.length)return!1;d.sort(),p.sort();for(var y=0,b=d.length;y<b;y++)if(d[y]!==p[y])return!1;return!0}function x(d){var p=/^\/+|\/+$/g;return d.replace(p,"")}o._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,preventInvalidHostname:o.preventInvalidHostname,duplicateQueryParameters:o.duplicateQueryParameters,escapeQuerySpace:o.escapeQuerySpace}},o.preventInvalidHostname=!1,o.duplicateQueryParameters=!1,o.escapeQuerySpace=!0,o.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,o.idn_expression=/[^a-z0-9\._-]/i,o.punycode_expression=/(xn--)/i,o.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,o.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,o.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/ig,o.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g},o.leading_whitespace_expression=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,o.ascii_tab_whitespace=/[\u0009\u000A\u000D]+/g,o.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},o.hostProtocols=["http","https"],o.invalid_hostname_characters=/[^a-zA-Z0-9\.\-:_]/,o.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},o.getDomAttribute=function(d){if(!(!d||!d.nodeName)){var p=d.nodeName.toLowerCase();if(!(p==="input"&&d.type!=="image"))return o.domAttributes[p]}};function v(d){return escape(d)}function w(d){return encodeURIComponent(d).replace(/[!'()*]/g,v).replace(/\*/g,"%2A")}o.encode=w,o.decode=decodeURIComponent,o.iso8859=function(){o.encode=escape,o.decode=unescape},o.unicode=function(){o.encode=w,o.decode=decodeURIComponent},o.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/ig,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},o.encodeQuery=function(d,p){var y=o.encode(d+"");return p===void 0&&(p=o.escapeQuerySpace),p?y.replace(/%20/g,"+"):y},o.decodeQuery=function(d,p){d+="",p===void 0&&(p=o.escapeQuerySpace);try{return o.decode(p?d.replace(/\+/g,"%20"):d)}catch{return d}};var S={encode:"encode",decode:"decode"},E,T=function(d,p){return function(y){try{return o[p](y+"").replace(o.characters[d][p].expression,function(b){return o.characters[d][p].map[b]})}catch{return y}}};for(E in S)o[E+"PathSegment"]=T("pathname",S[E]),o[E+"UrnPathSegment"]=T("urnpath",S[E]);var R=function(d,p,y){return function(b){var M;y?M=function(D){return o[p](o[y](D))}:M=o[p];for(var P=(b+"").split(d),A=0,L=P.length;A<L;A++)P[A]=M(P[A]);return P.join(d)}};o.decodePath=R("/","decodePathSegment"),o.decodeUrnPath=R(":","decodeUrnPathSegment"),o.recodePath=R("/","encodePathSegment","decode"),o.recodeUrnPath=R(":","encodeUrnPathSegment","decode"),o.encodeReserved=T("reserved","encode"),o.parse=function(d,p){var y;return p||(p={preventInvalidHostname:o.preventInvalidHostname}),d=d.replace(o.leading_whitespace_expression,""),d=d.replace(o.ascii_tab_whitespace,""),y=d.indexOf("#"),y>-1&&(p.fragment=d.substring(y+1)||null,d=d.substring(0,y)),y=d.indexOf("?"),y>-1&&(p.query=d.substring(y+1)||null,d=d.substring(0,y)),d=d.replace(/^(https?|ftp|wss?)?:+[/\\]*/i,"$1://"),d=d.replace(/^[/\\]{2,}/i,"//"),d.substring(0,2)==="//"?(p.protocol=null,d=d.substring(2),d=o.parseAuthority(d,p)):(y=d.indexOf(":"),y>-1&&(p.protocol=d.substring(0,y)||null,p.protocol&&!p.protocol.match(o.protocol_expression)?p.protocol=void 0:d.substring(y+1,y+3).replace(/\\/g,"/")==="//"?(d=d.substring(y+3),d=o.parseAuthority(d,p)):(d=d.substring(y+1),p.urn=!0))),p.path=d,p},o.parseHost=function(d,p){d||(d=""),d=d.replace(/\\/g,"/");var y=d.indexOf("/"),b,M;if(y===-1&&(y=d.length),d.charAt(0)==="[")b=d.indexOf("]"),p.hostname=d.substring(1,b)||null,p.port=d.substring(b+2,y)||null,p.port==="/"&&(p.port=null);else{var P=d.indexOf(":"),A=d.indexOf("/"),L=d.indexOf(":",P+1);L!==-1&&(A===-1||L<A)?(p.hostname=d.substring(0,y)||null,p.port=null):(M=d.substring(0,y).split(":"),p.hostname=M[0]||null,p.port=M[1]||null)}return p.hostname&&d.substring(y).charAt(0)!=="/"&&(y++,d="/"+d),p.preventInvalidHostname&&o.ensureValidHostname(p.hostname,p.protocol),p.port&&o.ensureValidPort(p.port),d.substring(y)||"/"},o.parseAuthority=function(d,p){return d=o.parseUserinfo(d,p),o.parseHost(d,p)},o.parseUserinfo=function(d,p){var y=d,b=d.indexOf("\\");b!==-1&&(d=d.replace(/\\/g,"/"));var M=d.indexOf("/"),P=d.lastIndexOf("@",M>-1?M:d.length-1),A;return P>-1&&(M===-1||P<M)?(A=d.substring(0,P).split(":"),p.username=A[0]?o.decode(A[0]):null,A.shift(),p.password=A[0]?o.decode(A.join(":")):null,d=y.substring(P+1)):(p.username=null,p.password=null),d},o.parseQuery=function(d,p){if(!d)return{};if(d=d.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!d)return{};for(var y={},b=d.split("&"),M=b.length,P,A,L,D=0;D<M;D++)P=b[D].split("="),A=o.decodeQuery(P.shift(),p),L=P.length?o.decodeQuery(P.join("="),p):null,A!=="__proto__"&&(h.call(y,A)?((typeof y[A]=="string"||y[A]===null)&&(y[A]=[y[A]]),y[A].push(L)):y[A]=L);return y},o.build=function(d){var p="",y=!1;return d.protocol&&(p+=d.protocol+":"),!d.urn&&(p||d.hostname)&&(p+="//",y=!0),p+=o.buildAuthority(d)||"",typeof d.path=="string"&&(d.path.charAt(0)!=="/"&&y&&(p+="/"),p+=d.path),typeof d.query=="string"&&d.query&&(p+="?"+d.query),typeof d.fragment=="string"&&d.fragment&&(p+="#"+d.fragment),p},o.buildHost=function(d){var p="";if(d.hostname)o.ip6_expression.test(d.hostname)?p+="["+d.hostname+"]":p+=d.hostname;else return"";return d.port&&(p+=":"+d.port),p},o.buildAuthority=function(d){return o.buildUserinfo(d)+o.buildHost(d)},o.buildUserinfo=function(d){var p="";return d.username&&(p+=o.encode(d.username)),d.password&&(p+=":"+o.encode(d.password)),p&&(p+="@"),p},o.buildQuery=function(d,p,y){var b="",M,P,A,L;for(P in d)if(P!=="__proto__"&&h.call(d,P))if(f(d[P]))for(M={},A=0,L=d[P].length;A<L;A++)d[P][A]!==void 0&&M[d[P][A]+""]===void 0&&(b+="&"+o.buildQueryParameter(P,d[P][A],y),p!==!0&&(M[d[P][A]+""]=!0));else d[P]!==void 0&&(b+="&"+o.buildQueryParameter(P,d[P],y));return b.substring(1)},o.buildQueryParameter=function(d,p,y){return o.encodeQuery(d,y)+(p!==null?"="+o.encodeQuery(p,y):"")},o.addQuery=function(d,p,y){if(typeof p=="object")for(var b in p)h.call(p,b)&&o.addQuery(d,b,p[b]);else if(typeof p=="string"){if(d[p]===void 0){d[p]=y;return}else typeof d[p]=="string"&&(d[p]=[d[p]]);f(y)||(y=[y]),d[p]=(d[p]||[]).concat(y)}else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter")},o.setQuery=function(d,p,y){if(typeof p=="object")for(var b in p)h.call(p,b)&&o.setQuery(d,b,p[b]);else if(typeof p=="string")d[p]=y===void 0?null:y;else throw new TypeError("URI.setQuery() accepts an object, string as the name parameter")},o.removeQuery=function(d,p,y){var b,M,P;if(f(p))for(b=0,M=p.length;b<M;b++)d[p[b]]=void 0;else if(c(p)==="RegExp")for(P in d)p.test(P)&&(d[P]=void 0);else if(typeof p=="object")for(P in p)h.call(p,P)&&o.removeQuery(d,P,p[P]);else if(typeof p=="string")y!==void 0?c(y)==="RegExp"?!f(d[p])&&y.test(d[p])?d[p]=void 0:d[p]=g(d[p],y):d[p]===String(y)&&(!f(y)||y.length===1)?d[p]=void 0:f(d[p])&&(d[p]=g(d[p],y)):d[p]=void 0;else throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter")},o.hasQuery=function(d,p,y,b){switch(c(p)){case"String":break;case"RegExp":for(var M in d)if(h.call(d,M)&&p.test(M)&&(y===void 0||o.hasQuery(d,M,y)))return!0;return!1;case"Object":for(var P in p)if(h.call(p,P)&&!o.hasQuery(d,P,p[P]))return!1;return!0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(c(y)){case"Undefined":return p in d;case"Boolean":var A=!!(f(d[p])?d[p].length:d[p]);return y===A;case"Function":return!!y(d[p],p,d);case"Array":if(!f(d[p]))return!1;var L=b?m:_;return L(d[p],y);case"RegExp":return f(d[p])?b?m(d[p],y):!1:!!(d[p]&&d[p].match(y));case"Number":y=String(y);case"String":return f(d[p])?b?m(d[p],y):!1:d[p]===y;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},o.joinPaths=function(){for(var d=[],p=[],y=0,b=0;b<arguments.length;b++){var M=new o(arguments[b]);d.push(M);for(var P=M.segment(),A=0;A<P.length;A++)typeof P[A]=="string"&&p.push(P[A]),P[A]&&y++}if(!p.length||!y)return new o("");var L=new o("").segment(p);return(d[0].path()===""||d[0].path().slice(0,1)==="/")&&L.path("/"+L.path()),L.normalize()},o.commonPath=function(d,p){var y=Math.min(d.length,p.length),b;for(b=0;b<y;b++)if(d.charAt(b)!==p.charAt(b)){b--;break}return b<1?d.charAt(0)===p.charAt(0)&&d.charAt(0)==="/"?"/":"":((d.charAt(b)!=="/"||p.charAt(b)!=="/")&&(b=d.substring(0,b).lastIndexOf("/")),d.substring(0,b+1))},o.withinString=function(d,p,y){y||(y={});var b=y.start||o.findUri.start,M=y.end||o.findUri.end,P=y.trim||o.findUri.trim,A=y.parens||o.findUri.parens,L=/[a-z0-9-]=["']?$/i;for(b.lastIndex=0;;){var D=b.exec(d);if(!D)break;var X=D.index;if(y.ignoreHtml){var K=d.slice(Math.max(X-3,0),X);if(K&&L.test(K))continue}for(var G=X+d.slice(X).search(M),H=d.slice(X,G),Q=-1;;){var nt=A.exec(H);if(!nt)break;var xt=nt.index+nt[0].length;Q=Math.max(Q,xt)}if(Q>-1?H=H.slice(0,Q)+H.slice(Q).replace(P,""):H=H.replace(P,""),!(H.length<=D[0].length)&&!(y.ignore&&y.ignore.test(H))){G=X+H.length;var dt=p(H,X,G,d);if(dt===void 0){b.lastIndex=G;continue}dt=String(dt),d=d.slice(0,X)+dt+d.slice(G),b.lastIndex=X+dt.length}}return b.lastIndex=0,d},o.ensureValidHostname=function(d,p){var y=!!d,b=!!p,M=!1;if(b&&(M=m(o.hostProtocols,p)),M&&!y)throw new TypeError("Hostname cannot be empty, if protocol is "+p);if(d&&d.match(o.invalid_hostname_characters)){if(!t)throw new TypeError('Hostname "'+d+'" contains characters other than [A-Z0-9.-:_] and Punycode.js is not available');if(t.toASCII(d).match(o.invalid_hostname_characters))throw new TypeError('Hostname "'+d+'" contains characters other than [A-Z0-9.-:_]')}},o.ensureValidPort=function(d){if(d){var p=Number(d);if(!(a(p)&&p>0&&p<65536))throw new TypeError('Port "'+d+'" is not a valid port')}},o.noConflict=function(d){if(d){var p={URI:this.noConflict()};return i.URITemplate&&typeof i.URITemplate.noConflict=="function"&&(p.URITemplate=i.URITemplate.noConflict()),i.IPv6&&typeof i.IPv6.noConflict=="function"&&(p.IPv6=i.IPv6.noConflict()),i.SecondLevelDomains&&typeof i.SecondLevelDomains.noConflict=="function"&&(p.SecondLevelDomains=i.SecondLevelDomains.noConflict()),p}else i.URI===this&&(i.URI=s);return this},l.build=function(d){return d===!0?this._deferred_build=!0:(d===void 0||this._deferred_build)&&(this._string=o.build(this._parts),this._deferred_build=!1),this},l.clone=function(){return new o(this)},l.valueOf=l.toString=function(){return this.build(!1)._string};function C(d){return function(p,y){return p===void 0?this._parts[d]||"":(this._parts[d]=p||null,this.build(!y),this)}}function I(d,p){return function(y,b){return y===void 0?this._parts[d]||"":(y!==null&&(y=y+"",y.charAt(0)===p&&(y=y.substring(1))),this._parts[d]=y,this.build(!b),this)}}l.protocol=C("protocol"),l.username=C("username"),l.password=C("password"),l.hostname=C("hostname"),l.port=C("port"),l.query=I("query","?"),l.fragment=I("fragment","#"),l.search=function(d,p){var y=this.query(d,p);return typeof y=="string"&&y.length?"?"+y:y},l.hash=function(d,p){var y=this.fragment(d,p);return typeof y=="string"&&y.length?"#"+y:y},l.pathname=function(d,p){if(d===void 0||d===!0){var y=this._parts.path||(this._parts.hostname?"/":"");return d?(this._parts.urn?o.decodeUrnPath:o.decodePath)(y):y}else return this._parts.urn?this._parts.path=d?o.recodeUrnPath(d):"":this._parts.path=d?o.recodePath(d):"/",this.build(!p),this},l.path=l.pathname,l.href=function(d,p){var y;if(d===void 0)return this.toString();this._string="",this._parts=o._parts();var b=d instanceof o,M=typeof d=="object"&&(d.hostname||d.path||d.pathname);if(d.nodeName){var P=o.getDomAttribute(d);d=d[P]||"",M=!1}if(!b&&M&&d.pathname!==void 0&&(d=d.toString()),typeof d=="string"||d instanceof String)this._parts=o.parse(String(d),this._parts);else if(b||M){var A=b?d._parts:d;for(y in A)y!=="query"&&h.call(this._parts,y)&&(this._parts[y]=A[y]);A.query&&this.query(A.query,!1)}else throw new TypeError("invalid input");return this.build(!p),this},l.is=function(d){var p=!1,y=!1,b=!1,M=!1,P=!1,A=!1,L=!1,D=!this._parts.urn;switch(this._parts.hostname&&(D=!1,y=o.ip4_expression.test(this._parts.hostname),b=o.ip6_expression.test(this._parts.hostname),p=y||b,M=!p,P=M&&n&&n.has(this._parts.hostname),A=M&&o.idn_expression.test(this._parts.hostname),L=M&&o.punycode_expression.test(this._parts.hostname)),d.toLowerCase()){case"relative":return D;case"absolute":return!D;case"domain":case"name":return M;case"sld":return P;case"ip":return p;case"ip4":case"ipv4":case"inet4":return y;case"ip6":case"ipv6":case"inet6":return b;case"idn":return A;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return L}return null};var F=l.protocol,U=l.port,j=l.hostname;l.protocol=function(d,p){if(d&&(d=d.replace(/:(\/\/)?$/,""),!d.match(o.protocol_expression)))throw new TypeError('Protocol "'+d+`" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]`);return F.call(this,d,p)},l.scheme=l.protocol,l.port=function(d,p){return this._parts.urn?d===void 0?"":this:(d!==void 0&&(d===0&&(d=null),d&&(d+="",d.charAt(0)===":"&&(d=d.substring(1)),o.ensureValidPort(d))),U.call(this,d,p))},l.hostname=function(d,p){if(this._parts.urn)return d===void 0?"":this;if(d!==void 0){var y={preventInvalidHostname:this._parts.preventInvalidHostname},b=o.parseHost(d,y);if(b!=="/")throw new TypeError('Hostname "'+d+'" contains characters other than [A-Z0-9.-]');d=y.hostname,this._parts.preventInvalidHostname&&o.ensureValidHostname(d,this._parts.protocol)}return j.call(this,d,p)},l.origin=function(d,p){if(this._parts.urn)return d===void 0?"":this;if(d===void 0){var y=this.protocol(),b=this.authority();return b?(y?y+"://":"")+this.authority():""}else{var M=o(d);return this.protocol(M.protocol()).authority(M.authority()).build(!p),this}},l.host=function(d,p){if(this._parts.urn)return d===void 0?"":this;if(d===void 0)return this._parts.hostname?o.buildHost(this._parts):"";var y=o.parseHost(d,this._parts);if(y!=="/")throw new TypeError('Hostname "'+d+'" contains characters other than [A-Z0-9.-]');return this.build(!p),this},l.authority=function(d,p){if(this._parts.urn)return d===void 0?"":this;if(d===void 0)return this._parts.hostname?o.buildAuthority(this._parts):"";var y=o.parseAuthority(d,this._parts);if(y!=="/")throw new TypeError('Hostname "'+d+'" contains characters other than [A-Z0-9.-]');return this.build(!p),this},l.userinfo=function(d,p){if(this._parts.urn)return d===void 0?"":this;if(d===void 0){var y=o.buildUserinfo(this._parts);return y&&y.substring(0,y.length-1)}else return d[d.length-1]!=="@"&&(d+="@"),o.parseUserinfo(d,this._parts),this.build(!p),this},l.resource=function(d,p){var y;return d===void 0?this.path()+this.search()+this.hash():(y=o.parse(d),this._parts.path=y.path,this._parts.query=y.query,this._parts.fragment=y.fragment,this.build(!p),this)},l.subdomain=function(d,p){if(this._parts.urn)return d===void 0?"":this;if(d===void 0){if(!this._parts.hostname||this.is("IP"))return"";var y=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,y)||""}else{var b=this._parts.hostname.length-this.domain().length,M=this._parts.hostname.substring(0,b),P=new RegExp("^"+u(M));if(d&&d.charAt(d.length-1)!=="."&&(d+="."),d.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");return d&&o.ensureValidHostname(d,this._parts.protocol),this._parts.hostname=this._parts.hostname.replace(P,d),this.build(!p),this}},l.domain=function(d,p){if(this._parts.urn)return d===void 0?"":this;if(typeof d=="boolean"&&(p=d,d=void 0),d===void 0){if(!this._parts.hostname||this.is("IP"))return"";var y=this._parts.hostname.match(/\./g);if(y&&y.length<2)return this._parts.hostname;var b=this._parts.hostname.length-this.tld(p).length-1;return b=this._parts.hostname.lastIndexOf(".",b-1)+1,this._parts.hostname.substring(b)||""}else{if(!d)throw new TypeError("cannot set domain empty");if(d.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");if(o.ensureValidHostname(d,this._parts.protocol),!this._parts.hostname||this.is("IP"))this._parts.hostname=d;else{var M=new RegExp(u(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(M,d)}return this.build(!p),this}},l.tld=function(d,p){if(this._parts.urn)return d===void 0?"":this;if(typeof d=="boolean"&&(p=d,d=void 0),d===void 0){if(!this._parts.hostname||this.is("IP"))return"";var y=this._parts.hostname.lastIndexOf("."),b=this._parts.hostname.substring(y+1);return p!==!0&&n&&n.list[b.toLowerCase()]&&n.get(this._parts.hostname)||b}else{var M;if(d)if(d.match(/[^a-zA-Z0-9-]/))if(n&&n.is(d))M=new RegExp(u(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(M,d);else throw new TypeError('TLD "'+d+'" contains characters other than [A-Z0-9]');else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");M=new RegExp(u(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(M,d)}else throw new TypeError("cannot set TLD empty");return this.build(!p),this}},l.directory=function(d,p){if(this._parts.urn)return d===void 0?"":this;if(d===void 0||d===!0){if(!this._parts.path&&!this._parts.hostname)return"";if(this._parts.path==="/")return"/";var y=this._parts.path.length-this.filename().length-1,b=this._parts.path.substring(0,y)||(this._parts.hostname?"/":"");return d?o.decodePath(b):b}else{var M=this._parts.path.length-this.filename().length,P=this._parts.path.substring(0,M),A=new RegExp("^"+u(P));return this.is("relative")||(d||(d="/"),d.charAt(0)!=="/"&&(d="/"+d)),d&&d.charAt(d.length-1)!=="/"&&(d+="/"),d=o.recodePath(d),this._parts.path=this._parts.path.replace(A,d),this.build(!p),this}},l.filename=function(d,p){if(this._parts.urn)return d===void 0?"":this;if(typeof d!="string"){if(!this._parts.path||this._parts.path==="/")return"";var y=this._parts.path.lastIndexOf("/"),b=this._parts.path.substring(y+1);return d?o.decodePathSegment(b):b}else{var M=!1;d.charAt(0)==="/"&&(d=d.substring(1)),d.match(/\.?\//)&&(M=!0);var P=new RegExp(u(this.filename())+"$");return d=o.recodePath(d),this._parts.path=this._parts.path.replace(P,d),M?this.normalizePath(p):this.build(!p),this}},l.suffix=function(d,p){if(this._parts.urn)return d===void 0?"":this;if(d===void 0||d===!0){if(!this._parts.path||this._parts.path==="/")return"";var y=this.filename(),b=y.lastIndexOf("."),M,P;return b===-1?"":(M=y.substring(b+1),P=/^[a-z0-9%]+$/i.test(M)?M:"",d?o.decodePathSegment(P):P)}else{d.charAt(0)==="."&&(d=d.substring(1));var A=this.suffix(),L;if(A)d?L=new RegExp(u(A)+"$"):L=new RegExp(u("."+A)+"$");else{if(!d)return this;this._parts.path+="."+o.recodePath(d)}return L&&(d=o.recodePath(d),this._parts.path=this._parts.path.replace(L,d)),this.build(!p),this}},l.segment=function(d,p,y){var b=this._parts.urn?":":"/",M=this.path(),P=M.substring(0,1)==="/",A=M.split(b);if(d!==void 0&&typeof d!="number"&&(y=p,p=d,d=void 0),d!==void 0&&typeof d!="number")throw new Error('Bad segment "'+d+'", must be 0-based integer');if(P&&A.shift(),d<0&&(d=Math.max(A.length+d,0)),p===void 0)return d===void 0?A:A[d];if(d===null||A[d]===void 0)if(f(p)){A=[];for(var L=0,D=p.length;L<D;L++)!p[L].length&&(!A.length||!A[A.length-1].length)||(A.length&&!A[A.length-1].length&&A.pop(),A.push(x(p[L])))}else(p||typeof p=="string")&&(p=x(p),A[A.length-1]===""?A[A.length-1]=p:A.push(p));else p?A[d]=x(p):A.splice(d,1);return P&&A.unshift(""),this.path(A.join(b),y)},l.segmentCoded=function(d,p,y){var b,M,P;if(typeof d!="number"&&(y=p,p=d,d=void 0),p===void 0){if(b=this.segment(d,p,y),!f(b))b=b!==void 0?o.decode(b):void 0;else for(M=0,P=b.length;M<P;M++)b[M]=o.decode(b[M]);return b}if(!f(p))p=typeof p=="string"||p instanceof String?o.encode(p):p;else for(M=0,P=p.length;M<P;M++)p[M]=o.encode(p[M]);return this.segment(d,p,y)};var B=l.query;return l.query=function(d,p){if(d===!0)return o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof d=="function"){var y=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace),b=d.call(this,y);return this._parts.query=o.buildQuery(b||y,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!p),this}else return d!==void 0&&typeof d!="string"?(this._parts.query=o.buildQuery(d,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!p),this):B.call(this,d,p)},l.setQuery=function(d,p,y){var b=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof d=="string"||d instanceof String)b[d]=p!==void 0?p:null;else if(typeof d=="object")for(var M in d)h.call(d,M)&&(b[M]=d[M]);else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");return this._parts.query=o.buildQuery(b,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof d!="string"&&(y=p),this.build(!y),this},l.addQuery=function(d,p,y){var b=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.addQuery(b,d,p===void 0?null:p),this._parts.query=o.buildQuery(b,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof d!="string"&&(y=p),this.build(!y),this},l.removeQuery=function(d,p,y){var b=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.removeQuery(b,d,p),this._parts.query=o.buildQuery(b,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof d!="string"&&(y=p),this.build(!y),this},l.hasQuery=function(d,p,y){var b=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.hasQuery(b,d,p,y)},l.setSearch=l.setQuery,l.addSearch=l.addQuery,l.removeSearch=l.removeQuery,l.hasSearch=l.hasQuery,l.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},l.normalizeProtocol=function(d){return typeof this._parts.protocol=="string"&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!d)),this},l.normalizeHostname=function(d){return this._parts.hostname&&(this.is("IDN")&&t?this._parts.hostname=t.toASCII(this._parts.hostname):this.is("IPv6")&&e&&(this._parts.hostname=e.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!d)),this},l.normalizePort=function(d){return typeof this._parts.protocol=="string"&&this._parts.port===o.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!d)),this},l.normalizePath=function(d){var p=this._parts.path;if(!p)return this;if(this._parts.urn)return this._parts.path=o.recodeUrnPath(this._parts.path),this.build(!d),this;if(this._parts.path==="/")return this;p=o.recodePath(p);var y,b="",M,P;for(p.charAt(0)!=="/"&&(y=!0,p="/"+p),(p.slice(-3)==="/.."||p.slice(-2)==="/.")&&(p+="/"),p=p.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),y&&(b=p.substring(1).match(/^(\.\.\/)+/)||"",b&&(b=b[0]));M=p.search(/\/\.\.(\/|$)/),M!==-1;){if(M===0){p=p.substring(3);continue}P=p.substring(0,M).lastIndexOf("/"),P===-1&&(P=M),p=p.substring(0,P)+p.substring(M+3)}return y&&this.is("relative")&&(p=b+p.substring(1)),this._parts.path=p,this.build(!d),this},l.normalizePathname=l.normalizePath,l.normalizeQuery=function(d){return typeof this._parts.query=="string"&&(this._parts.query.length?this.query(o.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!d)),this},l.normalizeFragment=function(d){return this._parts.fragment||(this._parts.fragment=null,this.build(!d)),this},l.normalizeSearch=l.normalizeQuery,l.normalizeHash=l.normalizeFragment,l.iso8859=function(){var d=o.encode,p=o.decode;o.encode=escape,o.decode=decodeURIComponent;try{this.normalize()}finally{o.encode=d,o.decode=p}return this},l.unicode=function(){var d=o.encode,p=o.decode;o.encode=w,o.decode=unescape;try{this.normalize()}finally{o.encode=d,o.decode=p}return this},l.readable=function(){var d=this.clone();d.username("").password("").normalize();var p="";if(d._parts.protocol&&(p+=d._parts.protocol+"://"),d._parts.hostname&&(d.is("punycode")&&t?(p+=t.toUnicode(d._parts.hostname),d._parts.port&&(p+=":"+d._parts.port)):p+=d.host()),d._parts.hostname&&d._parts.path&&d._parts.path.charAt(0)!=="/"&&(p+="/"),p+=d.path(!0),d._parts.query){for(var y="",b=0,M=d._parts.query.split("&"),P=M.length;b<P;b++){var A=(M[b]||"").split("=");y+="&"+o.decodeQuery(A[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),A[1]!==void 0&&(y+="="+o.decodeQuery(A[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}p+="?"+y.substring(1)}return p+=o.decodeQuery(d.hash(),!0),p},l.absoluteTo=function(d){var p=this.clone(),y=["protocol","username","password","hostname","port"],b,M,P;if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(d instanceof o||(d=new o(d)),p._parts.protocol||(p._parts.protocol=d._parts.protocol,this._parts.hostname))return p;for(M=0;P=y[M];M++)p._parts[P]=d._parts[P];return p._parts.path?(p._parts.path.substring(-2)===".."&&(p._parts.path+="/"),p.path().charAt(0)!=="/"&&(b=d.directory(),b=b||(d.path().indexOf("/")===0?"/":""),p._parts.path=(b?b+"/":"")+p._parts.path,p.normalizePath())):(p._parts.path=d._parts.path,p._parts.query||(p._parts.query=d._parts.query)),p.build(),p},l.relativeTo=function(d){var p=this.clone().normalize(),y,b,M,P,A;if(p._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(d=new o(d).normalize(),y=p._parts,b=d._parts,P=p.path(),A=d.path(),P.charAt(0)!=="/")throw new Error("URI is already relative");if(A.charAt(0)!=="/")throw new Error("Cannot calculate a URI relative to another relative URI");if(y.protocol===b.protocol&&(y.protocol=null),y.username!==b.username||y.password!==b.password||y.protocol!==null||y.username!==null||y.password!==null)return p.build();if(y.hostname===b.hostname&&y.port===b.port)y.hostname=null,y.port=null;else return p.build();if(P===A)return y.path="",p.build();if(M=o.commonPath(P,A),!M)return p.build();var L=b.path.substring(M.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return y.path=L+y.path.substring(M.length)||"./",p.build()},l.equals=function(d){var p=this.clone(),y=new o(d),b={},M={},P={},A,L,D;if(p.normalize(),y.normalize(),p.toString()===y.toString())return!0;if(A=p.query(),L=y.query(),p.query(""),y.query(""),p.toString()!==y.toString()||A.length!==L.length)return!1;b=o.parseQuery(A,this._parts.escapeQuerySpace),M=o.parseQuery(L,this._parts.escapeQuerySpace);for(D in b)if(h.call(b,D)){if(f(b[D])){if(!_(b[D],M[D]))return!1}else if(b[D]!==M[D])return!1;P[D]=!0}for(D in M)if(h.call(M,D)&&!P[D])return!1;return!0},l.preventInvalidHostname=function(d){return this._parts.preventInvalidHostname=!!d,this},l.duplicateQueryParameters=function(d){return this._parts.duplicateQueryParameters=!!d,this},l.escapeQuerySpace=function(d){return this._parts.escapeQuerySpace=!!d,this},o})})(Om);var dx=Om.exports;const Bu=ax(dx),eg=["http","https"];function fx(r){return typeof r=="string"&&r.startsWith("/vsi")&&!r.startsWith("/vsicurl/")}function wl(r,t,e=!0){return gx(r,t,!1,e)}function gx(r,t=null,e=!1,n=!0){typeof r=="string"&&r.startsWith("/vsicurl/")&&(r=r.replace(/^\/vsicurl\//,""));let i=Bu(r);if(t&&i.is("relative")&&!fx(r)){let s=Bu(t),o=s.path();!o.endsWith("/")&&!o.endsWith(".json")&&s.path(o+"/"),i=i.absoluteTo(s)}return i.normalize(),e&&(i.query(""),i.fragment("")),n?i.toString():i}var px={exports:{}};(function(r,t){(function(e,n){r.exports=n()})(Pi,function(){var e=/^v?(?:\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+))?(?:-[\da-z\-]+(?:\.[\da-z\-]+)*)?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i;function n(c,f){return c.indexOf(f)===-1?c.length:c.indexOf(f)}function i(c){var f=c.replace(/^v/,"").replace(/\+.*$/,""),g=n(f,"-"),m=f.substring(0,g).split(".");return m.push(f.substring(g+1)),m}function s(c){return isNaN(Number(c))?c:Number(c)}function o(c){if(typeof c!="string")throw new TypeError("Invalid argument expected string");if(!e.test(c))throw new Error("Invalid argument not valid semver ('"+c+"' received)")}function a(c,f){[c,f].forEach(o);for(var g=i(c),m=i(f),_=0;_<Math.max(g.length-1,m.length-1);_++){var x=parseInt(g[_]||0,10),v=parseInt(m[_]||0,10);if(x>v)return 1;if(v>x)return-1}var w=g[g.length-1],S=m[m.length-1];if(w&&S){var E=w.split(".").map(s),T=S.split(".").map(s);for(_=0;_<Math.max(E.length,T.length);_++){if(E[_]===void 0||typeof T[_]=="string"&&typeof E[_]=="number")return-1;if(T[_]===void 0||typeof E[_]=="string"&&typeof T[_]=="number"||E[_]>T[_])return 1;if(T[_]>E[_])return-1}}else if(w||S)return w?-1:1;return 0}var l=[">",">=","=","<","<="],h={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]};function u(c){if(typeof c!="string")throw new TypeError("Invalid operator type, expected string but got "+typeof c);if(l.indexOf(c)===-1)throw new TypeError("Invalid operator, expected one of "+l.join("|"))}return a.validate=function(c){return typeof c=="string"&&e.test(c)},a.compare=function(c,f,g){u(g);var m=a(c,f);return h[g].indexOf(m)>-1},a})})(px);const Te={classification:"https://stac-extensions.github.io/classification/v1.1.0/schema.json",datacube:"https://stac-extensions.github.io/datacube/v2.1.0/schema.json",eo:"https://stac-extensions.github.io/eo/v1.0.0/schema.json",file:"https://stac-extensions.github.io/file/v1.0.0/schema.json","item-assets":"https://stac-extensions.github.io/item-assets/v1.0.0/schema.json",label:"https://stac-extensions.github.io/label/v1.0.1/schema.json",pointcloud:"https://stac-extensions.github.io/pointcloud/v1.0.0/schema.json",processing:"https://stac-extensions.github.io/processing/v1.1.0/schema.json",projection:"https://stac-extensions.github.io/projection/v1.0.0/schema.json",raster:"https://stac-extensions.github.io/raster/v1.1.0/schema.json",sar:"https://stac-extensions.github.io/sar/v1.0.0/schema.json",sat:"https://stac-extensions.github.io/sat/v1.0.0/schema.json",scientific:"https://stac-extensions.github.io/scientific/v1.0.0/schema.json",table:"https://stac-extensions.github.io/table/v1.2.0/schema.json",timestamps:"https://stac-extensions.github.io/timestamps/v1.0.0/schema.json",version:"https://stac-extensions.github.io/version/v1.0.0/schema.json",view:"https://stac-extensions.github.io/view/v1.0.0/schema.json"},Ts={itemAndCollection:{"cube:":Te.datacube,"eo:":Te.eo,"file:":Te.file,"label:":Te.label,"pc:":Te.pointcloud,"processing:":Te.processing,"proj:":Te.projection,"raster:":Te.raster,"sar:":Te.sar,"sat:":Te.sat,"sci:":Te.scientific,"view:":Te.view,version:Te.version,deprecated:Te.version,published:Te.timestamps,expires:Te.timestamps,unpublished:Te.timestamps},catalog:{},collection:{item_assets:Te["item-assets"]},item:{}};Ts.collection=Object.assign(Ts.collection,Ts.itemAndCollection);Ts.item=Object.assign(Ts.item,Ts.itemAndCollection);function pa(r){let t=r.length>=6,e=r[0],n=r[t?3:2],i=r[1],s=r[t?4:3],o={west:e,east:n,south:i,north:s};return t&&(o.base=r[2],o.height=r[5]),o}function iu(r){let{west:t,east:e,south:n,north:i}=pa(r);return[[[t,i],[t,n],[e,n],[e,i],[t,i]]]}function mx(r){if(!In(r))return null;let t=pa(r),e=[];if(Fm(r)){let n=(t.west+360+t.east)/2;n>180&&(n-=360),e.push(n)}else e.push((t.west+t.east)/2);return e.push((t.south+t.north)/2),typeof t.base<"u"&&e.push((t.base+t.height)/2),e}function _x(r){if(In(r)?r=[r]:Array.isArray(r)&&(r=r.filter(n=>In(n))),!Array.isArray(r)||r.length===0)return null;let t=r.reduce((n,i)=>{if(Fm(i)){let{west:s,east:o,south:a,north:l}=pa(i);n.push(iu([-180,a,o,l])),n.push(iu([s,a,180,l]))}else n.push(iu(i));return n},[]),e=null;if(t.length===1?e={type:"Polygon",coordinates:t[0]}:t.length>1&&(e={type:"MultiPolygon",coordinates:t}),e)return{type:"Feature",geometry:e,properties:{}}}function In(r){if(!Array.isArray(r)||![4,6].includes(r.length)||r.some(s=>typeof s!="number"))return!1;let{west:t,east:e,south:n,north:i}=pa(r);return n<=i&&t>=-180&&t<=180&&n>=-90&&e<=180&&e>=-180&&i<=90}function Fm(r){if(!In(r))return!1;let{west:t,east:e}=pa(r);return t>e}function sr(r){return typeof r=="string"&&r.length>0}function tr(r){return typeof r=="object"&&r===Object(r)&&!Array.isArray(r)}function Nm(...r){if(r=r.filter(t=>Array.isArray(t)),r.length>1){let t=Math.max(...r.map(n=>n.length)),e=[];for(let n=0;n<t;n++)e.push(Object.assign({},...r.map(i=>i[n])));return e}else if(r.length===1)return r[0];return[]}function yx(r){switch(r){case"int8":return-128;case"int16":return-32768;case"int32":return-2147483648}return r.startsWith("u")?0:null}function xx(r){switch(r){case"int8":return 127;case"uint8":return 255;case"int16":return 32767;case"uint16":return 65535;case"int32":return 2147483647;case"uint32":return 4294967295}return null}class oh{constructor(t,e={},n=[]){if(!tr(t))throw new Error("Given data is not an object");if(t instanceof oh){for(let i of n)this[i]=t[i];t=t.toJSON()}this._keyMap=e,this._privateKeys=["_keyMap","_privateKeys"].concat(n);for(let i in t)typeof this[i]>"u"&&(i in e?this[i]=e[i](t[i],this):this[i]=t[i])}isItem(){return this.type==="Feature"}isCatalog(){return this.type==="Catalog"}isCatalogLike(){return this.isCatalog()||this.isCollection()}isCollection(){return this.type==="Collection"}isItemCollection(){return this.type==="FeatureCollection"}isCollectionCollection(){return!1}isAsset(){return!1}isLink(){return!1}getObjectType(){}getAbsoluteUrl(){return null}getMetadata(t){return this[t]}toGeoJSON(){return null}getBoundingBox(){return null}getCenter(){return mx(this.getBoundingBox())}getBoundingBoxes(){return[]}toJSON(){let t={};return Object.keys(this).forEach(e=>{if(typeof this[e]=="function"||this._privateKeys.includes(e))return;let n=this[e];if(e in this._keyMap){let i=Array.isArray(n)?[]:{};for(let s in n)i[s]=n[s].toJSON();n=i}t[e]=n}),t}}const vx="application/geo+json",wx=["application/json",vx,"text/json"],rg=["image/gif","image/jpeg","image/apng","image/png","image/webp"],Dm=["image/tiff; application=geotiff; profile=cloud-optimized","image/vnd.stac.geotiff; cloud-optimized=true"],km=["application/geotiff","image/tiff; application=geotiff","image/vnd.stac.geotiff"].concat(Dm);function Ac(r,t,e=!1){return Array.isArray(t)||(t=[t]),e&&typeof r>"u"?!0:typeof r!="string"?!1:(t=t.map(n=>n.toLowerCase()),t.includes(r.toLowerCase()))}function bx(r,t=!1){return Ac(r,wx,t)}class Gm extends oh{constructor(t,e=null,n={},i=[]){super(t,n,["_context"].concat(i)),this._context||(this._context=e)}getAbsoluteUrl(t=!0){return this._context?wl(this.href,this._context.getAbsoluteUrl(),t):this.href.includes("://")?this.href:null}getContext(){return this._context}canBrowserDisplayImage(t=!1){if(typeof this.href!="string")return!1;if(!t&&typeof this.type>"u")return!1;let e=new Bu(this.href),n=e.protocol().toLowerCase(),i=e.suffix().toLowerCase();return sr(n)&&!eg.includes(n)?!1:sr(this.type)&&rg.includes(this.type.toLowerCase())?!0:!!(typeof this.type>"u"&&sr(i)&&(i==="jpg"||rg.includes("image/"+i)))}isType(t){return sr(this.type)&&Ac(this.type,t)}isGeoTIFF(){return this.isType(km)}isCOG(){return this.isType(Dm)}isHTTP(){let e=this.getAbsoluteUrl(!1).protocol().toLowerCase();return sr(e)&&eg.includes(e)}}class Lc extends Gm{constructor(t,e=null){super(t,e)}isLink(){return!0}getObjectType(){return"Link"}static fromLinks(t,e=null){return Array.isArray(t)?t.map(n=>tr(n)?new Lc(n,e):n):[]}}class Sx extends oh{constructor(t,e=null,n={},i=[]){if(super(t,Object.assign({links:Lc.fromLinks},n),["_url"].concat(i)),!this._url&&(this._url=e,!this._url)){let s=this.getSelfLink();s&&(this._url=s.href)}}getAbsoluteUrl(){return this._url}setAbsoluteUrl(t){this._url=t}getStacLinksWithRel(t,e=!0){return this.getLinksWithRels([t]).filter(n=>bx(n.type,e))}getStacLinkWithRel(t,e=!0){const n=this.getStacLinksWithRel(t,e);return n.length>0?n[0]:null}getLinks(){return Array.isArray(this.links)?this.links.filter(t=>tr(t)&&sr(t.href)):[]}getLinkWithRel(t){return this.getLinks().find(e=>e.rel===t)||null}getLinksWithRels(t){return this.getLinks().filter(e=>t.includes(e.rel))}getLinksWithOtherRels(t){return this.getLinks().filter(e=>!t.includes(e.rel))}getSelfLink(){return this.getStacLinkWithRel("self")}getRootLink(){return this.getStacLinkWithRel("root")}getParentLink(){return this.getStacLinkWithRel("parent")}}class Zo extends Gm{constructor(t,e=null,n=null){super(t,n,{},["_key"]),this._key||(this._key=e)}getObjectType(){return"Asset"}isAsset(){return!0}getAbsoluteUrl(t=!0){return this.isDefinition()?null:super.getAbsoluteUrl(t)}getKey(){return this._key}getMetadata(t){if(typeof this[t]<"u")return this[t];if(this._context)return this._context.getMetadata(t)}getBands(){return Nm(this["eo:bands"],this["raster:bands"])}findVisualBands(){let t={red:null,green:null,blue:null},e=this.getBands();for(let i in e){let s=parseInt(i,10),o=e[s];tr(o)&&sr(o.common_name)&&o.common_name in t&&(t[o.common_name]={index:s,band:o})}return Object.values(t).every(i=>i!==null)?t:null}findBand(t,e="name",n=null){Array.isArray(t)||(t=[t]),tr(n)||(n=this.getBands());let i=n.findIndex(s=>tr(s)&&t.includes(s[e]));return i>=0?{index:i,band:n[i]}:null}getBand(t){return tr(t)||t===null?t:this.getBands()[t]||null}getMinMaxValues(t=null){t=this.getBand(t);const e={minimum:null,maximum:null},n=a=>a.minimum!==null&&a.maximum!==null;if(t&&(tr(t.statistics)&&(typeof t.statistics.minimum=="number"&&(e.minimum=t.statistics.minimum),typeof t.statistics.maximum=="number"&&(e.maximum=t.statistics.maximum),n(e))||tr(t.histogram)&&(typeof t.histogram.min=="number"&&(e.minimum=t.histogram.min),typeof t.histogram.max=="number"&&(e.maximum=t.histogram.max),n(e))))return e;let i=this.getMetadata("classification:classes");if(Array.isArray(i)&&(i.reduce((a,l)=>(a.minimum=Math.min(a.minimum,l.value),a.maximum=Math.max(a.maximum,l.value),a),e),n(e)))return e;let s=this.getMetadata("file:values");if(Array.isArray(s)&&(s.reduce((a,l)=>(a.minimum=Math.min(a.minimum,...l.values),a.maximum=Math.max(a.maximum,...l.values),a),e),n(e)))return e;let o=tr(t)&&t.data_type||this.getMetadata("file:data_type");return o&&(e.minimum=yx(o),e.maximum=xx(o)),e}getNoDataValues(t=null){t=this.getBand(t);let e=[];if(t&&typeof t.nodata<"u")e.push(t.nodata);else{let n=this.getMetadata("file:nodata");if(typeof n<"u")e=n;else{let i=this.getMetadata("classification:classes");Array.isArray(i)&&(e=i.filter(s=>!!s.nodata).map(s=>s.value))}}return e.map(n=>n==="nan"?NaN:n==="+inf"?1/0:n==="-inf"?-1/0:n)}isDefinition(){return!sr(this.href)}isHTTP(){return this.isDefinition()?null:super.isHTTP()}hasRole(t,e=!1){return Array.isArray(t)||(t=[t]),e&&t.includes(this.getKey())?!0:Array.isArray(this.roles)&&!!this.roles.find(n=>t.includes(n))}static fromAssets(t,e=null){let n={};if(tr(t))for(let i in t)n[i]=new Zo(t[i],i,e);return n}}class ah extends Sx{constructor(t,e=null,n={},i=[]){super(t,e,n,i)}getTemporalExtent(){return null}getTemporalExtents(){return[]}getIcons(t=!0){return this.getLinksWithRels(["icon"]).filter(e=>e.canBrowserDisplayImage(t))}getThumbnails(t=!0,e=null){let n=this.getAssetsWithRoles(["thumbnail","overview"],!0);if(n.length===0&&(n=this.getLinksWithRels(["preview"])),t&&(n=n.filter(i=>i.canBrowserDisplayImage())),e&&n.length>1){let i=s=>Array.isArray(s.roles)&&s.roles.includes(e)||s.getKey()===e;n=n.filter(i).concat(n.filter(s=>!i(s)))}return n}getDefaultGeoTIFF(t=!0,e=!1){return this.rankGeoTIFFs(t,e)[0]?.asset}rankGeoTIFFs(t=!0,e=!1,n=null,i=null){tr(n)||(n={data:1,visual:2,thumbnail:2,overview:3});let s=[],o=this.getAssetsByTypes(km);t&&(o=o.filter(l=>l.isHTTP()&&(!e||l.isCOG())));let a=Object.entries(n);for(let l of o){let h=0;if(a.length>0){let u=a.filter(([c])=>l.hasRole(c,!0)).map(([,c])=>c);u.length>0&&(h+=Math.max(...u))}!e&&l.isCOG()&&(h+=2),l.findVisualBands()&&(h+=1),typeof i=="function"&&(h+=i(l)),s.push({asset:l,score:h})}return s.sort((l,h)=>h.score-l.score),s}findVisualAssets(){let t={red:null,green:null,blue:null},e=Object.keys(t),n=this.getAssets();for(let s of n){let o=s.getBands();if(o.length!==1)continue;let a=s.findBand(e,"common_name",o);a&&(t[a.band.common_name]=s)}return Object.values(t).every(s=>s!==null)?t:null}getAsset(t){return tr(this.assets)&&this.assets[t]||null}getAssets(){return tr(this.assets)?Object.values(this.assets):[]}getAssetsWithRoles(t,e=!1){return this.getAssets().filter(n=>n.hasRole(t,e))}getAssetWithRole(t,e=!1){return this.getAssetsWithRoles([t],e)[0]||null}getAssetsByTypes(t){return this.getAssets().filter(e=>Ac(e.type,t))}equals(t){return this===t?!0:!(t instanceof ah)||this.getObjectType()!==t.getObjectType()?!1:!!(this.id&&this.id===t.id)}}class Ex extends ah{constructor(t,e=null,n={},i=[]){super(t,e,n,i)}getObjectType(){return this.type}getSearchLink(t=null){let e=this.getStacLinksWithRel("search");return t?e[0]||null:e.find(n=>n.method===t||!t&&!n.method)||null}getApiCollectionsLink(){return this.getStacLinkWithRel("data")}getApiItemsLink(){return this.getStacLinkWithRel("items")}getChildLinks(){return this.getStacLinksWithRel("child")}getItemLinks(){return this.getStacLinksWithRel("item")}}function wo(r){if(sr(r)&&r.length>=10)try{let e=r.match(/^(-?\d{1,})-(\d\d)-(\d\d)[T ](\d\d):(\d\d):(\d\d)(?:\.(\d*))?(?:Z|[+-]00:00)?$/i).slice(1).map(n=>parseInt(n,10));return new Date(Date.UTC(e[0],e[1]-1,e[2],e[3],e[4],e[5],e[6]||0))}catch{return null}return null}function Tx(r,t){return new Date(r.valueOf()+(t-r)/2)}class ng extends Ex{constructor(t,e=null){const n={assets:Zo.fromAssets,item_assets:Zo.fromAssets};super(t,e,n)}toGeoJSON(){let t=_x(this.getBoundingBoxes());return t&&(t.id=this.id),t}getBoundingBox(){let t=this.getRawBoundingBoxes();return t.length>0&&In(t[0])?t[0]:null}getBoundingBoxes(){let t=this.getRawBoundingBoxes();return t.length===1&&In(t[0])?t:t.length>1?t.filter((e,n)=>n>0&&In(e)):[]}getRawBoundingBoxes(){let t=this.extent?.spatial?.bbox;return Array.isArray(t)&&t.length>0?t:[]}getTemporalExtent(){return this.getTemporalExtents()[0]||null}getTemporalExtents(){let t=this.extent?.temporal?.interval;return Array.isArray(t)&&t.length>0?t.filter(e=>Array.isArray(e)&&(sr(e[0])||sr(e[1]))).map(e=>e.map(n=>wo(n))):[]}getSummary(t){return this.summaries[t]}getBands(){let t=this.getSummary("eo:bands"),e=this.getSummary("raster:bands"),n=[t,e].filter(i=>Array.isArray(i));return n.length>=2?Nm(...n):n.length===1?n[0]:[]}}class Mx extends ah{constructor(t,e=null){super(t,e,{assets:Zo.fromAssets})}getObjectType(){return"Item"}toGeoJSON(){return this.toJSON()}getBoundingBox(){return In(this.bbox)?this.bbox:null}getBoundingBoxes(){return In(this.bbox)?[this.bbox]:[]}getDateTime(){let t=wo(this.properties.datetime);if(!t){let e=wo(this.properties.start_datetime),n=wo(this.properties.end_datetime);return e&&n?Tx(e,n):e||n}return t}getTemporalExtent(){return this.getTemporalExtents()[0]||null}getTemporalExtents(){let t=[];return sr(this.properties.start_datetime)||sr(this.properties.end_datetime)?t=[[this.properties.start_datetime||null,this.properties.end_datetime||null]]:sr(this.properties.datetime)&&(t=[[this.properties.datetime,this.properties.datetime]]),t.map(e=>e.map(n=>wo(n)))}getMetadata(t){return this.properties[t]}getBands(){let t=this.getMetadata("eo:bands");return Array.isArray(t)?t:[]}getCollectionLink(){return this.getStacLinkWithRel("collection")}}function Rx(r){const t=[];return r.forEach(n=>{if(n.rel==="item"&&"latlng"in n){const[i,s]=n.latlng.split(",").map(o=>Number(o));t.push({type:"Feature",geometry:{type:"Point",coordinates:[s,i]}})}}),{type:"FeatureCollection",crs:{type:"name",properties:{name:"EPSG:4326"}},features:t}}class Cx{#e=void 0;#t=void 0;selectedItem=null;constructor(t){this.#e=t}createLayersJson=async(t=null)=>{let e,n,i=[{type:"Tile",properties:{id:"OSM"},source:{type:"OSM"}}];if(this.#t||(n=await(await fetch(this.#e)).json(),this.#t=new ng(n)),n&&n.endpointtype==="GeoDB"){const s=Rx(n.links);return i.unshift({type:"Vector",properties:{id:n.id},source:{type:"Vector",url:"data:,"+encodeURIComponent(JSON.stringify(s)),format:"GeoJSON"},style:{"circle-radius":5,"circle-fill-color":"#00417077","circle-stroke-color":"#004170","fill-color":"#00417077","stroke-color":"#004170"}}),i}else if(t instanceof Date?(e=this.getItems().sort((o,a)=>{const l=Math.abs(new Date(o.datetime)-t),h=Math.abs(new Date(a.datetime)-t);return l-h})[0],this.selectedItem=e):e=t,n=await(await fetch(e?wl(e.href,this.#e):this.#e)).json(),e){const o=new Mx(n);return this.selectedItem=o,i.unshift(this.buildJson(o)),i}else{this.#t=new ng(n);const o=this.getItems();return this.selectedItem=o[o.length-1],i=await this.createLayersJson(this.selectedItem),i}};buildJson(t){let e;return t.links.find(n=>n.rel==="wms"||n.rel==="wmts"||n.rel==="xyz")?e={type:"STAC",displayWebMapLink:!0,displayFootprint:!1,data:t,properties:{id:t.id}}:e={type:"Vector",source:{type:"Vector",url:"data:,"+encodeURIComponent(JSON.stringify(t.geometry)),format:"GeoJSON"},properties:{id:t.id}},e}getItems(){return(this.#t?.links).filter(t=>t.rel==="item").sort((t,e)=>t.datetime<e.datetime?-1:1)}getDates(){return(this.#t?.links).filter(t=>t.rel==="item").sort((t,e)=>t.datetime<e.datetime?-1:1).map(t=>new Date(t.datetime))}}var Ix=Object.defineProperty,Px=(r,t,e)=>t in r?Ix(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,Oc=(r,t,e)=>(Px(r,typeof t!="symbol"?t+"":t,e),e);class fn{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}const Fc={PROPERTYCHANGE:"propertychange"};class Nc{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function Ax(r,t,e){let n,i;e=e||on;let s=0,o=r.length,a=!1;for(;s<o;)n=s+(o-s>>1),i=+e(r[n],t),i<0?s=n+1:(o=n,a=!i);return a?s:~s}function on(r,t){return r>t?1:r<t?-1:0}function Lx(r,t){return r<t?1:r>t?-1:0}function lh(r,t,e){if(r[0]<=t)return 0;const n=r.length;if(t<=r[n-1])return n-1;if(typeof e=="function"){for(let i=1;i<n;++i){const s=r[i];if(s===t)return i;if(s<t)return e(t,r[i-1],s)>0?i-1:i}return n-1}if(e>0){for(let i=1;i<n;++i)if(r[i]<t)return i-1;return n-1}if(e<0){for(let i=1;i<n;++i)if(r[i]<=t)return i;return n-1}for(let i=1;i<n;++i){if(r[i]==t)return i;if(r[i]<t)return r[i-1]-t<t-r[i]?i-1:i}return n-1}function Ox(r,t,e){for(;t<e;){const n=r[t];r[t]=r[e],r[e]=n,++t,--e}}function Ot(r,t){const e=Array.isArray(t)?t:[t],n=e.length;for(let i=0;i<n;i++)r[r.length]=e[i]}function Wi(r,t){const e=r.length;if(e!==t.length)return!1;for(let n=0;n<e;n++)if(r[n]!==t[n])return!1;return!0}function Fx(r,t,e){const n=t||on;return r.every(function(i,s){if(s===0)return!0;const o=n(r[s-1],i);return!(o>0||o===0)})}function Nx(){return!0}function $o(){}function jm(r){let t=!1,e,n,i;return function(){const s=Array.prototype.slice.call(arguments);return(!t||this!==i||!Wi(s,n))&&(t=!0,i=this,n=s,e=r.apply(this,arguments)),e}}function zm(r){function t(){let e;try{e=r()}catch(n){return Promise.reject(n)}return e instanceof Promise?e:Promise.resolve(e)}return t()}function $s(r){for(const t in r)delete r[t]}function Fn(r){let t;for(t in r)return!1;return!t}class ma extends Nc{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const n=this.listeners_||(this.listeners_={}),i=n[t]||(n[t]=[]);i.includes(e)||i.push(e)}dispatchEvent(t){const e=typeof t=="string",n=e?t:t.type,i=this.listeners_&&this.listeners_[n];if(!i)return;const s=e?new fn(t):t;s.target||(s.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});n in o||(o[n]=0,a[n]=0),++o[n];let l;for(let h=0,u=i.length;h<u;++h)if("handleEvent"in i[h]?l=i[h].handleEvent(s):l=i[h].call(this,s),l===!1||s.propagationStopped){l=!1;break}if(--o[n]===0){let h=a[n];for(delete a[n];h--;)this.removeEventListener(n,$o);delete o[n]}return l}disposeInternal(){this.listeners_&&$s(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){if(!this.listeners_)return;const n=this.listeners_[t];if(!n)return;const i=n.indexOf(e);i!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(n[i]=$o,++this.pendingRemovals_[t]):(n.splice(i,1),n.length===0&&delete this.listeners_[t]))}}const Lt={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function le(r,t,e,n,i){if(n&&n!==r&&(e=e.bind(n)),i){const o=e;e=function(){r.removeEventListener(t,e),o.apply(this,arguments)}}const s={target:r,type:t,listener:e};return r.addEventListener(t,e),s}function Vo(r,t,e,n){return le(r,t,e,n,!0)}function ve(r){r&&r.target&&(r.target.removeEventListener(r.type,r.listener),$s(r))}class _a extends ma{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(Lt.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const n=t.length,i=new Array(n);for(let s=0;s<n;++s)i[s]=le(this,t[s],e);return i}return le(this,t,e)}onceInternal(t,e){let n;if(Array.isArray(t)){const i=t.length;n=new Array(i);for(let s=0;s<i;++s)n[s]=Vo(this,t[s],e)}else n=Vo(this,t,e);return e.ol_key=n,n}unInternal(t,e){const n=e.ol_key;if(n)Dx(n);else if(Array.isArray(t))for(let i=0,s=t.length;i<s;++i)this.removeEventListener(t[i],e);else this.removeEventListener(t,e)}}_a.prototype.on;_a.prototype.once;_a.prototype.un;function Dx(r){if(Array.isArray(r))for(let t=0,e=r.length;t<e;++t)ve(r[t]);else ve(r)}function ut(){throw new Error("Unimplemented abstract method.")}let kx=0;function it(r){return r.ol_uid||(r.ol_uid=String(++kx))}class ig extends fn{constructor(t,e,n){super(t),this.key=e,this.oldValue=n}}class qi extends _a{constructor(t){super(),this.on,this.once,this.un,it(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,e){let n;n=`change:${t}`,this.hasListener(n)&&this.dispatchEvent(new ig(n,t,e)),n=Fc.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new ig(n,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,n){const i=this.values_||(this.values_={});if(n)i[t]=e;else{const s=i[t];i[t]=e,s!==e&&this.notify(t,s)}}setProperties(t,e){for(const n in t)this.set(n,t[n],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const n=this.values_[t];delete this.values_[t],Fn(this.values_)&&(this.values_=null),e||this.notify(t,n)}}}function At(r,t){if(!r)throw new Error(t)}class Se extends qi{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new Se(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const n=this.getStyle();return n&&t.setStyle(n),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(ve(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=le(t,Lt.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?Gx(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function Gx(r){if(typeof r=="function")return r;let t;return Array.isArray(r)?t=r:(At(typeof r.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[r]),function(){return t}}const Dc=new Array(6);function pe(){return[1,0,0,1,0,0]}function Xu(r){return hh(r,1,0,0,1,0,0)}function Vs(r,t){const e=r[0],n=r[1],i=r[2],s=r[3],o=r[4],a=r[5],l=t[0],h=t[1],u=t[2],c=t[3],f=t[4],g=t[5];return r[0]=e*l+i*h,r[1]=n*l+s*h,r[2]=e*u+i*c,r[3]=n*u+s*c,r[4]=e*f+i*g+o,r[5]=n*f+s*g+a,r}function hh(r,t,e,n,i,s,o){return r[0]=t,r[1]=e,r[2]=n,r[3]=i,r[4]=s,r[5]=o,r}function jx(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r}function ae(r,t){const e=t[0],n=t[1];return t[0]=r[0]*e+r[2]*n+r[4],t[1]=r[1]*e+r[3]*n+r[5],t}function zx(r,t){const e=Math.cos(t),n=Math.sin(t);return Vs(r,hh(Dc,e,n,-n,e,0,0))}function Ao(r,t,e){return Vs(r,hh(Dc,t,0,0,e,0,0))}function kc(r,t,e){return Vs(r,hh(Dc,1,0,0,1,t,e))}function hr(r,t,e,n,i,s,o,a){const l=Math.sin(s),h=Math.cos(s);return r[0]=n*h,r[1]=i*l,r[2]=-n*l,r[3]=i*h,r[4]=o*n*h-a*n*l+t,r[5]=o*i*l+a*i*h+e,r}function uh(r,t){const e=Ux(t);At(e!==0,"Transformation matrix cannot be inverted");const n=t[0],i=t[1],s=t[2],o=t[3],a=t[4],l=t[5];return r[0]=o/e,r[1]=-i/e,r[2]=-s/e,r[3]=n/e,r[4]=(s*l-o*a)/e,r[5]=-(n*l-i*a)/e,r}function Ux(r){return r[0]*r[3]-r[1]*r[2]}const sg=[1e6,1e6,1e6,1e6,2,2];function Gc(r){return"matrix("+r.map((t,e)=>Math.round(t*sg[e])/sg[e]).join(", ")+")"}const Me={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function Os(r){const t=ze();for(let e=0,n=r.length;e<n;++e)Lo(t,r[e]);return t}function Bx(r,t,e){const n=Math.min.apply(null,r),i=Math.min.apply(null,t),s=Math.max.apply(null,r),o=Math.max.apply(null,t);return Br(n,i,s,o,e)}function Ir(r,t,e){return e?(e[0]=r[0]-t,e[1]=r[1]-t,e[2]=r[2]+t,e[3]=r[3]+t,e):[r[0]-t,r[1]-t,r[2]+t,r[3]+t]}function Xx(r,t){return t?(t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t):r.slice()}function Zi(r,t,e){let n,i;return t<r[0]?n=r[0]-t:r[2]<t?n=t-r[2]:n=0,e<r[1]?i=r[1]-e:r[3]<e?i=e-r[3]:i=0,n*n+i*i}function xr(r,t){return jc(r,t[0],t[1])}function Ze(r,t){return r[0]<=t[0]&&t[2]<=r[2]&&r[1]<=t[1]&&t[3]<=r[3]}function jc(r,t,e){return r[0]<=t&&t<=r[2]&&r[1]<=e&&e<=r[3]}function Wu(r,t){const e=r[0],n=r[1],i=r[2],s=r[3],o=t[0],a=t[1];let l=Me.UNKNOWN;return o<e?l=l|Me.LEFT:o>i&&(l=l|Me.RIGHT),a<n?l=l|Me.BELOW:a>s&&(l=l|Me.ABOVE),l===Me.UNKNOWN&&(l=Me.INTERSECTING),l}function ze(){return[1/0,1/0,-1/0,-1/0]}function Br(r,t,e,n,i){return i?(i[0]=r,i[1]=t,i[2]=e,i[3]=n,i):[r,t,e,n]}function ya(r){return Br(1/0,1/0,-1/0,-1/0,r)}function zc(r,t){const e=r[0],n=r[1];return Br(e,n,e,n,t)}function Uc(r,t,e,n,i){const s=ya(i);return Bm(s,r,t,e,n)}function Nn(r,t){return r[0]==t[0]&&r[2]==t[2]&&r[1]==t[1]&&r[3]==t[3]}function Wx(r,t,e){return Math.abs(r[0]-t[0])<e&&Math.abs(r[2]-t[2])<e&&Math.abs(r[1]-t[1])<e&&Math.abs(r[3]-t[3])<e}function Um(r,t){return t[0]<r[0]&&(r[0]=t[0]),t[2]>r[2]&&(r[2]=t[2]),t[1]<r[1]&&(r[1]=t[1]),t[3]>r[3]&&(r[3]=t[3]),r}function Lo(r,t){t[0]<r[0]&&(r[0]=t[0]),t[0]>r[2]&&(r[2]=t[0]),t[1]<r[1]&&(r[1]=t[1]),t[1]>r[3]&&(r[3]=t[1])}function Bm(r,t,e,n,i){for(;e<n;e+=i)qx(r,t[e],t[e+1]);return r}function qx(r,t,e){r[0]=Math.min(r[0],t),r[1]=Math.min(r[1],e),r[2]=Math.max(r[2],t),r[3]=Math.max(r[3],e)}function Xm(r,t){let e;return e=t(xa(r)),e||(e=t(ch(r)),e)||(e=t(va(r)),e)||(e=t(zn(r)),e)?e:!1}function Yo(r){let t=0;return Un(r)||(t=yt(r)*Vt(r)),t}function xa(r){return[r[0],r[1]]}function ch(r){return[r[2],r[1]]}function Ce(r){return[(r[0]+r[2])/2,(r[1]+r[3])/2]}function Zx(r,t){let e;if(t==="bottom-left")e=xa(r);else if(t==="bottom-right")e=ch(r);else if(t==="top-left")e=zn(r);else if(t==="top-right")e=va(r);else throw new Error("Invalid corner");return e}function Bc(r,t,e,n,i){const[s,o,a,l,h,u,c,f]=qu(r,t,e,n);return Br(Math.min(s,a,h,c),Math.min(o,l,u,f),Math.max(s,a,h,c),Math.max(o,l,u,f),i)}function qu(r,t,e,n){const i=t*n[0]/2,s=t*n[1]/2,o=Math.cos(e),a=Math.sin(e),l=i*o,h=i*a,u=s*o,c=s*a,f=r[0],g=r[1];return[f-l+c,g-h-u,f-l-c,g-h+u,f+l-c,g+h+u,f+l+c,g+h-u,f-l+c,g-h-u]}function Vt(r){return r[3]-r[1]}function we(r,t,e){const n=e||ze();return Qt(r,t)?(r[0]>t[0]?n[0]=r[0]:n[0]=t[0],r[1]>t[1]?n[1]=r[1]:n[1]=t[1],r[2]<t[2]?n[2]=r[2]:n[2]=t[2],r[3]<t[3]?n[3]=r[3]:n[3]=t[3]):ya(n),n}function zn(r){return[r[0],r[3]]}function va(r){return[r[2],r[3]]}function yt(r){return r[2]-r[0]}function Qt(r,t){return r[0]<=t[2]&&r[2]>=t[0]&&r[1]<=t[3]&&r[3]>=t[1]}function Un(r){return r[2]<r[0]||r[3]<r[1]}function $x(r,t){return t?(t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t):r}function Wm(r,t){const e=(r[2]-r[0])/2*(t-1),n=(r[3]-r[1])/2*(t-1);r[0]-=e,r[2]+=e,r[1]-=n,r[3]+=n}function Vx(r,t,e){let n=!1;const i=Wu(r,t),s=Wu(r,e);if(i===Me.INTERSECTING||s===Me.INTERSECTING)n=!0;else{const o=r[0],a=r[1],l=r[2],h=r[3],u=t[0],c=t[1],f=e[0],g=e[1],m=(g-c)/(f-u);let _,x;s&Me.ABOVE&&!(i&Me.ABOVE)&&(_=f-(g-h)/m,n=_>=o&&_<=l),!n&&s&Me.RIGHT&&!(i&Me.RIGHT)&&(x=g-(f-l)*m,n=x>=a&&x<=h),!n&&s&Me.BELOW&&!(i&Me.BELOW)&&(_=f-(g-a)/m,n=_>=o&&_<=l),!n&&s&Me.LEFT&&!(i&Me.LEFT)&&(x=g-(f-o)*m,n=x>=a&&x<=h)}return n}function Fs(r,t,e,n){if(Un(r))return ya(e);let i=[];if(n>1){const a=r[2]-r[0],l=r[3]-r[1];for(let h=0;h<n;++h)i.push(r[0]+a*h/n,r[1],r[2],r[1]+l*h/n,r[2]-a*h/n,r[3],r[0],r[3]-l*h/n)}else i=[r[0],r[1],r[2],r[1],r[2],r[3],r[0],r[3]];t(i,i,2);const s=[],o=[];for(let a=0,l=i.length;a<l;a+=2)s.push(i[a]),o.push(i[a+1]);return Bx(s,o,e)}function Xc(r,t){const e=t.getExtent(),n=Ce(r);if(t.canWrapX()&&(n[0]<e[0]||n[0]>=e[2])){const i=yt(e),s=Math.floor((n[0]-e[0])/i)*i;r[0]-=s,r[2]-=s}return r}function Yx(r,t){if(t.canWrapX()){const e=t.getExtent();if(!isFinite(r[0])||!isFinite(r[2]))return[[e[0],r[1],e[2],r[3]]];Xc(r,t);const n=yt(e);if(yt(r)>n)return[[e[0],r[1],e[2],r[3]]];if(r[0]<e[0])return[[r[0]+n,r[1],e[2],r[3]],[e[0],r[1],r[2],r[3]]];if(r[2]>e[2])return[[r[0],r[1],e[2],r[3]],[e[0],r[1],r[2]-n,r[3]]]}return[r]}const Hx={9001:"m",9002:"ft",9003:"us-ft",9101:"radians",9102:"degrees"};function og(r){return Hx[r]}const Wc={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};let Ns=class{constructor(r){this.code_=r.code,this.units_=r.units,this.extent_=r.extent!==void 0?r.extent:null,this.worldExtent_=r.worldExtent!==void 0?r.worldExtent:null,this.axisOrientation_=r.axisOrientation!==void 0?r.axisOrientation:"enu",this.global_=r.global!==void 0?r.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=r.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=r.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||Wc[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(r){this.global_=r,this.canWrapX_=!!(r&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(r){this.defaultTileGrid_=r}setExtent(r){this.extent_=r,this.canWrapX_=!!(this.global_&&r)}setWorldExtent(r){this.worldExtent_=r}setGetPointResolution(r){this.getPointResolutionFunc_=r}getPointResolutionFunc(){return this.getPointResolutionFunc_}};const wa=6378137,_s=Math.PI*wa,Kx=[-_s,-_s,_s,_s],Qx=[-180,-85,180,85],$a=wa*Math.log(Math.tan(Math.PI/2));class Ji extends Ns{constructor(t){super({code:t,units:"m",extent:Kx,global:!0,worldExtent:Qx,getPointResolution:function(e,n){return e/Math.cosh(n[1]/wa)}})}}const ag=[new Ji("EPSG:3857"),new Ji("EPSG:102100"),new Ji("EPSG:102113"),new Ji("EPSG:900913"),new Ji("http://www.opengis.net/def/crs/EPSG/0/3857"),new Ji("http://www.opengis.net/gml/srs/epsg.xml#3857")];function Jx(r,t,e){const n=r.length;e=e>1?e:2,t===void 0&&(e>2?t=r.slice():t=new Array(n));for(let i=0;i<n;i+=e){t[i]=_s*r[i]/180;let s=wa*Math.log(Math.tan(Math.PI*(+r[i+1]+90)/360));s>$a?s=$a:s<-$a&&(s=-$a),t[i+1]=s}return t}function tv(r,t,e){const n=r.length;e=e>1?e:2,t===void 0&&(e>2?t=r.slice():t=new Array(n));for(let i=0;i<n;i+=e)t[i]=180*r[i]/_s,t[i+1]=360*Math.atan(Math.exp(r[i+1]/wa))/Math.PI-90;return t}const ev=6378137,lg=[-180,-90,180,90],rv=Math.PI*ev/180;class bi extends Ns{constructor(t,e){super({code:t,units:"degrees",extent:lg,axisOrientation:e,global:!0,metersPerUnit:rv,worldExtent:lg})}}const hg=[new bi("CRS:84"),new bi("EPSG:4326","neu"),new bi("urn:ogc:def:crs:OGC:1.3:CRS84"),new bi("urn:ogc:def:crs:OGC:2:84"),new bi("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new bi("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new bi("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Zu={};function nv(r){return Zu[r]||Zu[r.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function iv(r,t){Zu[r]=t}let Ms={};function Ds(r,t,e){const n=r.getCode(),i=t.getCode();n in Ms||(Ms[n]={}),Ms[n][i]=e}function qm(r,t){let e;return r in Ms&&t in Ms[r]&&(e=Ms[r][t]),e}function wt(r,t,e){return Math.min(Math.max(r,t),e)}function Zm(r,t,e,n,i,s){const o=i-e,a=s-n;if(o!==0||a!==0){const l=((r-e)*o+(t-n)*a)/(o*o+a*a);l>1?(e=i,n=s):l>0&&(e+=o*l,n+=a*l)}return Ai(r,t,e,n)}function Ai(r,t,e,n){const i=e-r,s=n-t;return i*i+s*s}function sv(r){const t=r.length;for(let n=0;n<t;n++){let i=n,s=Math.abs(r[n][n]);for(let a=n+1;a<t;a++){const l=Math.abs(r[a][n]);l>s&&(s=l,i=a)}if(s===0)return null;const o=r[i];r[i]=r[n],r[n]=o;for(let a=n+1;a<t;a++){const l=-r[a][n]/r[n][n];for(let h=n;h<t+1;h++)n==h?r[a][h]=0:r[a][h]+=l*r[n][h]}}const e=new Array(t);for(let n=t-1;n>=0;n--){e[n]=r[n][t]/r[n][n];for(let i=n-1;i>=0;i--)r[i][t]-=r[i][n]*e[n]}return e}function Oo(r){return r*Math.PI/180}function an(r,t){const e=r%t;return e*t<0?e+t:e}function mr(r,t,e){return r+e*(t-r)}function ba(r,t){const e=Math.pow(10,t);return Math.round(r*e)/e}function bl(r,t){return Math.round(ba(r,t))}function ys(r,t){return Math.floor(ba(r,t))}function ri(r,t){return Math.ceil(ba(r,t))}function Ti(r,t,e){const n=e!==void 0?r.toFixed(e):""+r;let i=n.indexOf(".");return i=i===-1?n.length:i,i>t?n:new Array(1+t-i).join("0")+n}function qc(r,t){const e=(""+r).split("."),n=(""+t).split(".");for(let i=0;i<Math.max(e.length,n.length);i++){const s=parseInt(e[i]||"0",10),o=parseInt(n[i]||"0",10);if(s>o)return 1;if(o>s)return-1}return 0}function $m(r,t){return r[0]+=+t[0],r[1]+=+t[1],r}function ug(r,t,e){const n=an(t+180,360)-180,i=Math.abs(3600*n),s=e||0;let o=Math.floor(i/3600),a=Math.floor((i-o*3600)/60),l=ba(i-o*3600-a*60,s);l>=60&&(l=0,a+=1),a>=60&&(a=0,o+=1);let h=o+"°";return(a!==0||l!==0)&&(h+=" "+Ti(a,2)+"′"),l!==0&&(h+=" "+Ti(l,2,s)+"″"),n!==0&&(h+=" "+r.charAt(n<0?1:0)),h}function Sl(r,t){let e=!0;for(let n=r.length-1;n>=0;--n)if(r[n]!=t[n]){e=!1;break}return e}function ov(r,t){const e=Math.cos(t),n=Math.sin(t),i=r[0]*e-r[1]*n,s=r[1]*e+r[0]*n;return r[0]=i,r[1]=s,r}function av(r,t){return r[0]*=t,r[1]*=t,r}function Vm(r,t){if(t.canWrapX()){const e=yt(t.getExtent()),n=Ym(r,t,e);n&&(r[0]-=n*e)}return r}function Ym(r,t,e){const n=t.getExtent();let i=0;return t.canWrapX()&&(r[0]<n[0]||r[0]>n[2])&&(e=e||yt(n),i=Math.floor((r[0]-n[0])/e)),i}const lv=63710088e-1;function cg(r,t,e){e=e||lv;const n=Oo(r[1]),i=Oo(t[1]),s=(i-n)/2,o=Oo(t[0]-r[0])/2,a=Math.sin(s)*Math.sin(s)+Math.sin(o)*Math.sin(o)*Math.cos(n)*Math.cos(i);return 2*e*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}function hv(...r){console.warn(...r)}function El(...r){console.error(...r)}let $u=!0;function uv(r){$u=!1}function Zc(r,t){if(t!==void 0){for(let e=0,n=r.length;e<n;++e)t[e]=r[e];t=t}else t=r.slice();return t}function Hm(r,t){if(t!==void 0&&r!==t){for(let e=0,n=r.length;e<n;++e)t[e]=r[e];r=t}return r}function Km(r){iv(r.getCode(),r),Ds(r,r,Zc)}function cv(r){r.forEach(Km)}function tt(r){return typeof r=="string"?nv(r):r||null}function dg(r,t,e,n){r=tt(r);let i;const s=r.getPointResolutionFunc();if(s)i=s(t,e);else{const o=r.getUnits();if(o=="degrees"&&!n||n=="degrees")i=t;else{const a=$i(r,tt("EPSG:4326"));if(a===Hm&&o!=="degrees")i=t*r.getMetersPerUnit();else{let h=[e[0]-t/2,e[1],e[0]+t/2,e[1],e[0],e[1]-t/2,e[0],e[1]+t/2];h=a(h,h,2);const u=cg(h.slice(0,2),h.slice(2,4)),c=cg(h.slice(4,6),h.slice(6,8));i=(u+c)/2}const l=r.getMetersPerUnit();l!==void 0&&(i/=l)}}return i}function Vu(r){cv(r),r.forEach(function(t){r.forEach(function(e){t!==e&&Ds(t,e,Zc)})})}function dv(r,t,e,n){r.forEach(function(i){t.forEach(function(s){Ds(i,s,e),Ds(s,i,n)})})}function $c(r,t){return r?typeof r=="string"?tt(r):r:tt(t)}function fg(r){return function(t,e,n){const i=t.length;n=n!==void 0?n:2,e=e!==void 0?e:new Array(i);for(let s=0;s<i;s+=n){const o=r(t.slice(s,s+n)),a=o.length;for(let l=0,h=n;l<h;++l)e[s+l]=l>=a?t[s+l]:o[l]}return e}}function fv(r,t,e,n){const i=tt(r),s=tt(t);Ds(i,s,fg(e)),Ds(s,i,fg(n))}function gg(r,t){const e=dh(r,t!==void 0?t:"EPSG:3857","EPSG:4326"),n=e[0];return(n<-180||n>180)&&(e[0]=an(n+180,360)-180),e}function Ae(r,t){if(r===t)return!0;const e=r.getUnits()===t.getUnits();return(r.getCode()===t.getCode()||$i(r,t)===Zc)&&e}function $i(r,t){const e=r.getCode(),n=t.getCode();let i=qm(e,n);return i||(i=Hm),i}function hn(r,t){const e=tt(r),n=tt(t);return $i(e,n)}function dh(r,t,e){return hn(t,e)(r,void 0,r.length)}function Vc(r,t,e,n){const i=hn(t,e);return Fs(r,i,void 0,n)}let gv=null;function pv(){return gv}function Yu(r,t){return r}function $n(r,t){return $u&&!Sl(r,[0,0])&&r[0]>=-180&&r[0]<=180&&r[1]>=-90&&r[1]<=90&&($u=!1,hv("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),r}function fh(r,t){return r}function Gr(r,t){return r}function pg(r,t,e){return function(n){let i,s;if(r.canWrapX()){const o=r.getExtent(),a=yt(o);n=n.slice(0),s=Ym(n,r,a),s&&(n[0]=n[0]-s*a),n[0]=wt(n[0],o[0],o[2]),n[1]=wt(n[1],o[1],o[3]),i=e(n)}else i=e(n);return s&&t.canWrapX()&&(i[0]+=s*yt(t.getExtent())),i}}function mv(){Vu(ag),Vu(hg),dv(hg,ag,Jx,tv)}mv();function li(r,t,e,n,i,s){s=s||[];let o=0;for(let a=t;a<e;a+=n){const l=r[a],h=r[a+1];s[o++]=i[0]*l+i[2]*h+i[4],s[o++]=i[1]*l+i[3]*h+i[5]}return s&&s.length!=o&&(s.length=o),s}function Qm(r,t,e,n,i,s,o){o=o||[];const a=Math.cos(i),l=Math.sin(i),h=s[0],u=s[1];let c=0;for(let f=t;f<e;f+=n){const g=r[f]-h,m=r[f+1]-u;o[c++]=h+g*a-m*l,o[c++]=u+g*l+m*a;for(let _=f+2;_<f+n;++_)o[c++]=r[_]}return o&&o.length!=c&&(o.length=c),o}function _v(r,t,e,n,i,s,o,a){a=a||[];const l=o[0],h=o[1];let u=0;for(let c=t;c<e;c+=n){const f=r[c]-l,g=r[c+1]-h;a[u++]=l+i*f,a[u++]=h+s*g;for(let m=c+2;m<c+n;++m)a[u++]=r[m]}return a&&a.length!=u&&(a.length=u),a}function yv(r,t,e,n,i,s,o){o=o||[];let a=0;for(let l=t;l<e;l+=n){o[a++]=r[l]+i,o[a++]=r[l+1]+s;for(let h=l+2;h<l+n;++h)o[a++]=r[h]}return o&&o.length!=a&&(o.length=a),o}const mg=pe();class Yc extends qi{constructor(){super(),this.extent_=ze(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=jm((t,e,n)=>{if(!n)return this.getSimplifiedGeometry(e);const i=this.clone();return i.applyTransform(n),i.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return ut()}closestPointXY(t,e,n,i){return ut()}containsXY(t,e){const n=this.getClosestPoint([t,e]);return n[0]===t&&n[1]===e}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return ut()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&ya(e),this.extentRevision_=this.getRevision()}return $x(this.extent_,t)}rotate(t,e){ut()}scale(t,e,n){ut()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return ut()}getType(){return ut()}applyTransform(t){ut()}intersectsExtent(t){return ut()}translate(t,e){ut()}transform(t,e){const n=tt(t),i=n.getUnits()=="tile-pixels"?function(s,o,a){const l=n.getExtent(),h=n.getWorldExtent(),u=Vt(h)/Vt(l);return hr(mg,h[0],h[3],u,-u,0,0,0),li(s,0,s.length,a,mg,o),hn(n,e)(s,o,a)}:hn(n,e);return this.applyTransform(i),this}}class xv extends Yc{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(t){return Uc(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return ut()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=Hu(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){ut()}setLayout(t,e,n){let i;if(t)i=Hu(t);else{for(let s=0;s<n;++s){if(e.length===0){this.layout="XY",this.stride=2;return}e=e[0]}i=e.length,t=Vi(i)}this.layout=t,this.stride=i}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(t,e){const n=this.getFlatCoordinates();if(n){const i=this.getStride();Qm(n,0,n.length,i,t,e,n),this.changed()}}scale(t,e,n){e===void 0&&(e=t),n||(n=Ce(this.getExtent()));const i=this.getFlatCoordinates();if(i){const s=this.getStride();_v(i,0,i.length,s,t,e,n,i),this.changed()}}translate(t,e){const n=this.getFlatCoordinates();if(n){const i=this.getStride();yv(n,0,n.length,i,t,e,n),this.changed()}}}function Vi(r){let t;return r==2?t="XY":r==3?t="XYZ":r==4&&(t="XYZM"),t}function Hu(r){let t;return r=="XY"?t=2:r=="XYZ"||r=="XYM"?t=3:r=="XYZM"&&(t=4),t}function vv(r,t,e){const n=r.getFlatCoordinates();if(!n)return null;const i=r.getStride();return li(n,0,n.length,i,t,e)}const Dn=xv;function wv(r,t,e,n){for(let i=0,s=e.length;i<s;++i)r[t++]=e[i];return t}function Sa(r,t,e,n){for(let i=0,s=e.length;i<s;++i){const o=e[i];for(let a=0;a<n;++a)r[t++]=o[a]}return t}function Ea(r,t,e,n,i){i=i||[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=Sa(r,t,e[o],n);i[s++]=l,t=l}return i.length=s,i}function Jm(r,t,e,n,i){i=i||[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=Ea(r,t,e[o],n,i[s]);l.length===0&&(l[0]=t),i[s++]=l,t=l[l.length-1]}return i.length=s,i}class Tl extends Yc{constructor(t){super(),this.geometries_=t,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(ve),this.changeEventsKeys_.length=0}listenGeometriesChange_(){const t=this.geometries_;for(let e=0,n=t.length;e<n;++e)this.changeEventsKeys_.push(le(t[e],Lt.CHANGE,this.changed,this))}clone(){const t=new Tl(su(this.geometries_));return t.applyProperties(this),t}closestPointXY(t,e,n,i){if(i<Zi(this.getExtent(),t,e))return i;const s=this.geometries_;for(let o=0,a=s.length;o<a;++o)i=s[o].closestPointXY(t,e,n,i);return i}containsXY(t,e){const n=this.geometries_;for(let i=0,s=n.length;i<s;++i)if(n[i].containsXY(t,e))return!0;return!1}computeExtent(t){ya(t);const e=this.geometries_;for(let n=0,i=e.length;n<i;++n)Um(t,e[n].getExtent());return t}getGeometries(){return su(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let t=[];const e=this.geometries_;for(let n=0,i=e.length;n<i;++n)e[n].getType()===this.getType()?t=t.concat(e[n].getGeometriesArrayRecursive()):t.push(e[n]);return t}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=[],n=this.geometries_;let i=!1;for(let s=0,o=n.length;s<o;++s){const a=n[s],l=a.getSimplifiedGeometry(t);e.push(l),l!==a&&(i=!0)}return i?new Tl(e):(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getType(){return"GeometryCollection"}intersectsExtent(t){const e=this.geometries_;for(let n=0,i=e.length;n<i;++n)if(e[n].intersectsExtent(t))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(t,e){const n=this.geometries_;for(let i=0,s=n.length;i<s;++i)n[i].rotate(t,e);this.changed()}scale(t,e,n){n||(n=Ce(this.getExtent()));const i=this.geometries_;for(let s=0,o=i.length;s<o;++s)i[s].scale(t,e,n);this.changed()}setGeometries(t){this.setGeometriesArray(su(t))}setGeometriesArray(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}applyTransform(t){const e=this.geometries_;for(let n=0,i=e.length;n<i;++n)e[n].applyTransform(t);this.changed()}translate(t,e){const n=this.geometries_;for(let i=0,s=n.length;i<s;++i)n[i].translate(t,e);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function su(r){return r.map(t=>t.clone())}const je=Tl;function _g(r,t,e,n,i,s,o){const a=r[t],l=r[t+1],h=r[e]-a,u=r[e+1]-l;let c;if(h===0&&u===0)c=t;else{const f=((i-a)*h+(s-l)*u)/(h*h+u*u);if(f>1)c=e;else if(f>0){for(let g=0;g<n;++g)o[g]=mr(r[t+g],r[e+g],f);o.length=n;return}else c=t}for(let f=0;f<n;++f)o[f]=r[c+f];o.length=n}function Hc(r,t,e,n,i){let s=r[t],o=r[t+1];for(t+=n;t<e;t+=n){const a=r[t],l=r[t+1],h=Ai(s,o,a,l);h>i&&(i=h),s=a,o=l}return i}function Kc(r,t,e,n,i){for(let s=0,o=e.length;s<o;++s){const a=e[s];i=Hc(r,t,a,n,i),t=a}return i}function bv(r,t,e,n,i){for(let s=0,o=e.length;s<o;++s){const a=e[s];i=Kc(r,t,a,n,i),t=a[a.length-1]}return i}function Qc(r,t,e,n,i,s,o,a,l,h,u){if(t==e)return h;let c,f;if(i===0){if(f=Ai(o,a,r[t],r[t+1]),f<h){for(c=0;c<n;++c)l[c]=r[t+c];return l.length=n,f}return h}u=u||[NaN,NaN];let g=t+n;for(;g<e;)if(_g(r,g-n,g,n,o,a,u),f=Ai(o,a,u[0],u[1]),f<h){for(h=f,c=0;c<n;++c)l[c]=u[c];l.length=n,g+=n}else g+=n*Math.max((Math.sqrt(f)-Math.sqrt(h))/i|0,1);if(s&&(_g(r,e-n,t,n,o,a,u),f=Ai(o,a,u[0],u[1]),f<h)){for(h=f,c=0;c<n;++c)l[c]=u[c];l.length=n}return h}function Jc(r,t,e,n,i,s,o,a,l,h,u){u=u||[NaN,NaN];for(let c=0,f=e.length;c<f;++c){const g=e[c];h=Qc(r,t,g,n,i,s,o,a,l,h,u),t=g}return h}function Sv(r,t,e,n,i,s,o,a,l,h,u){u=u||[NaN,NaN];for(let c=0,f=e.length;c<f;++c){const g=e[c];h=Jc(r,t,g,n,i,s,o,a,l,h,u),t=g[g.length-1]}return h}function gh(r,t,e,n,i,s,o){const a=(e-t)/n;if(a<3){for(;t<e;t+=n)s[o++]=r[t],s[o++]=r[t+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const h=[t,e-n];let u=0;for(;h.length>0;){const c=h.pop(),f=h.pop();let g=0;const m=r[f],_=r[f+1],x=r[c],v=r[c+1];for(let w=f+n;w<c;w+=n){const S=r[w],E=r[w+1],T=Zm(S,E,m,_,x,v);T>g&&(u=w,g=T)}g>i&&(l[(u-t)/n]=1,f+n<u&&h.push(f,u),u+n<c&&h.push(u,c))}for(let c=0;c<a;++c)l[c]&&(s[o++]=r[t+c*n],s[o++]=r[t+c*n+1]);return o}function t0(r,t,e,n,i,s,o,a){for(let l=0,h=e.length;l<h;++l){const u=e[l];o=gh(r,t,u,n,i,s,o),a.push(o),t=u}return o}function Ei(r,t){return t*Math.round(r/t)}function Ev(r,t,e,n,i,s,o){if(t==e)return o;let a=Ei(r[t],i),l=Ei(r[t+1],i);t+=n,s[o++]=a,s[o++]=l;let h,u;do if(h=Ei(r[t],i),u=Ei(r[t+1],i),t+=n,t==e)return s[o++]=h,s[o++]=u,o;while(h==a&&u==l);for(;t<e;){const c=Ei(r[t],i),f=Ei(r[t+1],i);if(t+=n,c==h&&f==u)continue;const g=h-a,m=u-l,_=c-a,x=f-l;if(g*x==m*_&&(g<0&&_<g||g==_||g>0&&_>g)&&(m<0&&x<m||m==x||m>0&&x>m)){h=c,u=f;continue}s[o++]=h,s[o++]=u,a=h,l=u,h=c,u=f}return s[o++]=h,s[o++]=u,o}function td(r,t,e,n,i,s,o,a){for(let l=0,h=e.length;l<h;++l){const u=e[l];o=Ev(r,t,u,n,i,s,o),a.push(o),t=u}return o}function Tv(r,t,e,n,i,s,o,a){for(let l=0,h=e.length;l<h;++l){const u=e[l],c=[];o=td(r,t,u,n,i,s,o,c),a.push(c),t=u[u.length-1]}return o}function Rn(r,t,e,n,i){i=i!==void 0?i:[];let s=0;for(let o=t;o<e;o+=n)i[s++]=r.slice(o,o+n);return i.length=s,i}function Ho(r,t,e,n,i){i=i!==void 0?i:[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=e[o];i[s++]=Rn(r,t,l,n,i[s]),t=l}return i.length=s,i}function Ku(r,t,e,n,i){i=i!==void 0?i:[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=e[o];i[s++]=l.length===1&&l[0]===t?[]:Ho(r,t,l,n,i[s]),t=l[l.length-1]}return i.length=s,i}function e0(r,t,e,n){let i=0,s=r[e-n],o=r[e-n+1];for(;t<e;t+=n){const a=r[t],l=r[t+1];i+=o*a-s*l,s=a,o=l}return i/2}function r0(r,t,e,n){let i=0;for(let s=0,o=e.length;s<o;++s){const a=e[s];i+=e0(r,t,a,n),t=a}return i}function Mv(r,t,e,n){let i=0;for(let s=0,o=e.length;s<o;++s){const a=e[s];i+=r0(r,t,a,n),t=a[a.length-1]}return i}class ci extends Dn{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}clone(){return new ci(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,n,i){return i<Zi(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Hc(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Qc(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,n,i))}getArea(){return e0(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return Rn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=gh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new ci(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Sa(this.flatCoordinates,0,t,this.stride),this.changed()}}function n0(r,t,e,n,i){let s;for(t+=n;t<e;t+=n)if(s=i(r.slice(t-n,t),r.slice(t,t+n)),s)return s;return!1}function Ml(r,t,e,n,i,s,o){let a,l;const h=(e-t)/n;if(h===1)a=t;else if(h===2)a=t,l=i;else if(h!==0){let u=r[t],c=r[t+1],f=0;const g=[0];for(let x=t+n;x<e;x+=n){const v=r[x],w=r[x+1];f+=Math.sqrt((v-u)*(v-u)+(w-c)*(w-c)),g.push(f),u=v,c=w}const m=i*f,_=Ax(g,m);_<0?(l=(m-g[-_-2])/(g[-_-1]-g[-_-2]),a=t+(-_-2)*n):a=t+_*n}o=o>1?o:2,s=s||new Array(o);for(let u=0;u<o;++u)s[u]=a===void 0?NaN:l===void 0?r[a+u]:mr(r[a+u],r[a+n+u],l);return s}function Qu(r,t,e,n,i,s){if(e==t)return null;let o;if(i<r[t+n-1])return s?(o=r.slice(t,t+n),o[n-1]=i,o):null;if(r[e-1]<i)return s?(o=r.slice(e-n,e),o[n-1]=i,o):null;if(i==r[t+n-1])return r.slice(t,t+n);let a=t/n,l=e/n;for(;a<l;){const f=a+l>>1;i<r[(f+1)*n-1]?l=f:a=f+1}const h=r[a*n-1];if(i==h)return r.slice((a-1)*n,(a-1)*n+n);const u=r[(a+1)*n-1],c=(i-h)/(u-h);o=[];for(let f=0;f<n-1;++f)o.push(mr(r[(a-1)*n+f],r[a*n+f],c));return o.push(i),o}function Rv(r,t,e,n,i,s,o){if(o)return Qu(r,t,e[e.length-1],n,i,s);let a;if(i<r[n-1])return s?(a=r.slice(0,n),a[n-1]=i,a):null;if(r[r.length-1]<i)return s?(a=r.slice(r.length-n),a[n-1]=i,a):null;for(let l=0,h=e.length;l<h;++l){const u=e[l];if(t!=u){if(i<r[t+n-1])return null;if(i<=r[u-1])return Qu(r,t,u,n,i,!1);t=u}}return null}function Cv(r,t,e,n,i){return!Xm(i,function(s){return!Mi(r,t,e,n,s[0],s[1])})}function Mi(r,t,e,n,i,s){let o=0,a=r[e-n],l=r[e-n+1];for(;t<e;t+=n){const h=r[t],u=r[t+1];l<=s?u>s&&(h-a)*(s-l)-(i-a)*(u-l)>0&&o++:u<=s&&(h-a)*(s-l)-(i-a)*(u-l)<0&&o--,a=h,l=u}return o!==0}function ed(r,t,e,n,i,s){if(e.length===0||!Mi(r,t,e[0],n,i,s))return!1;for(let o=1,a=e.length;o<a;++o)if(Mi(r,e[o-1],e[o],n,i,s))return!1;return!0}function Iv(r,t,e,n,i,s){if(e.length===0)return!1;for(let o=0,a=e.length;o<a;++o){const l=e[o];if(ed(r,t,l,n,i,s))return!0;t=l[l.length-1]}return!1}function ph(r,t,e,n,i){const s=Bm(ze(),r,t,e,n);return Qt(i,s)?Ze(i,s)||s[0]>=i[0]&&s[2]<=i[2]||s[1]>=i[1]&&s[3]<=i[3]?!0:n0(r,t,e,n,function(o,a){return Vx(i,o,a)}):!1}function Pv(r,t,e,n,i){for(let s=0,o=e.length;s<o;++s){if(ph(r,t,e[s],n,i))return!0;t=e[s]}return!1}function i0(r,t,e,n,i){return!!(ph(r,t,e,n,i)||Mi(r,t,e,n,i[0],i[1])||Mi(r,t,e,n,i[0],i[3])||Mi(r,t,e,n,i[2],i[1])||Mi(r,t,e,n,i[2],i[3]))}function s0(r,t,e,n,i){if(!i0(r,t,e[0],n,i))return!1;if(e.length===1)return!0;for(let s=1,o=e.length;s<o;++s)if(Cv(r,e[s-1],e[s],n,i)&&!ph(r,e[s-1],e[s],n,i))return!1;return!0}function Av(r,t,e,n,i){for(let s=0,o=e.length;s<o;++s){const a=e[s];if(s0(r,t,a,n,i))return!0;t=a[a.length-1]}return!1}function o0(r,t,e,n){let i=r[t],s=r[t+1],o=0;for(let a=t+n;a<e;a+=n){const l=r[a],h=r[a+1];o+=Math.sqrt((l-i)*(l-i)+(h-s)*(h-s)),i=l,s=h}return o}class ye extends Dn{constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendCoordinate(t){Ot(this.flatCoordinates,t),this.changed()}clone(){const t=new ye(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,i){return i<Zi(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Hc(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Qc(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,n,i))}forEachSegment(t){return n0(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){return this.layout!="XYM"&&this.layout!="XYZM"?null:(e=e!==void 0?e:!1,Qu(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e))}getCoordinates(){return Rn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return Ml(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}getLength(){return o0(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const e=[];return e.length=gh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new ye(e,"XY")}getType(){return"LineString"}intersectsExtent(t){return ph(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Sa(this.flatCoordinates,0,t,this.stride),this.changed()}}class ur extends Dn{constructor(t,e,n){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,e);else if(e!==void 0&&n)this.setFlatCoordinates(e,t),this.ends_=n;else{const i=t,s=[],o=[];for(let l=0,h=i.length;l<h;++l){const u=i[l];Ot(s,u.getFlatCoordinates()),o.push(s.length)}const a=i.length===0?this.getLayout():i[0].getLayout();this.setFlatCoordinates(a,s),this.ends_=o}}appendLineString(t){Ot(this.flatCoordinates,t.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new ur(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,n,i){return i<Zi(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Kc(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Jc(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,n,i))}getCoordinateAtM(t,e,n){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(e=e!==void 0?e:!1,n=n!==void 0?n:!1,Rv(this.flatCoordinates,0,this.ends_,this.stride,t,e,n))}getCoordinates(){return Ho(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new ye(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){const t=this.flatCoordinates,e=this.ends_,n=this.layout,i=[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=e[o],h=new ye(t.slice(s,l),n);i.push(h),s=l}return i}getFlatMidpoints(){const t=[],e=this.flatCoordinates;let n=0;const i=this.ends_,s=this.stride;for(let o=0,a=i.length;o<a;++o){const l=i[o],h=Ml(e,n,l,s,.5);Ot(t,h),n=l}return t}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=t0(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,n),new ur(e,"XY",n)}getType(){return"MultiLineString"}intersectsExtent(t){return Pv(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=Ea(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}let Re=class a0 extends Dn{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new a0(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,i){const s=this.flatCoordinates,o=Ai(t,e,s[0],s[1]);if(o<i){const a=this.stride;for(let l=0;l<a;++l)n[l]=s[l];return n.length=a,o}return i}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return zc(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return jc(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=wv(this.flatCoordinates,0,t,this.stride),this.changed()}};class Zr extends Dn{constructor(t,e){super(),e&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendPoint(t){Ot(this.flatCoordinates,t.getFlatCoordinates()),this.changed()}clone(){const t=new Zr(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,i){if(i<Zi(this.getExtent(),t,e))return i;const s=this.flatCoordinates,o=this.stride;for(let a=0,l=s.length;a<l;a+=o){const h=Ai(t,e,s[a],s[a+1]);if(h<i){i=h;for(let u=0;u<o;++u)n[u]=s[a+u];n.length=o}}return i}getCoordinates(){return Rn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){const e=this.flatCoordinates.length/this.stride;return t<0||e<=t?null:new Re(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){const t=this.flatCoordinates,e=this.layout,n=this.stride,i=[];for(let s=0,o=t.length;s<o;s+=n){const a=new Re(t.slice(s,s+n),e);i.push(a)}return i}getType(){return"MultiPoint"}intersectsExtent(t){const e=this.flatCoordinates,n=this.stride;for(let i=0,s=e.length;i<s;i+=n){const o=e[i],a=e[i+1];if(jc(t,o,a))return!0}return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Sa(this.flatCoordinates,0,t,this.stride),this.changed()}}function rd(r,t,e,n,i,s,o){let a,l,h,u,c,f,g;const m=i[s+1],_=[];for(let w=0,S=e.length;w<S;++w){const E=e[w];for(u=r[E-n],f=r[E-n+1],a=t;a<E;a+=n)c=r[a],g=r[a+1],(m<=f&&g<=m||f<=m&&m<=g)&&(h=(m-f)/(g-f)*(c-u)+u,_.push(h)),u=c,f=g}let x=NaN,v=-1/0;for(_.sort(on),u=_[0],a=1,l=_.length;a<l;++a){c=_[a];const w=Math.abs(c-u);w>v&&(h=(u+c)/2,ed(r,t,e,n,h,m)&&(x=h,v=w)),u=c}return isNaN(x)&&(x=i[s]),o?(o.push(x,m,v),o):[x,m,v]}function l0(r,t,e,n,i){let s=[];for(let o=0,a=e.length;o<a;++o){const l=e[o];s=rd(r,t,l,n,i,2*o,s),t=l[l.length-1]}return s}function Lv(r,t,e,n){for(;t<e-n;){for(let i=0;i<n;++i){const s=r[t+i];r[t+i]=r[e-n+i],r[e-n+i]=s}t+=n,e-=n}}function mh(r,t,e,n){let i=0,s=r[e-n],o=r[e-n+1];for(;t<e;t+=n){const a=r[t],l=r[t+1];i+=(a-s)*(l+o),s=a,o=l}return i===0?void 0:i>0}function nd(r,t,e,n,i){i=i!==void 0?i:!1;for(let s=0,o=e.length;s<o;++s){const a=e[s],l=mh(r,t,a,n);if(s===0){if(i&&l||!i&&!l)return!1}else if(i&&!l||!i&&l)return!1;t=a}return!0}function h0(r,t,e,n,i){for(let s=0,o=e.length;s<o;++s){const a=e[s];if(!nd(r,t,a,n,i))return!1;a.length&&(t=a[a.length-1])}return!0}function Rl(r,t,e,n,i){i=i!==void 0?i:!1;for(let s=0,o=e.length;s<o;++s){const a=e[s],l=mh(r,t,a,n);(s===0?i&&l||!i&&!l:i&&!l||!i&&l)&&Lv(r,t,a,n),t=a}return t}function Ju(r,t,e,n,i){for(let s=0,o=e.length;s<o;++s)t=Rl(r,t,e[s],n,i);return t}function u0(r,t){const e=[];let n=0,i=0,s;for(let o=0,a=t.length;o<a;++o){const l=t[o],h=mh(r,n,l,2);if(s===void 0&&(s=h),h===s)e.push(t.slice(i,o+1));else{if(e.length===0)continue;e[e.length-1].push(t[i])}i=o+1,n=l}return e}class Ue extends Dn{constructor(t,e,n){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,e!==void 0&&n?(this.setFlatCoordinates(e,t),this.ends_=n):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?Ot(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new Ue(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,n,i){return i<Zi(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Kc(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Jc(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,n,i))}containsXY(t,e){return ed(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return r0(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),Rl(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,Ho(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=Ce(this.getExtent());this.flatInteriorPoint_=rd(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Re(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new ci(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,n=this.ends_,i=[];let s=0;for(let o=0,a=n.length;o<a;++o){const l=n[o],h=new ci(e.slice(s,l),t);i.push(h),s=l}return i}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;nd(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Rl(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=td(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,n),new Ue(e,"XY",n)}getType(){return"Polygon"}intersectsExtent(t){return s0(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=Ea(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}function yg(r){if(Un(r))throw new Error("Cannot create polygon from empty extent");const t=r[0],e=r[1],n=r[2],i=r[3],s=[t,e,t,i,n,i,n,e,t,e];return new Ue(s,"XY",[s.length])}function c0(r,t,e,n){const i=[];let s=ze();for(let o=0,a=e.length;o<a;++o){const l=e[o];s=Uc(r,t,l[0],n),i.push((s[0]+s[2])/2,(s[1]+s[3])/2),t=l[l.length-1]}return i}class Pr extends Dn{constructor(t,e,n){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!n&&!Array.isArray(t[0])){const i=t,s=[],o=[];for(let a=0,l=i.length;a<l;++a){const h=i[a],u=s.length,c=h.getEnds();for(let f=0,g=c.length;f<g;++f)c[f]+=u;Ot(s,h.getFlatCoordinates()),o.push(c)}e=i.length===0?this.getLayout():i[0].getLayout(),t=s,n=o}e!==void 0&&n?(this.setFlatCoordinates(e,t),this.endss_=n):this.setCoordinates(t,e)}appendPolygon(t){let e;if(!this.flatCoordinates)this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();else{const n=this.flatCoordinates.length;Ot(this.flatCoordinates,t.getFlatCoordinates()),e=t.getEnds().slice();for(let i=0,s=e.length;i<s;++i)e[i]+=n}this.endss_.push(e),this.changed()}clone(){const t=this.endss_.length,e=new Array(t);for(let i=0;i<t;++i)e[i]=this.endss_[i].slice();const n=new Pr(this.flatCoordinates.slice(),this.layout,e);return n.applyProperties(this),n}closestPointXY(t,e,n,i){return i<Zi(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(bv(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Sv(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,n,i))}containsXY(t,e){return Iv(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)}getArea(){return Mv(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),Ju(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,Ku(e,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const t=c0(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=l0(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new Zr(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;h0(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Ju(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=Tv(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,n),new Pr(e,"XY",n)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let e;if(t===0)e=0;else{const s=this.endss_[t-1];e=s[s.length-1]}const n=this.endss_[t].slice(),i=n[n.length-1];if(e!==0)for(let s=0,o=n.length;s<o;++s)n[s]-=e;return new Ue(this.flatCoordinates.slice(e,i),this.layout,n)}getPolygons(){const t=this.layout,e=this.flatCoordinates,n=this.endss_,i=[];let s=0;for(let o=0,a=n.length;o<a;++o){const l=n[o].slice(),h=l[l.length-1];if(s!==0)for(let c=0,f=l.length;c<f;++c)l[c]-=s;const u=new Ue(e.slice(s,h),t,l);i.push(u),s=h}return i}getType(){return"MultiPolygon"}intersectsExtent(t){return Av(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);const n=Jm(this.flatCoordinates,0,t,this.stride,this.endss_);if(n.length===0)this.flatCoordinates.length=0;else{const i=n[n.length-1];this.flatCoordinates.length=i.length===0?0:i[i.length-1]}this.changed()}}const xg=pe();class Ge{constructor(t,e,n,i,s,o){this.styleFunction,this.extent_,this.id_=o,this.type_=t,this.flatCoordinates_=e,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=n||null,this.properties_=s,this.squaredTolerance_,this.stride_=i,this.simplifiedGeometry_}get(t){return this.properties_[t]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?zc(this.flatCoordinates_):Uc(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const t=Ce(this.getExtent());this.flatInteriorPoints_=rd(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const t=u0(this.flatCoordinates_,this.ends_),e=c0(this.flatCoordinates_,0,t,2);this.flatInteriorPoints_=l0(this.flatCoordinates_,0,t,2,e)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=Ml(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const t=this.flatCoordinates_;let e=0;const n=this.ends_;for(let i=0,s=n.length;i<s;++i){const o=n[i],a=Ml(t,e,o,2,.5);Ot(this.flatMidpoints_,a),e=o}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(t){return this}simplifyTransformed(t,e){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(t){t=tt(t);const e=t.getExtent(),n=t.getWorldExtent();if(e&&n){const i=Vt(n)/Vt(e);hr(xg,n[0],n[3],i,-i,0,0,0),li(this.flatCoordinates_,0,this.flatCoordinates_.length,2,xg,this.flatCoordinates_)}}applyTransform(t){t(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){var t;return new Ge(this.type_,this.flatCoordinates_.slice(),(t=this.ends_)==null?void 0:t.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=jm((t,e)=>{if(t===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),e&&this.simplifiedGeometry_.applyTransform(e);const n=this.simplifiedGeometry_.getFlatCoordinates();let i;switch(this.type_){case"LineString":n.length=gh(n,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,t,n,0),i=[n.length];break;case"MultiLineString":i=[],n.length=t0(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,t,n,0,i);break;case"Polygon":i=[],n.length=td(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(t),n,0,i);break}return i&&(this.simplifiedGeometry_=new Ge(this.type_,n,i,2,this.properties_,this.id_)),this.squaredTolerance_=t,this.simplifiedGeometry_}),this}}Ge.prototype.getFlatCoordinates=Ge.prototype.getOrientedFlatCoordinates;class Ov{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=Se,this.supportedMediaTypes=null}getReadOptions(t,e){if(e){let n=e.dataProjection?tt(e.dataProjection):this.readProjection(t);e.extent&&n&&n.getUnits()==="tile-pixels"&&(n=tt(n),n.setWorldExtent(e.extent)),e={dataProjection:n,featureProjection:e.featureProjection}}return this.adaptOptions(e)}adaptOptions(t){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},t)}getType(){return ut()}readFeature(t,e){return ut()}readFeatures(t,e){return ut()}readGeometry(t,e){return ut()}readProjection(t){return ut()}writeFeature(t,e){return ut()}writeFeatures(t,e){return ut()}writeGeometry(t,e){return ut()}}const Ta=Ov;function se(r,t,e){const n=e?tt(e.featureProjection):null,i=e?tt(e.dataProjection):null;let s=r;if(n&&i&&!Ae(n,i)){t&&(s=r.clone());const o=t?n:i,a=t?i:n;o.getUnits()==="tile-pixels"?s.transform(o,a):s.applyTransform(hn(o,a))}if(t&&e&&e.decimals!==void 0){const o=Math.pow(10,e.decimals),a=function(l){for(let h=0,u=l.length;h<u;++h)l[h]=Math.round(l[h]*o)/o;return l};s===r&&(s=r.clone()),s.applyTransform(a)}return s}function id(r,t){const e=t?tt(t.featureProjection):null,n=t?tt(t.dataProjection):null;return e&&n&&!Ae(e,n)?Vc(r,n,e):r}const Fv={Point:Re,LineString:ye,Polygon:Ue,MultiPoint:Zr,MultiLineString:ur,MultiPolygon:Pr};function Nv(r,t,e){return Array.isArray(t[0])?(h0(r,0,t,e)||(r=r.slice(),Ju(r,0,t,e)),r):(nd(r,0,t,e)||(r=r.slice(),Rl(r,0,t,e)),r)}function d0(r,t){var e;const n=r.geometry;if(!n)return[];if(Array.isArray(n))return n.map(o=>d0({...r,geometry:o})).flat();const i=n.type==="MultiPolygon"?"Polygon":n.type;if(i==="GeometryCollection"||i==="Circle")throw new Error("Unsupported geometry type: "+i);const s=n.layout.length;return se(new Ge(i,i==="Polygon"?Nv(n.flatCoordinates,n.ends,s):n.flatCoordinates,(e=n.ends)==null?void 0:e.flat(),s,r.properties||{},r.id).enableSimplifyTransformed(),!1,t)}function sd(r,t){if(!r)return null;if(Array.isArray(r)){const n=r.map(i=>sd(i,t));return new je(n)}const e=Fv[r.type];return se(new e(r.flatCoordinates,r.layout,r.ends),!1,t)}class od extends Ta{constructor(){super()}getType(){return"json"}readFeature(t,e){return this.readFeatureFromObject(Va(t),this.getReadOptions(t,e))}readFeatures(t,e){return this.readFeaturesFromObject(Va(t),this.getReadOptions(t,e))}readFeatureFromObject(t,e){return ut()}readFeaturesFromObject(t,e){return ut()}readGeometry(t,e){return this.readGeometryFromObject(Va(t),this.getReadOptions(t,e))}readGeometryFromObject(t,e){return ut()}readProjection(t){return this.readProjectionFromObject(Va(t))}readProjectionFromObject(t){return ut()}writeFeature(t,e){return JSON.stringify(this.writeFeatureObject(t,e))}writeFeatureObject(t,e){return ut()}writeFeatures(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))}writeFeaturesObject(t,e){return ut()}writeGeometry(t,e){return JSON.stringify(this.writeGeometryObject(t,e))}writeGeometryObject(t,e){return ut()}}function Va(r){return typeof r=="string"?JSON.parse(r)||null:r!==null?r:null}const Dv={Point:zv,LineString:Uv,Polygon:qv,MultiPoint:Xv,MultiLineString:Bv,MultiPolygon:Wv},kv={Point:Zv,LineString:$v,Polygon:Vv,MultiPoint:Hv,MultiLineString:Yv,MultiPolygon:Kv};class Gv extends od{constructor(t){t=t||{},super(),this.geometryName_=t.geometryName}readFeatureFromObject(t,e,n){const i=t,s=vg(i.geometry,e),o=new Se;if(this.geometryName_&&o.setGeometryName(this.geometryName_),o.setGeometry(s),i.attributes){o.setProperties(i.attributes,!0);const a=i.attributes[n];a!==void 0&&o.setId(a)}return o}readFeaturesFromObject(t,e){if(e=e||{},t.features){const n=t,i=[],s=n.features;for(let o=0,a=s.length;o<a;++o)i.push(this.readFeatureFromObject(s[o],e,t.objectIdFieldName));return i}return[this.readFeatureFromObject(t,e)]}readGeometryFromObject(t,e){return vg(t,e)}readProjectionFromObject(t){if(t.spatialReference&&t.spatialReference.wkid!==void 0){const e=t.spatialReference.wkid;return tt("EPSG:"+e)}return null}writeGeometryObject(t,e){return wg(t,this.adaptOptions(e))}writeFeatureObject(t,e){e=this.adaptOptions(e);const n={};if(!t.hasProperties())return n.attributes={},n;const i=t.getProperties(),s=t.getGeometry();if(s){n.geometry=wg(s,e);const o=e&&(e.dataProjection||e.featureProjection);o&&(n.geometry.spatialReference={wkid:Number(tt(o).getCode().split(":").pop())}),delete i[t.getGeometryName()]}return Fn(i)?n.attributes={}:n.attributes=i,n}writeFeaturesObject(t,e){e=this.adaptOptions(e);const n=[];for(let i=0,s=t.length;i<s;++i)n.push(this.writeFeatureObject(t[i],e));return{features:n}}}function vg(r,t){if(!r)return null;let e;if(typeof r.x=="number"&&typeof r.y=="number")e="Point";else if(r.points)e="MultiPoint";else if(r.paths)r.paths.length===1?e="LineString":e="MultiLineString";else if(r.rings){const i=r,s=Ys(i),o=jv(i.rings,s);o.length===1?(e="Polygon",r=Object.assign({},r,{rings:o[0]})):(e="MultiPolygon",r=Object.assign({},r,{rings:o}))}const n=Dv[e];return se(n(r),!1,t)}function jv(r,t){const e=[],n=[],i=[];let s,o;for(s=0,o=r.length;s<o;++s)e.length=0,Sa(e,0,r[s],t.length),mh(e,0,e.length,t.length)?n.push([r[s]]):i.push(r[s]);for(;i.length;){const a=i.shift();let l=!1;for(s=n.length-1;s>=0;s--){const h=n[s][0];if(Ze(new ci(h).getExtent(),new ci(a).getExtent())){n[s].push(a),l=!0;break}}l||n.push([a.reverse()])}return n}function zv(r){let t;return r.m!==void 0&&r.z!==void 0?t=new Re([r.x,r.y,r.z,r.m],"XYZM"):r.z!==void 0?t=new Re([r.x,r.y,r.z],"XYZ"):r.m!==void 0?t=new Re([r.x,r.y,r.m],"XYM"):t=new Re([r.x,r.y]),t}function Uv(r){const t=Ys(r);return new ye(r.paths[0],t)}function Bv(r){const t=Ys(r);return new ur(r.paths,t)}function Ys(r){let t="XY";return r.hasZ===!0&&r.hasM===!0?t="XYZM":r.hasZ===!0?t="XYZ":r.hasM===!0&&(t="XYM"),t}function Xv(r){const t=Ys(r);return new Zr(r.points,t)}function Wv(r){const t=Ys(r);return new Pr(r.rings,t)}function qv(r){const t=Ys(r);return new Ue(r.rings,t)}function Zv(r,t){const e=r.getCoordinates();let n;const i=r.getLayout();if(i==="XYZ")n={x:e[0],y:e[1],z:e[2]};else if(i==="XYM")n={x:e[0],y:e[1],m:e[2]};else if(i==="XYZM")n={x:e[0],y:e[1],z:e[2],m:e[3]};else if(i==="XY")n={x:e[0],y:e[1]};else throw new Error("Invalid geometry layout");return n}function Ma(r){const t=r.getLayout();return{hasZ:t==="XYZ"||t==="XYZM",hasM:t==="XYM"||t==="XYZM"}}function $v(r,t){const e=Ma(r);return{hasZ:e.hasZ,hasM:e.hasM,paths:[r.getCoordinates()]}}function Vv(r,t){const e=Ma(r);return{hasZ:e.hasZ,hasM:e.hasM,rings:r.getCoordinates(!1)}}function Yv(r,t){const e=Ma(r);return{hasZ:e.hasZ,hasM:e.hasM,paths:r.getCoordinates()}}function Hv(r,t){const e=Ma(r);return{hasZ:e.hasZ,hasM:e.hasM,points:r.getCoordinates()}}function Kv(r,t){const e=Ma(r),n=r.getCoordinates(!1),i=[];for(let s=0;s<n.length;s++)for(let o=n[s].length-1;o>=0;o--)i.push(n[s][o]);return{hasZ:e.hasZ,hasM:e.hasM,rings:i}}function wg(r,t){const e=kv[r.getType()];return e(se(r,!0,t),t)}const Qv=Gv;class Jv extends od{constructor(t){t=t||{},super(),this.dataProjection=tt(t.dataProjection?t.dataProjection:"EPSG:4326"),t.featureProjection&&(this.defaultFeatureProjection=tt(t.featureProjection)),t.featureClass&&(this.featureClass=t.featureClass),this.geometryName_=t.geometryName,this.extractGeometryName_=t.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(t,e){let n=null;t.type==="Feature"?n=t:n={type:"Feature",geometry:t,properties:null};const i=ad(n.geometry);if(this.featureClass===Ge)return d0({geometry:i,id:n.id,properties:n.properties},e);const s=new Se;return this.geometryName_?s.setGeometryName(this.geometryName_):this.extractGeometryName_&&n.geometry_name&&s.setGeometryName(n.geometry_name),s.setGeometry(sd(i,e)),"id"in n&&s.setId(n.id),n.properties&&s.setProperties(n.properties,!0),s}readFeaturesFromObject(t,e){const n=t;let i=null;if(n.type==="FeatureCollection"){const s=t;i=[];const o=s.features;for(let a=0,l=o.length;a<l;++a){const h=this.readFeatureFromObject(o[a],e);h&&i.push(h)}}else i=[this.readFeatureFromObject(t,e)];return i.flat()}readGeometryFromObject(t,e){return tw(t,e)}readProjectionFromObject(t){const e=t.crs;let n;if(e)if(e.type=="name")n=tt(e.properties.name);else if(e.type==="EPSG")n=tt("EPSG:"+e.properties.code);else throw new Error("Unknown SRS type");else n=this.dataProjection;return n}writeFeatureObject(t,e){e=this.adaptOptions(e);const n={type:"Feature",geometry:null,properties:null},i=t.getId();if(i!==void 0&&(n.id=i),!t.hasProperties())return n;const s=t.getProperties(),o=t.getGeometry();return o&&(n.geometry=tc(o,e),delete s[t.getGeometryName()]),Fn(s)||(n.properties=s),n}writeFeaturesObject(t,e){e=this.adaptOptions(e);const n=[];for(let i=0,s=t.length;i<s;++i)n.push(this.writeFeatureObject(t[i],e));return{type:"FeatureCollection",features:n}}writeGeometryObject(t,e){return tc(t,this.adaptOptions(e))}}function ad(r,t){if(!r)return null;let e;switch(r.type){case"Point":{e=rw(r);break}case"LineString":{e=nw(r);break}case"Polygon":{e=aw(r);break}case"MultiPoint":{e=sw(r);break}case"MultiLineString":{e=iw(r);break}case"MultiPolygon":{e=ow(r);break}case"GeometryCollection":{e=ew(r);break}default:throw new Error("Unsupported GeoJSON type: "+r.type)}return e}function tw(r,t){const e=ad(r);return sd(e,t)}function ew(r,t){return r.geometries.map(function(e){return ad(e)})}function rw(r){const t=r.coordinates;return{type:"Point",flatCoordinates:t,layout:Vi(t.length)}}function nw(r){var t;const e=r.coordinates,n=e.flat();return{type:"LineString",flatCoordinates:n,ends:[n.length],layout:Vi(((t=e[0])==null?void 0:t.length)||2)}}function iw(r){var t,e;const n=r.coordinates,i=((e=(t=n[0])==null?void 0:t[0])==null?void 0:e.length)||2,s=[],o=Ea(s,0,n,i);return{type:"MultiLineString",flatCoordinates:s,ends:o,layout:Vi(i)}}function sw(r){var t;const e=r.coordinates;return{type:"MultiPoint",flatCoordinates:e.flat(),layout:Vi(((t=e[0])==null?void 0:t.length)||2)}}function ow(r){var t,e;const n=r.coordinates,i=[],s=((e=(t=n[0])==null?void 0:t[0])==null?void 0:e[0].length)||2,o=Jm(i,0,n,s);return{type:"MultiPolygon",flatCoordinates:i,ends:o,layout:Vi(s)}}function aw(r){var t,e;const n=r.coordinates,i=[],s=(e=(t=n[0])==null?void 0:t[0])==null?void 0:e.length,o=Ea(i,0,n,s);return{type:"Polygon",flatCoordinates:i,ends:o,layout:Vi(s)}}function tc(r,t){r=se(r,!0,t);const e=r.getType();let n;switch(e){case"Point":{n=fw(r);break}case"LineString":{n=hw(r);break}case"Polygon":{n=gw(r,t);break}case"MultiPoint":{n=cw(r);break}case"MultiLineString":{n=uw(r);break}case"MultiPolygon":{n=dw(r,t);break}case"GeometryCollection":{n=lw(r,t);break}case"Circle":{n={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+e)}return n}function lw(r,t){return t=Object.assign({},t),delete t.featureProjection,{type:"GeometryCollection",geometries:r.getGeometriesArray().map(function(e){return tc(e,t)})}}function hw(r,t){return{type:"LineString",coordinates:r.getCoordinates()}}function uw(r,t){return{type:"MultiLineString",coordinates:r.getCoordinates()}}function cw(r,t){return{type:"MultiPoint",coordinates:r.getCoordinates()}}function dw(r,t){let e;return t&&(e=t.rightHanded),{type:"MultiPolygon",coordinates:r.getCoordinates(e)}}function fw(r,t){return{type:"Point",coordinates:r.getCoordinates()}}function gw(r,t){let e;return t&&(e=t.rightHanded),{type:"Polygon",coordinates:r.getCoordinates(e)}}const f0=Jv,Di="http://www.w3.org/2001/XMLSchema-instance";function mt(r,t){return Hs().createElementNS(r,t)}function Ye(r,t){return g0(r,t,[]).join("")}function g0(r,t,e){if(r.nodeType==Node.CDATA_SECTION_NODE||r.nodeType==Node.TEXT_NODE)e.push(r.nodeValue);else{let n;for(n=r.firstChild;n;n=n.nextSibling)g0(n,t,e)}return e}function Rr(r){return"documentElement"in r}function pw(r,t,e){return r.getAttributeNS(t,e)||""}function Cr(r){return new DOMParser().parseFromString(r,"application/xml")}function Cl(r,t){return function(e,n){const i=r.call(t!==void 0?t:this,e,n);if(i!==void 0){const s=n[n.length-1];Ot(s,i)}}}function ot(r,t){return function(e,n){const i=r.call(t!==void 0?t:this,e,n);i!==void 0&&n[n.length-1].push(i)}}function ht(r,t){return function(e,n){const i=r.call(t!==void 0?t:this,e,n);i!==void 0&&(n[n.length-1]=i)}}function Kt(r,t,e){return function(n,i){const s=r.call(this,n,i);if(s!==void 0){const o=i[i.length-1],a=n.localName;let l;a in o?l=o[a]:(l=[],o[a]=l),l.push(s)}}}function O(r,t,e){return function(n,i){const s=r.call(this,n,i);if(s!==void 0){const o=i[i.length-1],a=t!==void 0?t:n.localName;o[a]=s}}}function N(r,t){return function(e,n,i){r.call(t!==void 0?t:this,e,n,i),i[i.length-1].node.appendChild(e)}}function p0(r,t){let e,n;return function(i,s,o){if(e===void 0){e={};const a={};a[i.localName]=r,e[i.namespaceURI]=a,n=ue(i.localName)}m0(e,n,s,o)}}function ue(r,t){return function(e,n,i){const s=n[n.length-1].node;let o=r;o===void 0&&(o=i);const a=t!==void 0?t:s.namespaceURI;return mt(a,o)}}const Ie=ue();function cr(r,t){const e=t.length,n=new Array(e);for(let i=0;i<e;++i)n[i]=r[t[i]];return n}function q(r,t,e){e=e!==void 0?e:{};let n,i;for(n=0,i=r.length;n<i;++n)e[r[n]]=t;return e}function lr(r,t,e,n){let i;for(i=t.firstElementChild;i;i=i.nextElementSibling){const s=r[i.namespaceURI];if(s!==void 0){const o=s[i.localName];o!==void 0&&o.call(n,i,e)}}}function Z(r,t,e,n,i){return n.push(r),lr(t,e,n,i),n.pop()}function m0(r,t,e,n,i,s){const o=(i!==void 0?i:e).length;let a,l;for(let h=0;h<o;++h)a=e[h],a!==void 0&&(l=t.call(s!==void 0?s:this,a,n,i!==void 0?i[h]:void 0),l!==void 0&&r[l.namespaceURI][l.localName].call(s,l,a,n))}function pt(r,t,e,n,i,s,o){return i.push(r),m0(t,e,n,i,s,o),i.pop()}let ou;function mw(){return ou===void 0&&typeof XMLSerializer<"u"&&(ou=new XMLSerializer),ou}let au;function Hs(){return au===void 0&&typeof document<"u"&&(au=document.implementation.createDocument("","",null)),au}class Ra extends Ta{constructor(){super(),this.xmlSerializer_=mw()}getType(){return"xml"}readFeature(t,e){if(!t)return null;if(typeof t=="string"){const n=Cr(t);return this.readFeatureFromDocument(n,e)}return Rr(t)?this.readFeatureFromDocument(t,e):this.readFeatureFromNode(t,e)}readFeatureFromDocument(t,e){const n=this.readFeaturesFromDocument(t,e);return n.length>0?n[0]:null}readFeatureFromNode(t,e){return null}readFeatures(t,e){if(!t)return[];if(typeof t=="string"){const n=Cr(t);return this.readFeaturesFromDocument(n,e)}return Rr(t)?this.readFeaturesFromDocument(t,e):this.readFeaturesFromNode(t,e)}readFeaturesFromDocument(t,e){const n=[];for(let i=t.firstChild;i;i=i.nextSibling)i.nodeType==Node.ELEMENT_NODE&&Ot(n,this.readFeaturesFromNode(i,e));return n}readFeaturesFromNode(t,e){return ut()}readGeometry(t,e){if(!t)return null;if(typeof t=="string"){const n=Cr(t);return this.readGeometryFromDocument(n,e)}return Rr(t)?this.readGeometryFromDocument(t,e):this.readGeometryFromNode(t,e)}readGeometryFromDocument(t,e){return null}readGeometryFromNode(t,e){return null}readProjection(t){if(!t)return null;if(typeof t=="string"){const e=Cr(t);return this.readProjectionFromDocument(e)}return Rr(t)?this.readProjectionFromDocument(t):this.readProjectionFromNode(t)}readProjectionFromDocument(t){return this.dataProjection}readProjectionFromNode(t){return this.dataProjection}writeFeature(t,e){const n=this.writeFeatureNode(t,e);return this.xmlSerializer_.serializeToString(n)}writeFeatureNode(t,e){return null}writeFeatures(t,e){const n=this.writeFeaturesNode(t,e);return this.xmlSerializer_.serializeToString(n)}writeFeaturesNode(t,e){return null}writeGeometry(t,e){const n=this.writeGeometryNode(t,e);return this.xmlSerializer_.serializeToString(n)}writeGeometryNode(t,e){return null}}const Pn="http://www.opengis.net/gml",_w=/^\s*$/;class st extends Ra{constructor(t){super(),t=t||{},this.featureType=t.featureType,this.featureNS=t.featureNS,this.srsName=t.srsName,this.schemaLocation="",this.FEATURE_COLLECTION_PARSERS={},this.FEATURE_COLLECTION_PARSERS[this.namespace]={featureMember:ot(this.readFeaturesInternal),featureMembers:ht(this.readFeaturesInternal)},this.supportedMediaTypes=["application/gml+xml"]}readFeaturesInternal(t,e){const n=t.localName;let i=null;if(n=="FeatureCollection")i=Z([],this.FEATURE_COLLECTION_PARSERS,t,e,this);else if(n=="featureMembers"||n=="featureMember"||n=="member"){const s=e[0];let o=s.featureType,a=s.featureNS;const l="p",h="p0";if(!o&&t.childNodes){o=[],a={};for(let f=0,g=t.childNodes.length;f<g;++f){const m=t.childNodes[f];if(m.nodeType===1){const _=m.nodeName.split(":").pop();if(!o.includes(_)){let x="",v=0;const w=m.namespaceURI;for(const S in a){if(a[S]===w){x=S;break}++v}x||(x=l+v,a[x]=w),o.push(x+":"+_)}}}n!="featureMember"&&(s.featureType=o,s.featureNS=a)}if(typeof a=="string"){const f=a;a={},a[h]=f}const u={},c=Array.isArray(o)?o:[o];for(const f in a){const g={};for(let m=0,_=c.length;m<_;++m)(c[m].includes(":")?c[m].split(":")[0]:h)===f&&(g[c[m].split(":").pop()]=n=="featureMembers"?ot(this.readFeatureElement,this):ht(this.readFeatureElement,this));u[a[f]]=g}n=="featureMember"||n=="member"?i=Z(void 0,u,t,e):i=Z([],u,t,e)}return i===null&&(i=[]),i}readGeometryOrExtent(t,e){const n=e[0];return n.srsName=t.firstElementChild.getAttribute("srsName"),n.srsDimension=t.firstElementChild.getAttribute("srsDimension"),Z(null,this.GEOMETRY_PARSERS,t,e,this)}readExtentElement(t,e){const n=e[0],i=this.readGeometryOrExtent(t,e);return i?id(i,n):void 0}readGeometryElement(t,e){const n=e[0],i=this.readGeometryOrExtent(t,e);return i?se(i,!1,n):void 0}readFeatureElementInternal(t,e,n){let i;const s={};for(let l=t.firstElementChild;l;l=l.nextElementSibling){let h;const u=l.localName;l.childNodes.length===0||l.childNodes.length===1&&(l.firstChild.nodeType===3||l.firstChild.nodeType===4)?(h=Ye(l,!1),_w.test(h)&&(h=void 0)):(n&&(h=u==="boundedBy"?this.readExtentElement(l,e):this.readGeometryElement(l,e)),h?u!=="boundedBy"&&(i=u):h=this.readFeatureElementInternal(l,e,!1));const c=l.attributes.length;if(c>0&&!(h instanceof Yc)){h={_content_:h};for(let f=0;f<c;f++){const g=l.attributes[f].name;h[g]=l.attributes[f].value}}s[u]?(s[u]instanceof Array||(s[u]=[s[u]]),s[u].push(h)):s[u]=h}if(!n)return s;const o=new Se(s);i&&o.setGeometryName(i);const a=t.getAttribute("fid")||pw(t,this.namespace,"id");return a&&o.setId(a),o}readFeatureElement(t,e){return this.readFeatureElementInternal(t,e,!0)}readPoint(t,e){const n=this.readFlatCoordinatesFromNode(t,e);if(n)return new Re(n,"XYZ")}readMultiPoint(t,e){const n=Z([],this.MULTIPOINT_PARSERS,t,e,this);if(n)return new Zr(n)}readMultiLineString(t,e){const n=Z([],this.MULTILINESTRING_PARSERS,t,e,this);if(n)return new ur(n)}readMultiPolygon(t,e){const n=Z([],this.MULTIPOLYGON_PARSERS,t,e,this);if(n)return new Pr(n)}pointMemberParser(t,e){lr(this.POINTMEMBER_PARSERS,t,e,this)}lineStringMemberParser(t,e){lr(this.LINESTRINGMEMBER_PARSERS,t,e,this)}polygonMemberParser(t,e){lr(this.POLYGONMEMBER_PARSERS,t,e,this)}readLineString(t,e){const n=this.readFlatCoordinatesFromNode(t,e);if(n)return new ye(n,"XYZ")}readFlatLinearRing(t,e){const n=Z(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,t,e,this);if(n)return n}readLinearRing(t,e){const n=this.readFlatCoordinatesFromNode(t,e);if(n)return new ci(n,"XYZ")}readPolygon(t,e){const n=Z([null],this.FLAT_LINEAR_RINGS_PARSERS,t,e,this);if(n&&n[0]){const i=n[0],s=[i.length];let o,a;for(o=1,a=n.length;o<a;++o)Ot(i,n[o]),s.push(i.length);return new Ue(i,"XYZ",s)}}readFlatCoordinatesFromNode(t,e){return Z(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,t,e,this)}readGeometryFromNode(t,e){return this.readGeometryElement(t,[this.getReadOptions(t,e||{})])||null}readFeaturesFromNode(t,e){const n={featureType:this.featureType,featureNS:this.featureNS};return n&&Object.assign(n,this.getReadOptions(t,e)),this.readFeaturesInternal(t,[n])||[]}readProjectionFromNode(t){return tt(this.srsName?this.srsName:t.firstElementChild.getAttribute("srsName"))}}st.prototype.namespace=Pn;st.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{}};st.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{}};st.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{}};st.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml":{pointMember:ot(st.prototype.pointMemberParser),pointMembers:ot(st.prototype.pointMemberParser)}};st.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml":{lineStringMember:ot(st.prototype.lineStringMemberParser),lineStringMembers:ot(st.prototype.lineStringMemberParser)}};st.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml":{polygonMember:ot(st.prototype.polygonMemberParser),polygonMembers:ot(st.prototype.polygonMemberParser)}};st.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml":{Point:ot(st.prototype.readFlatCoordinatesFromNode)}};st.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:ot(st.prototype.readLineString)}};st.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:ot(st.prototype.readPolygon)}};st.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:ht(st.prototype.readFlatLinearRing)}};function di(r){const t=Ye(r,!1);return Li(t)}function Li(r){const t=/^\s*(true|1)|(false|0)\s*$/.exec(r);if(t)return t[1]!==void 0||!1}function _h(r){const t=Ye(r,!1),e=Date.parse(t);return isNaN(e)?void 0:e/1e3}function Pt(r){const t=Ye(r,!1);return En(t)}function En(r){const t=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(r);if(t)return parseFloat(t[1])}function fe(r){const t=Ye(r,!1);return Cn(t)}function Cn(r){const t=/^\s*(\d+)\s*$/.exec(r);if(t)return parseInt(t[1],10)}function $(r){return Ye(r,!1).trim()}function ks(r,t){gt(r,t?"1":"0")}function yw(r,t){r.appendChild(Hs().createCDATASection(t))}function xw(r,t){const e=new Date(t*1e3),n=e.getUTCFullYear()+"-"+Ti(e.getUTCMonth()+1,2)+"-"+Ti(e.getUTCDate(),2)+"T"+Ti(e.getUTCHours(),2)+":"+Ti(e.getUTCMinutes(),2)+":"+Ti(e.getUTCSeconds(),2)+"Z";r.appendChild(Hs().createTextNode(n))}function rr(r,t){const e=t.toPrecision();r.appendChild(Hs().createTextNode(e))}function Il(r,t){const e=t.toString();r.appendChild(Hs().createTextNode(e))}function gt(r,t){r.appendChild(Hs().createTextNode(t))}const vw=Pn+" http://schemas.opengis.net/gml/2.1.2/feature.xsd",ww={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class It extends st{constructor(t){t=t||{},super(t),this.FEATURE_COLLECTION_PARSERS[Pn].featureMember=ot(this.readFeaturesInternal),this.schemaLocation=t.schemaLocation?t.schemaLocation:vw}readFlatCoordinates(t,e){const n=Ye(t,!1).replace(/^\s*|\s*$/g,""),i=e[0].srsName;let s="enu";if(i){const l=tt(i);l&&(s=l.getAxisOrientation())}const o=n.trim().split(/\s+/),a=[];for(let l=0,h=o.length;l<h;l++){const u=o[l].split(/,+/),c=parseFloat(u[0]),f=parseFloat(u[1]),g=u.length===3?parseFloat(u[2]):0;s.substr(0,2)==="en"?a.push(c,f,g):a.push(f,c,g)}return a}readBox(t,e){const n=Z([null],this.BOX_PARSERS_,t,e,this);return Br(n[1][0],n[1][1],n[1][3],n[1][4])}innerBoundaryIsParser(t,e){const n=Z(void 0,this.RING_PARSERS,t,e,this);n&&e[e.length-1].push(n)}outerBoundaryIsParser(t,e){const n=Z(void 0,this.RING_PARSERS,t,e,this);if(n){const i=e[e.length-1];i[0]=n}}GEOMETRY_NODE_FACTORY_(t,e,n){const i=e[e.length-1],s=i.multiSurface,o=i.surface,a=i.multiCurve;return Array.isArray(t)?n="Envelope":(n=t.getType(),n==="MultiPolygon"&&s===!0?n="MultiSurface":n==="Polygon"&&o===!0?n="Surface":n==="MultiLineString"&&a===!0&&(n="MultiCurve")),mt("http://www.opengis.net/gml",n)}writeFeatureElement(t,e,n){const i=e.getId();i&&t.setAttribute("fid",i);const s=n[n.length-1],o=s.featureNS,a=e.getGeometryName();s.serializers||(s.serializers={},s.serializers[o]={});const l=[],h=[];if(e.hasProperties()){const c=e.getProperties();for(const f in c){const g=c[f];g!==null&&(l.push(f),h.push(g),f==a||typeof g.getSimplifiedGeometry=="function"?f in s.serializers[o]||(s.serializers[o][f]=N(this.writeGeometryElement,this)):f in s.serializers[o]||(s.serializers[o][f]=N(gt)))}}const u=Object.assign({},s);u.node=t,pt(u,s.serializers,ue(void 0,o),h,n,l)}writeCurveOrLineString(t,e,n){const i=n[n.length-1].srsName;if(t.nodeName!=="LineStringSegment"&&i&&t.setAttribute("srsName",i),t.nodeName==="LineString"||t.nodeName==="LineStringSegment"){const s=this.createCoordinatesNode_(t.namespaceURI);t.appendChild(s),this.writeCoordinates_(s,e,n)}else if(t.nodeName==="Curve"){const s=mt(t.namespaceURI,"segments");t.appendChild(s),this.writeCurveSegments_(s,e,n)}}writeLineStringOrCurveMember(t,e,n){const i=this.GEOMETRY_NODE_FACTORY_(e,n);i&&(t.appendChild(i),this.writeCurveOrLineString(i,e,n))}writeMultiCurveOrLineString(t,e,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName,a=i.curve;o&&t.setAttribute("srsName",o);const l=e.getLineStrings();pt({node:t,hasZ:s,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,n,void 0,this)}writeGeometryElement(t,e,n){const i=n[n.length-1],s=Object.assign({},i);s.node=t;let o;Array.isArray(e)?o=id(e,i):o=se(e,!0,i),pt(s,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[o],n,void 0,this)}createCoordinatesNode_(t){const e=mt(t,"coordinates");return e.setAttribute("decimal","."),e.setAttribute("cs",","),e.setAttribute("ts"," "),e}writeCoordinates_(t,e,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName,a=e.getCoordinates(),l=a.length,h=new Array(l);for(let u=0;u<l;++u){const c=a[u];h[u]=this.getCoords_(c,o,s)}gt(t,h.join(" "))}writeCurveSegments_(t,e,n){const i=mt(t.namespaceURI,"LineStringSegment");t.appendChild(i),this.writeCurveOrLineString(i,e,n)}writeSurfaceOrPolygon(t,e,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName;if(t.nodeName!=="PolygonPatch"&&o&&t.setAttribute("srsName",o),t.nodeName==="Polygon"||t.nodeName==="PolygonPatch"){const a=e.getLinearRings();pt({node:t,hasZ:s,srsName:o},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,a,n,void 0,this)}else if(t.nodeName==="Surface"){const a=mt(t.namespaceURI,"patches");t.appendChild(a),this.writeSurfacePatches_(a,e,n)}}RING_NODE_FACTORY_(t,e,n){const i=e[e.length-1],s=i.node,o=i.exteriorWritten;return o===void 0&&(i.exteriorWritten=!0),mt(s.namespaceURI,o!==void 0?"innerBoundaryIs":"outerBoundaryIs")}writeSurfacePatches_(t,e,n){const i=mt(t.namespaceURI,"PolygonPatch");t.appendChild(i),this.writeSurfaceOrPolygon(i,e,n)}writeRing(t,e,n){const i=mt(t.namespaceURI,"LinearRing");t.appendChild(i),this.writeLinearRing(i,e,n)}getCoords_(t,e,n){let i="enu";e&&(i=tt(e).getAxisOrientation());let s=i.substr(0,2)==="en"?t[0]+","+t[1]:t[1]+","+t[0];if(n){const o=t[2]||0;s+=","+o}return s}writePoint(t,e,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName;o&&t.setAttribute("srsName",o);const a=this.createCoordinatesNode_(t.namespaceURI);t.appendChild(a);const l=e.getCoordinates(),h=this.getCoords_(l,o,s);gt(a,h)}writeMultiPoint(t,e,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName;o&&t.setAttribute("srsName",o);const a=e.getPoints();pt({node:t,hasZ:s,srsName:o},this.POINTMEMBER_SERIALIZERS,ue("pointMember"),a,n,void 0,this)}writePointMember(t,e,n){const i=mt(t.namespaceURI,"Point");t.appendChild(i),this.writePoint(i,e,n)}writeLinearRing(t,e,n){const i=n[n.length-1].srsName;i&&t.setAttribute("srsName",i);const s=this.createCoordinatesNode_(t.namespaceURI);t.appendChild(s),this.writeCoordinates_(s,e,n)}writeMultiSurfaceOrPolygon(t,e,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName,a=i.surface;o&&t.setAttribute("srsName",o);const l=e.getPolygons();pt({node:t,hasZ:s,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,n,void 0,this)}writeSurfaceOrPolygonMember(t,e,n){const i=this.GEOMETRY_NODE_FACTORY_(e,n);i&&(t.appendChild(i),this.writeSurfaceOrPolygon(i,e,n))}writeEnvelope(t,e,n){const i=n[n.length-1].srsName;i&&t.setAttribute("srsName",i);const s=["lowerCorner","upperCorner"],o=[e[0]+" "+e[1],e[2]+" "+e[3]];pt({node:t},this.ENVELOPE_SERIALIZERS,Ie,o,n,s,this)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(t,e,n){const i=e[e.length-1].node;return mt("http://www.opengis.net/gml",ww[i.nodeName])}}It.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{coordinates:ht(It.prototype.readFlatCoordinates)}};It.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{innerBoundaryIs:It.prototype.innerBoundaryIsParser,outerBoundaryIs:It.prototype.outerBoundaryIsParser}};It.prototype.BOX_PARSERS_={"http://www.opengis.net/gml":{coordinates:ot(It.prototype.readFlatCoordinates)}};It.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:ht(st.prototype.readPoint),MultiPoint:ht(st.prototype.readMultiPoint),LineString:ht(st.prototype.readLineString),MultiLineString:ht(st.prototype.readMultiLineString),LinearRing:ht(st.prototype.readLinearRing),Polygon:ht(st.prototype.readPolygon),MultiPolygon:ht(st.prototype.readMultiPolygon),Box:ht(It.prototype.readBox)}};It.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:N(It.prototype.writeCurveOrLineString),MultiCurve:N(It.prototype.writeMultiCurveOrLineString),Point:N(It.prototype.writePoint),MultiPoint:N(It.prototype.writeMultiPoint),LineString:N(It.prototype.writeCurveOrLineString),MultiLineString:N(It.prototype.writeMultiCurveOrLineString),LinearRing:N(It.prototype.writeLinearRing),Polygon:N(It.prototype.writeSurfaceOrPolygon),MultiPolygon:N(It.prototype.writeMultiSurfaceOrPolygon),Surface:N(It.prototype.writeSurfaceOrPolygon),MultiSurface:N(It.prototype.writeMultiSurfaceOrPolygon),Envelope:N(It.prototype.writeEnvelope)}};It.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:N(It.prototype.writeLineStringOrCurveMember),curveMember:N(It.prototype.writeLineStringOrCurveMember)}};It.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{outerBoundaryIs:N(It.prototype.writeRing),innerBoundaryIs:N(It.prototype.writeRing)}};It.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:N(It.prototype.writePointMember)}};It.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:N(It.prototype.writeSurfaceOrPolygonMember),polygonMember:N(It.prototype.writeSurfaceOrPolygonMember)}};It.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:N(gt),upperCorner:N(gt)}};const bw=Pn+" http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",Sw={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class at extends st{constructor(t){t=t||{},super(t),this.surface_=t.surface!==void 0?t.surface:!1,this.curve_=t.curve!==void 0?t.curve:!1,this.multiCurve_=t.multiCurve!==void 0?t.multiCurve:!0,this.multiSurface_=t.multiSurface!==void 0?t.multiSurface:!0,this.schemaLocation=t.schemaLocation?t.schemaLocation:bw,this.hasZ=t.hasZ!==void 0?t.hasZ:!1}readMultiCurve(t,e){const n=Z([],this.MULTICURVE_PARSERS,t,e,this);if(n)return new ur(n)}readFlatCurveRing(t,e){const n=Z([],this.MULTICURVE_PARSERS,t,e,this),i=[];for(let s=0,o=n.length;s<o;++s)Ot(i,n[s].getFlatCoordinates());return i}readMultiSurface(t,e){const n=Z([],this.MULTISURFACE_PARSERS,t,e,this);if(n)return new Pr(n)}curveMemberParser(t,e){lr(this.CURVEMEMBER_PARSERS,t,e,this)}surfaceMemberParser(t,e){lr(this.SURFACEMEMBER_PARSERS,t,e,this)}readPatch(t,e){return Z([null],this.PATCHES_PARSERS,t,e,this)}readSegment(t,e){return Z([],this.SEGMENTS_PARSERS,t,e,this)}readPolygonPatch(t,e){return Z([null],this.FLAT_LINEAR_RINGS_PARSERS,t,e,this)}readLineStringSegment(t,e){return Z([null],this.GEOMETRY_FLAT_COORDINATES_PARSERS,t,e,this)}interiorParser(t,e){const n=Z(void 0,this.RING_PARSERS,t,e,this);n&&e[e.length-1].push(n)}exteriorParser(t,e){const n=Z(void 0,this.RING_PARSERS,t,e,this);if(n){const i=e[e.length-1];i[0]=n}}readSurface(t,e){const n=Z([null],this.SURFACE_PARSERS,t,e,this);if(n&&n[0]){const i=n[0],s=[i.length];let o,a;for(o=1,a=n.length;o<a;++o)Ot(i,n[o]),s.push(i.length);return new Ue(i,"XYZ",s)}}readCurve(t,e){const n=Z([null],this.CURVE_PARSERS,t,e,this);if(n)return new ye(n,"XYZ")}readEnvelope(t,e){const n=Z([null],this.ENVELOPE_PARSERS,t,e,this);return Br(n[1][0],n[1][1],n[2][0],n[2][1])}readFlatPos(t,e){let n=Ye(t,!1);const i=/^\s*([+\-]?\d*\.?\d+(?:[eE][+\-]?\d+)?)\s*/,s=[];let o;for(;o=i.exec(n);)s.push(parseFloat(o[1])),n=n.substr(o[0].length);if(n!=="")return;const a=e[0].srsName;let l="enu";if(a&&(l=tt(a).getAxisOrientation()),l==="neu"){let u,c;for(u=0,c=s.length;u<c;u+=3){const f=s[u],g=s[u+1];s[u]=g,s[u+1]=f}}const h=s.length;if(h==2&&s.push(0),h!==0)return s}readFlatPosList(t,e){const n=Ye(t,!1).replace(/^\s*|\s*$/g,""),i=e[0],s=i.srsName,o=i.srsDimension;let a="enu";s&&(a=tt(s).getAxisOrientation());const l=n.split(/\s+/);let h=2;t.getAttribute("srsDimension")?h=Cn(t.getAttribute("srsDimension")):t.getAttribute("dimension")?h=Cn(t.getAttribute("dimension")):t.parentNode.getAttribute("srsDimension")?h=Cn(t.parentNode.getAttribute("srsDimension")):o&&(h=Cn(o));let u,c,f;const g=[];for(let m=0,_=l.length;m<_;m+=h)u=parseFloat(l[m]),c=parseFloat(l[m+1]),f=h===3?parseFloat(l[m+2]):0,a.substr(0,2)==="en"?g.push(u,c,f):g.push(c,u,f);return g}writePos_(t,e,n){const i=n[n.length-1],s=i.hasZ,o=s?"3":"2";t.setAttribute("srsDimension",o);const a=i.srsName;let l="enu";a&&(l=tt(a).getAxisOrientation());const h=e.getCoordinates();let u;if(l.substr(0,2)==="en"?u=h[0]+" "+h[1]:u=h[1]+" "+h[0],s){const c=h[2]||0;u+=" "+c}gt(t,u)}getCoords_(t,e,n){let i="enu";e&&(i=tt(e).getAxisOrientation());let s=i.substr(0,2)==="en"?t[0]+" "+t[1]:t[1]+" "+t[0];if(n){const o=t[2]||0;s+=" "+o}return s}writePosList_(t,e,n){const i=n[n.length-1],s=i.hasZ,o=s?"3":"2";t.setAttribute("srsDimension",o);const a=i.srsName,l=e.getCoordinates(),h=l.length,u=new Array(h);let c;for(let f=0;f<h;++f)c=l[f],u[f]=this.getCoords_(c,a,s);gt(t,u.join(" "))}writePoint(t,e,n){const i=n[n.length-1].srsName;i&&t.setAttribute("srsName",i);const s=mt(t.namespaceURI,"pos");t.appendChild(s),this.writePos_(s,e,n)}writeEnvelope(t,e,n){const i=n[n.length-1].srsName;i&&t.setAttribute("srsName",i);const s=["lowerCorner","upperCorner"],o=[e[0]+" "+e[1],e[2]+" "+e[3]];pt({node:t},this.ENVELOPE_SERIALIZERS,Ie,o,n,s,this)}writeLinearRing(t,e,n){const i=n[n.length-1].srsName;i&&t.setAttribute("srsName",i);const s=mt(t.namespaceURI,"posList");t.appendChild(s),this.writePosList_(s,e,n)}RING_NODE_FACTORY_(t,e,n){const i=e[e.length-1],s=i.node,o=i.exteriorWritten;return o===void 0&&(i.exteriorWritten=!0),mt(s.namespaceURI,o!==void 0?"interior":"exterior")}writeSurfaceOrPolygon(t,e,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName;if(t.nodeName!=="PolygonPatch"&&o&&t.setAttribute("srsName",o),t.nodeName==="Polygon"||t.nodeName==="PolygonPatch"){const a=e.getLinearRings();pt({node:t,hasZ:s,srsName:o},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,a,n,void 0,this)}else if(t.nodeName==="Surface"){const a=mt(t.namespaceURI,"patches");t.appendChild(a),this.writeSurfacePatches_(a,e,n)}}writeCurveOrLineString(t,e,n){const i=n[n.length-1].srsName;if(t.nodeName!=="LineStringSegment"&&i&&t.setAttribute("srsName",i),t.nodeName==="LineString"||t.nodeName==="LineStringSegment"){const s=mt(t.namespaceURI,"posList");t.appendChild(s),this.writePosList_(s,e,n)}else if(t.nodeName==="Curve"){const s=mt(t.namespaceURI,"segments");t.appendChild(s),this.writeCurveSegments_(s,e,n)}}writeMultiSurfaceOrPolygon(t,e,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName,a=i.surface;o&&t.setAttribute("srsName",o);const l=e.getPolygons();pt({node:t,hasZ:s,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,n,void 0,this)}writeMultiPoint(t,e,n){const i=n[n.length-1],s=i.srsName,o=i.hasZ;s&&t.setAttribute("srsName",s);const a=e.getPoints();pt({node:t,hasZ:o,srsName:s},this.POINTMEMBER_SERIALIZERS,ue("pointMember"),a,n,void 0,this)}writeMultiCurveOrLineString(t,e,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName,a=i.curve;o&&t.setAttribute("srsName",o);const l=e.getLineStrings();pt({node:t,hasZ:s,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,n,void 0,this)}writeRing(t,e,n){const i=mt(t.namespaceURI,"LinearRing");t.appendChild(i),this.writeLinearRing(i,e,n)}writeSurfaceOrPolygonMember(t,e,n){const i=this.GEOMETRY_NODE_FACTORY_(e,n);i&&(t.appendChild(i),this.writeSurfaceOrPolygon(i,e,n))}writePointMember(t,e,n){const i=mt(t.namespaceURI,"Point");t.appendChild(i),this.writePoint(i,e,n)}writeLineStringOrCurveMember(t,e,n){const i=this.GEOMETRY_NODE_FACTORY_(e,n);i&&(t.appendChild(i),this.writeCurveOrLineString(i,e,n))}writeSurfacePatches_(t,e,n){const i=mt(t.namespaceURI,"PolygonPatch");t.appendChild(i),this.writeSurfaceOrPolygon(i,e,n)}writeCurveSegments_(t,e,n){const i=mt(t.namespaceURI,"LineStringSegment");t.appendChild(i),this.writeCurveOrLineString(i,e,n)}writeGeometryElement(t,e,n){const i=n[n.length-1],s=Object.assign({},i);s.node=t;let o;Array.isArray(e)?o=id(e,i):o=se(e,!0,i),pt(s,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[o],n,void 0,this)}writeFeatureElement(t,e,n){const i=e.getId();i&&t.setAttribute("fid",i);const s=n[n.length-1],o=s.featureNS,a=e.getGeometryName();s.serializers||(s.serializers={},s.serializers[o]={});const l=[],h=[];if(e.hasProperties()){const c=e.getProperties();for(const f in c){const g=c[f];g!==null&&(l.push(f),h.push(g),f==a||typeof g.getSimplifiedGeometry=="function"?f in s.serializers[o]||(s.serializers[o][f]=N(this.writeGeometryElement,this)):f in s.serializers[o]||(s.serializers[o][f]=N(gt)))}}const u=Object.assign({},s);u.node=t,pt(u,s.serializers,ue(void 0,o),h,n,l)}writeFeatureMembers_(t,e,n){const i=n[n.length-1],s=i.featureType,o=i.featureNS,a={};a[o]={},a[o][s]=N(this.writeFeatureElement,this);const l=Object.assign({},i);l.node=t,pt(l,a,ue(s,o),e,n)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(t,e,n){const i=e[e.length-1].node;return mt(this.namespace,Sw[i.nodeName])}GEOMETRY_NODE_FACTORY_(t,e,n){const i=e[e.length-1],s=i.multiSurface,o=i.surface,a=i.curve,l=i.multiCurve;return Array.isArray(t)?n="Envelope":(n=t.getType(),n==="MultiPolygon"&&s===!0?n="MultiSurface":n==="Polygon"&&o===!0?n="Surface":n==="LineString"&&a===!0?n="Curve":n==="MultiLineString"&&l===!0&&(n="MultiCurve")),mt(this.namespace,n)}writeGeometryNode(t,e){e=this.adaptOptions(e);const n=mt(this.namespace,"geom"),i={node:n,hasZ:this.hasZ,srsName:this.srsName,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_};return e&&Object.assign(i,e),this.writeGeometryElement(n,t,[i]),n}writeFeaturesNode(t,e){e=this.adaptOptions(e);const n=mt(this.namespace,"featureMembers");n.setAttributeNS(Di,"xsi:schemaLocation",this.schemaLocation);const i={srsName:this.srsName,hasZ:this.hasZ,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_,featureNS:this.featureNS,featureType:this.featureType};return e&&Object.assign(i,e),this.writeFeatureMembers_(n,t,[i]),n}}at.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{pos:ht(at.prototype.readFlatPos),posList:ht(at.prototype.readFlatPosList),coordinates:ht(It.prototype.readFlatCoordinates)}};at.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{interior:at.prototype.interiorParser,exterior:at.prototype.exteriorParser}};at.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:ht(st.prototype.readPoint),MultiPoint:ht(st.prototype.readMultiPoint),LineString:ht(st.prototype.readLineString),MultiLineString:ht(st.prototype.readMultiLineString),LinearRing:ht(st.prototype.readLinearRing),Polygon:ht(st.prototype.readPolygon),MultiPolygon:ht(st.prototype.readMultiPolygon),Surface:ht(at.prototype.readSurface),MultiSurface:ht(at.prototype.readMultiSurface),Curve:ht(at.prototype.readCurve),MultiCurve:ht(at.prototype.readMultiCurve),Envelope:ht(at.prototype.readEnvelope)}};at.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml":{curveMember:ot(at.prototype.curveMemberParser),curveMembers:ot(at.prototype.curveMemberParser)}};at.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml":{surfaceMember:ot(at.prototype.surfaceMemberParser),surfaceMembers:ot(at.prototype.surfaceMemberParser)}};at.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:ot(st.prototype.readLineString),Curve:ot(at.prototype.readCurve)}};at.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:ot(st.prototype.readPolygon),Surface:ot(at.prototype.readSurface)}};at.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml":{patches:ht(at.prototype.readPatch)}};at.prototype.CURVE_PARSERS={"http://www.opengis.net/gml":{segments:ht(at.prototype.readSegment)}};at.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml":{lowerCorner:ot(at.prototype.readFlatPosList),upperCorner:ot(at.prototype.readFlatPosList)}};at.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml":{PolygonPatch:ht(at.prototype.readPolygonPatch)}};at.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml":{LineStringSegment:Cl(at.prototype.readLineStringSegment)}};st.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:ht(st.prototype.readFlatLinearRing),Ring:ht(at.prototype.readFlatCurveRing)}};at.prototype.writeFeatures;at.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{exterior:N(at.prototype.writeRing),interior:N(at.prototype.writeRing)}};at.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:N(gt),upperCorner:N(gt)}};at.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:N(at.prototype.writeSurfaceOrPolygonMember),polygonMember:N(at.prototype.writeSurfaceOrPolygonMember)}};at.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:N(at.prototype.writePointMember)}};at.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:N(at.prototype.writeLineStringOrCurveMember),curveMember:N(at.prototype.writeLineStringOrCurveMember)}};at.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:N(at.prototype.writeCurveOrLineString),MultiCurve:N(at.prototype.writeMultiCurveOrLineString),Point:N(at.prototype.writePoint),MultiPoint:N(at.prototype.writeMultiPoint),LineString:N(at.prototype.writeCurveOrLineString),MultiLineString:N(at.prototype.writeMultiCurveOrLineString),LinearRing:N(at.prototype.writeLinearRing),Polygon:N(at.prototype.writeSurfaceOrPolygon),MultiPolygon:N(at.prototype.writeMultiSurfaceOrPolygon),Surface:N(at.prototype.writeSurfaceOrPolygon),MultiSurface:N(at.prototype.writeMultiSurfaceOrPolygon),Envelope:N(at.prototype.writeEnvelope)}};const Rt=at,ld=Rt;ld.prototype.writeFeatures;ld.prototype.writeFeaturesNode;const Ew=ld,ne=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"],Tw="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",Mw={rte:_0,trk:y0,wpt:x0},Rw=q(ne,{rte:ot(_0),trk:ot(y0),wpt:ot(x0)}),Cw=q(ne,{text:O($,"linkText"),type:O($,"linkType")}),Iw=q(ne,{name:O($),email:rb,link:Ca}),Pw=q(ne,{name:O($),desc:O($),author:O(Jw),copyright:O(tb),link:Ca,time:O(_h),keywords:O($),bounds:eb,extensions:yh}),Aw=q(ne,{year:O(fe),license:O($)}),Lw=q(ne,{rte:N(ob),trk:N(ab),wpt:N(hb)});class Ow extends Ra{constructor(t){super(),t=t||{},this.dataProjection=tt("EPSG:4326"),this.readExtensions_=t.readExtensions}handleReadExtensions_(t){t||(t=[]);for(let e=0,n=t.length;e<n;++e){const i=t[e];if(this.readExtensions_){const s=i.get("extensionsNode_")||null;this.readExtensions_(i,s)}i.set("extensionsNode_",void 0)}}readMetadata(t){return t?typeof t=="string"?this.readMetadataFromDocument(Cr(t)):Rr(t)?this.readMetadataFromDocument(t):this.readMetadataFromNode(t):null}readMetadataFromDocument(t){for(let e=t.firstChild;e;e=e.nextSibling)if(e.nodeType===Node.ELEMENT_NODE){const n=this.readMetadataFromNode(e);if(n)return n}return null}readMetadataFromNode(t){if(!ne.includes(t.namespaceURI))return null;for(let e=t.firstElementChild;e;e=e.nextElementSibling)if(ne.includes(e.namespaceURI)&&e.localName==="metadata")return Z({},Pw,e,[]);return null}readFeatureFromNode(t,e){if(!ne.includes(t.namespaceURI))return null;const n=Mw[t.localName];if(!n)return null;const i=n(t,[this.getReadOptions(t,e)]);return i?(this.handleReadExtensions_([i]),i):null}readFeaturesFromNode(t,e){if(!ne.includes(t.namespaceURI))return[];if(t.localName=="gpx"){const n=Z([],Rw,t,[this.getReadOptions(t,e)]);return n?(this.handleReadExtensions_(n),n):[]}return[]}writeFeaturesNode(t,e){e=this.adaptOptions(e);const n=mt("http://www.topografix.com/GPX/1/1","gpx");return n.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xsi",Di),n.setAttributeNS(Di,"xsi:schemaLocation",Tw),n.setAttribute("version","1.1"),n.setAttribute("creator","OpenLayers"),pt({node:n},Lw,Qw,t,[e]),n}}const Fw=q(ne,{name:O($),cmt:O($),desc:O($),src:O($),link:Ca,number:O(fe),extensions:yh,type:O($),rtept:nb}),Nw=q(ne,{ele:O(Pt),time:O(_h)}),Dw=q(ne,{name:O($),cmt:O($),desc:O($),src:O($),link:Ca,number:O(fe),type:O($),extensions:yh,trkseg:sb}),kw=q(ne,{trkpt:ib}),Gw=q(ne,{ele:O(Pt),time:O(_h)}),jw=q(ne,{ele:O(Pt),time:O(_h),magvar:O(Pt),geoidheight:O(Pt),name:O($),cmt:O($),desc:O($),src:O($),link:Ca,sym:O($),type:O($),fix:O($),sat:O(fe),hdop:O(Pt),vdop:O(Pt),pdop:O(Pt),ageofdgpsdata:O(Pt),dgpsid:O(fe),extensions:yh}),zw=["text","type"],Uw=q(ne,{text:N(gt),type:N(gt)}),Bw=q(ne,["name","cmt","desc","src","link","number","type","rtept"]),Xw=q(ne,{name:N(gt),cmt:N(gt),desc:N(gt),src:N(gt),link:N(cd),number:N(Il),type:N(gt),rtept:p0(N(dd))}),Ww=q(ne,["ele","time"]),qw=q(ne,["name","cmt","desc","src","link","number","type","trkseg"]),Zw=q(ne,{name:N(gt),cmt:N(gt),desc:N(gt),src:N(gt),link:N(cd),number:N(Il),type:N(gt),trkseg:p0(N(lb))}),$w=ue("trkpt"),Vw=q(ne,{trkpt:N(dd)}),Yw=q(ne,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),Hw=q(ne,{ele:N(rr),time:N(xw),magvar:N(rr),geoidheight:N(rr),name:N(gt),cmt:N(gt),desc:N(gt),src:N(gt),link:N(cd),sym:N(gt),type:N(gt),fix:N(gt),sat:N(Il),hdop:N(rr),vdop:N(rr),pdop:N(rr),ageofdgpsdata:N(rr),dgpsid:N(Il)}),Kw={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function Qw(r,t,e){const n=r.getGeometry();if(n){const i=Kw[n.getType()];if(i){const s=t[t.length-1].node;return mt(s.namespaceURI,i)}}}function hd(r,t,e,n){return r.push(parseFloat(e.getAttribute("lon")),parseFloat(e.getAttribute("lat"))),"ele"in n?(r.push(n.ele),delete n.ele,t.hasZ=!0):r.push(0),"time"in n?(r.push(n.time),delete n.time,t.hasM=!0):r.push(0),r}function ud(r,t,e){let n="XY",i=2;if(r.hasZ&&r.hasM?(n="XYZM",i=4):r.hasZ?(n="XYZ",i=3):r.hasM&&(n="XYM",i=3),i!==4){for(let s=0,o=t.length/4;s<o;s++)t[s*i]=t[s*4],t[s*i+1]=t[s*4+1],r.hasZ&&(t[s*i+2]=t[s*4+2]),r.hasM&&(t[s*i+2]=t[s*4+3]);if(t.length=t.length/4*i,e)for(let s=0,o=e.length;s<o;s++)e[s]=e[s]/4*i}return n}function Jw(r,t){const e=Z({},Iw,r,t);if(e)return e}function tb(r,t){const e=Z({},Aw,r,t);if(e){const n=r.getAttribute("author");return n!==null&&(e.author=n),e}}function eb(r,t){const e=t[t.length-1],n=r.getAttribute("minlat"),i=r.getAttribute("minlon"),s=r.getAttribute("maxlat"),o=r.getAttribute("maxlon");i!==null&&n!==null&&o!==null&&s!==null&&(e.bounds=[[parseFloat(i),parseFloat(n)],[parseFloat(o),parseFloat(s)]])}function rb(r,t){const e=t[t.length-1],n=r.getAttribute("id"),i=r.getAttribute("domain");n!==null&&i!==null&&(e.email=`${n}@${i}`)}function Ca(r,t){const e=t[t.length-1],n=r.getAttribute("href");n!==null&&(e.link=n),lr(Cw,r,t)}function yh(r,t){const e=t[t.length-1];e.extensionsNode_=r}function nb(r,t){const e=Z({},Nw,r,t);if(e){const n=t[t.length-1],i=n.flatCoordinates,s=n.layoutOptions;hd(i,s,r,e)}}function ib(r,t){const e=Z({},Gw,r,t);if(e){const n=t[t.length-1],i=n.flatCoordinates,s=n.layoutOptions;hd(i,s,r,e)}}function sb(r,t){const e=t[t.length-1];lr(kw,r,t);const n=e.flatCoordinates;e.ends.push(n.length)}function _0(r,t){const e=t[0],n=Z({flatCoordinates:[],layoutOptions:{}},Fw,r,t);if(!n)return;const i=n.flatCoordinates;delete n.flatCoordinates;const s=n.layoutOptions;delete n.layoutOptions;const o=ud(s,i),a=new ye(i,o);se(a,!1,e);const l=new Se(a);return l.setProperties(n,!0),l}function y0(r,t){const e=t[0],n=Z({flatCoordinates:[],ends:[],layoutOptions:{}},Dw,r,t);if(!n)return;const i=n.flatCoordinates;delete n.flatCoordinates;const s=n.ends;delete n.ends;const o=n.layoutOptions;delete n.layoutOptions;const a=ud(o,i,s),l=new ur(i,a,s);se(l,!1,e);const h=new Se(l);return h.setProperties(n,!0),h}function x0(r,t){const e=t[0],n=Z({},jw,r,t);if(!n)return;const i={},s=hd([],i,r,n),o=ud(i,s),a=new Re(s,o);se(a,!1,e);const l=new Se(a);return l.setProperties(n,!0),l}function cd(r,t,e){r.setAttribute("href",t);const n=e[e.length-1].properties,i=[n.linkText,n.linkType];pt({node:r},Uw,Ie,i,e,zw)}function dd(r,t,e){const n=e[e.length-1],i=n.node.namespaceURI,s=n.properties;switch(r.setAttributeNS(null,"lat",String(t[1])),r.setAttributeNS(null,"lon",String(t[0])),n.geometryLayout){case"XYZM":t[3]!==0&&(s.time=t[3]);case"XYZ":t[2]!==0&&(s.ele=t[2]);break;case"XYM":t[2]!==0&&(s.time=t[2]);break}const o=r.nodeName=="rtept"?Ww[i]:Yw[i],a=cr(s,o);pt({node:r,properties:s},Hw,Ie,a,e,o)}function ob(r,t,e){const n=e[0],i=t.getProperties(),s={node:r};s.properties=i;const o=t.getGeometry();if(o.getType()=="LineString"){const u=se(o,!0,n);s.geometryLayout=u.getLayout(),i.rtept=u.getCoordinates()}const a=e[e.length-1].node,l=Bw[a.namespaceURI],h=cr(i,l);pt(s,Xw,Ie,h,e,l)}function ab(r,t,e){const n=e[0],i=t.getProperties(),s={node:r};s.properties=i;const o=t.getGeometry();if(o.getType()=="MultiLineString"){const u=se(o,!0,n);i.trkseg=u.getLineStrings()}const a=e[e.length-1].node,l=qw[a.namespaceURI],h=cr(i,l);pt(s,Zw,Ie,h,e,l)}function lb(r,t,e){const n={node:r};n.geometryLayout=t.getLayout(),n.properties={},pt(n,Vw,$w,t.getCoordinates(),e)}function hb(r,t,e){const n=e[0],i=e[e.length-1];i.properties=t.getProperties();const s=t.getGeometry();if(s.getType()=="Point"){const o=se(s,!0,n);i.geometryLayout=o.getLayout(),dd(r,o.getCoordinates(),e)}}const ub=Ow;class fd extends Ta{constructor(){super()}getType(){return"text"}readFeature(t,e){return this.readFeatureFromText(Ya(t),this.adaptOptions(e))}readFeatureFromText(t,e){return ut()}readFeatures(t,e){return this.readFeaturesFromText(Ya(t),this.adaptOptions(e))}readFeaturesFromText(t,e){return ut()}readGeometry(t,e){return this.readGeometryFromText(Ya(t),this.adaptOptions(e))}readGeometryFromText(t,e){return ut()}readProjection(t){return this.readProjectionFromText(Ya(t))}readProjectionFromText(t){return this.dataProjection}writeFeature(t,e){return this.writeFeatureText(t,this.adaptOptions(e))}writeFeatureText(t,e){return ut()}writeFeatures(t,e){return this.writeFeaturesText(t,this.adaptOptions(e))}writeFeaturesText(t,e){return ut()}writeGeometry(t,e){return this.writeGeometryText(t,this.adaptOptions(e))}writeGeometryText(t,e){return ut()}}function Ya(r){return typeof r=="string"?r:""}const cb=/^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{5})([NS])(\d{3})(\d{5})([EW])([AV])(\d{5})(\d{5})/,db=/^H.([A-Z]{3}).*?:(.*)/,fb=/^HFDTE(\d{2})(\d{2})(\d{2})/,gb=/\r\n|\r|\n/;class pb extends fd{constructor(t){super(),t=t||{},this.dataProjection=tt("EPSG:4326"),this.altitudeMode_=t.altitudeMode?t.altitudeMode:"none"}readFeatureFromText(t,e){const n=this.altitudeMode_,i=t.split(gb),s={},o=[];let a=2e3,l=0,h=1,u=-1,c,f;for(c=0,f=i.length;c<f;++c){const x=i[c];let v;if(x.charAt(0)=="B"){if(v=cb.exec(x),v){const w=parseInt(v[1],10),S=parseInt(v[2],10),E=parseInt(v[3],10);let T=parseInt(v[4],10)+parseInt(v[5],10)/6e4;v[6]=="S"&&(T=-T);let R=parseInt(v[7],10)+parseInt(v[8],10)/6e4;if(v[9]=="W"&&(R=-R),o.push(R,T),n!="none"){let I;n=="gps"?I=parseInt(v[11],10):n=="barometric"?I=parseInt(v[12],10):I=0,o.push(I)}let C=Date.UTC(a,l,h,w,S,E);C<u&&(C=Date.UTC(a,l,h+1,w,S,E)),o.push(C/1e3),u=C}}else x.charAt(0)=="H"&&(v=fb.exec(x),v?(h=parseInt(v[1],10),l=parseInt(v[2],10)-1,a=2e3+parseInt(v[3],10)):(v=db.exec(x),v&&(s[v[1]]=v[2].trim())))}if(o.length===0)return null;const g=n=="none"?"XYM":"XYZM",m=new ye(o,g),_=new Se(se(m,!1,e));return _.setProperties(s,!0),_}readFeaturesFromText(t,e){const n=this.readFeatureFromText(t,e);return n?[n]:[]}}const mb=pb,_e={VERSION1:"version1",VERSION2:"version2",VERSION3:"version3"},ki={};ki[_e.VERSION1]={level0:{supports:[],formats:[],qualities:["native"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["native"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["native","color","grey","bitonal"]}};ki[_e.VERSION2]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByDistortedWh","sizeByWh"],formats:["jpg","png"],qualities:["default","bitonal"]}};ki[_e.VERSION3]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","regionSquare","sizeByW","sizeByH","sizeByWh"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionSquare","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["default"]}};ki.none={none:{supports:[],formats:[],qualities:[]}};const _b=/^https?:\/\/library\.stanford\.edu\/iiif\/image-api\/(?:1\.1\/)?compliance\.html#level[0-2]$/,bg=/^https?:\/\/iiif\.io\/api\/image\/2\/level[0-2](?:\.json)?$/,yb=/(^https?:\/\/iiif\.io\/api\/image\/3\/level[0-2](?:\.json)?$)|(^level[0-2]$)/;function xb(r){let t=r.getComplianceLevelSupportedFeatures();return t===void 0&&(t=ki[_e.VERSION1].level0),{url:r.imageInfo["@id"]===void 0?void 0:r.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),supports:t.supports,formats:[...t.formats,r.imageInfo.formats===void 0?[]:r.imageInfo.formats],qualities:[...t.qualities,r.imageInfo.qualities===void 0?[]:r.imageInfo.qualities],resolutions:r.imageInfo.scale_factors,tileSize:r.imageInfo.tile_width!==void 0?r.imageInfo.tile_height!==void 0?[r.imageInfo.tile_width,r.imageInfo.tile_height]:[r.imageInfo.tile_width,r.imageInfo.tile_width]:r.imageInfo.tile_height!=null?[r.imageInfo.tile_height,r.imageInfo.tile_height]:void 0}}function vb(r){const t=r.getComplianceLevelSupportedFeatures(),e=Array.isArray(r.imageInfo.profile)&&r.imageInfo.profile.length>1,n=e&&r.imageInfo.profile[1].supports?r.imageInfo.profile[1].supports:[],i=e&&r.imageInfo.profile[1].formats?r.imageInfo.profile[1].formats:[],s=e&&r.imageInfo.profile[1].qualities?r.imageInfo.profile[1].qualities:[];return{url:r.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),sizes:r.imageInfo.sizes===void 0?void 0:r.imageInfo.sizes.map(function(o){return[o.width,o.height]}),tileSize:r.imageInfo.tiles===void 0?void 0:[r.imageInfo.tiles.map(function(o){return o.width})[0],r.imageInfo.tiles.map(function(o){return o.height===void 0?o.width:o.height})[0]],resolutions:r.imageInfo.tiles===void 0?void 0:r.imageInfo.tiles.map(function(o){return o.scaleFactors})[0],supports:[...t.supports,...n],formats:[...t.formats,...i],qualities:[...t.qualities,...s]}}function wb(r){const t=r.getComplianceLevelSupportedFeatures(),e=r.imageInfo.extraFormats===void 0?t.formats:[...t.formats,...r.imageInfo.extraFormats],n=r.imageInfo.preferredFormats!==void 0&&Array.isArray(r.imageInfo.preferredFormats)&&r.imageInfo.preferredFormats.length>0?r.imageInfo.preferredFormats.filter(function(i){return["jpg","png","gif"].includes(i)}).reduce(function(i,s){return i===void 0&&e.includes(s)?s:i},void 0):void 0;return{url:r.imageInfo.id,sizes:r.imageInfo.sizes===void 0?void 0:r.imageInfo.sizes.map(function(i){return[i.width,i.height]}),tileSize:r.imageInfo.tiles===void 0?void 0:[r.imageInfo.tiles.map(function(i){return i.width})[0],r.imageInfo.tiles.map(function(i){return i.height})[0]],resolutions:r.imageInfo.tiles===void 0?void 0:r.imageInfo.tiles.map(function(i){return i.scaleFactors})[0],supports:r.imageInfo.extraFeatures===void 0?t.supports:[...t.supports,...r.imageInfo.extraFeatures],formats:e,qualities:r.imageInfo.extraQualities===void 0?t.qualities:[...t.qualities,...r.imageInfo.extraQualities],preferredFormat:n}}const xh={};xh[_e.VERSION1]=xb;xh[_e.VERSION2]=vb;xh[_e.VERSION3]=wb;class bb{constructor(t){this.setImageInfo(t)}setImageInfo(t){typeof t=="string"?this.imageInfo=JSON.parse(t):this.imageInfo=t}getImageApiVersion(){if(this.imageInfo===void 0)return;let t=this.imageInfo["@context"]||"ol-no-context";typeof t=="string"&&(t=[t]);for(let e=0;e<t.length;e++)switch(t[e]){case"http://library.stanford.edu/iiif/image-api/1.1/context.json":case"http://iiif.io/api/image/1/context.json":return _e.VERSION1;case"http://iiif.io/api/image/2/context.json":return _e.VERSION2;case"http://iiif.io/api/image/3/context.json":return _e.VERSION3;case"ol-no-context":if(this.getComplianceLevelEntryFromProfile(_e.VERSION1)&&this.imageInfo.identifier)return _e.VERSION1;break}At(!1,"Cannot determine IIIF Image API version from provided image information JSON")}getComplianceLevelEntryFromProfile(t){if(!(this.imageInfo===void 0||this.imageInfo.profile===void 0))switch(t===void 0&&(t=this.getImageApiVersion()),t){case _e.VERSION1:if(_b.test(this.imageInfo.profile))return this.imageInfo.profile;break;case _e.VERSION3:if(yb.test(this.imageInfo.profile))return this.imageInfo.profile;break;case _e.VERSION2:if(typeof this.imageInfo.profile=="string"&&bg.test(this.imageInfo.profile))return this.imageInfo.profile;if(Array.isArray(this.imageInfo.profile)&&this.imageInfo.profile.length>0&&typeof this.imageInfo.profile[0]=="string"&&bg.test(this.imageInfo.profile[0]))return this.imageInfo.profile[0];break}}getComplianceLevelFromProfile(t){const e=this.getComplianceLevelEntryFromProfile(t);if(e===void 0)return;const n=e.match(/level[0-2](?:\.json)?$/g);return Array.isArray(n)?n[0].replace(".json",""):void 0}getComplianceLevelSupportedFeatures(){if(this.imageInfo===void 0)return;const t=this.getImageApiVersion(),e=this.getComplianceLevelFromProfile(t);return e===void 0?ki.none.none:ki[t][e]}getTileSourceOptions(t){const e=t||{},n=this.getImageApiVersion();if(n===void 0)return;const i=n===void 0?void 0:xh[n](this);if(i!==void 0)return{url:i.url,version:n,size:[this.imageInfo.width,this.imageInfo.height],sizes:i.sizes,format:e.format!==void 0&&i.formats.includes(e.format)?e.format:i.preferredFormat!==void 0?i.preferredFormat:"jpg",supports:i.supports,quality:e.quality&&i.qualities.includes(e.quality)?e.quality:i.qualities.includes("native")?"native":"default",resolutions:Array.isArray(i.resolutions)?i.resolutions.sort(function(s,o){return o-s}):void 0,tileSize:i.tileSize}}}const Sb=bb,et={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4},Ko={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]};var Le={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"]};Le.whitepoint={2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}};Le.max=Le.whitepoint[2].D65;Le.rgb=function(r,t){t=t||Le.whitepoint[2].E;var e=r[0]/t[0],n=r[1]/t[1],i=r[2]/t[2],s,o,a;return s=e*3.240969941904521+n*-1.537383177570093+i*-.498610760293,o=e*-.96924363628087+n*1.87596750150772+i*.041555057407175,a=e*.055630079696993+n*-.20397695888897+i*1.056971514242878,s=s>.0031308?1.055*Math.pow(s,1/2.4)-.055:s=s*12.92,o=o>.0031308?1.055*Math.pow(o,1/2.4)-.055:o=o*12.92,a=a>.0031308?1.055*Math.pow(a,1/2.4)-.055:a=a*12.92,s=Math.min(Math.max(0,s),1),o=Math.min(Math.max(0,o),1),a=Math.min(Math.max(0,a),1),[s*255,o*255,a*255]};Ko.xyz=function(r,t){var e=r[0]/255,n=r[1]/255,i=r[2]/255;e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92;var s=e*.41239079926595+n*.35758433938387+i*.18048078840183,o=e*.21263900587151+n*.71516867876775+i*.072192315360733,a=e*.019330818715591+n*.11919477979462+i*.95053215224966;return t=t||Le.whitepoint[2].E,[s*t[0],o*t[1],a*t[2]]};const gd={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(r,t,e){var n,i,s,o,a,l,h,u,c,f,g,m,_;if(s=r[0],o=r[1],a=r[2],s===0)return[0,0,0];var x=.0011070564598794539;return t=t||"D65",e=e||2,c=Le.whitepoint[e][t][0],f=Le.whitepoint[e][t][1],g=Le.whitepoint[e][t][2],m=4*c/(c+15*f+3*g),_=9*f/(c+15*f+3*g),n=o/(13*s)+m||0,i=a/(13*s)+_||0,h=s>8?f*Math.pow((s+16)/116,3):f*s*x,l=h*9*n/(4*i)||0,u=h*(12-3*n-20*i)/(4*i)||0,[l,h,u]}};Le.luv=function(r,t,e){var n,i,s,o,a,l,h,u,c,f,g,m,_,x=.008856451679035631,v=903.2962962962961;t=t||"D65",e=e||2,c=Le.whitepoint[e][t][0],f=Le.whitepoint[e][t][1],g=Le.whitepoint[e][t][2],m=4*c/(c+15*f+3*g),_=9*f/(c+15*f+3*g),l=r[0],h=r[1],u=r[2],n=4*l/(l+15*h+3*u)||0,i=9*h/(l+15*h+3*u)||0;var w=h/f;return s=w<=x?v*w:116*Math.pow(w,1/3)-16,o=13*s*(n-m),a=13*s*(i-_),[s,o,a]};var v0={name:"lchuv",channel:["lightness","chroma","hue"],alias:["LCHuv","cielchuv"],min:[0,0,0],max:[100,100,360],luv:function(r){var t=r[0],e=r[1],n=r[2],i,s,o;return o=n/360*2*Math.PI,i=e*Math.cos(o),s=e*Math.sin(o),[t,i,s]},xyz:function(r){return gd.xyz(v0.luv(r))}};gd.lchuv=function(r){var t=r[0],e=r[1],n=r[2],i=Math.sqrt(e*e+n*n),s=Math.atan2(n,e),o=s*360/2/Math.PI;return o<0&&(o+=360),[t,i,o]};Le.lchuv=function(r){return gd.lchuv(Le.luv(r))};var Oi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ks(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Eb={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};const Sg=Ks(Eb);var Eg={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function Tb(r){var t,e,n,i=[],s=1,o;if(typeof r=="number")return{space:"rgb",values:[r>>>16,(r&65280)>>>8,r&255],alpha:1};if(typeof r=="number")return{space:"rgb",values:[r>>>16,(r&65280)>>>8,r&255],alpha:1};if(r=String(r).toLowerCase(),Sg[r])i=Sg[r].slice(),o="rgb";else if(r==="transparent")s=0,o="rgb",i=[0,0,0];else if(r[0]==="#"){var a=r.slice(1),l=a.length,h=l<=4;s=1,h?(i=[parseInt(a[0]+a[0],16),parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16)],l===4&&(s=parseInt(a[3]+a[3],16)/255)):(i=[parseInt(a[0]+a[1],16),parseInt(a[2]+a[3],16),parseInt(a[4]+a[5],16)],l===8&&(s=parseInt(a[6]+a[7],16)/255)),i[0]||(i[0]=0),i[1]||(i[1]=0),i[2]||(i[2]=0),o="rgb"}else if(n=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^\)]*)\)/.exec(r)){var u=n[1];o=u.replace(/a$/,"");var c=o==="cmyk"?4:o==="gray"?1:3;i=n[2].trim().split(/\s*[,\/]\s*|\s+/),o==="color"&&(o=i.shift()),i=i.map(function(f,g){if(f[f.length-1]==="%")return f=parseFloat(f)/100,g===3?f:o==="rgb"?f*255:o[0]==="h"||o[0]==="l"&&!g?f*100:o==="lab"?f*125:o==="lch"?g<2?f*150:f*360:o[0]==="o"&&!g?f:o==="oklab"?f*.4:o==="oklch"?g<2?f*.4:f*360:f;if(o[g]==="h"||g===2&&o[o.length-1]==="h"){if(Eg[f]!==void 0)return Eg[f];if(f.endsWith("deg"))return parseFloat(f);if(f.endsWith("turn"))return parseFloat(f)*360;if(f.endsWith("grad"))return parseFloat(f)*360/400;if(f.endsWith("rad"))return parseFloat(f)*180/Math.PI}return f==="none"?0:parseFloat(f)}),s=i.length>c?i.pop():1}else/[0-9](?:\s|\/|,)/.test(r)&&(i=r.match(/([0-9]+)/g).map(function(f){return parseFloat(f)}),o=((e=(t=r.match(/([a-z])/ig))==null?void 0:t.join(""))==null?void 0:e.toLowerCase())||"rgb");return{space:o,values:i,alpha:s}}const lu={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(r){var t=r[0]/360,e=r[1]/100,n=r[2]/100,i,s,o,a,l,h=0;if(e===0)return l=n*255,[l,l,l];for(s=n<.5?n*(1+e):n+e-n*e,i=2*n-s,a=[0,0,0];h<3;)o=t+1/3*-(h-1),o<0?o++:o>1&&o--,l=6*o<1?i+(s-i)*6*o:2*o<1?s:3*o<2?i+(s-i)*(2/3-o)*6:i,a[h++]=l*255;return a}};Ko.hsl=function(r){var t=r[0]/255,e=r[1]/255,n=r[2]/255,i=Math.min(t,e,n),s=Math.max(t,e,n),o=s-i,a,l,h;return s===i?a=0:t===s?a=(e-n)/o:e===s?a=2+(n-t)/o:n===s&&(a=4+(t-e)/o),a=Math.min(a*60,360),a<0&&(a+=360),h=(i+s)/2,s===i?l=0:h<=.5?l=o/(s+i):l=o/(2-s-i),[a,l*100,h*100]};function Mb(r){Array.isArray(r)&&r.raw&&(r=String.raw(...arguments)),r instanceof Number&&(r=+r);var t,e=Tb(r);if(!e.space)return[];const n=e.space[0]==="h"?lu.min:Ko.min,i=e.space[0]==="h"?lu.max:Ko.max;return t=Array(3),t[0]=Math.min(Math.max(e.values[0],n[0]),i[0]),t[1]=Math.min(Math.max(e.values[1],n[1]),i[1]),t[2]=Math.min(Math.max(e.values[2],n[2]),i[2]),e.space[0]==="h"&&(t=lu.rgb(t)),t.push(Math.min(Math.max(e.alpha,0),1)),t}function Rb(r){return typeof r=="string"?r:md(r)}const Cb=1024,co={};let hu=0;function Ib(r){if(r.length===4)return r;const t=r.slice();return t[3]=1,t}function Tg(r){const t=Le.lchuv(Ko.xyz(r));return t[3]=r[3],t}function Pb(r){const t=Le.rgb(v0.xyz(r));return t[3]=r[3],t}function pd(r){if(co.hasOwnProperty(r))return co[r];if(hu>=Cb){let e=0;for(const n in co)e++&3||(delete co[n],--hu)}const t=Mb(r);if(t.length!==4)throw new Error('Failed to parse "'+r+'" as color');for(const e of t)if(isNaN(e))throw new Error('Failed to parse "'+r+'" as color');return w0(t),co[r]=t,++hu,t}function Xr(r){return Array.isArray(r)?r:pd(r)}function w0(r){return r[0]=wt(r[0]+.5|0,0,255),r[1]=wt(r[1]+.5|0,0,255),r[2]=wt(r[2]+.5|0,0,255),r[3]=wt(r[3],0,1),r}function md(r){let t=r[0];t!=(t|0)&&(t=t+.5|0);let e=r[1];e!=(e|0)&&(e=e+.5|0);let n=r[2];n!=(n|0)&&(n=n+.5|0);const i=r[3]===void 0?1:Math.round(r[3]*1e3)/1e3;return"rgba("+t+","+e+","+n+","+i+")"}function Ab(r){try{return pd(r),!0}catch{return!1}}const fi=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"";fi.includes("firefox");const Lb=fi.includes("safari")&&!fi.includes("chrom"),Ob=Lb&&(fi.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(fi));fi.includes("webkit")&&fi.includes("edge");fi.includes("macintosh");const b0=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,_d=typeof Image<"u"&&Image.prototype.decode,Fb=typeof createImageBitmap=="function";(function(){let r=!1;try{const t=Object.defineProperty({},"passive",{get:function(){r=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return r})();function Jt(r,t,e,n){let i;return e&&e.length?i=e.shift():b0?i=new OffscreenCanvas(r||300,t||300):i=document.createElement("canvas"),r&&(i.width=r),t&&(i.height=t),i.getContext("2d",n)}let uu;function ec(){return uu||(uu=Jt(1,1)),uu}function Gi(r){const t=r.canvas;t.width=1,t.height=1,r.clearRect(0,0,1,1)}class vh extends ma{constructor(t,e,n,i){super(),this.extent=t,this.pixelRatio_=n,this.resolution=e,this.state=typeof i=="function"?et.IDLE:i,this.image_=null,this.loader=typeof i=="function"?i:null}changed(){this.dispatchEvent(Lt.CHANGE)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(this.state==et.IDLE&&this.loader){this.state=et.LOADING,this.changed();const t=this.getResolution(),e=Array.isArray(t)?t[0]:t;zm(()=>this.loader(this.getExtent(),e,this.getPixelRatio())).then(n=>{"image"in n&&(this.image_=n.image),"extent"in n&&(this.extent=n.extent),"resolution"in n&&(this.resolution=n.resolution),"pixelRatio"in n&&(this.pixelRatio_=n.pixelRatio),(n instanceof HTMLImageElement||n instanceof ImageBitmap||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement)&&(this.image_=n),this.state=et.LOADED}).catch(n=>{this.state=et.ERROR,console.error(n)}).finally(()=>this.changed())}}setImage(t){this.image_=t}setResolution(t){this.resolution=t}}function Nb(r,t,e){const n=r;let i=!0,s=!1,o=!1;const a=[Vo(n,Lt.LOAD,function(){o=!0,s||t()})];return n.src&&_d?(s=!0,n.decode().then(function(){i&&t()}).catch(function(l){i&&(o?t():e())})):a.push(Vo(n,Lt.ERROR,e)),function(){i=!1,a.forEach(ve)}}function Db(r,t){return new Promise((e,n)=>{function i(){o(),e(r)}function s(){o(),n(new Error("Image load error"))}function o(){r.removeEventListener("load",i),r.removeEventListener("error",s)}r.addEventListener("load",i),r.addEventListener("error",s)})}function S0(r,t){return t&&(r.src=t),r.src&&_d?new Promise((e,n)=>r.decode().then(()=>e(r)).catch(i=>r.complete&&r.width?e(r):n(i))):Db(r)}function mi(r,t){return t&&(r.src=t),r.src&&_d&&Fb?r.decode().then(()=>createImageBitmap(r)).catch(e=>{if(r.complete&&r.width)return r;throw e}):S0(r)}class kb{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const n=this.cache_[e];!(t++&3)&&!n.hasListener()&&(delete this.cache_[e],delete this.patternCache_[e],--this.cacheSize_)}}}get(t,e,n){const i=cu(t,e,n);return i in this.cache_?this.cache_[i]:null}getPattern(t,e,n){const i=cu(t,e,n);return i in this.patternCache_?this.patternCache_[i]:null}set(t,e,n,i,s){const o=cu(t,e,n),a=o in this.cache_;this.cache_[o]=i,s&&(i.getImageState()===et.IDLE&&i.load(),i.getImageState()===et.LOADING?i.ready().then(()=>{this.patternCache_[o]=ec().createPattern(i.getImage(1),"repeat")}):this.patternCache_[o]=ec().createPattern(i.getImage(1),"repeat")),a||++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}}function cu(r,t,e){const n=e?Xr(e):"null";return t+":"+r+":"+n}const ni=new kb;let fo=null;class Gb extends ma{constructor(t,e,n,i,s){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=n,this.canvas_={},this.color_=s,this.imageState_=i===void 0?et.IDLE:i,this.size_=t&&t.width&&t.height?[t.width,t.height]:null,this.src_=e,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===et.LOADED){fo||(fo=Jt(1,1,void 0,{willReadFrequently:!0})),fo.drawImage(this.image_,0,0);try{fo.getImageData(0,0,1,1),this.tainted_=!1}catch{fo=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(Lt.CHANGE)}handleImageError_(){this.imageState_=et.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=et.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],n=Jt(t,e);n.fillRect(0,0,t,e),this.hitDetectionImage_=n.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===et.IDLE){this.image_||this.initializeImage_(),this.imageState_=et.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&S0(this.image_,this.src_).then(t=>{this.image_=t,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==et.LOADED)return;const e=this.image_,n=document.createElement("canvas");n.width=Math.ceil(e.width*t),n.height=Math.ceil(e.height*t);const i=n.getContext("2d");i.scale(t,t),i.drawImage(e,0,0),i.globalCompositeOperation="multiply",i.fillStyle=Rb(this.color_),i.fillRect(0,0,n.width/t,n.height/t),i.globalCompositeOperation="destination-in",i.drawImage(e,0,0),this.canvas_[t]=n}ready(){return this.ready_||(this.ready_=new Promise(t=>{this.imageState_===et.LOADED||this.imageState_===et.ERROR?t():this.addEventListener(Lt.CHANGE,function e(){(this.imageState_===et.LOADED||this.imageState_===et.ERROR)&&(this.removeEventListener(Lt.CHANGE,e),t())})})),this.ready_}}function yd(r,t,e,n,i,s){let o=t===void 0?void 0:ni.get(t,e,i);return o||(o=new Gb(r,r instanceof HTMLImageElement?r.src||void 0:t,e,n,i),ni.set(t,e,i,o,s)),s&&o&&!ni.getPattern(t,e,i)&&ni.set(t,e,i,o,s),o}class Wr{constructor(t){t=t||{},this.patternImage_=null,this.color_=null,t.color!==void 0&&this.setColor(t.color)}clone(){const t=this.getColor();return new Wr({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){if(t!==null&&typeof t=="object"&&"src"in t){const e=yd(null,t.src,"anonymous",void 0,t.offset?null:t.color?t.color:null,!(t.offset&&t.size));e.ready().then(()=>{this.patternImage_=null}),e.getImageState()===et.IDLE&&e.load(),e.getImageState()===et.LOADING&&(this.patternImage_=e)}this.color_=t}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}function E0(r,t,e){return e===void 0&&(e=[0,0]),e[0]=r[0]*t+.5|0,e[1]=r[1]*t+.5|0,e}function ie(r,t){return Array.isArray(r)?r:(t===void 0?t=[r,r]:(t[0]=r,t[1]=r),t)}class wh{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=ie(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new wh({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return ut()}getImage(t){return ut()}getHitDetectionImage(){return ut()}getPixelRatio(t){return 1}getImageState(){return ut()}getImageSize(){return ut()}getOrigin(){return ut()}getSize(){return ut()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=ie(t)}listenImageChange(t){ut()}load(){ut()}unlistenImageChange(t){ut()}ready(){return Promise.resolve()}}function Mg(r,t,e,n){return e!==void 0&&n!==void 0?[e/r,n/t]:e!==void 0?e/r:n!==void 0?n/t:1}class xd extends wh{constructor(t){t=t||{};const e=t.opacity!==void 0?t.opacity:1,n=t.rotation!==void 0?t.rotation:0,i=t.scale!==void 0?t.scale:1,s=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:e,rotation:n,scale:i,displacement:t.displacement!==void 0?t.displacement:[0,0],rotateWithView:s,declutterMode:t.declutterMode}),this.anchor_=t.anchor!==void 0?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin!==void 0?t.anchorOrigin:"top-left",this.anchorXUnits_=t.anchorXUnits!==void 0?t.anchorXUnits:"fraction",this.anchorYUnits_=t.anchorYUnits!==void 0?t.anchorYUnits:"fraction",this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null;const o=t.img!==void 0?t.img:null;let a=t.src;At(!(a!==void 0&&o),"`image` and `src` cannot be provided at the same time"),(a===void 0||a.length===0)&&o&&(a=o.src||it(o)),At(a!==void 0&&a.length>0,"A defined and non-empty `src` or `image` must be provided"),At(!((t.width!==void 0||t.height!==void 0)&&t.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let l;if(t.src!==void 0?l=et.IDLE:o!==void 0&&(o instanceof HTMLImageElement?o.complete?l=o.src?et.LOADED:et.IDLE:l=et.LOADING:l=et.LOADED),this.color_=t.color!==void 0?Xr(t.color):null,this.iconImage_=yd(o,a,this.crossOrigin_,l,this.color_),this.offset_=t.offset!==void 0?t.offset:[0,0],this.offsetOrigin_=t.offsetOrigin!==void 0?t.offsetOrigin:"top-left",this.origin_=null,this.size_=t.size!==void 0?t.size:null,t.width!==void 0||t.height!==void 0){let h,u;if(t.size)[h,u]=t.size;else{const c=this.getImage(1);if(c.width&&c.height)h=c.width,u=c.height;else if(c instanceof HTMLImageElement){this.initialOptions_=t;const f=()=>{if(this.unlistenImageChange(f),!this.initialOptions_)return;const g=this.iconImage_.getSize();this.setScale(Mg(g[0],g[1],t.width,t.height))};this.listenImageChange(f);return}}h!==void 0&&this.setScale(Mg(h,u,t.width,t.height))}}clone(){let t,e,n;return this.initialOptions_?(e=this.initialOptions_.width,n=this.initialOptions_.height):(t=this.getScale(),t=Array.isArray(t)?t.slice():t),new xd({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:t,width:e,height:n,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const i=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!i)return null;t=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(t[0]*=i[0]),this.anchorYUnits_=="fraction"&&(t[1]*=i[1])}if(this.anchorOrigin_!="top-left"){if(!i)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(t[0]=-t[0]+i[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(t[1]=-t[1]+i[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),n=this.getScaleArray();return[t[0]-e[0]/n[0],t[1]+e[1]/n[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(this.offsetOrigin_!="top-left"){const e=this.getSize(),n=this.iconImage_.getSize();if(!e||!n)return null;t=t.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(t[0]=n[0]-e[0]-t[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(t[1]=n[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const t=this.getScaleArray();if(this.size_)return this.size_[0]*t[0];if(this.iconImage_.getImageState()==et.LOADED)return this.iconImage_.getSize()[0]*t[0]}getHeight(){const t=this.getScaleArray();if(this.size_)return this.size_[1]*t[1];if(this.iconImage_.getImageState()==et.LOADED)return this.iconImage_.getSize()[1]*t[1]}setScale(t){delete this.initialOptions_,super.setScale(t)}listenImageChange(t){this.iconImage_.addEventListener(Lt.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(Lt.CHANGE,t)}ready(){return this.iconImage_.ready()}}const bh=xd;class vd{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new vd({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}const un=vd;function rn(r){return r?Array.isArray(r)?md(r):typeof r=="object"&&"src"in r?jb(r):r:null}function jb(r){if(!r.offset||!r.size)return ni.getPattern(r.src,"anonymous",r.color);const t=r.src+":"+r.offset,e=ni.getPattern(t,void 0,r.color);if(e)return e;const n=ni.get(r.src,"anonymous",null);if(n.getImageState()!==et.LOADED)return null;const i=Jt(r.size[0],r.size[1]);return i.drawImage(n.getImage(1),r.offset[0],r.offset[1],r.size[0],r.size[1],0,0,r.size[0],r.size[1]),yd(i.canvas,t,void 0,et.LOADED,r.color,!0),ni.getPattern(t,void 0,r.color)}const zb=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),Rg=["style","variant","weight","size","lineHeight","family"],T0=function(r){const t=r.match(zb);if(!t)return null;const e={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let n=0,i=Rg.length;n<i;++n){const s=t[n+1];s!==void 0&&(e[Rg[n]]=s)}return e.families=e.family.split(/,\s?/),e},M0="10px sans-serif",nr="#000",Gs="round",An=[],Ln=0,js="round",Qo=10,Jo="#000",ta="center",Pl="middle",Ri=[0,0,0,0],ea=1,Vn=new qi;let us=null,rc;const nc={},Ub=function(){const r="32px ",t=["monospace","serif"],e=t.length,n="wmytzilWMYTZIL@#/&?$%10";let i,s;function o(l,h,u){let c=!0;for(let f=0;f<e;++f){const g=t[f];if(s=Al(l+" "+h+" "+r+g,n),u!=g){const m=Al(l+" "+h+" "+r+u+","+g,n);c=c&&m!=s}}return!!c}function a(){let l=!0;const h=Vn.getKeys();for(let u=0,c=h.length;u<c;++u){const f=h[u];Vn.get(f)<100&&(o.apply(this,f.split(`
`))?($s(nc),us=null,rc=void 0,Vn.set(f,100)):(Vn.set(f,Vn.get(f)+1,!0),l=!1))}l&&(clearInterval(i),i=void 0)}return function(l){const h=T0(l);if(!h)return;const u=h.families;for(let c=0,f=u.length;c<f;++c){const g=u[c],m=h.style+`
`+h.weight+`
`+g;Vn.get(m)===void 0&&(Vn.set(m,100,!0),o(h.style,h.weight,g)||(Vn.set(m,0,!0),i===void 0&&(i=setInterval(a,32))))}}}(),Bb=function(){let r;return function(t){let e=nc[t];if(e==null){if(b0){const n=T0(t),i=R0(t,"Žg");e=(isNaN(Number(n.lineHeight))?1.2:Number(n.lineHeight))*(i.actualBoundingBoxAscent+i.actualBoundingBoxDescent)}else r||(r=document.createElement("div"),r.innerHTML="M",r.style.minHeight="0",r.style.maxHeight="none",r.style.height="auto",r.style.padding="0",r.style.border="none",r.style.position="absolute",r.style.display="block",r.style.left="-99999px"),r.style.font=t,document.body.appendChild(r),e=r.offsetHeight,document.body.removeChild(r);nc[t]=e}return e}}();function R0(r,t){return us||(us=Jt(1,1)),r!=rc&&(us.font=r,rc=us.font),us.measureText(t)}function Al(r,t){return R0(r,t).width}function Cg(r,t,e){if(t in e)return e[t];const n=t.split(`
`).reduce((i,s)=>Math.max(i,Al(r,s)),0);return e[t]=n,n}function Xb(r,t){const e=[],n=[],i=[];let s=0,o=0,a=0,l=0;for(let h=0,u=t.length;h<=u;h+=2){const c=t[h];if(c===`
`||h===u){s=Math.max(s,o),i.push(o),o=0,a+=l;continue}const f=t[h+1]||r.font,g=Al(f,c);e.push(g),o+=g;const m=Bb(f);n.push(m),l=Math.max(l,m)}return{width:s,height:a,widths:e,heights:n,lineWidths:i}}function Wb(r,t,e,n,i,s,o,a,l,h,u){r.save(),e!==1&&(r.globalAlpha===void 0?r.globalAlpha=c=>c.globalAlpha*=e:r.globalAlpha*=e),t&&r.transform.apply(r,t),n.contextInstructions?(r.translate(l,h),r.scale(u[0],u[1]),qb(n,r)):u[0]<0||u[1]<0?(r.translate(l,h),r.scale(u[0],u[1]),r.drawImage(n,i,s,o,a,0,0,o,a)):r.drawImage(n,i,s,o,a,l,h,o*u[0],a*u[1]),r.restore()}function qb(r,t){const e=r.contextInstructions;for(let n=0,i=e.length;n<i;n+=2)Array.isArray(e[n+1])?t[e[n]].apply(t,e[n+1]):t[e[n]]=e[n+1]}class Sh extends wh{constructor(t){super({opacity:1,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode}),this.canvases_,this.hitDetectionCanvas_=null,this.fill_=t.fill!==void 0?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius_=t.radius,this.radius2_=t.radius2,this.angle_=t.angle!==void 0?t.angle:0,this.stroke_=t.stroke!==void 0?t.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?et.LOADING:et.LOADED,this.imageState_===et.LOADING&&this.ready().then(()=>this.imageState_=et.LOADED),this.render()}clone(){const t=this.getScale(),e=new Sh({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_,e=this.getDisplacement(),n=this.getScaleArray();return[t[0]/2-e[0]/n[0],t[1]/2+e[1]/n[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(t){let e=this.canvases_[t];if(!e){const n=this.renderOptions_,i=Jt(n.size*t,n.size*t);this.draw_(n,i,t),e=i.canvas,this.canvases_[t]=e}return e}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,n){if(e===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return e;let i=this.radius_,s=this.radius2_===void 0?i:this.radius2_;if(i<s){const E=i;i=s,s=E}const o=this.radius2_===void 0?this.points_:this.points_*2,a=2*Math.PI/o,l=s*Math.sin(a),h=Math.sqrt(s*s-l*l),u=i-h,c=Math.sqrt(l*l+u*u),f=c/l;if(t==="miter"&&f<=n)return f*e;const g=e/2/f,m=e/2*(u/c),_=Math.sqrt((i+g)*(i+g)+m*m)-i;if(this.radius2_===void 0||t==="bevel")return _*2;const x=i*Math.sin(a),v=Math.sqrt(i*i-x*x),w=s-v,S=Math.sqrt(x*x+w*w)/x;if(S<=n){const E=S*e/2-s-i;return 2*Math.max(_,E)}return _*2}createRenderOptions(){let t=Gs,e=js,n=0,i=null,s=0,o,a=0;this.stroke_&&(o=rn(this.stroke_.getColor()??Jo),a=this.stroke_.getWidth()??ea,i=this.stroke_.getLineDash(),s=this.stroke_.getLineDashOffset()??0,e=this.stroke_.getLineJoin()??js,t=this.stroke_.getLineCap()??Gs,n=this.stroke_.getMiterLimit()??Qo);const l=this.calculateLineJoinSize_(e,a,n),h=Math.max(this.radius_,this.radius2_||0),u=Math.ceil(2*h+l);return{strokeStyle:o,strokeWidth:a,size:u,lineCap:t,lineDash:i,lineDashOffset:s,lineJoin:e,miterLimit:n}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.canvases_={},this.hitDetectionCanvas_=null,this.size_=[t,t]}draw_(t,e,n){if(e.scale(n,n),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let i=this.fill_.getColor();i===null&&(i=nr),e.fillStyle=rn(i),e.fill()}t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){let e;if(this.fill_){let n=this.fill_.getColor(),i=0;typeof n=="string"&&(n=Xr(n)),n===null?i=1:Array.isArray(n)&&(i=n.length===4?n[3]:1),i===0&&(e=Jt(t.size,t.size),this.drawHitDetectionCanvas_(t,e))}return e?e.canvas:this.getImage(1)}createPath_(t){let e=this.points_;const n=this.radius_;if(e===1/0)t.arc(0,0,n,0,2*Math.PI);else{const i=this.radius2_===void 0?n:this.radius2_;this.radius2_!==void 0&&(e*=2);const s=this.angle_-Math.PI/2,o=2*Math.PI/e;for(let a=0;a<e;a++){const l=s+a*o,h=a%2===0?n:i;t.lineTo(h*Math.cos(l),h*Math.sin(l))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=nr,e.fill(),t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}class Eh extends Sh{constructor(t){t=t||{radius:5},super({points:1/0,fill:t.fill,radius:t.radius,stroke:t.stroke,scale:t.scale!==void 0?t.scale:1,rotation:t.rotation!==void 0?t.rotation:0,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new Eh({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius_=t,this.render()}}class Th{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=Ig,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&typeof t=="object"&&(t=t.clone()),new Th({geometry:t??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){typeof t=="function"?this.geometryFunction_=t:typeof t=="string"?this.geometryFunction_=function(e){return e.get(t)}:t?t!==void 0&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=Ig,this.geometry_=t}setZIndex(t){this.zIndex_=t}}function Zb(r){let t;if(typeof r=="function")t=r;else{let e;Array.isArray(r)?e=r:(At(typeof r.getZIndex=="function","Expected an `Style` or an array of `Style`"),e=[r]),t=function(){return e}}return t}let du=null;function $b(r,t){if(!du){const e=new Wr({color:"rgba(255,255,255,0.4)"}),n=new un({color:"#3399CC",width:1.25});du=[new Th({image:new Eh({fill:e,stroke:n,radius:5}),fill:e,stroke:n})]}return du}function Ig(r){return r.getGeometry()}const Ve=Th,Vb="#333";class ji{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.scale_=t.scale,this.scaleArray_=ie(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.repeat_=t.repeat,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new Wr({color:Vb}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new ji({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRepeat(t){this.repeat_=t}setRotateWithView(t){this.rotateWithView_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=ie(t!==void 0?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}}const Bn=["http://www.google.com/kml/ext/2.2"],lt=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"],Yb="http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd",Pg={fraction:"fraction",pixels:"pixels",insetPixels:"pixels"},Hb=q(lt,{ExtendedData:B0,Region:X0,MultiGeometry:O(j0,"geometry"),LineString:O(k0,"geometry"),LinearRing:O(G0,"geometry"),Point:O(z0,"geometry"),Polygon:O(U0,"geometry"),Style:O(Sd),StyleMap:O2,address:O($),description:O($),name:O($),open:O(di),phoneNumber:O($),styleUrl:O(L0),visibility:O(di)},q(Bn,{MultiTrack:O(v2,"geometry"),Track:O(D0,"geometry")})),Kb=q(lt,{ExtendedData:B0,Region:X0,Link:q2,address:O($),description:O($),name:O($),open:O(di),phoneNumber:O($),visibility:O(di)}),Qb=q(lt,{href:O(A0)}),Jb=q(lt,{Altitude:O(Pt),Longitude:O(Pt),Latitude:O(Pt),Tilt:O(Pt),AltitudeMode:O($),Heading:O(Pt),Roll:O(Pt)}),C0=q(lt,{LatLonAltBox:G2,Lod:z2}),t2=q(lt,["Document","Placemark"]),e2=q(lt,{Document:N(J2),Placemark:N(Z0)});let Rs,dl=null,ic,Fo,No,Do,Ll,sc=null,wd,oc=null,ac,Ci=null,Ag=null,lc=null;function Ol(r){return 32/Math.min(r[0],r[1])}function r2(){Rs=[255,255,255,1],dl=new Wr({color:Rs}),ic=[20,2],Fo="pixels",No="pixels",Do=[64,64],Ll="https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png",sc=new bh({anchor:ic,anchorOrigin:"bottom-left",anchorXUnits:Fo,anchorYUnits:No,crossOrigin:"anonymous",rotation:0,scale:Ol(Do),size:Do,src:Ll}),wd="NO_IMAGE",oc=new un({color:Rs,width:1}),ac=new un({color:[51,51,51,1],width:2}),Ci=new ji({font:"bold 16px Helvetica",fill:dl,stroke:ac,scale:.8}),Ag=new Ve({fill:dl,image:sc,text:Ci,stroke:oc,zIndex:0}),lc=[Ag]}let Ha;function n2(r){return r}class i2 extends Ra{constructor(t){super(),t=t||{},lc||r2(),this.dataProjection=tt("EPSG:4326"),this.defaultStyle_=t.defaultStyle?t.defaultStyle:lc,this.extractStyles_=t.extractStyles!==void 0?t.extractStyles:!0,this.writeStyles_=t.writeStyles!==void 0?t.writeStyles:!0,this.sharedStyles_={},this.showPointNames_=t.showPointNames!==void 0?t.showPointNames:!0,this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:"anonymous",this.iconUrlFunction_=t.iconUrlFunction?t.iconUrlFunction:n2,this.supportedMediaTypes=["application/vnd.google-earth.kml+xml"]}readDocumentOrFolder_(t,e){const n=q(lt,{Document:Cl(this.readDocumentOrFolder_,this),Folder:Cl(this.readDocumentOrFolder_,this),Placemark:ot(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this)}),i=Z([],n,t,e,this);if(i)return i}readPlacemark_(t,e){const n=Z({geometry:null},Hb,t,e,this);if(!n)return;const i=new Se,s=t.getAttribute("id");s!==null&&i.setId(s);const o=e[0],a=n.geometry;if(a&&se(a,!1,o),i.setGeometry(a),delete n.geometry,this.extractStyles_){const l=n.Style,h=n.styleUrl,u=o2(l,h,this.defaultStyle_,this.sharedStyles_,this.showPointNames_);i.setStyle(u)}return delete n.Style,i.setProperties(n,!0),i}readSharedStyle_(t,e){const n=t.getAttribute("id");if(n!==null){const i=Sd.call(this,t,e);if(i){let s,o=t.baseURI;(!o||o=="about:blank")&&(o=window.location.href),o?s=new URL("#"+n,o).href:s="#"+n,this.sharedStyles_[s]=i}}}readSharedStyleMap_(t,e){const n=t.getAttribute("id");if(n===null)return;const i=F0.call(this,t,e);if(!i)return;let s,o=t.baseURI;(!o||o=="about:blank")&&(o=window.location.href),o?s=new URL("#"+n,o).href:s="#"+n,this.sharedStyles_[s]=i}readFeatureFromNode(t,e){return lt.includes(t.namespaceURI)&&this.readPlacemark_(t,[this.getReadOptions(t,e)])||null}readFeaturesFromNode(t,e){if(!lt.includes(t.namespaceURI))return[];let n;const i=t.localName;if(i=="Document"||i=="Folder")return n=this.readDocumentOrFolder_(t,[this.getReadOptions(t,e)]),n||[];if(i=="Placemark"){const s=this.readPlacemark_(t,[this.getReadOptions(t,e)]);return s?[s]:[]}if(i=="kml"){n=[];for(let s=t.firstElementChild;s;s=s.nextElementSibling){const o=this.readFeaturesFromNode(s,e);o&&Ot(n,o)}return n}return[]}readName(t){if(t){if(typeof t=="string"){const e=Cr(t);return this.readNameFromDocument(e)}return Rr(t)?this.readNameFromDocument(t):this.readNameFromNode(t)}}readNameFromDocument(t){for(let e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE){const n=this.readNameFromNode(e);if(n)return n}}readNameFromNode(t){for(let e=t.firstElementChild;e;e=e.nextElementSibling)if(lt.includes(e.namespaceURI)&&e.localName=="name")return $(e);for(let e=t.firstElementChild;e;e=e.nextElementSibling){const n=e.localName;if(lt.includes(e.namespaceURI)&&(n=="Document"||n=="Folder"||n=="Placemark"||n=="kml")){const i=this.readNameFromNode(e);if(i)return i}}}readNetworkLinks(t){const e=[];if(typeof t=="string"){const n=Cr(t);Ot(e,this.readNetworkLinksFromDocument(n))}else Rr(t)?Ot(e,this.readNetworkLinksFromDocument(t)):Ot(e,this.readNetworkLinksFromNode(t));return e}readNetworkLinksFromDocument(t){const e=[];for(let n=t.firstChild;n;n=n.nextSibling)n.nodeType==Node.ELEMENT_NODE&&Ot(e,this.readNetworkLinksFromNode(n));return e}readNetworkLinksFromNode(t){const e=[];for(let n=t.firstElementChild;n;n=n.nextElementSibling)if(lt.includes(n.namespaceURI)&&n.localName=="NetworkLink"){const i=Z({},Kb,n,[]);e.push(i)}for(let n=t.firstElementChild;n;n=n.nextElementSibling){const i=n.localName;lt.includes(n.namespaceURI)&&(i=="Document"||i=="Folder"||i=="kml")&&Ot(e,this.readNetworkLinksFromNode(n))}return e}readRegion(t){const e=[];if(typeof t=="string"){const n=Cr(t);Ot(e,this.readRegionFromDocument(n))}else Rr(t)?Ot(e,this.readRegionFromDocument(t)):Ot(e,this.readRegionFromNode(t));return e}readRegionFromDocument(t){const e=[];for(let n=t.firstChild;n;n=n.nextSibling)n.nodeType==Node.ELEMENT_NODE&&Ot(e,this.readRegionFromNode(n));return e}readRegionFromNode(t){const e=[];for(let n=t.firstElementChild;n;n=n.nextElementSibling)if(lt.includes(n.namespaceURI)&&n.localName=="Region"){const i=Z({},C0,n,[]);e.push(i)}for(let n=t.firstElementChild;n;n=n.nextElementSibling){const i=n.localName;lt.includes(n.namespaceURI)&&(i=="Document"||i=="Folder"||i=="kml")&&Ot(e,this.readRegionFromNode(n))}return e}readCamera(t){const e=[];if(typeof t=="string"){const n=Cr(t);Ot(e,this.readCameraFromDocument(n))}else Rr(t)?Ot(e,this.readCameraFromDocument(t)):Ot(e,this.readCameraFromNode(t));return e}readCameraFromDocument(t){const e=[];for(let n=t.firstChild;n;n=n.nextSibling)n.nodeType===Node.ELEMENT_NODE&&Ot(e,this.readCameraFromNode(n));return e}readCameraFromNode(t){const e=[];for(let n=t.firstElementChild;n;n=n.nextElementSibling)if(lt.includes(n.namespaceURI)&&n.localName==="Camera"){const i=Z({},Jb,n,[]);e.push(i)}for(let n=t.firstElementChild;n;n=n.nextElementSibling){const i=n.localName;lt.includes(n.namespaceURI)&&(i==="Document"||i==="Folder"||i==="Placemark"||i==="kml")&&Ot(e,this.readCameraFromNode(n))}return e}writeFeaturesNode(t,e){e=this.adaptOptions(e);const n=mt(lt[4],"kml"),i="http://www.w3.org/2000/xmlns/";n.setAttributeNS(i,"xmlns:gx",Bn[0]),n.setAttributeNS(i,"xmlns:xsi",Di),n.setAttributeNS(Di,"xsi:schemaLocation",Yb);const s={node:n},o={};t.length>1?o.Document=t:t.length==1&&(o.Placemark=t[0]);const a=t2[n.namespaceURI],l=cr(o,a);return pt(s,e2,Ie,l,[e],a,this),n}}function s2(r,t){const e=[0,0];let n="start";const i=r.getImage();if(i){const o=i.getSize();if(o&&o.length==2){const a=i.getScaleArray(),l=i.getAnchor();e[0]=a[0]*(o[0]-l[0]),e[1]=a[1]*(o[1]/2-l[1]),n="left"}}let s=r.getText();return s?(s=s.clone(),s.setFont(s.getFont()||Ci.getFont()),s.setScale(s.getScale()||Ci.getScale()),s.setFill(s.getFill()||Ci.getFill()),s.setStroke(s.getStroke()||ac)):s=Ci.clone(),s.setText(t),s.setOffsetX(e[0]),s.setOffsetY(e[1]),s.setTextAlign(n),new Ve({image:i,text:s})}function o2(r,t,e,n,i){return function(s,o){let a=i,l="",h=[];if(a){const c=s.getGeometry();if(c)if(c instanceof je)h=c.getGeometriesArrayRecursive().filter(function(f){const g=f.getType();return g==="Point"||g==="MultiPoint"}),a=h.length>0;else{const f=c.getType();a=f==="Point"||f==="MultiPoint"}}a&&(l=s.get("name"),a=a&&!!l,a&&/&[^&]+;/.test(l)&&(Ha||(Ha=document.createElement("textarea")),Ha.innerHTML=l,l=Ha.value));let u=e;if(r?u=r:t&&(u=I0(t,e,n)),a){const c=s2(u[0],l);if(h.length>0){c.setGeometry(new je(h));const f=new Ve({geometry:u[0].getGeometry(),image:null,fill:u[0].getFill(),stroke:u[0].getStroke(),text:null});return[c,f].concat(u.slice(1))}return c}return u}}function I0(r,t,e){return Array.isArray(r)?r:typeof r=="string"?I0(e[r],t,e):t}function Mh(r){const t=Ye(r,!1),e=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(t);if(e){const n=e[1];return[parseInt(n.substr(6,2),16),parseInt(n.substr(4,2),16),parseInt(n.substr(2,2),16),parseInt(n.substr(0,2),16)/255]}}function P0(r){let t=Ye(r,!1);const e=[];t=t.replace(/\s*,\s*/g,",");const n=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?),([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|,|$)(?:([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|$))?\s*/i;let i;for(;i=n.exec(t);){const s=parseFloat(i[1]),o=parseFloat(i[2]),a=i[3]?parseFloat(i[3]):0;e.push(s,o,a),t=t.substr(i[0].length)}if(t==="")return e}function A0(r){const t=Ye(r,!1).trim();let e=r.baseURI;return(!e||e=="about:blank")&&(e=window.location.href),e?new URL(t,e).href:t}function L0(r){const t=Ye(r,!1).trim().replace(/^(?!.*#)/,"#");let e=r.baseURI;return(!e||e=="about:blank")&&(e=window.location.href),e?new URL(t,e).href:t}function a2(r){const t=r.getAttribute("xunits"),e=r.getAttribute("yunits");let n;return t!=="insetPixels"?e!=="insetPixels"?n="bottom-left":n="top-left":e!=="insetPixels"?n="bottom-right":n="top-right",{x:parseFloat(r.getAttribute("x")),xunits:Pg[t],y:parseFloat(r.getAttribute("y")),yunits:Pg[e],origin:n}}function O0(r){return Pt(r)}const l2=q(lt,{Pair:L2});function F0(r,t){return Z(void 0,l2,r,t,this)}const h2=q(lt,{Icon:O(S2),color:O(Mh),heading:O(Pt),hotSpot:O(a2),scale:O(O0)});function u2(r,t){const e=Z({},h2,r,t);if(!e)return;const n=t[t.length-1],i="Icon"in e?e.Icon:{},s=!("Icon"in e)||Object.keys(i).length>0;let o;const a=i.href;a?o=a:s&&(o=Ll);let l,h,u,c="bottom-left";const f=e.hotSpot;f?(l=[f.x,f.y],h=f.xunits,u=f.yunits,c=f.origin):/^https?:\/\/maps\.(?:google|gstatic)\.com\//.test(o)&&(o.includes("pushpin")?(l=ic,h=Fo,u=No):o.includes("arrow-reverse")?(l=[54,42],h=Fo,u=No):o.includes("paddle")&&(l=[32,1],h=Fo,u=No));let g;const m=i.x,_=i.y;m!==void 0&&_!==void 0&&(g=[m,_]);let x;const v=i.w,w=i.h;v!==void 0&&w!==void 0&&(x=[v,w]);let S;const E=e.heading;E!==void 0&&(S=Oo(E));const T=e.scale,R=e.color;if(s){o==Ll&&(x=Do);const C=new bh({anchor:l,anchorOrigin:c,anchorXUnits:h,anchorYUnits:u,crossOrigin:this.crossOrigin_,offset:g,offsetOrigin:"bottom-left",rotation:S,scale:T,size:x,src:this.iconUrlFunction_(o),color:R}),I=C.getScaleArray()[0],F=C.getSize();if(F===null){const U=C.getImageState();if(U===et.IDLE||U===et.LOADING){const j=function(){const B=C.getImageState();if(!(B===et.IDLE||B===et.LOADING)){const d=C.getSize();if(d&&d.length==2){const p=Ol(d);C.setScale(I*p)}C.unlistenImageChange(j)}};C.listenImageChange(j),U===et.IDLE&&C.load()}}else if(F.length==2){const U=Ol(F);C.setScale(I*U)}n.imageStyle=C}else n.imageStyle=wd}const c2=q(lt,{color:O(Mh),scale:O(O0)});function d2(r,t){const e=Z({},c2,r,t);if(!e)return;const n=t[t.length-1],i=new ji({fill:new Wr({color:"color"in e?e.color:Rs}),scale:e.scale});n.textStyle=i}const f2=q(lt,{color:O(Mh),width:O(Pt)});function g2(r,t){const e=Z({},f2,r,t);if(!e)return;const n=t[t.length-1],i=new un({color:"color"in e?e.color:Rs,width:"width"in e?e.width:1});n.strokeStyle=i}const p2=q(lt,{color:O(Mh),fill:O(di),outline:O(di)});function m2(r,t){const e=Z({},p2,r,t);if(!e)return;const n=t[t.length-1],i=new Wr({color:"color"in e?e.color:Rs});n.fillStyle=i;const s=e.fill;s!==void 0&&(n.fill=s);const o=e.outline;o!==void 0&&(n.outline=o)}const _2=q(lt,{coordinates:ht(P0)});function N0(r,t){return Z(null,_2,r,t)}function y2(r,t){const e=t[t.length-1].coordinates,n=Ye(r,!1),i=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(n);if(i){const s=parseFloat(i[1]),o=parseFloat(i[2]),a=parseFloat(i[3]);e.push([s,o,a])}else e.push([])}const x2=q(Bn,{Track:ot(D0)});function v2(r,t){const e=Z([],x2,r,t);if(e)return new ur(e)}const w2=q(lt,{when:Z2},q(Bn,{coord:y2}));function D0(r,t){const e=Z({coordinates:[],whens:[]},w2,r,t);if(!e)return;const n=[],i=e.coordinates,s=e.whens;for(let o=0,a=Math.min(i.length,s.length);o<a;++o)i[o].length==3&&n.push(i[o][0],i[o][1],i[o][2],s[o]);return new ye(n,"XYZM")}const b2=q(lt,{href:O(A0)},q(Bn,{x:O(Pt),y:O(Pt),w:O(Pt),h:O(Pt)}));function S2(r,t){return Z({},b2,r,t)||null}const E2=q(lt,{coordinates:ht(P0)});function bd(r,t){return Z(null,E2,r,t)}const Rh=q(lt,{extrude:O(di),tessellate:O(di),altitudeMode:O($)});function k0(r,t){const e=Z({},Rh,r,t),n=bd(r,t);if(n){const i=new ye(n,"XYZ");return i.setProperties(e,!0),i}}function G0(r,t){const e=Z({},Rh,r,t),n=bd(r,t);if(n){const i=new Ue(n,"XYZ",[n.length]);return i.setProperties(e,!0),i}}const T2=q(lt,{LineString:ot(k0),LinearRing:ot(G0),MultiGeometry:ot(j0),Point:ot(z0),Polygon:ot(U0)});function j0(r,t){const e=Z([],T2,r,t);if(!e)return null;if(e.length===0)return new je(e);let n,i=!0;const s=e[0].getType();let o;for(let a=1,l=e.length;a<l;++a)if(o=e[a],o.getType()!=s){i=!1;break}if(i){let a,l;if(s=="Point"){const h=e[0];a=h.getLayout(),l=h.getFlatCoordinates();for(let u=1,c=e.length;u<c;++u)o=e[u],Ot(l,o.getFlatCoordinates());n=new Zr(l,a),fu(n,e)}else if(s=="LineString")n=new ur(e),fu(n,e);else if(s=="Polygon")n=new Pr(e),fu(n,e);else if(s=="GeometryCollection")n=new je(e);else throw new Error("Unknown geometry type found")}else n=new je(e);return n}function z0(r,t){const e=Z({},Rh,r,t),n=bd(r,t);if(n){const i=new Re(n,"XYZ");return i.setProperties(e,!0),i}}const M2=q(lt,{innerBoundaryIs:B2,outerBoundaryIs:W2});function U0(r,t){const e=Z({},Rh,r,t),n=Z([null],M2,r,t);if(n&&n[0]){const i=n[0],s=[i.length];for(let a=1,l=n.length;a<l;++a)Ot(i,n[a]),s.push(i.length);const o=new Ue(i,"XYZ",s);return o.setProperties(e,!0),o}}const R2=q(lt,{IconStyle:u2,LabelStyle:d2,LineStyle:g2,PolyStyle:m2});function Sd(r,t){const e=Z({},R2,r,t,this);if(!e)return null;let n="fillStyle"in e?e.fillStyle:dl;const i=e.fill;i!==void 0&&!i&&(n=null);let s;"imageStyle"in e?e.imageStyle!=wd&&(s=e.imageStyle):s=sc;const o="textStyle"in e?e.textStyle:Ci,a="strokeStyle"in e?e.strokeStyle:oc,l=e.outline;return l!==void 0&&!l?[new Ve({geometry:function(h){const u=h.getGeometry(),c=u.getType();if(c==="GeometryCollection"){const f=u;return new je(f.getGeometriesArrayRecursive().filter(function(g){const m=g.getType();return m!=="Polygon"&&m!=="MultiPolygon"}))}if(c!=="Polygon"&&c!=="MultiPolygon")return u},fill:n,image:s,stroke:a,text:o,zIndex:void 0}),new Ve({geometry:function(h){const u=h.getGeometry(),c=u.getType();if(c==="GeometryCollection"){const f=u;return new je(f.getGeometriesArrayRecursive().filter(function(g){const m=g.getType();return m==="Polygon"||m==="MultiPolygon"}))}if(c==="Polygon"||c==="MultiPolygon")return u},fill:n,stroke:null,zIndex:void 0})]:[new Ve({fill:n,image:s,stroke:a,text:o,zIndex:void 0})]}function fu(r,t){const e=t.length,n=new Array(t.length),i=new Array(t.length),s=new Array(t.length);let o,a,l;o=!1,a=!1,l=!1;for(let h=0;h<e;++h){const u=t[h];n[h]=u.get("extrude"),i[h]=u.get("tessellate"),s[h]=u.get("altitudeMode"),o=o||n[h]!==void 0,a=a||i[h]!==void 0,l=l||s[h]}o&&r.set("extrude",n),a&&r.set("tessellate",i),l&&r.set("altitudeMode",s)}const C2=q(lt,{displayName:O($),value:O($)});function I2(r,t){const e=r.getAttribute("name");lr(C2,r,t);const n=t[t.length-1];e&&n.displayName?n[e]={value:n.value,displayName:n.displayName,toString:function(){return n.value}}:e!==null?n[e]=n.value:n.displayName!==null&&(n[n.displayName]=n.value),delete n.value}const P2=q(lt,{Data:I2,SchemaData:N2});function B0(r,t){lr(P2,r,t)}function X0(r,t){lr(C0,r,t)}const A2=q(lt,{Style:O(Sd),key:O($),styleUrl:O(L0)});function L2(r,t){const e=Z({},A2,r,t,this);if(!e)return;const n=e.key;if(n&&n=="normal"){const i=e.styleUrl;i&&(t[t.length-1]=i);const s=e.Style;s&&(t[t.length-1]=s)}}function O2(r,t){const e=F0.call(this,r,t);if(!e)return;const n=t[t.length-1];if(Array.isArray(e))n.Style=e;else if(typeof e=="string")n.styleUrl=e;else throw new Error("`styleMapValue` has an unknown type")}const F2=q(lt,{SimpleData:D2});function N2(r,t){lr(F2,r,t)}function D2(r,t){const e=r.getAttribute("name");if(e!==null){const n=$(r),i=t[t.length-1];i[e]=n}}const k2=q(lt,{altitudeMode:O($),minAltitude:O(Pt),maxAltitude:O(Pt),north:O(Pt),south:O(Pt),east:O(Pt),west:O(Pt)});function G2(r,t){const e=Z({},k2,r,t);if(!e)return;const n=t[t.length-1],i=[parseFloat(e.west),parseFloat(e.south),parseFloat(e.east),parseFloat(e.north)];n.extent=i,n.altitudeMode=e.altitudeMode,n.minAltitude=parseFloat(e.minAltitude),n.maxAltitude=parseFloat(e.maxAltitude)}const j2=q(lt,{minLodPixels:O(Pt),maxLodPixels:O(Pt),minFadeExtent:O(Pt),maxFadeExtent:O(Pt)});function z2(r,t){const e=Z({},j2,r,t);if(!e)return;const n=t[t.length-1];n.minLodPixels=parseFloat(e.minLodPixels),n.maxLodPixels=parseFloat(e.maxLodPixels),n.minFadeExtent=parseFloat(e.minFadeExtent),n.maxFadeExtent=parseFloat(e.maxFadeExtent)}const U2=q(lt,{LinearRing:ot(N0)});function B2(r,t){const e=Z([],U2,r,t);e.length>0&&t[t.length-1].push(...e)}const X2=q(lt,{LinearRing:ht(N0)});function W2(r,t){const e=Z(void 0,X2,r,t);if(e){const n=t[t.length-1];n[0]=e}}function q2(r,t){lr(Qb,r,t)}function Z2(r,t){const e=t[t.length-1].whens,n=Ye(r,!1),i=Date.parse(n);e.push(isNaN(i)?0:i)}function Ch(r,t){const e=Xr(t),n=[(e.length==4?e[3]:1)*255,e[2],e[1],e[0]];for(let i=0;i<4;++i){const s=Math.floor(n[i]).toString(16);n[i]=s.length==1?"0"+s:s}gt(r,n.join(""))}function $2(r,t,e){const n=e[e.length-1],i=n.layout,s=n.stride;let o;if(i=="XY"||i=="XYM")o=2;else if(i=="XYZ"||i=="XYZM")o=3;else throw new Error("Invalid geometry layout");const a=t.length;let l="";if(a>0){l+=t[0];for(let h=1;h<o;++h)l+=","+t[h];for(let h=s;h<a;h+=s){l+=" "+t[h];for(let u=1;u<o;++u)l+=","+t[h+u]}}gt(r,l)}const fl=q(lt,{Data:N(V2),value:N(H2),displayName:N(Y2)});function V2(r,t,e){r.setAttribute("name",t.name);const n={node:r},i=t.value;typeof i=="object"?(i!==null&&i.displayName&&pt(n,fl,Ie,[i.displayName],e,["displayName"]),i!==null&&i.value&&pt(n,fl,Ie,[i.value],e,["value"])):pt(n,fl,Ie,[i],e,["value"])}function Y2(r,t){yw(r,t)}function H2(r,t){gt(r,t)}const K2=q(lt,{Placemark:N(Z0)}),Q2=function(r,t,e){const n=t[t.length-1].node;return mt(n.namespaceURI,"Placemark")};function J2(r,t,e){pt({node:r},K2,Q2,t,e,void 0,this)}const tS=ue("Data");function eS(r,t,e){const n={node:r},i=t.names,s=t.values,o=i.length;for(let a=0;a<o;a++)pt(n,fl,tS,[{name:i[a],value:s[a]}],e)}const Lg=q(lt,["href"],q(Bn,["x","y","w","h"])),Og=q(lt,{href:N(gt)},q(Bn,{x:N(rr),y:N(rr),w:N(rr),h:N(rr)})),rS=function(r,t,e){return mt(Bn[0],"gx:"+e)};function nS(r,t,e){const n={node:r},i=e[e.length-1].node;let s=Lg[i.namespaceURI],o=cr(t,s);pt(n,Og,Ie,o,e,s),s=Lg[Bn[0]],o=cr(t,s),pt(n,Og,rS,o,e,s)}const iS=q(lt,["scale","heading","Icon","color","hotSpot"]),sS=q(lt,{Icon:N(nS),color:N(Ch),heading:N(rr),hotSpot:N(LS),scale:N(V0)});function oS(r,t,e){const n={node:r},i={},s=t.getSrc(),o=t.getSize(),a=t.getImageSize(),l={href:s};if(o){l.w=o[0],l.h=o[1];const x=t.getAnchor(),v=t.getOrigin();if(v&&a&&v[0]!==0&&v[1]!==o[1]&&(l.x=v[0],l.y=a[1]-(v[1]+o[1])),x&&(x[0]!==o[0]/2||x[1]!==o[1]/2)){const w={x:x[0],xunits:"pixels",y:o[1]-x[1],yunits:"pixels"};i.hotSpot=w}}i.Icon=l;let h=t.getScaleArray()[0],u=o;if(u===null&&(u=Do),u.length==2){const x=Ol(u);h=h/x}h!==1&&(i.scale=h);const c=t.getRotation();c!==0&&(i.heading=c);const f=t.getColor();f&&(i.color=f);const g=e[e.length-1].node,m=iS[g.namespaceURI],_=cr(i,m);pt(n,sS,Ie,_,e,m)}const aS=q(lt,["color","scale"]),lS=q(lt,{color:N(Ch),scale:N(V0)});function hS(r,t,e){const n={node:r},i={},s=t.getFill();s&&(i.color=s.getColor());const o=t.getScale();o&&o!==1&&(i.scale=o);const a=e[e.length-1].node,l=aS[a.namespaceURI],h=cr(i,l);pt(n,lS,Ie,h,e,l)}const uS=q(lt,["color","width"]),cS=q(lt,{color:N(Ch),width:N(rr)});function dS(r,t,e){const n={node:r},i={color:t.getColor(),width:Number(t.getWidth())||1},s=e[e.length-1].node,o=uS[s.namespaceURI],a=cr(i,o);pt(n,cS,Ie,a,e,o)}const fS={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"},W0=function(r,t,e){if(r){const n=t[t.length-1].node;return mt(n.namespaceURI,fS[r.getType()])}},gS=ue("Point"),pS=ue("LineString"),mS=ue("LinearRing"),_S=ue("Polygon"),yS=q(lt,{LineString:N(Cs),Point:N(Cs),Polygon:N($0),GeometryCollection:N(q0)});function q0(r,t,e){const n={node:r},i=t.getType();let s=[],o;if(i==="GeometryCollection")t.getGeometriesArrayRecursive().forEach(function(a){const l=a.getType();if(l==="MultiPoint")s=s.concat(a.getPoints());else if(l==="MultiLineString")s=s.concat(a.getLineStrings());else if(l==="MultiPolygon")s=s.concat(a.getPolygons());else if(l==="Point"||l==="LineString"||l==="Polygon")s.push(a);else throw new Error("Unknown geometry type")}),o=W0;else if(i==="MultiPoint")s=t.getPoints(),o=gS;else if(i==="MultiLineString")s=t.getLineStrings(),o=pS;else if(i==="MultiPolygon")s=t.getPolygons(),o=_S;else throw new Error("Unknown geometry type");pt(n,yS,o,s,e)}const xS=q(lt,{LinearRing:N(Cs)});function Fg(r,t,e){pt({node:r},xS,mS,[t],e)}const gu=q(lt,{ExtendedData:N(eS),MultiGeometry:N(q0),LineString:N(Cs),LinearRing:N(Cs),Point:N(Cs),Polygon:N($0),Style:N(AS),address:N(gt),description:N(gt),name:N(gt),open:N(ks),phoneNumber:N(gt),styleUrl:N(gt),visibility:N(ks)}),vS=q(lt,["name","open","visibility","address","phoneNumber","description","styleUrl","Style"]),wS=ue("ExtendedData");function Z0(r,t,e){const n={node:r};t.getId()&&r.setAttribute("id",t.getId());const i=t.getProperties(),s={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};s[t.getGeometryName()]=1;const o=Object.keys(i||{}).sort().filter(function(g){return!s[g]}),a=t.getStyleFunction();if(a){const g=a(t,0);if(g){const m=Array.isArray(g)?g:[g];let _=m;if(t.getGeometry()&&(_=m.filter(function(x){const v=x.getGeometryFunction()(t);if(v){const w=v.getType();return w==="GeometryCollection"?v.getGeometriesArrayRecursive().filter(function(S){const E=S.getType();return E==="Point"||E==="MultiPoint"}).length:w==="Point"||w==="MultiPoint"}})),this.writeStyles_){let x=m,v=m;t.getGeometry()&&(x=m.filter(function(w){const S=w.getGeometryFunction()(t);if(S){const E=S.getType();return E==="GeometryCollection"?S.getGeometriesArrayRecursive().filter(function(T){const R=T.getType();return R==="LineString"||R==="MultiLineString"}).length:E==="LineString"||E==="MultiLineString"}}),v=m.filter(function(w){const S=w.getGeometryFunction()(t);if(S){const E=S.getType();return E==="GeometryCollection"?S.getGeometriesArrayRecursive().filter(function(T){const R=T.getType();return R==="Polygon"||R==="MultiPolygon"}).length:E==="Polygon"||E==="MultiPolygon"}})),i.Style={pointStyles:_,lineStyles:x,polyStyles:v}}if(_.length&&i.name===void 0){const x=_[0].getText();x&&(i.name=x.getText())}}}const l=e[e.length-1].node,h=vS[l.namespaceURI],u=cr(i,h);if(pt(n,gu,Ie,u,e,h),o.length>0){const g=cr(i,o);pt(n,gu,wS,[{names:o,values:g}],e)}const c=e[0];let f=t.getGeometry();f&&(f=se(f,!0,c)),pt(n,gu,W0,[f],e)}const bS=q(lt,["extrude","tessellate","altitudeMode","coordinates"]),SS=q(lt,{extrude:N(ks),tessellate:N(ks),altitudeMode:N(gt),coordinates:N($2)});function Cs(r,t,e){const n=t.getFlatCoordinates(),i={node:r};i.layout=t.getLayout(),i.stride=t.getStride();const s=t.getProperties();s.coordinates=n;const o=e[e.length-1].node,a=bS[o.namespaceURI],l=cr(s,a);pt(i,SS,Ie,l,e,a)}const ES=q(lt,["color","fill","outline"]),Ng=q(lt,{outerBoundaryIs:N(Fg),innerBoundaryIs:N(Fg)}),TS=ue("innerBoundaryIs"),MS=ue("outerBoundaryIs");function $0(r,t,e){const n=t.getLinearRings(),i=n.shift(),s={node:r};pt(s,Ng,TS,n,e),pt(s,Ng,MS,[i],e)}const RS=q(lt,{color:N(Ch),fill:N(ks),outline:N(ks)});function CS(r,t,e){const n={node:r},i=t.getFill(),s=t.getStroke(),o={color:i?i.getColor():void 0,fill:i?void 0:!1,outline:s?void 0:!1},a=e[e.length-1].node,l=ES[a.namespaceURI],h=cr(o,l);pt(n,RS,Ie,h,e,l)}function V0(r,t){rr(r,Math.round(t*1e6)/1e6)}const IS=q(lt,["IconStyle","LabelStyle","LineStyle","PolyStyle"]),PS=q(lt,{IconStyle:N(oS),LabelStyle:N(hS),LineStyle:N(dS),PolyStyle:N(CS)});function AS(r,t,e){const n={node:r},i={};if(t.pointStyles.length){const l=t.pointStyles[0].getText();l&&(i.LabelStyle=l);const h=t.pointStyles[0].getImage();h&&typeof h.getSrc=="function"&&(i.IconStyle=h)}if(t.lineStyles.length){const l=t.lineStyles[0].getStroke();l&&(i.LineStyle=l)}if(t.polyStyles.length){const l=t.polyStyles[0].getStroke();l&&!i.LineStyle&&(i.LineStyle=l),i.PolyStyle=t.polyStyles[0]}const s=e[e.length-1].node,o=IS[s.namespaceURI],a=cr(i,o);pt(n,PS,Ie,a,e,o)}function LS(r,t){r.setAttribute("x",String(t.x)),r.setAttribute("y",String(t.y)),r.setAttribute("xunits",t.xunits),r.setAttribute("yunits",t.yunits)}const OS=i2;var Ed={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Ed.read=function(r,t,e,n,i){var s,o,a=i*8-n-1,l=(1<<a)-1,h=l>>1,u=-7,c=e?i-1:0,f=e?-1:1,g=r[t+c];for(c+=f,s=g&(1<<-u)-1,g>>=-u,u+=a;u>0;s=s*256+r[t+c],c+=f,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=n;u>0;o=o*256+r[t+c],c+=f,u-=8);if(s===0)s=1-h;else{if(s===l)return o?NaN:(g?-1:1)*(1/0);o=o+Math.pow(2,n),s=s-h}return(g?-1:1)*o*Math.pow(2,s-n)};Ed.write=function(r,t,e,n,i,s){var o,a,l,h=s*8-i-1,u=(1<<h)-1,c=u>>1,f=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,g=n?0:s-1,m=n?1:-1,_=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+c>=1?t+=f/l:t+=f*Math.pow(2,1-c),t*l>=2&&(o++,l/=2),o+c>=u?(a=0,o=u):o+c>=1?(a=(t*l-1)*Math.pow(2,i),o=o+c):(a=t*Math.pow(2,c-1)*Math.pow(2,i),o=0));i>=8;r[e+g]=a&255,g+=m,a/=256,i-=8);for(o=o<<i|a,h+=i;h>0;r[e+g]=o&255,g+=m,o/=256,h-=8);r[e+g-m]|=_*128};var FS=jt,Ka=Ed;function jt(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}jt.Varint=0;jt.Fixed64=1;jt.Bytes=2;jt.Fixed32=5;var hc=65536*65536,Dg=1/hc,NS=12,Y0=typeof TextDecoder>"u"?null:new TextDecoder("utf8");jt.prototype={destroy:function(){this.buf=null},readFields:function(r,t,e){for(e=e||this.length;this.pos<e;){var n=this.readVarint(),i=n>>3,s=this.pos;this.type=n&7,r(i,t,this),this.pos===s&&this.skip(n)}return t},readMessage:function(r,t){return this.readFields(r,t,this.readVarint()+this.pos)},readFixed32:function(){var r=Qa(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=Gg(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=Qa(this.buf,this.pos)+Qa(this.buf,this.pos+4)*hc;return this.pos+=8,r},readSFixed64:function(){var r=Qa(this.buf,this.pos)+Gg(this.buf,this.pos+4)*hc;return this.pos+=8,r},readFloat:function(){var r=Ka.read(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=Ka.read(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var t=this.buf,e,n;return n=t[this.pos++],e=n&127,n<128||(n=t[this.pos++],e|=(n&127)<<7,n<128)||(n=t[this.pos++],e|=(n&127)<<14,n<128)||(n=t[this.pos++],e|=(n&127)<<21,n<128)?e:(n=t[this.pos],e|=(n&15)<<28,DS(e,r,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2===1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,t=this.pos;return this.pos=r,r-t>=NS&&Y0?KS(this.buf,t,r):HS(this.buf,t,r)},readBytes:function(){var r=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,r);return this.pos=r,t},readPackedVarint:function(r,t){if(this.type!==jt.Bytes)return r.push(this.readVarint(t));var e=xn(this);for(r=r||[];this.pos<e;)r.push(this.readVarint(t));return r},readPackedSVarint:function(r){if(this.type!==jt.Bytes)return r.push(this.readSVarint());var t=xn(this);for(r=r||[];this.pos<t;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==jt.Bytes)return r.push(this.readBoolean());var t=xn(this);for(r=r||[];this.pos<t;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==jt.Bytes)return r.push(this.readFloat());var t=xn(this);for(r=r||[];this.pos<t;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==jt.Bytes)return r.push(this.readDouble());var t=xn(this);for(r=r||[];this.pos<t;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==jt.Bytes)return r.push(this.readFixed32());var t=xn(this);for(r=r||[];this.pos<t;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==jt.Bytes)return r.push(this.readSFixed32());var t=xn(this);for(r=r||[];this.pos<t;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==jt.Bytes)return r.push(this.readFixed64());var t=xn(this);for(r=r||[];this.pos<t;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==jt.Bytes)return r.push(this.readSFixed64());var t=xn(this);for(r=r||[];this.pos<t;)r.push(this.readSFixed64());return r},skip:function(r){var t=r&7;if(t===jt.Varint)for(;this.buf[this.pos++]>127;);else if(t===jt.Bytes)this.pos=this.readVarint()+this.pos;else if(t===jt.Fixed32)this.pos+=4;else if(t===jt.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+t)},writeTag:function(r,t){this.writeVarint(r<<3|t)},realloc:function(r){for(var t=this.length||16;t<this.pos+r;)t*=2;if(t!==this.length){var e=new Uint8Array(t);e.set(this.buf),this.buf=e,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),ts(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),ts(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),ts(this.buf,r&-1,this.pos),ts(this.buf,Math.floor(r*Dg),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),ts(this.buf,r&-1,this.pos),ts(this.buf,Math.floor(r*Dg),this.pos+4),this.pos+=8},writeVarint:function(r){if(r=+r||0,r>268435455||r<0){GS(r,this);return}this.realloc(4),this.buf[this.pos++]=r&127|(r>127?128:0),!(r<=127)&&(this.buf[this.pos++]=(r>>>=7)&127|(r>127?128:0),!(r<=127)&&(this.buf[this.pos++]=(r>>>=7)&127|(r>127?128:0),!(r<=127)&&(this.buf[this.pos++]=r>>>7&127)))},writeSVarint:function(r){this.writeVarint(r<0?-r*2-1:r*2)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(r.length*4),this.pos++;var t=this.pos;this.pos=QS(this.buf,r,this.pos);var e=this.pos-t;e>=128&&kg(t,e,this),this.pos=t-1,this.writeVarint(e),this.pos+=e},writeFloat:function(r){this.realloc(4),Ka.write(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),Ka.write(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var t=r.length;this.writeVarint(t),this.realloc(t);for(var e=0;e<t;e++)this.buf[this.pos++]=r[e]},writeRawMessage:function(r,t){this.pos++;var e=this.pos;r(t,this);var n=this.pos-e;n>=128&&kg(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeMessage:function(r,t,e){this.writeTag(r,jt.Bytes),this.writeRawMessage(t,e)},writePackedVarint:function(r,t){t.length&&this.writeMessage(r,US,t)},writePackedSVarint:function(r,t){t.length&&this.writeMessage(r,BS,t)},writePackedBoolean:function(r,t){t.length&&this.writeMessage(r,qS,t)},writePackedFloat:function(r,t){t.length&&this.writeMessage(r,XS,t)},writePackedDouble:function(r,t){t.length&&this.writeMessage(r,WS,t)},writePackedFixed32:function(r,t){t.length&&this.writeMessage(r,ZS,t)},writePackedSFixed32:function(r,t){t.length&&this.writeMessage(r,$S,t)},writePackedFixed64:function(r,t){t.length&&this.writeMessage(r,VS,t)},writePackedSFixed64:function(r,t){t.length&&this.writeMessage(r,YS,t)},writeBytesField:function(r,t){this.writeTag(r,jt.Bytes),this.writeBytes(t)},writeFixed32Field:function(r,t){this.writeTag(r,jt.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(r,t){this.writeTag(r,jt.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(r,t){this.writeTag(r,jt.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(r,t){this.writeTag(r,jt.Fixed64),this.writeSFixed64(t)},writeVarintField:function(r,t){this.writeTag(r,jt.Varint),this.writeVarint(t)},writeSVarintField:function(r,t){this.writeTag(r,jt.Varint),this.writeSVarint(t)},writeStringField:function(r,t){this.writeTag(r,jt.Bytes),this.writeString(t)},writeFloatField:function(r,t){this.writeTag(r,jt.Fixed32),this.writeFloat(t)},writeDoubleField:function(r,t){this.writeTag(r,jt.Fixed64),this.writeDouble(t)},writeBooleanField:function(r,t){this.writeVarintField(r,!!t)}};function DS(r,t,e){var n=e.buf,i,s;if(s=n[e.pos++],i=(s&112)>>4,s<128||(s=n[e.pos++],i|=(s&127)<<3,s<128)||(s=n[e.pos++],i|=(s&127)<<10,s<128)||(s=n[e.pos++],i|=(s&127)<<17,s<128)||(s=n[e.pos++],i|=(s&127)<<24,s<128)||(s=n[e.pos++],i|=(s&1)<<31,s<128))return kS(r,i,t);throw new Error("Expected varint not more than 10 bytes")}function xn(r){return r.type===jt.Bytes?r.readVarint()+r.pos:r.pos+1}function kS(r,t,e){return e?t*4294967296+(r>>>0):(t>>>0)*4294967296+(r>>>0)}function GS(r,t){var e,n;if(r>=0?(e=r%4294967296|0,n=r/4294967296|0):(e=~(-r%4294967296),n=~(-r/4294967296),e^4294967295?e=e+1|0:(e=0,n=n+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),jS(e,n,t),zS(n,t)}function jS(r,t,e){e.buf[e.pos++]=r&127|128,r>>>=7,e.buf[e.pos++]=r&127|128,r>>>=7,e.buf[e.pos++]=r&127|128,r>>>=7,e.buf[e.pos++]=r&127|128,r>>>=7,e.buf[e.pos]=r&127}function zS(r,t){var e=(r&7)<<4;t.buf[t.pos++]|=e|((r>>>=3)?128:0),r&&(t.buf[t.pos++]=r&127|((r>>>=7)?128:0),r&&(t.buf[t.pos++]=r&127|((r>>>=7)?128:0),r&&(t.buf[t.pos++]=r&127|((r>>>=7)?128:0),r&&(t.buf[t.pos++]=r&127|((r>>>=7)?128:0),r&&(t.buf[t.pos++]=r&127)))))}function kg(r,t,e){var n=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(Math.LN2*7));e.realloc(n);for(var i=e.pos-1;i>=r;i--)e.buf[i+n]=e.buf[i]}function US(r,t){for(var e=0;e<r.length;e++)t.writeVarint(r[e])}function BS(r,t){for(var e=0;e<r.length;e++)t.writeSVarint(r[e])}function XS(r,t){for(var e=0;e<r.length;e++)t.writeFloat(r[e])}function WS(r,t){for(var e=0;e<r.length;e++)t.writeDouble(r[e])}function qS(r,t){for(var e=0;e<r.length;e++)t.writeBoolean(r[e])}function ZS(r,t){for(var e=0;e<r.length;e++)t.writeFixed32(r[e])}function $S(r,t){for(var e=0;e<r.length;e++)t.writeSFixed32(r[e])}function VS(r,t){for(var e=0;e<r.length;e++)t.writeFixed64(r[e])}function YS(r,t){for(var e=0;e<r.length;e++)t.writeSFixed64(r[e])}function Qa(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16)+r[t+3]*16777216}function ts(r,t,e){r[e]=t,r[e+1]=t>>>8,r[e+2]=t>>>16,r[e+3]=t>>>24}function Gg(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16)+(r[t+3]<<24)}function HS(r,t,e){for(var n="",i=t;i<e;){var s=r[i],o=null,a=s>239?4:s>223?3:s>191?2:1;if(i+a>e)break;var l,h,u;a===1?s<128&&(o=s):a===2?(l=r[i+1],(l&192)===128&&(o=(s&31)<<6|l&63,o<=127&&(o=null))):a===3?(l=r[i+1],h=r[i+2],(l&192)===128&&(h&192)===128&&(o=(s&15)<<12|(l&63)<<6|h&63,(o<=2047||o>=55296&&o<=57343)&&(o=null))):a===4&&(l=r[i+1],h=r[i+2],u=r[i+3],(l&192)===128&&(h&192)===128&&(u&192)===128&&(o=(s&15)<<18|(l&63)<<12|(h&63)<<6|u&63,(o<=65535||o>=1114112)&&(o=null))),o===null?(o=65533,a=1):o>65535&&(o-=65536,n+=String.fromCharCode(o>>>10&1023|55296),o=56320|o&1023),n+=String.fromCharCode(o),i+=a}return n}function KS(r,t,e){return Y0.decode(r.subarray(t,e))}function QS(r,t,e){for(var n=0,i,s;n<t.length;n++){if(i=t.charCodeAt(n),i>55295&&i<57344)if(s)if(i<56320){r[e++]=239,r[e++]=191,r[e++]=189,s=i;continue}else i=s-55296<<10|i-56320|65536,s=null;else{i>56319||n+1===t.length?(r[e++]=239,r[e++]=191,r[e++]=189):s=i;continue}else s&&(r[e++]=239,r[e++]=191,r[e++]=189,s=null);i<128?r[e++]=i:(i<2048?r[e++]=i>>6|192:(i<65536?r[e++]=i>>12|224:(r[e++]=i>>18|240,r[e++]=i>>12&63|128),r[e++]=i>>6&63|128),r[e++]=i&63|128)}return e}const JS=Ks(FS);class tE extends Ta{constructor(t){super(),t=t||{},this.dataProjection=new Ns({code:"",units:"tile-pixels"}),this.featureClass_=t.featureClass?t.featureClass:Ge,this.geometryName_=t.geometryName,this.layerName_=t.layerName?t.layerName:"layer",this.layers_=t.layers?t.layers:null,this.idProperty_=t.idProperty,this.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"]}readRawGeometry_(t,e,n,i){t.pos=e.geometry;const s=t.readVarint()+t.pos;let o=1,a=0,l=0,h=0,u=0,c=0;for(;t.pos<s;){if(!a){const f=t.readVarint();o=f&7,a=f>>3}if(a--,o===1||o===2)l+=t.readSVarint(),h+=t.readSVarint(),o===1&&u>c&&(i.push(u),c=u),n.push(l,h),u+=2;else if(o===7)u>c&&(n.push(n[c],n[c+1]),u+=2);else throw new Error("Invalid command found in the PBF")}u>c&&(i.push(u),c=u)}createFeature_(t,e,n){const i=e.type;if(i===0)return null;let s;const o=e.properties;let a;this.idProperty_?(a=o[this.idProperty_],delete o[this.idProperty_]):a=e.id,o[this.layerName_]=e.layer.name;const l=[],h=[];this.readRawGeometry_(t,e,l,h);const u=sE(i,h.length);if(this.featureClass_===Ge)s=new this.featureClass_(u,l,h,2,o,a),s.transform(n.dataProjection);else{let c;if(u=="Polygon"){const m=u0(l,h);c=m.length>1?new Pr(l,"XY",m):new Ue(l,"XY",h)}else c=u==="Point"?new Re(l,"XY"):u==="LineString"?new ye(l,"XY"):u==="MultiPoint"?new Zr(l,"XY"):u==="MultiLineString"?new ur(l,"XY",h):null;const f=this.featureClass_;s=new f,this.geometryName_&&s.setGeometryName(this.geometryName_);const g=se(c,!1,n);s.setGeometry(g),a!==void 0&&s.setId(a),s.setProperties(o,!0)}return s}getType(){return"arraybuffer"}readFeatures(t,e){const n=this.layers_;e=this.adaptOptions(e);const i=tt(e.dataProjection);i.setWorldExtent(e.extent),e.dataProjection=i;const s=new JS(t),o=s.readFields(eE,{}),a=[];for(const l in o){if(n&&!n.includes(l))continue;const h=o[l],u=h?[0,0,h.extent,h.extent]:null;i.setExtent(u);for(let c=0,f=h.length;c<f;++c){const g=iE(s,h,c),m=this.createFeature_(s,g,e);m!==null&&a.push(m)}}return a}readProjection(t){return this.dataProjection}setLayers(t){this.layers_=t}}function eE(r,t,e){if(r===3){const n={keys:[],values:[],features:[]},i=e.readVarint()+e.pos;e.readFields(rE,n,i),n.length=n.features.length,n.length&&(t[n.name]=n)}}function rE(r,t,e){if(r===15)t.version=e.readVarint();else if(r===1)t.name=e.readString();else if(r===5)t.extent=e.readVarint();else if(r===2)t.features.push(e.pos);else if(r===3)t.keys.push(e.readString());else if(r===4){let n=null;const i=e.readVarint()+e.pos;for(;e.pos<i;)r=e.readVarint()>>3,n=r===1?e.readString():r===2?e.readFloat():r===3?e.readDouble():r===4?e.readVarint64():r===5?e.readVarint():r===6?e.readSVarint():r===7?e.readBoolean():null;t.values.push(n)}}function nE(r,t,e){if(r==1)t.id=e.readVarint();else if(r==2){const n=e.readVarint()+e.pos;for(;e.pos<n;){const i=t.layer.keys[e.readVarint()],s=t.layer.values[e.readVarint()];t.properties[i]=s}}else r==3?t.type=e.readVarint():r==4&&(t.geometry=e.pos)}function iE(r,t,e){r.pos=t.features[e];const n=r.readVarint()+r.pos,i={layer:t,type:0,properties:{}};return r.readFields(nE,i,n),i}function sE(r,t){let e;return r===1?e=t===1?"Point":"MultiPoint":r===2?e=t===1?"LineString":"MultiLineString":r===3&&(e="Polygon"),e}const H0=tE;class Td{read(t){if(!t)return null;if(typeof t=="string"){const e=Cr(t);return this.readFromDocument(e)}return Rr(t)?this.readFromDocument(t):this.readFromNode(t)}readFromDocument(t){for(let e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFromNode(e);return null}readFromNode(t){ut()}}const oE="http://www.w3.org/1999/xlink";function Qs(r){return r.getAttributeNS(oE,"href")}const dr=[null,"http://www.opengis.net/ows/1.1"],aE=q(dr,{ServiceIdentification:O(LE),ServiceProvider:O(FE),OperationsMetadata:O(PE)});class lE extends Td{constructor(){super()}readFromNode(t){return Z({},aE,t,[])||null}}const hE=q(dr,{DeliveryPoint:O($),City:O($),AdministrativeArea:O($),PostalCode:O($),Country:O($),ElectronicMailAddress:O($)}),uE=q(dr,{Value:Kt(NE)}),cE=q(dr,{AllowedValues:O(SE)}),dE=q(dr,{Phone:O(AE),Address:O(bE)}),fE=q(dr,{HTTP:O(CE)}),gE=q(dr,{Get:Kt(RE),Post:void 0}),pE=q(dr,{DCP:O(ME)}),mE=q(dr,{Operation:IE}),_E=q(dr,{Voice:O($),Facsimile:O($)}),yE=q(dr,{Constraint:Kt(EE)}),xE=q(dr,{IndividualName:O($),PositionName:O($),ContactInfo:O(TE)}),vE=q(dr,{Abstract:O($),AccessConstraints:O($),Fees:O($),Title:O($),ServiceTypeVersion:O($),ServiceType:O($)}),wE=q(dr,{ProviderName:O($),ProviderSite:O(Qs),ServiceContact:O(OE)});function bE(r,t){return Z({},hE,r,t)}function SE(r,t){return Z({},uE,r,t)}function EE(r,t){const e=r.getAttribute("name");if(e)return Z({name:e},cE,r,t)}function TE(r,t){return Z({},dE,r,t)}function ME(r,t){return Z({},fE,r,t)}function RE(r,t){const e=Qs(r);if(e)return Z({href:e},yE,r,t)}function CE(r,t){return Z({},gE,r,t)}function IE(r,t){const e=r.getAttribute("name"),n=Z({},pE,r,t);if(!n)return;const i=t[t.length-1];i[e]=n}function PE(r,t){return Z({},mE,r,t)}function AE(r,t){return Z({},_E,r,t)}function LE(r,t){return Z({},vE,r,t)}function OE(r,t){return Z({},xE,r,t)}function FE(r,t){return Z({},wE,r,t)}function NE(r,t){return $(r)}const K0=lE;function jg(r,t,e,n,i,s){i!==void 0?(i=i,s=s!==void 0?s:0):(i=[],s=0);let o=t;for(;o<e;){const a=r[o++];i[s++]=r[o++],i[s++]=a;for(let l=2;l<n;++l)i[s++]=r[o++]}return i.length=s,i}class DE extends fd{constructor(t){super(),t=t||{},this.dataProjection=tt("EPSG:4326"),this.factor_=t.factor?t.factor:1e5,this.geometryLayout_=t.geometryLayout?t.geometryLayout:"XY"}readFeatureFromText(t,e){const n=this.readGeometryFromText(t,e);return new Se(n)}readFeaturesFromText(t,e){return[this.readFeatureFromText(t,e)]}readGeometryFromText(t,e){const n=Hu(this.geometryLayout_),i=GE(t,n,this.factor_);jg(i,0,i.length,n,i);const s=Rn(i,0,i.length,n),o=new ye(s,this.geometryLayout_);return se(o,!1,this.adaptOptions(e))}writeFeatureText(t,e){const n=t.getGeometry();if(n)return this.writeGeometryText(n,e);throw new Error("Expected `feature` to have a geometry")}writeFeaturesText(t,e){return this.writeFeatureText(t[0],e)}writeGeometryText(t,e){t=se(t,!0,this.adaptOptions(e));const n=t.getFlatCoordinates(),i=t.getStride();return jg(n,0,n.length,i,n),kE(n,i,this.factor_)}}function kE(r,t,e){e=e||1e5;let n;const i=new Array(t);for(n=0;n<t;++n)i[n]=0;for(let s=0,o=r.length;s<o;)for(n=0;n<t;++n,++s){const a=r[s],l=a-i[n];i[n]=a,r[s]=l}return jE(r,e)}function GE(r,t,e){e=e||1e5;let n;const i=new Array(t);for(n=0;n<t;++n)i[n]=0;const s=zE(r,e);for(let o=0,a=s.length;o<a;)for(n=0;n<t;++n,++o)i[n]+=s[o],s[o]=i[n];return s}function jE(r,t){t=t||1e5;for(let e=0,n=r.length;e<n;++e)r[e]=Math.round(r[e]*t);return UE(r)}function zE(r,t){t=t||1e5;const e=BE(r);for(let n=0,i=e.length;n<i;++n)e[n]/=t;return e}function UE(r){for(let t=0,e=r.length;t<e;++t){const n=r[t];r[t]=n<0?~(n<<1):n<<1}return XE(r)}function BE(r){const t=WE(r);for(let e=0,n=t.length;e<n;++e){const i=t[e];t[e]=i&1?~(i>>1):i>>1}return t}function XE(r){let t="";for(let e=0,n=r.length;e<n;++e)t+=qE(r[e]);return t}function WE(r){const t=[];let e=0,n=0;for(let i=0,s=r.length;i<s;++i){const o=r.charCodeAt(i)-63;e|=(o&31)<<n,o<32?(t.push(e),e=0,n=0):n+=5}return t}function qE(r){let t,e="";for(;r>=32;)t=(32|r&31)+63,e+=String.fromCharCode(t),r>>=5;return t=r+63,e+=String.fromCharCode(t),e}const ZE=DE;class $E extends od{constructor(t){super(),t=t||{},this.layerName_=t.layerName,this.layers_=t.layers?t.layers:null,this.dataProjection=tt(t.dataProjection?t.dataProjection:"EPSG:4326")}readFeaturesFromObject(t,e){if(t.type=="Topology"){const n=t;let i,s=null,o=null;n.transform&&(i=n.transform,s=i.scale,o=i.translate);const a=n.arcs;i&&rT(a,s,o);const l=[],h=n.objects,u=this.layerName_;let c;for(const f in h)this.layers_&&!this.layers_.includes(f)||(h[f].type==="GeometryCollection"?(c=h[f],l.push.apply(l,eT(c,a,s,o,u,f,e))):(c=h[f],l.push(Q0(c,a,s,o,u,f,e))));return l}return[]}readProjectionFromObject(t){return this.dataProjection}}const VE={Point:YE,LineString:KE,Polygon:JE,MultiPoint:HE,MultiLineString:QE,MultiPolygon:tT};function Ih(r,t){const e=[];let n;for(let i=0,s=r.length;i<s;++i)if(n=r[i],i>0&&e.pop(),n>=0){const o=t[n];for(let a=0,l=o.length;a<l;++a)e.push(o[a].slice(0))}else{const o=t[~n];for(let a=o.length-1;a>=0;--a)e.push(o[a].slice(0))}return e}function YE(r,t,e){const n=r.coordinates;return t&&e&&Md(n,t,e),new Re(n)}function HE(r,t,e){const n=r.coordinates;if(t&&e)for(let i=0,s=n.length;i<s;++i)Md(n[i],t,e);return new Zr(n)}function KE(r,t){const e=Ih(r.arcs,t);return new ye(e)}function QE(r,t){const e=[];for(let n=0,i=r.arcs.length;n<i;++n)e[n]=Ih(r.arcs[n],t);return new ur(e)}function JE(r,t){const e=[];for(let n=0,i=r.arcs.length;n<i;++n)e[n]=Ih(r.arcs[n],t);return new Ue(e)}function tT(r,t){const e=[];for(let n=0,i=r.arcs.length;n<i;++n){const s=r.arcs[n],o=[];for(let a=0,l=s.length;a<l;++a)o[a]=Ih(s[a],t);e[n]=o}return new Pr(e)}function eT(r,t,e,n,i,s,o){const a=r.geometries,l=[];for(let h=0,u=a.length;h<u;++h)l[h]=Q0(a[h],t,e,n,i,s,o);return l}function Q0(r,t,e,n,i,s,o){let a=null;const l=r.type;if(l){const c=VE[l];l==="Point"||l==="MultiPoint"?a=c(r,e,n):a=c(r,t),a=se(a,!1,o)}const h=new Se({geometry:a});r.id!==void 0&&h.setId(r.id);let u=r.properties;return i&&(u||(u={}),u[i]=s),u&&h.setProperties(u,!0),h}function rT(r,t,e){for(let n=0,i=r.length;n<i;++n)nT(r[n],t,e)}function nT(r,t,e){let n=0,i=0;for(let s=0,o=r.length;s<o;++s){const a=r[s];n+=a[0],i+=a[1],a[0]=n,a[1]=i,Md(a,t,e)}}function Md(r,t,e){r[0]=r[0]*t[0]+e[0],r[1]=r[1]*t[1]+e[1]}const iT=$E;class Gt extends Rt{constructor(t){t=t||{},super(t),this.schemaLocation=t.schemaLocation?t.schemaLocation:this.namespace+" http://schemas.opengis.net/gml/3.2.1/gml.xsd"}writeGeometryElement(t,e,n){const i=n[n.length-1];n[n.length-1]=Object.assign({multiCurve:!0,multiSurface:!0},i),super.writeGeometryElement(t,e,n)}}Gt.prototype.namespace="http://www.opengis.net/gml/3.2";Gt.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml/3.2":{pos:ht(Rt.prototype.readFlatPos),posList:ht(Rt.prototype.readFlatPosList),coordinates:ht(It.prototype.readFlatCoordinates)}};Gt.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml/3.2":{interior:Rt.prototype.interiorParser,exterior:Rt.prototype.exteriorParser}};Gt.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml/3.2":{Point:ht(st.prototype.readPoint),MultiPoint:ht(st.prototype.readMultiPoint),LineString:ht(st.prototype.readLineString),MultiLineString:ht(st.prototype.readMultiLineString),LinearRing:ht(st.prototype.readLinearRing),Polygon:ht(st.prototype.readPolygon),MultiPolygon:ht(st.prototype.readMultiPolygon),Surface:ht(Gt.prototype.readSurface),MultiSurface:ht(Rt.prototype.readMultiSurface),Curve:ht(Gt.prototype.readCurve),MultiCurve:ht(Rt.prototype.readMultiCurve),Envelope:ht(Gt.prototype.readEnvelope)}};Gt.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml/3.2":{curveMember:ot(Rt.prototype.curveMemberParser),curveMembers:ot(Rt.prototype.curveMemberParser)}};Gt.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{surfaceMember:ot(Rt.prototype.surfaceMemberParser),surfaceMembers:ot(Rt.prototype.surfaceMemberParser)}};Gt.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:ot(st.prototype.readLineString),Curve:ot(Rt.prototype.readCurve)}};Gt.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:ot(st.prototype.readPolygon),Surface:ot(Rt.prototype.readSurface)}};Gt.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{patches:ht(Rt.prototype.readPatch)}};Gt.prototype.CURVE_PARSERS={"http://www.opengis.net/gml/3.2":{segments:ht(Rt.prototype.readSegment)}};Gt.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml/3.2":{lowerCorner:ot(Rt.prototype.readFlatPosList),upperCorner:ot(Rt.prototype.readFlatPosList)}};Gt.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml/3.2":{PolygonPatch:ht(Rt.prototype.readPolygonPatch)}};Gt.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml/3.2":{LineStringSegment:Cl(Rt.prototype.readLineStringSegment)}};Gt.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml/3.2":{pointMember:ot(st.prototype.pointMemberParser),pointMembers:ot(st.prototype.pointMemberParser)}};Gt.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml/3.2":{lineStringMember:ot(st.prototype.lineStringMemberParser),lineStringMembers:ot(st.prototype.lineStringMemberParser)}};Gt.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml/3.2":{polygonMember:ot(st.prototype.polygonMemberParser),polygonMembers:ot(st.prototype.polygonMemberParser)}};Gt.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Point:ot(st.prototype.readFlatCoordinatesFromNode)}};Gt.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:ot(st.prototype.readLineString)}};Gt.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:ot(st.prototype.readPolygon)}};Gt.prototype.RING_PARSERS={"http://www.opengis.net/gml/3.2":{LinearRing:ht(st.prototype.readFlatLinearRing),Ring:ht(Gt.prototype.readFlatCurveRing)}};Gt.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml/3.2":{exterior:N(Rt.prototype.writeRing),interior:N(Rt.prototype.writeRing)}};Gt.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lowerCorner:N(gt),upperCorner:N(gt)}};Gt.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{surfaceMember:N(Rt.prototype.writeSurfaceOrPolygonMember),polygonMember:N(Rt.prototype.writeSurfaceOrPolygonMember)}};Gt.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{pointMember:N(Rt.prototype.writePointMember)}};Gt.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lineStringMember:N(Rt.prototype.writeLineStringOrCurveMember),curveMember:N(Rt.prototype.writeLineStringOrCurveMember)}};Gt.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml/3.2":{Curve:N(Rt.prototype.writeCurveOrLineString),MultiCurve:N(Rt.prototype.writeMultiCurveOrLineString),Point:N(Gt.prototype.writePoint),MultiPoint:N(Rt.prototype.writeMultiPoint),LineString:N(Rt.prototype.writeCurveOrLineString),MultiLineString:N(Rt.prototype.writeMultiCurveOrLineString),LinearRing:N(Rt.prototype.writeLinearRing),Polygon:N(Rt.prototype.writeSurfaceOrPolygon),MultiPolygon:N(Rt.prototype.writeMultiSurfaceOrPolygon),Surface:N(Rt.prototype.writeSurfaceOrPolygon),MultiSurface:N(Rt.prototype.writeMultiSurfaceOrPolygon),Envelope:N(Rt.prototype.writeEnvelope)}};const Rd=Gt;class J0{constructor(t){this.tagName_=t}getTagName(){return this.tagName_}}class sT extends J0{constructor(t,e){super(t),this.conditions=e,At(this.conditions.length>=2,"At least 2 conditions are required")}}class oT extends sT{constructor(t){super("And",Array.prototype.slice.call(arguments))}}const aT=oT;class lT extends J0{constructor(t,e,n){if(super("BBOX"),this.geometryName=t,this.extent=e,e.length!==4)throw new Error("Expected an extent with four values ([minX, minY, maxX, maxY])");this.srsName=n}}function hT(r){const t=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(aT,t))}function uT(r,t,e){return new lT(r,t,e)}const zg={"http://www.opengis.net/gml":{boundedBy:O(st.prototype.readExtentElement,"bounds")},"http://www.opengis.net/wfs/2.0":{member:ot(st.prototype.readFeaturesInternal)}},cT={"http://www.opengis.net/wfs":{totalInserted:O(fe),totalUpdated:O(fe),totalDeleted:O(fe)},"http://www.opengis.net/wfs/2.0":{totalInserted:O(fe),totalUpdated:O(fe),totalDeleted:O(fe)}},dT={"http://www.opengis.net/wfs":{TransactionSummary:O(Bg,"transactionSummary"),InsertResults:O(Wg,"insertIds")},"http://www.opengis.net/wfs/2.0":{TransactionSummary:O(Bg,"transactionSummary"),InsertResults:O(Wg,"insertIds")}},fT={"http://www.opengis.net/wfs":{PropertyName:N(gt)},"http://www.opengis.net/wfs/2.0":{PropertyName:N(gt)}},t_={"http://www.opengis.net/wfs":{Insert:N(qg),Update:N($g),Delete:N(Zg),Property:N(Vg),Native:N(Yg)},"http://www.opengis.net/wfs/2.0":{Insert:N(qg),Update:N($g),Delete:N(Zg),Property:N(Vg),Native:N(Yg)}},e_="feature",Cd="http://www.w3.org/2000/xmlns/",Id={"2.0.0":"http://www.opengis.net/ogc/1.1","1.1.0":"http://www.opengis.net/ogc","1.0.0":"http://www.opengis.net/ogc"},uc={"2.0.0":"http://www.opengis.net/wfs/2.0","1.1.0":"http://www.opengis.net/wfs","1.0.0":"http://www.opengis.net/wfs"},Pd={"2.0.0":"http://www.opengis.net/fes/2.0","1.1.0":"http://www.opengis.net/fes","1.0.0":"http://www.opengis.net/fes"},Ug={"2.0.0":"http://www.opengis.net/wfs/2.0 http://schemas.opengis.net/wfs/2.0/wfs.xsd","1.1.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd","1.0.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/wfs.xsd"},Ad={"2.0.0":Rd,"1.1.0":Rt,"1.0.0":It},gT="1.1.0";class pT extends Ra{constructor(t){super(),t=t||{},this.version_=t.version?t.version:gT,this.featureType_=t.featureType,this.featureNS_=t.featureNS,this.gmlFormat_=t.gmlFormat?t.gmlFormat:new Ad[this.version_],this.schemaLocation_=t.schemaLocation?t.schemaLocation:Ug[this.version_]}getFeatureType(){return this.featureType_}setFeatureType(t){this.featureType_=t}readFeaturesFromNode(t,e){const n={node:t};Object.assign(n,{featureType:this.featureType_,featureNS:this.featureNS_}),Object.assign(n,this.getReadOptions(t,e||{}));const i=[n];let s;this.version_==="2.0.0"?s=zg:s=this.gmlFormat_.FEATURE_COLLECTION_PARSERS;let o=Z([],s,t,i,this.gmlFormat_);return o||(o=[]),o}readTransactionResponse(t){if(t){if(typeof t=="string"){const e=Cr(t);return this.readTransactionResponseFromDocument(e)}return Rr(t)?this.readTransactionResponseFromDocument(t):this.readTransactionResponseFromNode(t)}}readFeatureCollectionMetadata(t){if(t){if(typeof t=="string"){const e=Cr(t);return this.readFeatureCollectionMetadataFromDocument(e)}return Rr(t)?this.readFeatureCollectionMetadataFromDocument(t):this.readFeatureCollectionMetadataFromNode(t)}}readFeatureCollectionMetadataFromDocument(t){for(let e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFeatureCollectionMetadataFromNode(e)}readFeatureCollectionMetadataFromNode(t){const e={},n=Cn(t.getAttribute("numberOfFeatures"));return e.numberOfFeatures=n,Z(e,zg,t,[],this.gmlFormat_)}readTransactionResponseFromDocument(t){for(let e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readTransactionResponseFromNode(e)}readTransactionResponseFromNode(t){return Z({},dT,t,[])}writeGetFeature(t){const e=mt(uc[this.version_],"GetFeature");e.setAttribute("service","WFS"),e.setAttribute("version",this.version_),t.handle&&e.setAttribute("handle",t.handle),t.outputFormat&&e.setAttribute("outputFormat",t.outputFormat),t.maxFeatures!==void 0&&e.setAttribute("maxFeatures",String(t.maxFeatures)),t.resultType&&e.setAttribute("resultType",t.resultType),t.startIndex!==void 0&&e.setAttribute("startIndex",String(t.startIndex)),t.count!==void 0&&e.setAttribute("count",String(t.count)),t.viewParams!==void 0&&e.setAttribute("viewParams",t.viewParams),e.setAttributeNS(Di,"xsi:schemaLocation",this.schemaLocation_);const n={node:e};if(Object.assign(n,{version:this.version_,srsName:t.srsName,featureNS:t.featureNS?t.featureNS:this.featureNS_,featurePrefix:t.featurePrefix,propertyNames:t.propertyNames?t.propertyNames:[]}),At(Array.isArray(t.featureTypes),"`options.featureTypes` must be an Array"),typeof t.featureTypes[0]=="string"){let i=t.filter;t.bbox&&(At(t.geometryName,"`options.geometryName` must also be provided when `options.bbox` is set"),i=this.combineBboxAndFilter(t.geometryName,t.bbox,t.srsName,i)),Object.assign(n,{geometryName:t.geometryName,filter:i}),sp(e,t.featureTypes,[n])}else t.featureTypes.forEach(i=>{const s=this.combineBboxAndFilter(i.geometryName,i.bbox,t.srsName,t.filter);Object.assign(n,{geometryName:i.geometryName,filter:s}),sp(e,[i.name],[n])});return e}combineBboxAndFilter(t,e,n,i){const s=uT(t,e,n);return i?hT(i,s):s}writeTransaction(t,e,n,i){const s=[],o=i.version?i.version:this.version_,a=mt(uc[o],"Transaction");a.setAttribute("service","WFS"),a.setAttribute("version",o);let l;i&&(l=i.gmlOptions?i.gmlOptions:{},i.handle&&a.setAttribute("handle",i.handle)),a.setAttributeNS(Di,"xsi:schemaLocation",Ug[o]);const h=mT(a,l,o,i);return t&&Ja("Insert",t,s,h),e&&Ja("Update",e,s,h),n&&Ja("Delete",n,s,h),i.nativeElements&&Ja("Native",i.nativeElements,s,h),a}readProjectionFromDocument(t){for(let e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readProjectionFromNode(e);return null}readProjectionFromNode(t){if(t.firstElementChild&&t.firstElementChild.firstElementChild){t=t.firstElementChild.firstElementChild;for(let e=t.firstElementChild;e;e=e.nextElementSibling)if(!(e.childNodes.length===0||e.childNodes.length===1&&e.firstChild.nodeType===3)){const n=[{}];return this.gmlFormat_.readGeometryElement(e,n),tt(n.pop().srsName)}}return null}}function mT(r,t,e,n){const i=n.featurePrefix?n.featurePrefix:e_;let s;return e==="1.0.0"?s=2:e==="1.1.0"?s=3:e==="2.0.0"&&(s=3.2),Object.assign({node:r},{version:e,featureNS:n.featureNS,featureType:n.featureType,featurePrefix:i,gmlVersion:s,hasZ:n.hasZ,srsName:n.srsName},t)}function Ja(r,t,e,n){pt(n,t_,ue(r),t,e)}function Bg(r,t){return Z({},cT,r,t)}const _T={"http://www.opengis.net/ogc":{FeatureId:ot(function(r,t){return r.getAttribute("fid")})},"http://www.opengis.net/ogc/1.1":{FeatureId:ot(function(r,t){return r.getAttribute("fid")})}};function Xg(r,t){lr(_T,r,t)}const yT={"http://www.opengis.net/wfs":{Feature:Xg},"http://www.opengis.net/wfs/2.0":{Feature:Xg}};function Wg(r,t){return Z([],yT,r,t)}function qg(r,t,e){const n=e[e.length-1],i=n.featureType,s=n.featureNS,o=n.gmlVersion,a=mt(s,i);r.appendChild(a),o===2?It.prototype.writeFeatureElement(a,t,e):o===3?Rt.prototype.writeFeatureElement(a,t,e):Rd.prototype.writeFeatureElement(a,t,e)}function r_(r,t,e){const n=e[e.length-1].version,i=Id[n],s=mt(i,"Filter"),o=mt(i,"FeatureId");s.appendChild(o),o.setAttribute("fid",t),r.appendChild(s)}function Ld(r,t){r=r||e_;const e=r+":";return t.startsWith(e)?t:e+t}function Zg(r,t,e){const n=e[e.length-1];At(t.getId()!==void 0,"Features must have an id set");const i=n.featureType,s=n.featurePrefix,o=n.featureNS,a=Ld(s,i);r.setAttribute("typeName",a),r.setAttributeNS(Cd,"xmlns:"+s,o);const l=t.getId();l!==void 0&&r_(r,l,e)}function $g(r,t,e){const n=e[e.length-1];At(t.getId()!==void 0,"Features must have an id set");const i=n.version,s=n.featureType,o=n.featurePrefix,a=n.featureNS,l=Ld(o,s),h=t.getGeometryName();r.setAttribute("typeName",l),r.setAttributeNS(Cd,"xmlns:"+o,a);const u=t.getId();if(u!==void 0){const c=t.getKeys(),f=[];for(let g=0,m=c.length;g<m;g++){const _=t.get(c[g]);if(_!==void 0){let x=c[g];_&&typeof _.getSimplifiedGeometry=="function"&&(x=h),f.push({name:x,value:_})}}pt({version:i,gmlVersion:n.gmlVersion,node:r,hasZ:n.hasZ,srsName:n.srsName},t_,ue("Property"),f,e),r_(r,u,e)}}function Vg(r,t,e){const n=e[e.length-1],i=n.version,s=uc[i],o=mt(s,i==="2.0.0"?"ValueReference":"Name"),a=n.gmlVersion;if(r.appendChild(o),gt(o,t.name),t.value!==void 0&&t.value!==null){const l=mt(s,"Value");r.appendChild(l),t.value&&typeof t.value.getSimplifiedGeometry=="function"?a===2?It.prototype.writeGeometryElement(l,t.value,e):a===3?Rt.prototype.writeGeometryElement(l,t.value,e):Rd.prototype.writeGeometryElement(l,t.value,e):gt(l,t.value)}}function Yg(r,t,e){t.vendorId&&r.setAttribute("vendorId",t.vendorId),t.safeToIgnore!==void 0&&r.setAttribute("safeToIgnore",String(t.safeToIgnore)),t.value!==void 0&&gt(r,t.value)}const Ph={"http://www.opengis.net/wfs":{Query:N(Hg)},"http://www.opengis.net/wfs/2.0":{Query:N(Hg)},"http://www.opengis.net/ogc":{During:N(Jg),And:N(tl),Or:N(tl),Not:N(tp),BBOX:N(Kg),Contains:N(ti),Intersects:N(ti),Within:N(ti),DWithin:N(Qg),PropertyIsEqualTo:N(Er),PropertyIsNotEqualTo:N(Er),PropertyIsLessThan:N(Er),PropertyIsLessThanOrEqualTo:N(Er),PropertyIsGreaterThan:N(Er),PropertyIsGreaterThanOrEqualTo:N(Er),PropertyIsNull:N(ep),PropertyIsBetween:N(rp),PropertyIsLike:N(np)},"http://www.opengis.net/fes/2.0":{During:N(Jg),And:N(tl),Or:N(tl),Not:N(tp),BBOX:N(Kg),Contains:N(ti),Disjoint:N(ti),Intersects:N(ti),ResourceId:N(vT),Within:N(ti),DWithin:N(Qg),PropertyIsEqualTo:N(Er),PropertyIsNotEqualTo:N(Er),PropertyIsLessThan:N(Er),PropertyIsLessThanOrEqualTo:N(Er),PropertyIsGreaterThan:N(Er),PropertyIsGreaterThanOrEqualTo:N(Er),PropertyIsNull:N(ep),PropertyIsBetween:N(rp),PropertyIsLike:N(np)}};function Hg(r,t,e){const n=e[e.length-1],i=n.version,s=n.featurePrefix,o=n.featureNS,a=n.propertyNames,l=n.srsName;let h;s?h=Ld(s,t):h=t;let u;i==="2.0.0"?u="typeNames":u="typeName",r.setAttribute(u,h),l&&r.setAttribute("srsName",l),o&&r.setAttributeNS(Cd,"xmlns:"+s,o);const c=Object.assign({},n);c.node=r,pt(c,fT,ue("PropertyName"),a,e);const f=n.filter;if(f){const g=mt(Ah(i),"Filter");r.appendChild(g),xT(g,f,e)}}function xT(r,t,e){const n=e[e.length-1],i={node:r};Object.assign(i,{context:n}),pt(i,Ph,ue(t.getTagName()),[t],e)}function Kg(r,t,e){const n=e[e.length-1],i=n.context.version;n.srsName=t.srsName;const s=Ad[i];Js(i,r,t.geometryName),s.prototype.writeGeometryElement(r,t.extent,e)}function vT(r,t,e){r.setAttribute("rid",t.rid)}function ti(r,t,e){const n=e[e.length-1],i=n.context.version;n.srsName=t.srsName;const s=Ad[i];Js(i,r,t.geometryName),s.prototype.writeGeometryElement(r,t.geometry,e)}function Qg(r,t,e){const n=e[e.length-1].context.version;ti(r,t,e);const i=mt(Ah(n),"Distance");gt(i,t.distance.toString()),n==="2.0.0"?i.setAttribute("uom",t.unit):i.setAttribute("units",t.unit),r.appendChild(i)}function Jg(r,t,e){const n=e[e.length-1].context.version;Fl(Pd[n],"ValueReference",r,t.propertyName);const i=mt(Pn,"TimePeriod");r.appendChild(i);const s=mt(Pn,"begin");i.appendChild(s),ip(s,t.begin);const o=mt(Pn,"end");i.appendChild(o),ip(o,t.end)}function tl(r,t,e){const n=e[e.length-1].context,i={node:r};Object.assign(i,{context:n});const s=t.conditions;for(let o=0,a=s.length;o<a;++o){const l=s[o];pt(i,Ph,ue(l.getTagName()),[l],e)}}function tp(r,t,e){const n=e[e.length-1].context,i={node:r};Object.assign(i,{context:n});const s=t.condition;pt(i,Ph,ue(s.getTagName()),[s],e)}function Er(r,t,e){const n=e[e.length-1].context.version;t.matchCase!==void 0&&r.setAttribute("matchCase",t.matchCase.toString()),Js(n,r,t.propertyName),Nl(n,r,""+t.expression)}function ep(r,t,e){const n=e[e.length-1].context.version;Js(n,r,t.propertyName)}function rp(r,t,e){const n=e[e.length-1].context.version,i=Ah(n);Js(n,r,t.propertyName);const s=mt(i,"LowerBoundary");r.appendChild(s),Nl(n,s,""+t.lowerBoundary);const o=mt(i,"UpperBoundary");r.appendChild(o),Nl(n,o,""+t.upperBoundary)}function np(r,t,e){const n=e[e.length-1].context.version;r.setAttribute("wildCard",t.wildCard),r.setAttribute("singleChar",t.singleChar),r.setAttribute("escapeChar",t.escapeChar),t.matchCase!==void 0&&r.setAttribute("matchCase",t.matchCase.toString()),Js(n,r,t.propertyName),Nl(n,r,""+t.pattern)}function Fl(r,t,e,n){const i=mt(r,t);gt(i,n),e.appendChild(i)}function Nl(r,t,e){Fl(Ah(r),"Literal",t,e)}function Js(r,t,e){r==="2.0.0"?Fl(Pd[r],"ValueReference",t,e):Fl(Id[r],"PropertyName",t,e)}function ip(r,t){const e=mt(Pn,"TimeInstant");r.appendChild(e);const n=mt(Pn,"timePosition");e.appendChild(n),gt(n,t)}function sp(r,t,e){const n=e[e.length-1],i=Object.assign({},n);i.node=r,pt(i,Ph,ue("Query"),t,e)}function Ah(r){let t;return r==="2.0.0"?t=Pd[r]:t=Id[r],t}const wT=pT,qt={POINT:1,LINE_STRING:2,POLYGON:3,MULTI_POINT:4,MULTI_LINE_STRING:5,MULTI_POLYGON:6,GEOMETRY_COLLECTION:7,POLYHEDRAL_SURFACE:15,TIN:16,TRIANGLE:17};class op{constructor(t){this.view_=t,this.pos_=0,this.initialized_=!1,this.isLittleEndian_=!1,this.hasZ_=!1,this.hasM_=!1,this.srid_=null,this.layout_="XY"}readUint8(){return this.view_.getUint8(this.pos_++)}readUint32(t){return this.view_.getUint32((this.pos_+=4)-4,t!==void 0?t:this.isLittleEndian_)}readDouble(t){return this.view_.getFloat64((this.pos_+=8)-8,t!==void 0?t:this.isLittleEndian_)}readPoint(){const t=[];return t.push(this.readDouble()),t.push(this.readDouble()),this.hasZ_&&t.push(this.readDouble()),this.hasM_&&t.push(this.readDouble()),t}readLineString(){const t=this.readUint32(),e=[];for(let n=0;n<t;n++)e.push(this.readPoint());return e}readPolygon(){const t=this.readUint32(),e=[];for(let n=0;n<t;n++)e.push(this.readLineString());return e}readWkbHeader(t){const e=this.readUint8()>0,n=this.readUint32(e),i=Math.floor((n&268435455)/1e3),s=!!(n&2147483648)||i===1||i===3,o=!!(n&1073741824)||i===2||i===3,a=!!(n&536870912),l=(n&268435455)%1e3,h=["XY",s?"Z":"",o?"M":""].join(""),u=a?this.readUint32(e):null;if(t!==void 0&&t!==l)throw new Error("Unexpected WKB geometry type "+l);if(this.initialized_){if(this.isLittleEndian_!==e)throw new Error("Inconsistent endian");if(this.layout_!==h)throw new Error("Inconsistent geometry layout");if(u&&this.srid_!==u)throw new Error("Inconsistent coordinate system (SRID)")}else this.isLittleEndian_=e,this.hasZ_=s,this.hasM_=o,this.layout_=h,this.srid_=u,this.initialized_=!0;return l}readWkbPayload(t){switch(t){case qt.POINT:return this.readPoint();case qt.LINE_STRING:return this.readLineString();case qt.POLYGON:case qt.TRIANGLE:return this.readPolygon();case qt.MULTI_POINT:return this.readMultiPoint();case qt.MULTI_LINE_STRING:return this.readMultiLineString();case qt.MULTI_POLYGON:case qt.POLYHEDRAL_SURFACE:case qt.TIN:return this.readMultiPolygon();case qt.GEOMETRY_COLLECTION:return this.readGeometryCollection();default:throw new Error("Unsupported WKB geometry type "+t+" is found")}}readWkbBlock(t){return this.readWkbPayload(this.readWkbHeader(t))}readWkbCollection(t,e){const n=this.readUint32(),i=[];for(let s=0;s<n;s++){const o=t.call(this,e);o&&i.push(o)}return i}readMultiPoint(){return this.readWkbCollection(this.readWkbBlock,qt.POINT)}readMultiLineString(){return this.readWkbCollection(this.readWkbBlock,qt.LINE_STRING)}readMultiPolygon(){return this.readWkbCollection(this.readWkbBlock,qt.POLYGON)}readGeometryCollection(){return this.readWkbCollection(this.readGeometry)}readGeometry(){const t=this.readWkbHeader(),e=this.readWkbPayload(t);switch(t){case qt.POINT:return new Re(e,this.layout_);case qt.LINE_STRING:return new ye(e,this.layout_);case qt.POLYGON:case qt.TRIANGLE:return new Ue(e,this.layout_);case qt.MULTI_POINT:return new Zr(e,this.layout_);case qt.MULTI_LINE_STRING:return new ur(e,this.layout_);case qt.MULTI_POLYGON:case qt.POLYHEDRAL_SURFACE:case qt.TIN:return new Pr(e,this.layout_);case qt.GEOMETRY_COLLECTION:return new je(e);default:return null}}getSrid(){return this.srid_}}class bT{constructor(t){t=t||{},this.layout_=t.layout,this.isLittleEndian_=t.littleEndian!==!1,this.isEWKB_=t.ewkb!==!1,this.writeQueue_=[],this.nodata_=Object.assign({X:0,Y:0,Z:0,M:0},t.nodata)}writeUint8(t){this.writeQueue_.push([1,t])}writeUint32(t){this.writeQueue_.push([4,t])}writeDouble(t){this.writeQueue_.push([8,t])}writePoint(t,e){const n=Object.assign.apply(null,e.split("").map((i,s)=>({[i]:t[s]})));for(const i of this.layout_)this.writeDouble(i in n?n[i]:this.nodata_[i])}writeLineString(t,e){this.writeUint32(t.length);for(let n=0;n<t.length;n++)this.writePoint(t[n],e)}writePolygon(t,e){this.writeUint32(t.length);for(let n=0;n<t.length;n++)this.writeLineString(t[n],e)}writeWkbHeader(t,e){t%=1e3,this.layout_.includes("Z")&&(t+=this.isEWKB_?2147483648:1e3),this.layout_.includes("M")&&(t+=this.isEWKB_?1073741824:2e3),this.isEWKB_&&Number.isInteger(e)&&(t|=536870912),this.writeUint8(this.isLittleEndian_?1:0),this.writeUint32(t),this.isEWKB_&&Number.isInteger(e)&&this.writeUint32(e)}writeMultiPoint(t,e){this.writeUint32(t.length);for(let n=0;n<t.length;n++)this.writeWkbHeader(1),this.writePoint(t[n],e)}writeMultiLineString(t,e){this.writeUint32(t.length);for(let n=0;n<t.length;n++)this.writeWkbHeader(2),this.writeLineString(t[n],e)}writeMultiPolygon(t,e){this.writeUint32(t.length);for(let n=0;n<t.length;n++)this.writeWkbHeader(3),this.writePolygon(t[n],e)}writeGeometryCollection(t){this.writeUint32(t.length);for(let e=0;e<t.length;e++)this.writeGeometry(t[e])}findMinimumLayout(t,e="XYZM"){const n=(i,s)=>i===s?i:i==="XYZM"?s:s==="XYZM"?i:"XY";if(t instanceof Dn)return n(t.getLayout(),e);if(t instanceof je){const i=t.getGeometriesArray();for(let s=0;s<i.length&&e!=="XY";s++)e=this.findMinimumLayout(i[s],e)}return e}writeGeometry(t,e){const n={Point:qt.POINT,LineString:qt.LINE_STRING,Polygon:qt.POLYGON,MultiPoint:qt.MULTI_POINT,MultiLineString:qt.MULTI_LINE_STRING,MultiPolygon:qt.MULTI_POLYGON,GeometryCollection:qt.GEOMETRY_COLLECTION},i=t.getType(),s=n[i];if(!s)throw new Error("GeometryType "+i+" is not supported");this.layout_||(this.layout_=this.findMinimumLayout(t)),this.writeWkbHeader(s,e),t instanceof Dn?{Point:this.writePoint,LineString:this.writeLineString,Polygon:this.writePolygon,MultiPoint:this.writeMultiPoint,MultiLineString:this.writeMultiLineString,MultiPolygon:this.writeMultiPolygon}[i].call(this,t.getCoordinates(),t.getLayout()):t instanceof je&&this.writeGeometryCollection(t.getGeometriesArray())}getBuffer(){const t=this.writeQueue_.reduce((s,o)=>s+o[0],0),e=new ArrayBuffer(t),n=new DataView(e);let i=0;return this.writeQueue_.forEach(s=>{switch(s[0]){case 1:n.setUint8(i,s[1]);break;case 4:n.setUint32(i,s[1],this.isLittleEndian_);break;case 8:n.setFloat64(i,s[1],this.isLittleEndian_);break}i+=s[0]}),e}}class ST extends Ta{constructor(t){super(),t=t||{},this.splitCollection=!!t.splitCollection,this.viewCache_=null,this.hex_=t.hex!==!1,this.littleEndian_=t.littleEndian!==!1,this.ewkb_=t.ewkb!==!1,this.layout_=t.geometryLayout,this.nodataZ_=t.nodataZ||0,this.nodataM_=t.nodataM||0,this.srid_=t.srid}getType(){return this.hex_?"text":"arraybuffer"}readFeature(t,e){return new Se({geometry:this.readGeometry(t,e)})}readFeatures(t,e){let n=[];const i=this.readGeometry(t,e);return this.splitCollection&&i instanceof je?n=i.getGeometriesArray():n=[i],n.map(s=>new Se({geometry:s}))}readGeometry(t,e){const n=ap(t);if(!n)return null;const i=new op(n).readGeometry();return this.viewCache_=n,e=this.getReadOptions(t,e),this.viewCache_=null,se(i,!1,e)}readProjection(t){const e=this.viewCache_||ap(t);if(!e)return;const n=new op(e);return n.readWkbHeader(),n.getSrid()&&tt("EPSG:"+n.getSrid())||void 0}writeFeature(t,e){return this.writeGeometry(t.getGeometry(),e)}writeFeatures(t,e){return this.writeGeometry(new je(t.map(n=>n.getGeometry())),e)}writeGeometry(t,e){e=this.adaptOptions(e);const n=new bT({layout:this.layout_,littleEndian:this.littleEndian_,ewkb:this.ewkb_,nodata:{Z:this.nodataZ_,M:this.nodataM_}});let i=Number.isInteger(this.srid_)?Number(this.srid_):null;if(this.srid_!==!1&&!Number.isInteger(this.srid_)){const o=e.dataProjection&&tt(e.dataProjection);if(o){const a=o.getCode();a.startsWith("EPSG:")&&(i=Number(a.substring(5)))}}n.writeGeometry(se(t,!0,e),i);const s=n.getBuffer();return this.hex_?ET(s):s}}function ET(r){const t=new Uint8Array(r);return Array.from(t.values()).map(e=>(e<16?"0":"")+Number(e).toString(16).toUpperCase()).join("")}function TT(r){const t=new Uint8Array(r.length/2);for(let e=0;e<r.length/2;e++)t[e]=parseInt(r.substr(e*2,2),16);return new DataView(t.buffer)}function ap(r){return typeof r=="string"?TT(r):ArrayBuffer.isView(r)?r instanceof DataView?r:new DataView(r.buffer,r.byteOffset,r.byteLength):r instanceof ArrayBuffer?new DataView(r):null}const MT=ST,RT={POINT:Re,LINESTRING:ye,POLYGON:Ue,MULTIPOINT:Zr,MULTILINESTRING:ur,MULTIPOLYGON:Pr},n_="EMPTY",i_="Z",s_="M",CT="ZM",zt={START:0,TEXT:1,LEFT_PAREN:2,RIGHT_PAREN:3,NUMBER:4,COMMA:5,EOF:6},IT={Point:"POINT",LineString:"LINESTRING",Polygon:"POLYGON",MultiPoint:"MULTIPOINT",MultiLineString:"MULTILINESTRING",MultiPolygon:"MULTIPOLYGON",GeometryCollection:"GEOMETRYCOLLECTION",Circle:"CIRCLE"};class PT{constructor(t){this.wkt=t,this.index_=-1}isAlpha_(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"}isNumeric_(t,e){return e=e!==void 0?e:!1,t>="0"&&t<="9"||t=="."&&!e}isWhiteSpace_(t){return t==" "||t=="	"||t=="\r"||t==`
`}nextChar_(){return this.wkt.charAt(++this.index_)}nextToken(){const t=this.nextChar_(),e=this.index_;let n=t,i;if(t=="(")i=zt.LEFT_PAREN;else if(t==",")i=zt.COMMA;else if(t==")")i=zt.RIGHT_PAREN;else if(this.isNumeric_(t)||t=="-")i=zt.NUMBER,n=this.readNumber_();else if(this.isAlpha_(t))i=zt.TEXT,n=this.readText_();else{if(this.isWhiteSpace_(t))return this.nextToken();if(t==="")i=zt.EOF;else throw new Error("Unexpected character: "+t)}return{position:e,value:n,type:i}}readNumber_(){let t;const e=this.index_;let n=!1,i=!1;do t=="."?n=!0:(t=="e"||t=="E")&&(i=!0),t=this.nextChar_();while(this.isNumeric_(t,n)||!i&&(t=="e"||t=="E")||i&&(t=="-"||t=="+"));return parseFloat(this.wkt.substring(e,this.index_--))}readText_(){let t;const e=this.index_;do t=this.nextChar_();while(this.isAlpha_(t));return this.wkt.substring(e,this.index_--).toUpperCase()}}let AT=class{constructor(r){this.lexer_=r,this.token_={position:0,type:zt.START},this.layout_="XY"}consume_(){this.token_=this.lexer_.nextToken()}isTokenType(r){return this.token_.type==r}match(r){const t=this.isTokenType(r);return t&&this.consume_(),t}parse(){return this.consume_(),this.parseGeometry_()}parseGeometryLayout_(){let r="XY";const t=this.token_;if(this.isTokenType(zt.TEXT)){const e=t.value;e===i_?r="XYZ":e===s_?r="XYM":e===CT&&(r="XYZM"),r!=="XY"&&this.consume_()}return r}parseGeometryCollectionText_(){if(this.match(zt.LEFT_PAREN)){const r=[];do r.push(this.parseGeometry_());while(this.match(zt.COMMA));if(this.match(zt.RIGHT_PAREN))return r}throw new Error(this.formatErrorMessage_())}parsePointText_(){if(this.match(zt.LEFT_PAREN)){const r=this.parsePoint_();if(this.match(zt.RIGHT_PAREN))return r}throw new Error(this.formatErrorMessage_())}parseLineStringText_(){if(this.match(zt.LEFT_PAREN)){const r=this.parsePointList_();if(this.match(zt.RIGHT_PAREN))return r}throw new Error(this.formatErrorMessage_())}parsePolygonText_(){if(this.match(zt.LEFT_PAREN)){const r=this.parseLineStringTextList_();if(this.match(zt.RIGHT_PAREN))return r}throw new Error(this.formatErrorMessage_())}parseMultiPointText_(){if(this.match(zt.LEFT_PAREN)){let r;if(this.token_.type==zt.LEFT_PAREN?r=this.parsePointTextList_():r=this.parsePointList_(),this.match(zt.RIGHT_PAREN))return r}throw new Error(this.formatErrorMessage_())}parseMultiLineStringText_(){if(this.match(zt.LEFT_PAREN)){const r=this.parseLineStringTextList_();if(this.match(zt.RIGHT_PAREN))return r}throw new Error(this.formatErrorMessage_())}parseMultiPolygonText_(){if(this.match(zt.LEFT_PAREN)){const r=this.parsePolygonTextList_();if(this.match(zt.RIGHT_PAREN))return r}throw new Error(this.formatErrorMessage_())}parsePoint_(){const r=[],t=this.layout_.length;for(let e=0;e<t;++e){const n=this.token_;if(this.match(zt.NUMBER))r.push(n.value);else break}if(r.length==t)return r;throw new Error(this.formatErrorMessage_())}parsePointList_(){const r=[this.parsePoint_()];for(;this.match(zt.COMMA);)r.push(this.parsePoint_());return r}parsePointTextList_(){const r=[this.parsePointText_()];for(;this.match(zt.COMMA);)r.push(this.parsePointText_());return r}parseLineStringTextList_(){const r=[this.parseLineStringText_()];for(;this.match(zt.COMMA);)r.push(this.parseLineStringText_());return r}parsePolygonTextList_(){const r=[this.parsePolygonText_()];for(;this.match(zt.COMMA);)r.push(this.parsePolygonText_());return r}isEmptyGeometry_(){const r=this.isTokenType(zt.TEXT)&&this.token_.value==n_;return r&&this.consume_(),r}formatErrorMessage_(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}parseGeometry_(){const r=this.token_;if(this.match(zt.TEXT)){const t=r.value;this.layout_=this.parseGeometryLayout_();const e=this.isEmptyGeometry_();if(t=="GEOMETRYCOLLECTION"){if(e)return new je([]);const s=this.parseGeometryCollectionText_();return new je(s)}const n=RT[t];if(!n)throw new Error("Invalid geometry type: "+t);let i;if(e)t=="POINT"?i=[NaN,NaN]:i=[];else switch(t){case"POINT":{i=this.parsePointText_();break}case"LINESTRING":{i=this.parseLineStringText_();break}case"POLYGON":{i=this.parsePolygonText_();break}case"MULTIPOINT":{i=this.parseMultiPointText_();break}case"MULTILINESTRING":{i=this.parseMultiLineStringText_();break}case"MULTIPOLYGON":{i=this.parseMultiPolygonText_();break}}return new n(i,this.layout_)}throw new Error(this.formatErrorMessage_())}};class LT extends fd{constructor(t){super(),t=t||{},this.splitCollection_=t.splitCollection!==void 0?t.splitCollection:!1}parse_(t){const e=new PT(t);return new AT(e).parse()}readFeatureFromText(t,e){const n=this.readGeometryFromText(t,e),i=new Se;return i.setGeometry(n),i}readFeaturesFromText(t,e){let n=[];const i=this.readGeometryFromText(t,e);this.splitCollection_&&i.getType()=="GeometryCollection"?n=i.getGeometriesArray():n=[i];const s=[];for(let o=0,a=n.length;o<a;++o){const l=new Se;l.setGeometry(n[o]),s.push(l)}return s}readGeometryFromText(t,e){const n=this.parse_(t);return se(n,!1,e)}writeFeatureText(t,e){const n=t.getGeometry();return n?this.writeGeometryText(n,e):""}writeFeaturesText(t,e){if(t.length==1)return this.writeFeatureText(t[0],e);const n=[];for(let s=0,o=t.length;s<o;++s)n.push(t[s].getGeometry());const i=new je(n);return this.writeGeometryText(i,e)}writeGeometryText(t,e){return l_(se(t,!0,e))}}function o_(r){const t=r.getCoordinates();return t.length===0?"":t.join(" ")}function OT(r){const t=[],e=r.getPoints();for(let n=0,i=e.length;n<i;++n)t.push("("+o_(e[n])+")");return t.join(",")}function FT(r){const t=[],e=r.getGeometries();for(let n=0,i=e.length;n<i;++n)t.push(l_(e[n]));return t.join(",")}function Od(r){const t=r.getCoordinates(),e=[];for(let n=0,i=t.length;n<i;++n)e.push(t[n].join(" "));return e.join(",")}function NT(r){const t=[],e=r.getLineStrings();for(let n=0,i=e.length;n<i;++n)t.push("("+Od(e[n])+")");return t.join(",")}function a_(r){const t=[],e=r.getLinearRings();for(let n=0,i=e.length;n<i;++n)t.push("("+Od(e[n])+")");return t.join(",")}function DT(r){const t=[],e=r.getPolygons();for(let n=0,i=e.length;n<i;++n)t.push("("+a_(e[n])+")");return t.join(",")}function kT(r){const t=r.getLayout();let e="";return(t==="XYZ"||t==="XYZM")&&(e+=i_),(t==="XYM"||t==="XYZM")&&(e+=s_),e}const GT={Point:o_,LineString:Od,Polygon:a_,MultiPoint:OT,MultiLineString:NT,MultiPolygon:DT,GeometryCollection:FT};function l_(r){const t=r.getType(),e=GT[t],n=e(r);let i=IT[t];if(typeof r.getFlatCoordinates=="function"){const s=kT(r);s.length>0&&(i+=" "+s)}return n.length===0?i+" "+n_:i+"("+n+")"}const jT=LT,Oe=[null,"http://www.opengis.net/wms"],zT=q(Oe,{Service:O(aM),Capability:O(oM)}),UT=q(Oe,{Request:O(gM),Exception:O(cM),Layer:O(dM)});class BT extends Td{constructor(){super(),this.version=void 0}readFromNode(t){return this.version=t.getAttribute("version").trim(),Z({version:this.version},zT,t,[])||null}}const XT=q(Oe,{Name:O($),Title:O($),Abstract:O($),KeywordList:O(d_),OnlineResource:O(Qs),ContactInformation:O(lM),Fees:O($),AccessConstraints:O($),LayerLimit:O(fe),MaxWidth:O(fe),MaxHeight:O(fe)}),WT=q(Oe,{ContactPersonPrimary:O(hM),ContactPosition:O($),ContactAddress:O(uM),ContactVoiceTelephone:O($),ContactFacsimileTelephone:O($),ContactElectronicMailAddress:O($)}),qT=q(Oe,{ContactPerson:O($),ContactOrganization:O($)}),ZT=q(Oe,{AddressType:O($),Address:O($),City:O($),StateOrProvince:O($),PostCode:O($),Country:O($)}),$T=q(Oe,{Format:ot($)}),h_=q(Oe,{Name:O($),Title:O($),Abstract:O($),KeywordList:O(d_),CRS:Kt($),EX_GeographicBoundingBox:O(sM),BoundingBox:Kt(iM),Dimension:Kt(fM),Attribution:O(nM),AuthorityURL:Kt(_M),Identifier:Kt($),MetadataURL:Kt(yM),DataURL:Kt(kn),FeatureListURL:Kt(kn),Style:Kt(xM),MinScaleDenominator:O(Pt),MaxScaleDenominator:O(Pt),Layer:Kt(u_)}),VT=q(Oe,{Title:O($),OnlineResource:O(Qs),LogoURL:O(c_)}),YT=q(Oe,{westBoundLongitude:O(Pt),eastBoundLongitude:O(Pt),southBoundLatitude:O(Pt),northBoundLatitude:O(Pt)}),HT=q(Oe,{GetCapabilities:O(pu),GetMap:O(pu),GetFeatureInfo:O(pu)}),KT=q(Oe,{Format:Kt($),DCPType:Kt(pM)}),QT=q(Oe,{HTTP:O(mM)}),JT=q(Oe,{Get:O(kn),Post:O(kn)}),tM=q(Oe,{Name:O($),Title:O($),Abstract:O($),LegendURL:Kt(c_),StyleSheetURL:O(kn),StyleURL:O(kn)}),eM=q(Oe,{Format:O($),OnlineResource:O(Qs)}),rM=q(Oe,{Keyword:ot($)});function nM(r,t){return Z({},VT,r,t)}function iM(r,t){const e=[En(r.getAttribute("minx")),En(r.getAttribute("miny")),En(r.getAttribute("maxx")),En(r.getAttribute("maxy"))],n=[En(r.getAttribute("resx")),En(r.getAttribute("resy"))];return{crs:r.getAttribute("CRS"),extent:e,res:n}}function sM(r,t){const e=Z({},YT,r,t);if(!e)return;const n=e.westBoundLongitude,i=e.southBoundLatitude,s=e.eastBoundLongitude,o=e.northBoundLatitude;if(!(n===void 0||i===void 0||s===void 0||o===void 0))return[n,i,s,o]}function oM(r,t){return Z({},UT,r,t)}function aM(r,t){return Z({},XT,r,t)}function lM(r,t){return Z({},WT,r,t)}function hM(r,t){return Z({},qT,r,t)}function uM(r,t){return Z({},ZT,r,t)}function cM(r,t){return Z([],$T,r,t)}function dM(r,t){const e=Z({},h_,r,t);return e.Layer===void 0?Object.assign(e,u_(r,t)):e}function u_(r,t){const e=t[t.length-1],n=Z({},h_,r,t);if(!n)return;let i=Li(r.getAttribute("queryable"));i===void 0&&(i=e.queryable),n.queryable=i!==void 0?i:!1;let s=Cn(r.getAttribute("cascaded"));s===void 0&&(s=e.cascaded),n.cascaded=s;let o=Li(r.getAttribute("opaque"));o===void 0&&(o=e.opaque),n.opaque=o!==void 0?o:!1;let a=Li(r.getAttribute("noSubsets"));a===void 0&&(a=e.noSubsets),n.noSubsets=a!==void 0?a:!1;let l=En(r.getAttribute("fixedWidth"));l||(l=e.fixedWidth),n.fixedWidth=l;let h=En(r.getAttribute("fixedHeight"));return h||(h=e.fixedHeight),n.fixedHeight=h,["Style","CRS","AuthorityURL"].forEach(function(u){if(u in e){const c=n[u]||[];n[u]=c.concat(e[u])}}),["EX_GeographicBoundingBox","BoundingBox","Dimension","Attribution","MinScaleDenominator","MaxScaleDenominator"].forEach(function(u){if(!(u in n)){const c=e[u];n[u]=c}}),n}function fM(r,t){return{name:r.getAttribute("name"),units:r.getAttribute("units"),unitSymbol:r.getAttribute("unitSymbol"),default:r.getAttribute("default"),multipleValues:Li(r.getAttribute("multipleValues")),nearestValue:Li(r.getAttribute("nearestValue")),current:Li(r.getAttribute("current")),values:$(r)}}function kn(r,t){return Z({},eM,r,t)}function gM(r,t){return Z({},HT,r,t)}function pM(r,t){return Z({},QT,r,t)}function mM(r,t){return Z({},JT,r,t)}function pu(r,t){return Z({},KT,r,t)}function c_(r,t){const e=kn(r,t);if(e){const n=[Cn(r.getAttribute("width")),Cn(r.getAttribute("height"))];return e.size=n,e}}function _M(r,t){const e=kn(r,t);if(e)return e.name=r.getAttribute("name"),e}function yM(r,t){const e=kn(r,t);if(e)return e.type=r.getAttribute("type"),e}function xM(r,t){return Z({},tM,r,t)}function d_(r,t){return Z([],rM,r,t)}const vM=BT,wM="_feature",bM="_layer";class SM extends Ra{constructor(t){super(),t=t||{},this.featureNS_="http://mapserver.gis.umn.edu/mapserver",this.gmlFormat_=new It,this.layers_=t.layers?t.layers:null}getLayers(){return this.layers_}setLayers(t){this.layers_=t}readFeatures_(t,e){t.setAttribute("namespaceURI",this.featureNS_);const n=t.localName;let i=[];if(t.childNodes.length===0)return i;if(n=="msGMLOutput")for(let s=0,o=t.childNodes.length;s<o;s++){const a=t.childNodes[s];if(a.nodeType!==Node.ELEMENT_NODE)continue;const l=a,h=e[0],u=bM,c=l.localName.replace(u,"");if(this.layers_&&!this.layers_.includes(c))continue;const f=c+wM;h.featureType=f,h.featureNS=this.featureNS_;const g={};g[f]=ot(this.gmlFormat_.readFeatureElement,this.gmlFormat_);const m=q([h.featureNS,null],g);l.setAttribute("namespaceURI",this.featureNS_);const _=Z([],m,l,e,this.gmlFormat_);_&&Ot(i,_)}if(n=="FeatureCollection"){const s=Z([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,t,[{}],this.gmlFormat_);s&&(i=s)}return i}readFeaturesFromNode(t,e){const n={};return e&&Object.assign(n,this.getReadOptions(t,e)),this.readFeatures_(t,[n])}}const EM=SM,gn=[null,"http://www.opengis.net/wmts/1.0"],to=[null,"http://www.opengis.net/ows/1.1"],TM=q(gn,{Contents:O(DM)});let MM=class extends Td{constructor(){super(),this.owsParser_=new K0}readFromNode(r){let t=r.getAttribute("version");t&&(t=t.trim());let e=this.owsParser_.readFromNode(r);return e?(e.version=t,e=Z(e,TM,r,[]),e||null):null}};const RM=q(gn,{Layer:Kt(kM),TileMatrixSet:Kt(GM)}),CM=q(gn,{Style:Kt(jM),Format:Kt($),TileMatrixSetLink:Kt(zM),Dimension:Kt(UM),ResourceURL:Kt(BM)},q(to,{Title:O($),Abstract:O($),WGS84BoundingBox:O(g_),BoundingBox:Kt(XM),Identifier:O($)})),IM=q(gn,{LegendURL:Kt(WM)},q(to,{Title:O($),Identifier:O($)})),PM=q(gn,{TileMatrixSet:O($),TileMatrixSetLimits:O(ZM)}),AM=q(gn,{TileMatrixLimits:ot($M)}),LM=q(gn,{TileMatrix:O($),MinTileRow:O(fe),MaxTileRow:O(fe),MinTileCol:O(fe),MaxTileCol:O(fe)}),OM=q(gn,{Default:O($),Value:Kt($)},q(to,{Identifier:O($)})),f_=q(to,{LowerCorner:ot(cc),UpperCorner:ot(cc)}),FM=q(gn,{WellKnownScaleSet:O($),TileMatrix:Kt(qM)},q(to,{SupportedCRS:O($),Identifier:O($),BoundingBox:O(g_)})),NM=q(gn,{TopLeftCorner:O(cc),ScaleDenominator:O(Pt),TileWidth:O(fe),TileHeight:O(fe),MatrixWidth:O(fe),MatrixHeight:O(fe)},q(to,{Identifier:O($)}));function DM(r,t){return Z({},RM,r,t)}function kM(r,t){return Z({},CM,r,t)}function GM(r,t){return Z({},FM,r,t)}function jM(r,t){const e=Z({},IM,r,t);if(!e)return;const n=r.getAttribute("isDefault")==="true";return e.isDefault=n,e}function zM(r,t){return Z({},PM,r,t)}function UM(r,t){return Z({},OM,r,t)}function BM(r,t){const e=r.getAttribute("format"),n=r.getAttribute("template"),i=r.getAttribute("resourceType"),s={};return e&&(s.format=e),n&&(s.template=n),i&&(s.resourceType=i),s}function g_(r,t){const e=Z([],f_,r,t);if(e.length==2)return Os(e)}function XM(r,t){const e=r.getAttribute("crs"),n=Z([],f_,r,t);if(n.length==2)return{extent:Os(n),crs:e}}function WM(r,t){const e={};return e.format=r.getAttribute("format"),e.href=Qs(r),e}function cc(r,t){const e=$(r).split(/\s+/);if(!e||e.length!=2)return;const n=+e[0],i=+e[1];if(!(isNaN(n)||isNaN(i)))return[n,i]}function qM(r,t){return Z({},NM,r,t)}function ZM(r,t){return Z([],AM,r,t)}function $M(r,t){return Z({},LM,r,t)}const Fd=MM,VM=Object.freeze(Object.defineProperty({__proto__:null,EsriJSON:Qv,GML:Ew,GPX:ub,GeoJSON:f0,IGC:mb,IIIFInfo:Sb,KML:OS,MVT:H0,OWS:K0,Polyline:ZE,TopoJSON:iT,WFS:wT,WKB:MT,WKT:jT,WMSCapabilities:vM,WMSGetFeatureInfo:EM,WMTSCapabilities:Fd},Symbol.toStringTag,{value:"Module"}));window.eoxMapAdvancedOlFormats=VM;const ii={ADD:"add",REMOVE:"remove"},lp={LENGTH:"length"};class el extends fn{constructor(t,e,n){super(t),this.element=e,this.index=n}}let Dl=class extends qi{constructor(r,t){if(super(),this.on,this.once,this.un,t=t||{},this.unique_=!!t.unique,this.array_=r||[],this.unique_)for(let e=0,n=this.array_.length;e<n;++e)this.assertUnique_(this.array_[e],e);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(r){for(let t=0,e=r.length;t<e;++t)this.push(r[t]);return this}forEach(r){const t=this.array_;for(let e=0,n=t.length;e<n;++e)r(t[e],e,t)}getArray(){return this.array_}item(r){return this.array_[r]}getLength(){return this.get(lp.LENGTH)}insertAt(r,t){if(r<0||r>this.getLength())throw new Error("Index out of bounds: "+r);this.unique_&&this.assertUnique_(t),this.array_.splice(r,0,t),this.updateLength_(),this.dispatchEvent(new el(ii.ADD,t,r))}pop(){return this.removeAt(this.getLength()-1)}push(r){this.unique_&&this.assertUnique_(r);const t=this.getLength();return this.insertAt(t,r),this.getLength()}remove(r){const t=this.array_;for(let e=0,n=t.length;e<n;++e)if(t[e]===r)return this.removeAt(e)}removeAt(r){if(r<0||r>=this.getLength())return;const t=this.array_[r];return this.array_.splice(r,1),this.updateLength_(),this.dispatchEvent(new el(ii.REMOVE,t,r)),t}setAt(r,t){const e=this.getLength();if(r>=e){this.insertAt(r,t);return}if(r<0)throw new Error("Index out of bounds: "+r);this.unique_&&this.assertUnique_(t,r);const n=this.array_[r];this.array_[r]=t,this.dispatchEvent(new el(ii.REMOVE,n,r)),this.dispatchEvent(new el(ii.ADD,t,r))}updateLength_(){this.set(lp.LENGTH,this.array_.length)}assertUnique_(r,t){for(let e=0,n=this.array_.length;e<n;++e)if(this.array_[e]===r&&e!==t)throw new Error("Duplicate item added to a unique collection")}};const ir={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},Ut={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class p_ extends qi{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;const e=Object.assign({},t);typeof t.properties=="object"&&(delete e.properties,Object.assign(e,t.properties)),e[Ut.OPACITY]=t.opacity!==void 0?t.opacity:1,At(typeof e[Ut.OPACITY]=="number","Layer opacity must be a number"),e[Ut.VISIBLE]=t.visible!==void 0?t.visible:!0,e[Ut.Z_INDEX]=t.zIndex,e[Ut.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,e[Ut.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,e[Ut.MIN_ZOOM]=t.minZoom!==void 0?t.minZoom:-1/0,e[Ut.MAX_ZOOM]=t.maxZoom!==void 0?t.maxZoom:1/0,this.className_=e.className!==void 0?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:t===void 0?!0:t},n=this.getZIndex();return e.opacity=wt(Math.round(this.getOpacity()*100)/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=n===void 0&&!e.managed?1/0:n,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return ut()}getLayerStatesArray(t){return ut()}getExtent(){return this.get(Ut.EXTENT)}getMaxResolution(){return this.get(Ut.MAX_RESOLUTION)}getMinResolution(){return this.get(Ut.MIN_RESOLUTION)}getMinZoom(){return this.get(Ut.MIN_ZOOM)}getMaxZoom(){return this.get(Ut.MAX_ZOOM)}getOpacity(){return this.get(Ut.OPACITY)}getSourceState(){return ut()}getVisible(){return this.get(Ut.VISIBLE)}getZIndex(){return this.get(Ut.Z_INDEX)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(Ut.EXTENT,t)}setMaxResolution(t){this.set(Ut.MAX_RESOLUTION,t)}setMinResolution(t){this.set(Ut.MIN_RESOLUTION,t)}setMaxZoom(t){this.set(Ut.MAX_ZOOM,t)}setMinZoom(t){this.set(Ut.MIN_ZOOM,t)}setOpacity(t){At(typeof t=="number","Layer opacity must be a number"),this.set(Ut.OPACITY,t)}setVisible(t){this.set(Ut.VISIBLE,t)}setZIndex(t){this.set(Ut.Z_INDEX,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const ee={ANIMATING:0,INTERACTING:1},Fr={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"},m_=42,zs=256;function hp(r,t,e){return function(n,i,s,o,a){if(!n)return;if(!i&&!t)return n;const l=t?0:s[0]*i,h=t?0:s[1]*i,u=a?a[0]:0,c=a?a[1]:0;let f=r[0]+l/2+u,g=r[2]-l/2+u,m=r[1]+h/2+c,_=r[3]-h/2+c;f>g&&(f=(g+f)/2,g=f),m>_&&(m=(_+m)/2,_=m);let x=wt(n[0],f,g),v=wt(n[1],m,_);if(o&&e&&i){const w=30*i;x+=-w*Math.log(1+Math.max(0,f-n[0])/w)+w*Math.log(1+Math.max(0,n[0]-g)/w),v+=-w*Math.log(1+Math.max(0,m-n[1])/w)+w*Math.log(1+Math.max(0,n[1]-_)/w)}return[x,v]}}function YM(r){return r}function Nd(r,t,e,n){const i=yt(t)/e[0],s=Vt(t)/e[1];return n?Math.min(r,Math.max(i,s)):Math.min(r,Math.min(i,s))}function Dd(r,t,e){let n=Math.min(r,t);const i=50;return n*=Math.log(1+i*Math.max(0,r/t-1))/i+1,e&&(n=Math.max(n,e),n/=Math.log(1+i*Math.max(0,e/r-1))/i+1),wt(n,e/2,t*2)}function HM(r,t,e,n){return t=t!==void 0?t:!0,function(i,s,o,a){if(i!==void 0){const l=r[0],h=r[r.length-1],u=e?Nd(l,e,o,n):l;if(a)return t?Dd(i,u,h):wt(i,h,u);const c=Math.min(u,i),f=Math.floor(lh(r,c,s));return r[f]>u&&f<r.length-1?r[f+1]:r[f]}}}function KM(r,t,e,n,i,s){return n=n!==void 0?n:!0,e=e!==void 0?e:0,function(o,a,l,h){if(o!==void 0){const u=i?Nd(t,i,l,s):t;if(h)return n?Dd(o,u,e):wt(o,e,u);const c=1e-9,f=Math.ceil(Math.log(t/u)/Math.log(r)-c),g=-a*(.5-c)+.5,m=Math.min(u,o),_=Math.floor(Math.log(t/m)/Math.log(r)+g),x=Math.max(f,_),v=t/Math.pow(r,x);return wt(v,e,u)}}}function up(r,t,e,n,i){return e=e!==void 0?e:!0,function(s,o,a,l){if(s!==void 0){const h=n?Nd(r,n,a,i):r;return!e||!l?wt(s,t,h):Dd(s,h,t)}}}function QM(r){if(r!==void 0)return 0}function cp(r){if(r!==void 0)return r}function JM(r){const t=2*Math.PI/r;return function(e,n){if(n)return e;if(e!==void 0)return e=Math.floor(e/t+.5)*t,e}}function tR(r){const t=Oo(5);return function(e,n){return n||e===void 0?e:Math.abs(e)<=t?0:e}}function __(r){return Math.pow(r,3)}function eR(r){return 1-__(1-r)}function rR(r){return 3*r*r-2*r*r*r}const mu=0;class dp extends qi{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=$c(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&uv(),t.center&&(t.center=$n(t.center,this.projection_)),t.extent&&(t.extent=Gr(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){const e=Object.assign({},t);for(const a in Fr)delete e[a];this.setProperties(e,!0);const n=iR(t);this.maxResolution_=n.maxResolution,this.minResolution_=n.minResolution,this.zoomFactor_=n.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=n.minZoom;const i=nR(t),s=n.constraint,o=sR(t);this.constraints_={center:i,resolution:s,rotation:o},this.setRotation(t.rotation!==void 0?t.rotation:0),this.setCenterInternal(t.center!==void 0?t.center:null),t.resolution!==void 0?this.setResolution(t.resolution):t.zoom!==void 0&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let e=this.padding_;this.padding_=t;const n=this.getCenterInternal();if(n){const i=t||[0,0,0,0];e=e||[0,0,0,0];const s=this.getResolution(),o=s/2*(i[3]-e[3]+e[1]-i[1]),a=s/2*(i[0]-e[0]+e[2]-i[2]);this.setCenterInternal([n[0]+o,n[1]-a])}}getUpdatedOptions_(t){const e=this.getProperties();return e.resolution!==void 0?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const e=new Array(arguments.length);for(let n=0;n<e.length;++n){let i=arguments[n];i.center&&(i=Object.assign({},i),i.center=$n(i.center,this.getProjection())),i.anchor&&(i=Object.assign({},i),i.anchor=$n(i.anchor,this.getProjection())),e[n]=i}this.animateInternal.apply(this,e)}animateInternal(t){let e=arguments.length,n;e>1&&typeof arguments[e-1]=="function"&&(n=arguments[e-1],--e);let i=0;for(;i<e&&!this.isDef();++i){const u=arguments[i];u.center&&this.setCenterInternal(u.center),u.zoom!==void 0?this.setZoom(u.zoom):u.resolution&&this.setResolution(u.resolution),u.rotation!==void 0&&this.setRotation(u.rotation)}if(i===e){n&&rl(n,!0);return}let s=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_;const h=[];for(;i<e;++i){const u=arguments[i],c={start:s,complete:!1,anchor:u.anchor,duration:u.duration!==void 0?u.duration:1e3,easing:u.easing||rR,callback:n};if(u.center&&(c.sourceCenter=o,c.targetCenter=u.center.slice(),o=c.targetCenter),u.zoom!==void 0?(c.sourceResolution=a,c.targetResolution=this.getResolutionForZoom(u.zoom),a=c.targetResolution):u.resolution&&(c.sourceResolution=a,c.targetResolution=u.resolution,a=c.targetResolution),u.rotation!==void 0){c.sourceRotation=l;const f=an(u.rotation-l+Math.PI,2*Math.PI)-Math.PI;c.targetRotation=l+f,l=c.targetRotation}oR(c)?c.complete=!0:s+=c.duration,h.push(c)}this.animations_.push(h),this.setHint(ee.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[ee.ANIMATING]>0}getInteracting(){return this.hints_[ee.INTERACTING]>0}cancelAnimations(){this.setHint(ee.ANIMATING,-this.hints_[ee.ANIMATING]);let t;for(let e=0,n=this.animations_.length;e<n;++e){const i=this.animations_[e];if(i[0].callback&&rl(i[0].callback,!1),!t)for(let s=0,o=i.length;s<o;++s){const a=i[s];if(!a.complete){t=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let e=!1;for(let n=this.animations_.length-1;n>=0;--n){const i=this.animations_[n];let s=!0;for(let o=0,a=i.length;o<a;++o){const l=i[o];if(l.complete)continue;const h=t-l.start;let u=l.duration>0?h/l.duration:1;u>=1?(l.complete=!0,u=1):s=!1;const c=l.easing(u);if(l.sourceCenter){const f=l.sourceCenter[0],g=l.sourceCenter[1],m=l.targetCenter[0],_=l.targetCenter[1];this.nextCenter_=l.targetCenter;const x=f+c*(m-f),v=g+c*(_-g);this.targetCenter_=[x,v]}if(l.sourceResolution&&l.targetResolution){const f=c===1?l.targetResolution:l.sourceResolution+c*(l.targetResolution-l.sourceResolution);if(l.anchor){const g=this.getViewportSize_(this.getRotation()),m=this.constraints_.resolution(f,0,g,!0);this.targetCenter_=this.calculateCenterZoom(m,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=f,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){const f=c===1?an(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+c*(l.targetRotation-l.sourceRotation);if(l.anchor){const g=this.constraints_.rotation(f,!0);this.targetCenter_=this.calculateCenterRotate(g,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=f}if(this.applyTargetState_(!0),e=!0,!l.complete)break}if(s){this.animations_[n]=null,this.setHint(ee.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const o=i[0].callback;o&&rl(o,!0)}}this.animations_=this.animations_.filter(Boolean),e&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,e){let n;const i=this.getCenterInternal();return i!==void 0&&(n=[i[0]-e[0],i[1]-e[1]],ov(n,t-this.getRotation()),$m(n,e)),n}calculateCenterZoom(t,e){let n;const i=this.getCenterInternal(),s=this.getResolution();if(i!==void 0&&s!==void 0){const o=e[0]-t*(e[0]-i[0])/s,a=e[1]-t*(e[1]-i[1])/s;n=[o,a]}return n}getViewportSize_(t){const e=this.viewportSize_;if(t){const n=e[0],i=e[1];return[Math.abs(n*Math.cos(t))+Math.abs(i*Math.sin(t)),Math.abs(n*Math.sin(t))+Math.abs(i*Math.cos(t))]}return e}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const t=this.getCenterInternal();return t&&Yu(t,this.getProjection())}getCenterInternal(){return this.get(Fr.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return t!==void 0?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){const e=this.calculateExtentInternal(t);return fh(e,this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();const e=this.getCenterInternal();At(e,"The view center is not defined");const n=this.getResolution();At(n!==void 0,"The view resolution is not defined");const i=this.getRotation();return At(i!==void 0,"The view rotation is not defined"),Bc(e,n,i,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(Fr.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){return this.getResolutionForExtentInternal(Gr(t,this.getProjection()),e)}getResolutionForExtentInternal(t,e){e=e||this.getViewportSizeMinusPadding_();const n=yt(t)/e[0],i=Vt(t)/e[1];return Math.max(n,i)}getResolutionForValueFunction(t){t=t||2;const e=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,i=Math.log(e/n)/Math.log(t);return function(s){return e/Math.pow(t,s*i)}}getRotation(){return this.get(Fr.ROTATION)}getValueForResolutionFunction(t){const e=Math.log(t||2),n=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,s=Math.log(n/i)/e;return function(o){return Math.log(n/o)/e/s}}getViewportSizeMinusPadding_(t){let e=this.getViewportSize_(t);const n=this.padding_;return n&&(e=[e[0]-n[1]-n[3],e[1]-n[0]-n[2]]),e}getState(){const t=this.getProjection(),e=this.getResolution(),n=this.getRotation();let i=this.getCenterInternal();const s=this.padding_;if(s){const o=this.getViewportSizeMinusPadding_();i=_u(i,this.getViewportSize_(),[o[0]/2+s[3],o[1]/2+s[0]],e,n)}return{center:i.slice(0),projection:t!==void 0?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:n,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let t;const e=this.getResolution();return e!==void 0&&(t=this.getZoomForResolution(e)),t}getZoomForResolution(t){let e=this.minZoom_||0,n,i;if(this.resolutions_){const s=lh(this.resolutions_,t,1);e=s,n=this.resolutions_[s],s==this.resolutions_.length-1?i=2:i=n/this.resolutions_[s+1]}else n=this.maxResolution_,i=this.zoomFactor_;return e+Math.log(n/t)/Math.log(i)}getResolutionForZoom(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const e=wt(Math.floor(t),0,this.resolutions_.length-2),n=this.resolutions_[e]/this.resolutions_[e+1];return this.resolutions_[e]/Math.pow(n,wt(t-e,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){let n;if(At(Array.isArray(t)||typeof t.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(t)){At(!Un(t),"Cannot fit empty extent provided as `geometry`");const i=Gr(t,this.getProjection());n=yg(i)}else if(t.getType()==="Circle"){const i=Gr(t.getExtent(),this.getProjection());n=yg(i),n.rotate(this.getRotation(),Ce(i))}else n=t;this.fitInternal(n,e)}rotatedExtentForGeometry(t){const e=this.getRotation(),n=Math.cos(e),i=Math.sin(-e),s=t.getFlatCoordinates(),o=t.getStride();let a=1/0,l=1/0,h=-1/0,u=-1/0;for(let c=0,f=s.length;c<f;c+=o){const g=s[c]*n-s[c+1]*i,m=s[c]*i+s[c+1]*n;a=Math.min(a,g),l=Math.min(l,m),h=Math.max(h,g),u=Math.max(u,m)}return[a,l,h,u]}fitInternal(t,e){e=e||{};let n=e.size;n||(n=this.getViewportSizeMinusPadding_());const i=e.padding!==void 0?e.padding:[0,0,0,0],s=e.nearest!==void 0?e.nearest:!1;let o;e.minResolution!==void 0?o=e.minResolution:e.maxZoom!==void 0?o=this.getResolutionForZoom(e.maxZoom):o=0;const a=this.rotatedExtentForGeometry(t);let l=this.getResolutionForExtentInternal(a,[n[0]-i[1]-i[3],n[1]-i[0]-i[2]]);l=isNaN(l)?o:Math.max(l,o),l=this.getConstrainedResolution(l,s?0:1);const h=this.getRotation(),u=Math.sin(h),c=Math.cos(h),f=Ce(a);f[0]+=(i[1]-i[3])/2*l,f[1]+=(i[0]-i[2])/2*l;const g=f[0]*c-f[1]*u,m=f[1]*c+f[0]*u,_=this.getConstrainedCenter([g,m],l),x=e.callback?e.callback:$o;e.duration!==void 0?this.animateInternal({resolution:l,center:_,duration:e.duration,easing:e.easing},x):(this.targetResolution_=l,this.targetCenter_=_,this.applyTargetState_(!1,!0),rl(x,!0))}centerOn(t,e,n){this.centerOnInternal($n(t,this.getProjection()),e,n)}centerOnInternal(t,e,n){this.setCenterInternal(_u(t,e,n,this.getResolution(),this.getRotation()))}calculateCenterShift(t,e,n,i){let s;const o=this.padding_;if(o&&t){const a=this.getViewportSizeMinusPadding_(-n),l=_u(t,i,[a[0]/2+o[3],a[1]/2+o[0]],e,n);s=[t[0]-l[0],t[1]-l[1]]}return s}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(t){const e=Yu(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustCenterInternal(t){const e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){e=e&&$n(e,this.getProjection()),this.adjustResolutionInternal(t,e)}adjustResolutionInternal(t,e){const n=this.getAnimating()||this.getInteracting(),i=this.getViewportSize_(this.getRotation()),s=this.constraints_.resolution(this.targetResolution_*t,0,i,n);e&&(this.targetCenter_=this.calculateCenterZoom(s,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){e&&(e=$n(e,this.getProjection())),this.adjustRotationInternal(t,e)}adjustRotationInternal(t,e){const n=this.getAnimating()||this.getInteracting(),i=this.constraints_.rotation(this.targetRotation_+t,n);e&&(this.targetCenter_=this.calculateCenterRotate(i,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&$n(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){const n=this.getAnimating()||this.getInteracting()||e,i=this.constraints_.rotation(this.targetRotation_,n),s=this.getViewportSize_(i),o=this.constraints_.resolution(this.targetResolution_,0,s,n),a=this.constraints_.center(this.targetCenter_,o,s,n,this.calculateCenterShift(this.targetCenter_,o,i,s));this.get(Fr.ROTATION)!==i&&this.set(Fr.ROTATION,i),this.get(Fr.RESOLUTION)!==o&&(this.set(Fr.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(Fr.CENTER)||!Sl(this.get(Fr.CENTER),a))&&this.set(Fr.CENTER,a),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,e,n){t=t!==void 0?t:200;const i=e||0,s=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(s),a=this.constraints_.resolution(this.targetResolution_,i,o),l=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,s,o));if(t===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=s,this.targetCenter_=l,this.applyTargetState_();return}n=n||(t===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==s||!this.getCenterInternal()||!Sl(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:s,center:l,resolution:a,duration:t,easing:eR,anchor:n}))}beginInteraction(){this.resolveConstraints(0),this.setHint(ee.INTERACTING,1)}endInteraction(t,e,n){n=n&&$n(n,this.getProjection()),this.endInteractionInternal(t,e,n)}endInteractionInternal(t,e,n){this.getInteracting()&&(this.setHint(ee.INTERACTING,-1),this.resolveConstraints(t,e,n))}getConstrainedCenter(t,e){const n=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),n)}getConstrainedZoom(t,e){const n=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(n,e))}getConstrainedResolution(t,e){e=e||0;const n=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,n)}}function rl(r,t){setTimeout(function(){r(t)},0)}function nR(r){if(r.extent!==void 0){const e=r.smoothExtentConstraint!==void 0?r.smoothExtentConstraint:!0;return hp(r.extent,r.constrainOnlyCenter,e)}const t=$c(r.projection,"EPSG:3857");if(r.multiWorld!==!0&&t.isGlobal()){const e=t.getExtent().slice();return e[0]=-1/0,e[2]=1/0,hp(e,!1,!1)}return YM}function iR(r){let t,e,n,i=r.minZoom!==void 0?r.minZoom:mu,s=r.maxZoom!==void 0?r.maxZoom:28;const o=r.zoomFactor!==void 0?r.zoomFactor:2,a=r.multiWorld!==void 0?r.multiWorld:!1,l=r.smoothResolutionConstraint!==void 0?r.smoothResolutionConstraint:!0,h=r.showFullExtent!==void 0?r.showFullExtent:!1,u=$c(r.projection,"EPSG:3857"),c=u.getExtent();let f=r.constrainOnlyCenter,g=r.extent;if(!a&&!g&&u.isGlobal()&&(f=!1,g=c),r.resolutions!==void 0){const m=r.resolutions;e=m[i],n=m[s]!==void 0?m[s]:m[m.length-1],r.constrainResolution?t=HM(m,l,!f&&g,h):t=up(e,n,l,!f&&g,h)}else{const m=(c?Math.max(yt(c),Vt(c)):360*Wc.degrees/u.getMetersPerUnit())/zs/Math.pow(2,mu),_=m/Math.pow(2,28-mu);e=r.maxResolution,e!==void 0?i=0:e=m/Math.pow(o,i),n=r.minResolution,n===void 0&&(r.maxZoom!==void 0?r.maxResolution!==void 0?n=e/Math.pow(o,s):n=m/Math.pow(o,s):n=_),s=i+Math.floor(Math.log(e/n)/Math.log(o)),n=e/Math.pow(o,s-i),r.constrainResolution?t=KM(o,e,n,l,!f&&g,h):t=up(e,n,l,!f&&g,h)}return{constraint:t,maxResolution:e,minResolution:n,minZoom:i,zoomFactor:o}}function sR(r){if(r.enableRotation===void 0||r.enableRotation){const t=r.constrainRotation;return t===void 0||t===!0?tR():t===!1?cp:typeof t=="number"?JM(t):cp}return QM}function oR(r){return!(r.sourceCenter&&r.targetCenter&&!Sl(r.sourceCenter,r.targetCenter)||r.sourceResolution!==r.targetResolution||r.sourceRotation!==r.targetRotation)}function _u(r,t,e,n,i){const s=Math.cos(-i);let o=Math.sin(-i),a=r[0]*s-r[1]*o,l=r[1]*s+r[0]*o;a+=(t[0]/2-e[0])*n,l+=(e[1]-t[1]/2)*n,o=-o;const h=a*s-l*o,u=l*s+a*o;return[h,u]}class aR extends p_{constructor(t){const e=Object.assign({},t);delete e.source,super(e),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(Ut.SOURCE,this.handleSourcePropertyChange_);const n=t.source?t.source:null;this.setSource(n)}getLayersArray(t){return t=t||[],t.push(this),t}getLayerStatesArray(t){return t=t||[],t.push(this.getLayerState()),t}getSource(){return this.get(Ut.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(ve(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const t=this.getSource();t&&(this.sourceChangeKey_=le(t,Lt.CHANGE,this.handleSourceChange_,this),t.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):Promise.resolve([])}getData(t){return!this.renderer_||!this.rendered?null:this.renderer_.getData(t)}isVisible(t){let e;const n=this.getMapInternal();!t&&n&&(t=n.getView()),t instanceof dp?e={viewState:t.getState(),extent:t.calculateExtent()}:e=t,!e.layerStatesArray&&n&&(e.layerStatesArray=n.getLayerGroup().getLayerStatesArray());let i;e.layerStatesArray?i=e.layerStatesArray.find(o=>o.layer===this):i=this.getLayerState();const s=this.getExtent();return lR(i,e.viewState)&&(!s||Qt(s,e.extent))}getAttributions(t){if(!this.isVisible(t))return[];let e;const n=this.getSource();if(n&&(e=n.getAttributions()),!e)return[];const i=t instanceof dp?t.getViewStateAndExtent():t;let s=e(i);return Array.isArray(s)||(s=[s]),s}render(t,e){const n=this.getRenderer();return n.prepareFrame(t)?(this.rendered=!0,n.renderFrame(t,e)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(t,e){}renderDeferred(t){const e=this.getRenderer();e&&e.renderDeferred(t)}setMapInternal(t){t||this.unrender(),this.set(Ut.MAP,t)}getMapInternal(){return this.get(Ut.MAP)}setMap(t){this.mapPrecomposeKey_&&(ve(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(ve(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=le(t,ir.PRECOMPOSE,function(e){const n=e.frameState.layerStatesArray,i=this.getLayerState(!1);At(!n.some(function(s){return s.layer===i.layer}),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),n.push(i)},this),this.mapRenderKey_=le(this,Lt.CHANGE,t.render,t),this.changed())}setSource(t){this.set(Ut.SOURCE,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}}function lR(r,t){if(!r.visible)return!1;const e=t.resolution;if(e<r.minResolution||e>=r.maxResolution)return!1;const n=t.zoom;return n>r.minZoom&&n<=r.maxZoom}const Ia=aR;function hR(r,t,e,n,i){y_(r,t,e||0,n||r.length-1,i||uR)}function y_(r,t,e,n,i){for(;n>e;){if(n-e>600){var s=n-e+1,o=t-e+1,a=Math.log(s),l=.5*Math.exp(2*a/3),h=.5*Math.sqrt(a*l*(s-l)/s)*(o-s/2<0?-1:1),u=Math.max(e,Math.floor(t-o*l/s+h)),c=Math.min(n,Math.floor(t+(s-o)*l/s+h));y_(r,t,u,c,i)}var f=r[t],g=e,m=n;for(go(r,e,t),i(r[n],f)>0&&go(r,e,n);g<m;){for(go(r,g,m),g++,m--;i(r[g],f)<0;)g++;for(;i(r[m],f)>0;)m--}i(r[e],f)===0?go(r,e,m):(m++,go(r,m,n)),m<=t&&(e=m+1),t<=m&&(n=m-1)}}function go(r,t,e){var n=r[t];r[t]=r[e],r[e]=n}function uR(r,t){return r<t?-1:r>t?1:0}let kd=class{constructor(r=9){this._maxEntries=Math.max(4,r),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(r){let t=this.data;const e=[];if(!il(r,t))return e;const n=this.toBBox,i=[];for(;t;){for(let s=0;s<t.children.length;s++){const o=t.children[s],a=t.leaf?n(o):o;il(r,a)&&(t.leaf?e.push(o):xu(r,a)?this._all(o,e):i.push(o))}t=i.pop()}return e}collides(r){let t=this.data;if(!il(r,t))return!1;const e=[];for(;t;){for(let n=0;n<t.children.length;n++){const i=t.children[n],s=t.leaf?this.toBBox(i):i;if(il(r,s)){if(t.leaf||xu(r,s))return!0;e.push(i)}}t=e.pop()}return!1}load(r){if(!(r&&r.length))return this;if(r.length<this._minEntries){for(let e=0;e<r.length;e++)this.insert(r[e]);return this}let t=this._build(r.slice(),0,r.length-1,0);if(!this.data.children.length)this.data=t;else if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const e=this.data;this.data=t,t=e}this._insert(t,this.data.height-t.height-1,!0)}return this}insert(r){return r&&this._insert(r,this.data.height-1),this}clear(){return this.data=cs([]),this}remove(r,t){if(!r)return this;let e=this.data;const n=this.toBBox(r),i=[],s=[];let o,a,l;for(;e||i.length;){if(e||(e=i.pop(),a=i[i.length-1],o=s.pop(),l=!0),e.leaf){const h=cR(r,e.children,t);if(h!==-1)return e.children.splice(h,1),i.push(e),this._condense(i),this}!l&&!e.leaf&&xu(e,n)?(i.push(e),s.push(o),o=0,a=e,e=e.children[0]):a?(o++,e=a.children[o],l=!1):e=null}return this}toBBox(r){return r}compareMinX(r,t){return r.minX-t.minX}compareMinY(r,t){return r.minY-t.minY}toJSON(){return this.data}fromJSON(r){return this.data=r,this}_all(r,t){const e=[];for(;r;)r.leaf?t.push(...r.children):e.push(...r.children),r=e.pop();return t}_build(r,t,e,n){const i=e-t+1;let s=this._maxEntries,o;if(i<=s)return o=cs(r.slice(t,e+1)),es(o,this.toBBox),o;n||(n=Math.ceil(Math.log(i)/Math.log(s)),s=Math.ceil(i/Math.pow(s,n-1))),o=cs([]),o.leaf=!1,o.height=n;const a=Math.ceil(i/s),l=a*Math.ceil(Math.sqrt(s));fp(r,t,e,l,this.compareMinX);for(let h=t;h<=e;h+=l){const u=Math.min(h+l-1,e);fp(r,h,u,a,this.compareMinY);for(let c=h;c<=u;c+=a){const f=Math.min(c+a-1,u);o.children.push(this._build(r,c,f,n-1))}}return es(o,this.toBBox),o}_chooseSubtree(r,t,e,n){for(;n.push(t),!(t.leaf||n.length-1===e);){let i=1/0,s=1/0,o;for(let a=0;a<t.children.length;a++){const l=t.children[a],h=yu(l),u=gR(r,l)-h;u<s?(s=u,i=h<i?h:i,o=l):u===s&&h<i&&(i=h,o=l)}t=o||t.children[0]}return t}_insert(r,t,e){const n=e?r:this.toBBox(r),i=[],s=this._chooseSubtree(n,this.data,t,i);for(s.children.push(r),So(s,n);t>=0&&i[t].children.length>this._maxEntries;)this._split(i,t),t--;this._adjustParentBBoxes(n,i,t)}_split(r,t){const e=r[t],n=e.children.length,i=this._minEntries;this._chooseSplitAxis(e,i,n);const s=this._chooseSplitIndex(e,i,n),o=cs(e.children.splice(s,e.children.length-s));o.height=e.height,o.leaf=e.leaf,es(e,this.toBBox),es(o,this.toBBox),t?r[t-1].children.push(o):this._splitRoot(e,o)}_splitRoot(r,t){this.data=cs([r,t]),this.data.height=r.height+1,this.data.leaf=!1,es(this.data,this.toBBox)}_chooseSplitIndex(r,t,e){let n,i=1/0,s=1/0;for(let o=t;o<=e-t;o++){const a=bo(r,0,o,this.toBBox),l=bo(r,o,e,this.toBBox),h=pR(a,l),u=yu(a)+yu(l);h<i?(i=h,n=o,s=u<s?u:s):h===i&&u<s&&(s=u,n=o)}return n||e-t}_chooseSplitAxis(r,t,e){const n=r.leaf?this.compareMinX:dR,i=r.leaf?this.compareMinY:fR,s=this._allDistMargin(r,t,e,n),o=this._allDistMargin(r,t,e,i);s<o&&r.children.sort(n)}_allDistMargin(r,t,e,n){r.children.sort(n);const i=this.toBBox,s=bo(r,0,t,i),o=bo(r,e-t,e,i);let a=nl(s)+nl(o);for(let l=t;l<e-t;l++){const h=r.children[l];So(s,r.leaf?i(h):h),a+=nl(s)}for(let l=e-t-1;l>=t;l--){const h=r.children[l];So(o,r.leaf?i(h):h),a+=nl(o)}return a}_adjustParentBBoxes(r,t,e){for(let n=e;n>=0;n--)So(t[n],r)}_condense(r){for(let t=r.length-1,e;t>=0;t--)r[t].children.length===0?t>0?(e=r[t-1].children,e.splice(e.indexOf(r[t]),1)):this.clear():es(r[t],this.toBBox)}};function cR(r,t,e){if(!e)return t.indexOf(r);for(let n=0;n<t.length;n++)if(e(r,t[n]))return n;return-1}function es(r,t){bo(r,0,r.children.length,t,r)}function bo(r,t,e,n,i){i||(i=cs(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let s=t;s<e;s++){const o=r.children[s];So(i,r.leaf?n(o):o)}return i}function So(r,t){return r.minX=Math.min(r.minX,t.minX),r.minY=Math.min(r.minY,t.minY),r.maxX=Math.max(r.maxX,t.maxX),r.maxY=Math.max(r.maxY,t.maxY),r}function dR(r,t){return r.minX-t.minX}function fR(r,t){return r.minY-t.minY}function yu(r){return(r.maxX-r.minX)*(r.maxY-r.minY)}function nl(r){return r.maxX-r.minX+(r.maxY-r.minY)}function gR(r,t){return(Math.max(t.maxX,r.maxX)-Math.min(t.minX,r.minX))*(Math.max(t.maxY,r.maxY)-Math.min(t.minY,r.minY))}function pR(r,t){const e=Math.max(r.minX,t.minX),n=Math.max(r.minY,t.minY),i=Math.min(r.maxX,t.maxX),s=Math.min(r.maxY,t.maxY);return Math.max(0,i-e)*Math.max(0,s-n)}function xu(r,t){return r.minX<=t.minX&&r.minY<=t.minY&&t.maxX<=r.maxX&&t.maxY<=r.maxY}function il(r,t){return t.minX<=r.maxX&&t.minY<=r.maxY&&t.maxX>=r.minX&&t.maxY>=r.minY}function cs(r){return{children:r,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function fp(r,t,e,n,i){const s=[t,e];for(;s.length;){if(e=s.pop(),t=s.pop(),e-t<=n)continue;const o=t+Math.ceil((e-t)/n/2)*n;hR(r,o,t,e,i),s.push(t,o,o,e)}}let eo=0;const Yi=0,te=1<<eo++,Y=1<<eo++,xe=1<<eo++,Xt=1<<eo++,me=1<<eo++,Ne=Math.pow(2,eo)-1,x_={[te]:"boolean",[Y]:"number",[xe]:"string",[Xt]:"color",[me]:"number[]"},mR=Object.keys(x_).map(Number).sort(on);function be(r){const t=[];for(const e of mR)_R(r,e)&&t.push(x_[e]);return t.length===0?"untyped":t.length<3?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t[t.length-1]}function _R(r,t){return(r&t)===t}function jr(r,t){return!!(r&t)}function Pa(r,t){return r===t}class si{constructor(t,e){this.type=t,this.value=e}}class v_{constructor(t,e,...n){this.type=t,this.operator=e,this.args=n}}function Gd(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,style:{}}}function yR(r){switch(r){case"string":return xe;case"color":return Xt;case"number":return Y;case"boolean":return te;case"number[]":return me;default:throw new Error(`Unrecognized type hint: ${r}`)}}function Bt(r,t,e){switch(typeof r){case"boolean":return new si(te,r);case"number":return new si(Y,r);case"string":{let i=xe;return Ab(r)&&(i|=Xt),Pa(i&e,Yi)||(i&=e),new si(i,r)}}if(!Array.isArray(r))throw new Error("Expression must be an array or a primitive value");if(r.length===0)throw new Error("Empty expression");if(typeof r[0]=="string")return PR(r,t,e);for(const i of r)if(typeof i!="number")throw new Error("Expected an array of numbers");let n=me;return(r.length===3||r.length===4)&&(n|=Xt),e&&(n&=e),new si(n,r)}const z={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string"},xR={[z.Get]:vt(([r,t])=>t!==void 0?yR(t.value):Ne,Ct(1,2),vR),[z.Var]:vt(([r])=>r.type,Ct(1,1),wR),[z.Id]:vt(Y|xe,po,bR),[z.Concat]:vt(xe,Ct(2,1/0),Nt(Ne)),[z.GeometryType]:vt(xe,po,SR),[z.Resolution]:vt(Y,po),[z.Zoom]:vt(Y,po),[z.Time]:vt(Y,po),[z.Any]:vt(te,Ct(2,1/0),Nt(te)),[z.All]:vt(te,Ct(2,1/0),Nt(te)),[z.Not]:vt(te,Ct(1,1),Nt(te)),[z.Equal]:vt(te,Ct(2,2),Nt(Ne),Yn),[z.NotEqual]:vt(te,Ct(2,2),Nt(Ne),Yn),[z.GreaterThan]:vt(te,Ct(2,2),Nt(Ne),Yn),[z.GreaterThanOrEqualTo]:vt(te,Ct(2,2),Nt(Ne),Yn),[z.LessThan]:vt(te,Ct(2,2),Nt(Ne),Yn),[z.LessThanOrEqualTo]:vt(te,Ct(2,2),Nt(Ne),Yn),[z.Multiply]:vt(r=>{let t=Y|Xt;for(let e=0;e<r.length;e++)t&=r[e].type;return t},Ct(2,1/0),Nt(Y|Xt),Yn),[z.Coalesce]:vt(r=>{let t=Ne;for(let e=1;e<r.length;e+=2)t&=r[e].type;return t&=r[r.length-1].type,t},Ct(2,1/0),Nt(Ne),Yn),[z.Divide]:vt(Y,Ct(2,2),Nt(Y)),[z.Add]:vt(Y,Ct(2,1/0),Nt(Y)),[z.Subtract]:vt(Y,Ct(2,2),Nt(Y)),[z.Clamp]:vt(Y,Ct(3,3),Nt(Y)),[z.Mod]:vt(Y,Ct(2,2),Nt(Y)),[z.Pow]:vt(Y,Ct(2,2),Nt(Y)),[z.Abs]:vt(Y,Ct(1,1),Nt(Y)),[z.Floor]:vt(Y,Ct(1,1),Nt(Y)),[z.Ceil]:vt(Y,Ct(1,1),Nt(Y)),[z.Round]:vt(Y,Ct(1,1),Nt(Y)),[z.Sin]:vt(Y,Ct(1,1),Nt(Y)),[z.Cos]:vt(Y,Ct(1,1),Nt(Y)),[z.Atan]:vt(Y,Ct(1,2),Nt(Y)),[z.Sqrt]:vt(Y,Ct(1,1),Nt(Y)),[z.Match]:vt(r=>{let t=Ne;for(let e=2;e<r.length;e+=2)t&=r[e].type;return t&=r[r.length-1].type,t},Ct(4,1/0),gp,TR),[z.Between]:vt(te,Ct(3,3),Nt(Y)),[z.Interpolate]:vt(r=>{let t=Xt|Y;for(let e=3;e<r.length;e+=2)t&=r[e].type;return t},Ct(6,1/0),gp,MR),[z.Case]:vt(r=>{let t=Ne;for(let e=1;e<r.length;e+=2)t&=r[e].type;return t&=r[r.length-1].type,t},Ct(3,1/0),ER,RR),[z.In]:vt(te,Ct(2,2),CR),[z.Number]:vt(Y,Ct(1,1/0),Nt(Ne)),[z.String]:vt(xe,Ct(1,1/0),Nt(Ne)),[z.Array]:vt(r=>r.length===3||r.length===4?me|Xt:me,Ct(1,1/0),Nt(Y)),[z.Color]:vt(Xt,Ct(1,4),Nt(Y)),[z.Band]:vt(Y,Ct(1,3),Nt(Y)),[z.Palette]:vt(Xt,Ct(2,2),IR),[z.ToString]:vt(xe,Ct(1,1),Nt(te|Y|xe|Xt))};function vR(r,t){const e=Bt(r[1],t);if(!(e instanceof si))throw new Error("Expected a literal argument for get operation");if(typeof e.value!="string")throw new Error("Expected a string argument for get operation");if(t.properties.add(e.value),r.length===3){const n=Bt(r[2],t);return[e,n]}return[e]}function wR(r,t,e,n){const i=r[1];if(typeof i!="string")throw new Error("Expected a string argument for var operation");if(t.variables.add(i),!("variables"in t.style)||t.style.variables[i]===void 0)return[new si(Ne,i)];const s=t.style.variables[i],o=Bt(s,t);if(o.value=i,n&&!jr(n,o.type))throw new Error(`The variable ${i} has type ${be(o.type)} but the following type was expected: ${be(n)}`);return[o]}function bR(r,t){t.featureId=!0}function SR(r,t){t.geometryType=!0}function po(r,t){const e=r[0];if(r.length!==1)throw new Error(`Expected no arguments for ${e} operation`);return[]}function Ct(r,t){return function(e,n){const i=e[0],s=e.length-1;if(r===t){if(s!==r){const o=r===1?"":"s";throw new Error(`Expected ${r} argument${o} for ${i}, got ${s}`)}}else if(s<r||s>t){const o=t===1/0?`${r} or more`:`${r} to ${t}`;throw new Error(`Expected ${o} arguments for ${i}, got ${s}`)}}}function Nt(r){return function(t,e){const n=t[0],i=t.length-1,s=new Array(i);for(let o=0;o<i;++o){const a=Bt(t[o+1],e);if(!jr(r,a.type)){const l=be(r),h=be(a.type);throw new Error(`Unexpected type for argument ${o} of ${n} operation, got ${l} but expected ${h}`)}a.type&=r,s[o]=a}return s}}function Yn(r,t,e){const n=r[0],i=r.length-1;let s=Ne;for(let a=0;a<e.length;++a)s&=e[a].type;if(s===Yi)throw new Error(`No common type could be found for arguments of ${n} operation`);const o=new Array(i);for(let a=0;a<i;++a)o[a]=Bt(r[a+1],t,s);return o}function ER(r,t){const e=r[0],n=r.length-1;if(n%2===0)throw new Error(`An odd amount of arguments was expected for operation ${e}, got ${JSON.stringify(n)} instead`)}function gp(r,t){const e=r[0],n=r.length-1;if(n%2===1)throw new Error(`An even amount of arguments was expected for operation ${e}, got ${JSON.stringify(n)} instead`)}function TR(r,t,e,n){const i=r.length-1;let s=Bt(r[1],t).type;const o=Bt(r[r.length-1],t);let a=n!==void 0?n&o.type:o.type;const l=new Array(i-2);for(let u=0;u<i-2;u+=2){const c=Bt(r[u+2],t),f=Bt(r[u+3],t);s&=c.type,a&=f.type,l[u]=c,l[u+1]=f}const h=xe|Y|te;if(!jr(h,s))throw new Error(`Expected an input of type ${be(h)} for the interpolate operation, got ${be(s)} instead`);if(Pa(a,Yi))throw new Error("Could not find a common output type for the following match operation: "+JSON.stringify(r));for(let u=0;u<i-2;u+=2){const c=Bt(r[u+2],t,s),f=Bt(r[u+3],t,a);l[u]=c,l[u+1]=f}return[Bt(r[1],t,s),...l,Bt(r[r.length-1],t,a)]}function MR(r,t,e,n){const i=r[1];let s;switch(i[0]){case"linear":s=1;break;case"exponential":if(s=i[1],typeof s!="number")throw new Error(`Expected a number base for exponential interpolation, got ${JSON.stringify(s)} instead`);break;default:s=null}if(!s)throw new Error(`Invalid interpolation type: ${JSON.stringify(i)}`);s=Bt(s,t);let o=Bt(r[2],t);if(!jr(Y,o.type))throw new Error(`Expected an input of type number for the interpolate operation, got ${be(o.type)} instead`);o=Bt(r[2],t,Y);const a=new Array(r.length-3);for(let l=0;l<a.length;l+=2){let h=Bt(r[l+3],t);if(!jr(Y,h.type))throw new Error(`Expected all stop input values in the interpolate operation to be of type number, got ${be(h.type)} at position ${l+2} instead`);let u=Bt(r[l+4],t);if(!jr(Y|Xt,u.type))throw new Error(`Expected all stop output values in the interpolate operation to be a number or color, got ${be(u.type)} at position ${l+3} instead`);h=Bt(r[l+3],t,Y),u=Bt(r[l+4],t,Y|Xt),a[l]=h,a[l+1]=u}return[s,o,...a]}function RR(r,t,e,n){const i=Bt(r[r.length-1],t);let s=n!==void 0?n&i.type:i.type;const o=new Array(r.length-1);for(let a=0;a<o.length-1;a+=2){const l=Bt(r[a+1],t),h=Bt(r[a+2],t);if(!jr(te,l.type))throw new Error(`Expected all conditions in the case operation to be of type boolean, got ${be(l.type)} at position ${a} instead`);s&=h.type,o[a]=l,o[a+1]=h}if(Pa(s,Yi))throw new Error("Could not find a common output type for the following case operation: "+JSON.stringify(r));for(let a=0;a<o.length-1;a+=2)o[a+1]=Bt(r[a+2],t,s);return o[o.length-1]=Bt(r[r.length-1],t,s),o}function CR(r,t){let e=r[2];if(!Array.isArray(e))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');if(typeof e[0]=="string"){if(e[0]!=="literal")throw new Error('For the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions.');if(!Array.isArray(e[1]))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');e=e[1]}let n=xe|Y;const i=new Array(e.length);for(let s=0;s<i.length;s++){const o=Bt(e[s],t);n&=o.type,i[s]=o}if(Pa(n,Yi))throw new Error("Could not find a common type for the following in operation: "+JSON.stringify(r));return[Bt(r[1],t,n),...i]}function IR(r,t){const e=Bt(r[1],t,Y);if(e.type!==Y)throw new Error(`The first argument of palette must be an number, got ${be(e.type)} instead`);const n=r[2];if(!Array.isArray(n))throw new Error("The second argument of palette must be an array");const i=new Array(n.length);for(let s=0;s<i.length;s++){const o=Bt(n[s],t,Xt);if(!(o instanceof si))throw new Error(`The palette color at index ${s} must be a literal value`);if(!jr(o.type,Xt))throw new Error(`The palette color at index ${s} should be of type color, got ${be(o.type)} instead`);i[s]=o}return[e,...i]}function vt(r,...t){return function(e,n,i){const s=e[0];let o=[];for(let l=0;l<t.length;l++)o=t[l](e,n,o,i)||o;let a=typeof r=="function"?r(o):r;if(i!==void 0){if(!jr(a,i))throw new Error(`The following expression was expected to return ${be(i)}, but returns ${be(a)} instead: ${JSON.stringify(e)}`);a&=i}if(a===Yi)throw new Error(`No matching type was found for the following expression: ${JSON.stringify(e)}`);return new v_(a,s,...o)}}function PR(r,t,e){const n=r[0],i=xR[n];if(!i)throw new Error(`Unknown operator: ${n}`);return i(r,t,e)}function jd(r){if(!r)return"";const t=r.getType();switch(t){case"Point":case"LineString":case"Polygon":return t;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return t.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return jd(r.getGeometries()[0]);default:return""}}function w_(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function Xn(r,t,e){const n=Bt(r,e);if(!jr(t,n.type)){const i=be(t),s=be(n.type);throw new Error(`Expected expression to be of type ${i}, got ${s}`)}return qr(n)}function qr(r,t){if(r instanceof si){if(r.type===Xt&&typeof r.value=="string"){const n=pd(r.value);return function(){return n}}return function(){return r.value}}const e=r.operator;switch(e){case z.Number:case z.String:case z.Coalesce:return AR(r);case z.Get:case z.Var:return LR(r);case z.Id:return n=>n.featureId;case z.GeometryType:return n=>n.geometryType;case z.Concat:{const n=r.args.map(i=>qr(i));return i=>"".concat(...n.map(s=>s(i).toString()))}case z.Resolution:return n=>n.resolution;case z.Any:case z.All:case z.Between:case z.In:case z.Not:return FR(r);case z.Equal:case z.NotEqual:case z.LessThan:case z.LessThanOrEqualTo:case z.GreaterThan:case z.GreaterThanOrEqualTo:return OR(r);case z.Multiply:case z.Divide:case z.Add:case z.Subtract:case z.Clamp:case z.Mod:case z.Pow:case z.Abs:case z.Floor:case z.Ceil:case z.Round:case z.Sin:case z.Cos:case z.Atan:case z.Sqrt:return NR(r);case z.Case:return DR(r);case z.Match:return kR(r);case z.Interpolate:return GR(r);case z.ToString:return jR(r);default:throw new Error(`Unsupported operator ${e}`)}}function AR(r,t){const e=r.operator,n=r.args.length,i=new Array(n);for(let s=0;s<n;++s)i[s]=qr(r.args[s]);switch(e){case z.Coalesce:return s=>{for(let o=0;o<n;++o){const a=i[o](s);if(typeof a<"u"&&a!==null)return a}throw new Error("Expected one of the values to be non-null")};case z.Number:case z.String:return s=>{for(let o=0;o<n;++o){const a=i[o](s);if(typeof a===e)return a}throw new Error(`Expected one of the values to be a ${e}`)};default:throw new Error(`Unsupported assertion operator ${e}`)}}function LR(r,t){const e=r.args[0].value;switch(r.operator){case z.Get:return n=>n.properties[e];case z.Var:return n=>n.variables[e];default:throw new Error(`Unsupported accessor operator ${r.operator}`)}}function OR(r,t){const e=r.operator,n=qr(r.args[0]),i=qr(r.args[1]);switch(e){case z.Equal:return s=>n(s)===i(s);case z.NotEqual:return s=>n(s)!==i(s);case z.LessThan:return s=>n(s)<i(s);case z.LessThanOrEqualTo:return s=>n(s)<=i(s);case z.GreaterThan:return s=>n(s)>i(s);case z.GreaterThanOrEqualTo:return s=>n(s)>=i(s);default:throw new Error(`Unsupported comparison operator ${e}`)}}function FR(r,t){const e=r.operator,n=r.args.length,i=new Array(n);for(let s=0;s<n;++s)i[s]=qr(r.args[s]);switch(e){case z.Any:return s=>{for(let o=0;o<n;++o)if(i[o](s))return!0;return!1};case z.All:return s=>{for(let o=0;o<n;++o)if(!i[o](s))return!1;return!0};case z.Between:return s=>{const o=i[0](s),a=i[1](s),l=i[2](s);return o>=a&&o<=l};case z.In:return s=>{const o=i[0](s);for(let a=1;a<n;++a)if(o===i[a](s))return!0;return!1};case z.Not:return s=>!i[0](s);default:throw new Error(`Unsupported logical operator ${e}`)}}function NR(r,t){const e=r.operator,n=r.args.length,i=new Array(n);for(let s=0;s<n;++s)i[s]=qr(r.args[s]);switch(e){case z.Multiply:return s=>{let o=1;for(let a=0;a<n;++a)o*=i[a](s);return o};case z.Divide:return s=>i[0](s)/i[1](s);case z.Add:return s=>{let o=0;for(let a=0;a<n;++a)o+=i[a](s);return o};case z.Subtract:return s=>i[0](s)-i[1](s);case z.Clamp:return s=>{const o=i[0](s),a=i[1](s);if(o<a)return a;const l=i[2](s);return o>l?l:o};case z.Mod:return s=>i[0](s)%i[1](s);case z.Pow:return s=>Math.pow(i[0](s),i[1](s));case z.Abs:return s=>Math.abs(i[0](s));case z.Floor:return s=>Math.floor(i[0](s));case z.Ceil:return s=>Math.ceil(i[0](s));case z.Round:return s=>Math.round(i[0](s));case z.Sin:return s=>Math.sin(i[0](s));case z.Cos:return s=>Math.cos(i[0](s));case z.Atan:return n===2?s=>Math.atan2(i[0](s),i[1](s)):s=>Math.atan(i[0](s));case z.Sqrt:return s=>Math.sqrt(i[0](s));default:throw new Error(`Unsupported numeric operator ${e}`)}}function DR(r,t){const e=r.args.length,n=new Array(e);for(let i=0;i<e;++i)n[i]=qr(r.args[i]);return i=>{for(let s=0;s<e-1;s+=2)if(n[s](i))return n[s+1](i);return n[e-1](i)}}function kR(r,t){const e=r.args.length,n=new Array(e);for(let i=0;i<e;++i)n[i]=qr(r.args[i]);return i=>{const s=n[0](i);for(let o=1;o<e;o+=2)if(s===n[o](i))return n[o+1](i);return n[e-1](i)}}function GR(r,t){const e=r.args.length,n=new Array(e);for(let i=0;i<e;++i)n[i]=qr(r.args[i]);return i=>{const s=n[0](i),o=n[1](i);let a,l;for(let h=2;h<e;h+=2){const u=n[h](i);let c=n[h+1](i);const f=Array.isArray(c);if(f&&(c=Ib(c)),u>=o)return h===2?c:f?zR(s,o,a,l,u,c):Eo(s,o,a,l,u,c);a=u,l=c}return l}}function jR(r,t){const e=r.operator,n=r.args.length,i=new Array(n);for(let s=0;s<n;++s)i[s]=qr(r.args[s]);switch(e){case z.ToString:return s=>{const o=i[0](s);return r.args[0].type===Xt?md(o):o.toString()};default:throw new Error(`Unsupported convert operator ${e}`)}}function Eo(r,t,e,n,i,s){const o=i-e;if(o===0)return n;const a=t-e,l=r===1?a/o:(Math.pow(r,a)-1)/(Math.pow(r,o)-1);return n+l*(s-n)}function zR(r,t,e,n,i,s){if(i-e===0)return n;const o=Tg(n),a=Tg(s);let l=a[2]-o[2];l>180?l-=360:l<-180&&(l+=360);const h=[Eo(r,t,e,o[0],i,a[0]),Eo(r,t,e,o[1],i,a[1]),o[2]+Eo(r,t,e,0,i,l),Eo(r,t,e,n[3],i,s[3])];return w0(Pb(h))}function UR(r){return!0}function BR(r){const t=Gd(),e=XR(r,t),n=w_();return function(i,s){if(n.properties=i.getPropertiesInternal(),n.resolution=s,t.featureId){const o=i.getId();o!==void 0?n.featureId=o:n.featureId=null}return t.geometryType&&(n.geometryType=jd(i.getGeometry())),e(n)}}function pp(r){const t=Gd(),e=r.length,n=new Array(e);for(let o=0;o<e;++o)n[o]=dc(r[o],t);const i=w_(),s=new Array(e);return function(o,a){if(i.properties=o.getPropertiesInternal(),i.resolution=a,t.featureId){const h=o.getId();h!==void 0?i.featureId=h:i.featureId=null}let l=0;for(let h=0;h<e;++h){const u=n[h](i);u&&(s[l]=u,l+=1)}return s.length=l,s}}function XR(r,t){const e=r.length,n=new Array(e);for(let i=0;i<e;++i){const s=r[i],o="filter"in s?Xn(s.filter,te,t):UR;let a;if(Array.isArray(s.style)){const l=s.style.length;a=new Array(l);for(let h=0;h<l;++h)a[h]=dc(s.style[h],t)}else a=[dc(s.style,t)];n[i]={filter:o,styles:a}}return function(i){const s=[];let o=!1;for(let a=0;a<e;++a){const l=n[a].filter;if(l(i)&&!(r[a].else&&o)){o=!0;for(const h of n[a].styles){const u=h(i);u&&s.push(u)}}}return s}}function dc(r,t){const e=ra(r,"",t),n=na(r,"",t),i=WR(r,t),s=qR(r,t),o=or(r,"z-index",t);if(!e&&!n&&!i&&!s&&!Fn(r))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(r));const a=new Ve;return function(l){let h=!0;if(e){const u=e(l);u&&(h=!1),a.setFill(u)}if(n){const u=n(l);u&&(h=!1),a.setStroke(u)}if(i){const u=i(l);u&&(h=!1),a.setText(u)}if(s){const u=s(l);u&&(h=!1),a.setImage(u)}return o&&a.setZIndex(o(l)),h?null:a}}function ra(r,t,e){let n;if(t+"fill-pattern-src"in r?n=YR(r,t+"fill-",e):n=zd(r,t+"fill-color",e),!n)return null;const i=new Wr;return function(s){const o=n(s);return o==="none"?null:(i.setColor(o),i)}}function na(r,t,e){const n=or(r,t+"stroke-width",e),i=zd(r,t+"stroke-color",e);if(!n&&!i)return null;const s=Tn(r,t+"stroke-line-cap",e),o=Tn(r,t+"stroke-line-join",e),a=b_(r,t+"stroke-line-dash",e),l=or(r,t+"stroke-line-dash-offset",e),h=or(r,t+"stroke-miter-limit",e),u=new un;return function(c){if(i){const f=i(c);if(f==="none")return null;u.setColor(f)}if(n&&u.setWidth(n(c)),s){const f=s(c);if(f!=="butt"&&f!=="round"&&f!=="square")throw new Error("Expected butt, round, or square line cap");u.setLineCap(f)}if(o){const f=o(c);if(f!=="bevel"&&f!=="round"&&f!=="miter")throw new Error("Expected bevel, round, or miter line join");u.setLineJoin(f)}return a&&u.setLineDash(a(c)),l&&u.setLineDashOffset(l(c)),h&&u.setMiterLimit(h(c)),u}}function WR(r,t){const e="text-",n=Tn(r,e+"value",t);if(!n)return null;const i=ra(r,e,t),s=ra(r,e+"background-",t),o=na(r,e,t),a=na(r,e+"background-",t),l=Tn(r,e+"font",t),h=or(r,e+"max-angle",t),u=or(r,e+"offset-x",t),c=or(r,e+"offset-y",t),f=ia(r,e+"overflow",t),g=Tn(r,e+"placement",t),m=or(r,e+"repeat",t),_=Lh(r,e+"scale",t),x=ia(r,e+"rotate-with-view",t),v=or(r,e+"rotation",t),w=Tn(r,e+"align",t),S=Tn(r,e+"justify",t),E=Tn(r,e+"baseline",t),T=b_(r,e+"padding",t),R=Oh(r,e+"declutter-mode"),C=new ji({declutterMode:R});return function(I){if(C.setText(n(I)),i&&C.setFill(i(I)),s&&C.setBackgroundFill(s(I)),o&&C.setStroke(o(I)),a&&C.setBackgroundStroke(a(I)),l&&C.setFont(l(I)),h&&C.setMaxAngle(h(I)),u&&C.setOffsetX(u(I)),c&&C.setOffsetY(c(I)),f&&C.setOverflow(f(I)),g){const F=g(I);if(F!=="point"&&F!=="line")throw new Error("Expected point or line for text-placement");C.setPlacement(F)}if(m&&C.setRepeat(m(I)),_&&C.setScale(_(I)),x&&C.setRotateWithView(x(I)),v&&C.setRotation(v(I)),w){const F=w(I);if(F!=="left"&&F!=="center"&&F!=="right"&&F!=="end"&&F!=="start")throw new Error("Expected left, right, center, start, or end for text-align");C.setTextAlign(F)}if(S){const F=S(I);if(F!=="left"&&F!=="right"&&F!=="center")throw new Error("Expected left, right, or center for text-justify");C.setJustify(F)}if(E){const F=E(I);if(F!=="bottom"&&F!=="top"&&F!=="middle"&&F!=="alphabetic"&&F!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");C.setTextBaseline(F)}return T&&C.setPadding(T(I)),C}}function qR(r,t){return"icon-src"in r?ZR(r,t):"shape-points"in r?$R(r,t):"circle-radius"in r?VR(r,t):null}function ZR(r,t){const e="icon-",n=e+"src",i=S_(r[n],n),s=kl(r,e+"anchor",t),o=Lh(r,e+"scale",t),a=or(r,e+"opacity",t),l=kl(r,e+"displacement",t),h=or(r,e+"rotation",t),u=ia(r,e+"rotate-with-view",t),c=_p(r,e+"anchor-origin"),f=yp(r,e+"anchor-x-units"),g=yp(r,e+"anchor-y-units"),m=JR(r,e+"color"),_=KR(r,e+"cross-origin"),x=QR(r,e+"offset"),v=_p(r,e+"offset-origin"),w=Gl(r,e+"width"),S=Gl(r,e+"height"),E=HR(r,e+"size"),T=Oh(r,e+"declutter-mode"),R=new bh({src:i,anchorOrigin:c,anchorXUnits:f,anchorYUnits:g,color:m,crossOrigin:_,offset:x,offsetOrigin:v,height:S,width:w,size:E,declutterMode:T});return function(C){return a&&R.setOpacity(a(C)),l&&R.setDisplacement(l(C)),h&&R.setRotation(h(C)),u&&R.setRotateWithView(u(C)),o&&R.setScale(o(C)),s&&R.setAnchor(s(C)),R}}function $R(r,t){const e="shape-",n=e+"points",i=e+"radius",s=fc(r[n],n),o=fc(r[i],i),a=ra(r,e,t),l=na(r,e,t),h=Lh(r,e+"scale",t),u=kl(r,e+"displacement",t),c=or(r,e+"rotation",t),f=ia(r,e+"rotate-with-view",t),g=Gl(r,e+"radius2"),m=Gl(r,e+"angle"),_=Oh(r,e+"declutter-mode"),x=new Sh({points:s,radius:o,radius2:g,angle:m,declutterMode:_});return function(v){return a&&x.setFill(a(v)),l&&x.setStroke(l(v)),u&&x.setDisplacement(u(v)),c&&x.setRotation(c(v)),f&&x.setRotateWithView(f(v)),h&&x.setScale(h(v)),x}}function VR(r,t){const e="circle-",n=ra(r,e,t),i=na(r,e,t),s=or(r,e+"radius",t),o=Lh(r,e+"scale",t),a=kl(r,e+"displacement",t),l=or(r,e+"rotation",t),h=ia(r,e+"rotate-with-view",t),u=Oh(r,e+"declutter-mode"),c=new Eh({radius:5,declutterMode:u});return function(f){return s&&c.setRadius(s(f)),n&&c.setFill(n(f)),i&&c.setStroke(i(f)),a&&c.setDisplacement(a(f)),l&&c.setRotation(l(f)),h&&c.setRotateWithView(h(f)),o&&c.setScale(o(f)),c}}function or(r,t,e){if(!(t in r))return;const n=Xn(r[t],Y,e);return function(i){return fc(n(i),t)}}function Tn(r,t,e){if(!(t in r))return null;const n=Xn(r[t],xe,e);return function(i){return S_(n(i),t)}}function YR(r,t,e){const n=Tn(r,t+"pattern-src",e),i=mp(r,t+"pattern-offset",e),s=mp(r,t+"pattern-size",e),o=zd(r,t+"color",e);return function(a){return{src:n(a),offset:i&&i(a),size:s&&s(a),color:o&&o(a)}}}function ia(r,t,e){if(!(t in r))return null;const n=Xn(r[t],te,e);return function(i){const s=n(i);if(typeof s!="boolean")throw new Error(`Expected a boolean for ${t}`);return s}}function zd(r,t,e){if(!(t in r))return null;const n=Xn(r[t],Xt|xe,e);return function(i){return E_(n(i),t)}}function b_(r,t,e){if(!(t in r))return null;const n=Xn(r[t],me,e);return function(i){return Aa(n(i),t)}}function kl(r,t,e){if(!(t in r))return null;const n=Xn(r[t],me,e);return function(i){const s=Aa(n(i),t);if(s.length!==2)throw new Error(`Expected two numbers for ${t}`);return s}}function mp(r,t,e){if(!(t in r))return null;const n=Xn(r[t],me,e);return function(i){return T_(n(i),t)}}function Lh(r,t,e){if(!(t in r))return null;const n=Xn(r[t],me|Y,e);return function(i){return tC(n(i),t)}}function Gl(r,t){const e=r[t];if(e!==void 0){if(typeof e!="number")throw new Error(`Expected a number for ${t}`);return e}}function HR(r,t){const e=r[t];if(e!==void 0){if(typeof e=="number")return ie(e);if(!Array.isArray(e))throw new Error(`Expected a number or size array for ${t}`);if(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number")throw new Error(`Expected a number or size array for ${t}`);return e}}function KR(r,t){const e=r[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);return e}}function _p(r,t){const e=r[t];if(e!==void 0){if(e!=="bottom-left"&&e!=="bottom-right"&&e!=="top-left"&&e!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${t}`);return e}}function yp(r,t){const e=r[t];if(e!==void 0){if(e!=="pixels"&&e!=="fraction")throw new Error(`Expected pixels or fraction for ${t}`);return e}}function QR(r,t){const e=r[t];if(e!==void 0)return Aa(e,t)}function Oh(r,t){const e=r[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);if(e!=="declutter"&&e!=="obstacle"&&e!=="none")throw new Error(`Expected declutter, obstacle, or none for ${t}`);return e}}function JR(r,t){const e=r[t];if(e!==void 0)return E_(e,t)}function Aa(r,t){if(!Array.isArray(r))throw new Error(`Expected an array for ${t}`);const e=r.length;for(let n=0;n<e;++n)if(typeof r[n]!="number")throw new Error(`Expected an array of numbers for ${t}`);return r}function S_(r,t){if(typeof r!="string")throw new Error(`Expected a string for ${t}`);return r}function fc(r,t){if(typeof r!="number")throw new Error(`Expected a number for ${t}`);return r}function E_(r,t){if(typeof r=="string")return r;const e=Aa(r,t),n=e.length;if(n<3||n>4)throw new Error(`Expected a color with 3 or 4 values for ${t}`);return e}function T_(r,t){const e=Aa(r,t);if(e.length!==2)throw new Error(`Expected an array of two numbers for ${t}`);return e}function tC(r,t){return typeof r=="number"?r:T_(r,t)}const xp={RENDER_ORDER:"renderOrder"};class La extends Ia{constructor(t){t=t||{};const e=Object.assign({},t);delete e.style,delete e.renderBuffer,delete e.updateWhileAnimating,delete e.updateWhileInteracting,super(e),this.declutter_=t.declutter?String(t.declutter):void 0,this.renderBuffer_=t.renderBuffer!==void 0?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=t.updateWhileAnimating!==void 0?t.updateWhileAnimating:!1,this.updateWhileInteracting_=t.updateWhileInteracting!==void 0?t.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(xp.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t,e){const n=this.getDeclutter();n in t.declutter||(t.declutter[n]=new kd(9)),this.getRenderer().renderDeclutter(t,e)}setRenderOrder(t){this.set(xp.RENDER_ORDER,t)}setStyle(t){this.style_=eC(t),this.styleFunction_=t===null?void 0:Zb(this.style_),this.changed()}}function eC(r){if(r===void 0)return $b;if(!r)return null;if(typeof r=="function"||r instanceof Ve)return r;if(!Array.isArray(r))return pp([r]);if(r.length===0)return[];const t=r.length,e=r[0];if(e instanceof Ve){const n=new Array(t);for(let i=0;i<t;++i){const s=r[i];if(!(s instanceof Ve))throw new Error("Expected a list of style instances");n[i]=s}return n}if("style"in e){const n=new Array(t);for(let i=0;i<t;++i){const s=r[i];if(!("style"in s))throw new Error("Expected a list of rules with a style property");n[i]=s}return BR(n)}return pp(r)}const ct={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},sl=[ct.FILL],oi=[ct.STROKE],Ii=[ct.BEGIN_PATH],vp=[ct.CLOSE_PATH];class M_{drawCustom(t,e,n,i,s){}drawGeometry(t){}setStyle(t){}drawCircle(t,e,n){}drawFeature(t,e,n){}drawGeometryCollection(t,e,n){}drawLineString(t,e,n){}drawMultiLineString(t,e,n){}drawMultiPoint(t,e,n){}drawMultiPolygon(t,e,n){}drawPoint(t,e,n){}drawPolygon(t,e,n){}drawText(t,e,n){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}}class Oa extends M_{constructor(t,e,n,i){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=i,this.maxLineWidth=0,this.resolution=n,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const e=this.pixelRatio;return e==1?t:t.map(function(n){return n*e})}appendFlatPointCoordinates(t,e){const n=this.getBufferedMaxExtent(),i=this.tmpCoordinate_,s=this.coordinates;let o=s.length;for(let a=0,l=t.length;a<l;a+=e)i[0]=t[a],i[1]=t[a+1],xr(n,i)&&(s[o++]=i[0],s[o++]=i[1]);return o}appendFlatLineCoordinates(t,e,n,i,s,o){const a=this.coordinates;let l=a.length;const h=this.getBufferedMaxExtent();o&&(e+=i);let u=t[e],c=t[e+1];const f=this.tmpCoordinate_;let g=!0,m,_,x;for(m=e+i;m<n;m+=i)f[0]=t[m],f[1]=t[m+1],x=Wu(h,f),x!==_?(g&&(a[l++]=u,a[l++]=c,g=!1),a[l++]=f[0],a[l++]=f[1]):x===Me.INTERSECTING?(a[l++]=f[0],a[l++]=f[1],g=!1):g=!0,u=f[0],c=f[1],_=x;return(s&&g||m===e+i)&&(a[l++]=u,a[l++]=c),l}drawCustomCoordinates_(t,e,n,i,s){for(let o=0,a=n.length;o<a;++o){const l=n[o],h=this.appendFlatLineCoordinates(t,e,l,i,!1,!1);s.push(h),e=l}return e}drawCustom(t,e,n,i,s){this.beginGeometry(t,e,s);const o=t.getType(),a=t.getStride(),l=this.coordinates.length;let h,u,c,f,g;switch(o){case"MultiPolygon":h=t.getOrientedFlatCoordinates(),f=[];const m=t.getEndss();g=0;for(let _=0,x=m.length;_<x;++_){const v=[];g=this.drawCustomCoordinates_(h,g,m[_],a,v),f.push(v)}this.instructions.push([ct.CUSTOM,l,f,t,n,Ku,s]),this.hitDetectionInstructions.push([ct.CUSTOM,l,f,t,i||n,Ku,s]);break;case"Polygon":case"MultiLineString":c=[],h=o=="Polygon"?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),g=this.drawCustomCoordinates_(h,0,t.getEnds(),a,c),this.instructions.push([ct.CUSTOM,l,c,t,n,Ho,s]),this.hitDetectionInstructions.push([ct.CUSTOM,l,c,t,i||n,Ho,s]);break;case"LineString":case"Circle":h=t.getFlatCoordinates(),u=this.appendFlatLineCoordinates(h,0,h.length,a,!1,!1),this.instructions.push([ct.CUSTOM,l,u,t,n,Rn,s]),this.hitDetectionInstructions.push([ct.CUSTOM,l,u,t,i||n,Rn,s]);break;case"MultiPoint":h=t.getFlatCoordinates(),u=this.appendFlatPointCoordinates(h,a),u>l&&(this.instructions.push([ct.CUSTOM,l,u,t,n,Rn,s]),this.hitDetectionInstructions.push([ct.CUSTOM,l,u,t,i||n,Rn,s]));break;case"Point":h=t.getFlatCoordinates(),this.coordinates.push(h[0],h[1]),u=this.coordinates.length,this.instructions.push([ct.CUSTOM,l,u,t,n,void 0,s]),this.hitDetectionInstructions.push([ct.CUSTOM,l,u,t,i||n,void 0,s]);break}this.endGeometry(e)}beginGeometry(t,e,n){this.beginGeometryInstruction1_=[ct.BEGIN_GEOMETRY,e,0,t,n],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[ct.BEGIN_GEOMETRY,e,0,t,n],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;t.reverse();let e;const n=t.length;let i,s,o=-1;for(e=0;e<n;++e)i=t[e],s=i[0],s==ct.END_GEOMETRY?o=e:s==ct.BEGIN_GEOMETRY&&(i[2]=e,Ox(this.hitDetectionInstructions,o,e),o=-1)}setFillStrokeStyle(t,e){const n=this.state;if(t){const i=t.getColor();n.fillPatternScale=i&&typeof i=="object"&&"src"in i?this.pixelRatio:1,n.fillStyle=rn(i||nr)}else n.fillStyle=void 0;if(e){const i=e.getColor();n.strokeStyle=rn(i||Jo);const s=e.getLineCap();n.lineCap=s!==void 0?s:Gs;const o=e.getLineDash();n.lineDash=o?o.slice():An;const a=e.getLineDashOffset();n.lineDashOffset=a||Ln;const l=e.getLineJoin();n.lineJoin=l!==void 0?l:js;const h=e.getWidth();n.lineWidth=h!==void 0?h:ea;const u=e.getMiterLimit();n.miterLimit=u!==void 0?u:Qo,n.lineWidth>this.maxLineWidth&&(this.maxLineWidth=n.lineWidth,this.bufferedMaxExtent_=null)}else n.strokeStyle=void 0,n.lineCap=void 0,n.lineDash=null,n.lineDashOffset=void 0,n.lineJoin=void 0,n.lineWidth=void 0,n.miterLimit=void 0}createFill(t){const e=t.fillStyle,n=[ct.SET_FILL_STYLE,e];return typeof e!="string"&&n.push(t.fillPatternScale),n}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[ct.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){const n=t.fillStyle;(typeof n!="string"||t.currentFillStyle!=n)&&(n!==void 0&&this.instructions.push(e.call(this,t)),t.currentFillStyle=n)}updateStrokeStyle(t,e){const n=t.strokeStyle,i=t.lineCap,s=t.lineDash,o=t.lineDashOffset,a=t.lineJoin,l=t.lineWidth,h=t.miterLimit;(t.currentStrokeStyle!=n||t.currentLineCap!=i||s!=t.currentLineDash&&!Wi(t.currentLineDash,s)||t.currentLineDashOffset!=o||t.currentLineJoin!=a||t.currentLineWidth!=l||t.currentMiterLimit!=h)&&(n!==void 0&&e.call(this,t),t.currentStrokeStyle=n,t.currentLineCap=i,t.currentLineDash=s,t.currentLineDashOffset=o,t.currentLineJoin=a,t.currentLineWidth=l,t.currentMiterLimit=h)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const e=[ct.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=Xx(this.maxExtent),this.maxLineWidth>0)){const t=this.resolution*(this.maxLineWidth+1)/2;Ir(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class rC extends Oa{constructor(t,e,n,i){super(t,e,n,i),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e,n){if(!this.image_||this.maxExtent&&!xr(this.maxExtent,t.getFlatCoordinates()))return;this.beginGeometry(t,e,n);const i=t.getFlatCoordinates(),s=t.getStride(),o=this.coordinates.length,a=this.appendFlatPointCoordinates(i,s);this.instructions.push([ct.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([ct.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e,n){if(!this.image_)return;this.beginGeometry(t,e,n);const i=t.getFlatCoordinates(),s=[];for(let l=0,h=i.length;l<h;l+=t.getStride())(!this.maxExtent||xr(this.maxExtent,i.slice(l,l+2)))&&s.push(i[l],i[l+1]);const o=this.coordinates.length,a=this.appendFlatPointCoordinates(s,2);this.instructions.push([ct.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([ct.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){const n=t.getAnchor(),i=t.getSize(),s=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=n[0],this.anchorY_=n[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=i[1],this.opacity_=t.getOpacity(),this.originX_=s[0],this.originY_=s[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=i[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}const nC=rC;class iC extends Oa{constructor(t,e,n,i){super(t,e,n,i)}drawFlatCoordinates_(t,e,n,i){const s=this.coordinates.length,o=this.appendFlatLineCoordinates(t,e,n,i,!1,!1),a=[ct.MOVE_TO_LINE_TO,s,o];return this.instructions.push(a),this.hitDetectionInstructions.push(a),n}drawLineString(t,e,n){const i=this.state,s=i.strokeStyle,o=i.lineWidth;if(s===void 0||o===void 0)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,e,n),this.hitDetectionInstructions.push([ct.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,An,Ln],Ii);const a=t.getFlatCoordinates(),l=t.getStride();this.drawFlatCoordinates_(a,0,a.length,l),this.hitDetectionInstructions.push(oi),this.endGeometry(e)}drawMultiLineString(t,e,n){const i=this.state,s=i.strokeStyle,o=i.lineWidth;if(s===void 0||o===void 0)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,e,n),this.hitDetectionInstructions.push([ct.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,An,Ln],Ii);const a=t.getEnds(),l=t.getFlatCoordinates(),h=t.getStride();let u=0;for(let c=0,f=a.length;c<f;++c)u=this.drawFlatCoordinates_(l,u,a[c],h);this.hitDetectionInstructions.push(oi),this.endGeometry(e)}finish(){const t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(oi),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(oi),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(Ii)}}const sC=iC;class oC extends Oa{constructor(t,e,n,i){super(t,e,n,i)}drawFlatCoordinatess_(t,e,n,i){const s=this.state,o=s.fillStyle!==void 0,a=s.strokeStyle!==void 0,l=n.length;this.instructions.push(Ii),this.hitDetectionInstructions.push(Ii);for(let h=0;h<l;++h){const u=n[h],c=this.coordinates.length,f=this.appendFlatLineCoordinates(t,e,u,i,!0,!a),g=[ct.MOVE_TO_LINE_TO,c,f];this.instructions.push(g),this.hitDetectionInstructions.push(g),a&&(this.instructions.push(vp),this.hitDetectionInstructions.push(vp)),e=u}return o&&(this.instructions.push(sl),this.hitDetectionInstructions.push(sl)),a&&(this.instructions.push(oi),this.hitDetectionInstructions.push(oi)),e}drawCircle(t,e,n){const i=this.state,s=i.fillStyle,o=i.strokeStyle;if(s===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,n),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([ct.SET_FILL_STYLE,nr]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([ct.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,An,Ln]);const a=t.getFlatCoordinates(),l=t.getStride(),h=this.coordinates.length;this.appendFlatLineCoordinates(a,0,a.length,l,!1,!1);const u=[ct.CIRCLE,h];this.instructions.push(Ii,u),this.hitDetectionInstructions.push(Ii,u),i.fillStyle!==void 0&&(this.instructions.push(sl),this.hitDetectionInstructions.push(sl)),i.strokeStyle!==void 0&&(this.instructions.push(oi),this.hitDetectionInstructions.push(oi)),this.endGeometry(e)}drawPolygon(t,e,n){const i=this.state,s=i.fillStyle,o=i.strokeStyle;if(s===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,n),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([ct.SET_FILL_STYLE,nr]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([ct.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,An,Ln]);const a=t.getEnds(),l=t.getOrientedFlatCoordinates(),h=t.getStride();this.drawFlatCoordinatess_(l,0,a,h),this.endGeometry(e)}drawMultiPolygon(t,e,n){const i=this.state,s=i.fillStyle,o=i.strokeStyle;if(s===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,n),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([ct.SET_FILL_STYLE,nr]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([ct.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,An,Ln]);const a=t.getEndss(),l=t.getOrientedFlatCoordinates(),h=t.getStride();let u=0;for(let c=0,f=a.length;c<f;++c)u=this.drawFlatCoordinatess_(l,u,a[c],h);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(t!==0){const e=this.coordinates;for(let n=0,i=e.length;n<i;++n)e[n]=Ei(e[n],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;t.fillStyle!==void 0&&this.updateFillStyle(t,this.createFill),t.strokeStyle!==void 0&&this.updateStrokeStyle(t,this.applyStroke)}}const wp=oC;function aC(r,t,e,n,i){const s=[];let o=e,a=0,l=t.slice(e,2);for(;a<r&&o+i<n;){const[h,u]=l.slice(-2),c=t[o+i],f=t[o+i+1],g=Math.sqrt((c-h)*(c-h)+(f-u)*(f-u));if(a+=g,a>=r){const m=(r-a+g)/g,_=mr(h,c,m),x=mr(u,f,m);l.push(_,x),s.push(l),l=[_,x],a==r&&(o+=i),a=0}else if(a<r)l.push(t[o+i],t[o+i+1]),o+=i;else{const m=g-a,_=mr(h,c,m/g),x=mr(u,f,m/g);l.push(_,x),s.push(l),l=[_,x],a=0,o+=i}}return a>0&&s.push(l),s}function lC(r,t,e,n,i){let s=e,o=e,a=0,l=0,h=e,u,c,f,g,m,_,x,v,w,S;for(c=e;c<n;c+=i){const E=t[c],T=t[c+1];m!==void 0&&(w=E-m,S=T-_,g=Math.sqrt(w*w+S*S),x!==void 0&&(l+=f,u=Math.acos((x*w+v*S)/(f*g)),u>r&&(l>a&&(a=l,s=h,o=c),l=0,h=c-i)),f=g,x=w,v=S),m=E,_=T}return l+=g,l>a?[h,c]:[s,o]}const jl={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class hC extends Oa{constructor(t,e,n,i){super(t,e,n,i),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[nr]={fillStyle:nr},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e,n){const i=this.textFillState_,s=this.textStrokeState_,o=this.textState_;if(this.text_===""||!o||!i&&!s)return;const a=this.coordinates;let l=a.length;const h=t.getType();let u=null,c=t.getStride();if(o.placement==="line"&&(h=="LineString"||h=="MultiLineString"||h=="Polygon"||h=="MultiPolygon")){if(!Qt(this.maxExtent,t.getExtent()))return;let f;if(u=t.getFlatCoordinates(),h=="LineString")f=[u.length];else if(h=="MultiLineString")f=t.getEnds();else if(h=="Polygon")f=t.getEnds().slice(0,1);else if(h=="MultiPolygon"){const x=t.getEndss();f=[];for(let v=0,w=x.length;v<w;++v)f.push(x[v][0])}this.beginGeometry(t,e,n);const g=o.repeat,m=g?void 0:o.textAlign;let _=0;for(let x=0,v=f.length;x<v;++x){let w;g?w=aC(g*this.resolution,u,_,f[x],c):w=[u.slice(_,f[x])];for(let S=0,E=w.length;S<E;++S){const T=w[S];let R=0,C=T.length;if(m==null){const F=lC(o.maxAngle,T,0,T.length,2);R=F[0],C=F[1]}for(let F=R;F<C;F+=c)a.push(T[F],T[F+1]);const I=a.length;_=f[x],this.drawChars_(l,I),l=I}}this.endGeometry(e)}else{let f=o.overflow?null:[];switch(h){case"Point":case"MultiPoint":u=t.getFlatCoordinates();break;case"LineString":u=t.getFlatMidpoint();break;case"Circle":u=t.getCenter();break;case"MultiLineString":u=t.getFlatMidpoints(),c=2;break;case"Polygon":u=t.getFlatInteriorPoint(),o.overflow||f.push(u[2]/this.resolution),c=3;break;case"MultiPolygon":const w=t.getFlatInteriorPoints();u=[];for(let S=0,E=w.length;S<E;S+=3)o.overflow||f.push(w[S+2]/this.resolution),u.push(w[S],w[S+1]);if(u.length===0)return;c=2;break}const g=this.appendFlatPointCoordinates(u,c);if(g===l)return;if(f&&(g-l)/2!==u.length/c){let w=l/2;f=f.filter((S,E)=>{const T=a[(w+E)*2]===u[E*c]&&a[(w+E)*2+1]===u[E*c+1];return T||--w,T})}this.saveTextStates_(),(o.backgroundFill||o.backgroundStroke)&&(this.setFillStrokeStyle(o.backgroundFill,o.backgroundStroke),o.backgroundFill&&this.updateFillStyle(this.state,this.createFill),o.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e,n);let m=o.padding;if(m!=Ri&&(o.scale[0]<0||o.scale[1]<0)){let w=o.padding[0],S=o.padding[1],E=o.padding[2],T=o.padding[3];o.scale[0]<0&&(S=-S,T=-T),o.scale[1]<0&&(w=-w,E=-E),m=[w,S,E,T]}const _=this.pixelRatio;this.instructions.push([ct.DRAW_IMAGE,l,g,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,m==Ri?Ri:m.map(function(w){return w*_}),!!o.backgroundFill,!!o.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,f]);const x=1/_,v=this.state.fillStyle;o.backgroundFill&&(this.state.fillStyle=nr,this.hitDetectionInstructions.push(this.createFill(this.state))),this.hitDetectionInstructions.push([ct.DRAW_IMAGE,l,g,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[x,x],NaN,this.declutterMode_,this.declutterImageWithText_,m,!!o.backgroundFill,!!o.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?nr:this.fillKey_,this.textOffsetX_,this.textOffsetY_,f]),o.backgroundFill&&(this.state.fillStyle=v,this.hitDetectionInstructions.push(this.createFill(this.state))),this.endGeometry(e)}}saveTextStates_(){const t=this.textStrokeState_,e=this.textState_,n=this.textFillState_,i=this.strokeKey_;t&&(i in this.strokeStates||(this.strokeStates[i]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const s=this.textKey_;s in this.textStates||(this.textStates[s]={font:e.font,textAlign:e.textAlign||ta,justify:e.justify,textBaseline:e.textBaseline||Pl,scale:e.scale});const o=this.fillKey_;n&&(o in this.fillStates||(this.fillStates[o]={fillStyle:n.fillStyle}))}drawChars_(t,e){const n=this.textStrokeState_,i=this.textState_,s=this.strokeKey_,o=this.textKey_,a=this.fillKey_;this.saveTextStates_();const l=this.pixelRatio,h=jl[i.textBaseline],u=this.textOffsetY_*l,c=this.text_,f=n?n.lineWidth*Math.abs(i.scale[0])/2:0;this.instructions.push([ct.DRAW_CHARS,t,e,h,i.overflow,a,i.maxAngle,l,u,s,f*l,c,o,1,this.declutterMode_]),this.hitDetectionInstructions.push([ct.DRAW_CHARS,t,e,h,i.overflow,a&&nr,i.maxAngle,l,u,s,f*l,c,o,1/l,this.declutterMode_])}setTextStyle(t,e){let n,i,s;if(!t)this.text_="";else{const o=t.getFill();o?(i=this.textFillState_,i||(i={},this.textFillState_=i),i.fillStyle=rn(o.getColor()||nr)):(i=null,this.textFillState_=i);const a=t.getStroke();if(!a)s=null,this.textStrokeState_=s;else{s=this.textStrokeState_,s||(s={},this.textStrokeState_=s);const m=a.getLineDash(),_=a.getLineDashOffset(),x=a.getWidth(),v=a.getMiterLimit();s.lineCap=a.getLineCap()||Gs,s.lineDash=m?m.slice():An,s.lineDashOffset=_===void 0?Ln:_,s.lineJoin=a.getLineJoin()||js,s.lineWidth=x===void 0?ea:x,s.miterLimit=v===void 0?Qo:v,s.strokeStyle=rn(a.getColor()||Jo)}n=this.textState_;const l=t.getFont()||M0;Ub(l);const h=t.getScaleArray();n.overflow=t.getOverflow(),n.font=l,n.maxAngle=t.getMaxAngle(),n.placement=t.getPlacement(),n.textAlign=t.getTextAlign(),n.repeat=t.getRepeat(),n.justify=t.getJustify(),n.textBaseline=t.getTextBaseline()||Pl,n.backgroundFill=t.getBackgroundFill(),n.backgroundStroke=t.getBackgroundStroke(),n.padding=t.getPadding()||Ri,n.scale=h===void 0?[1,1]:h;const u=t.getOffsetX(),c=t.getOffsetY(),f=t.getRotateWithView(),g=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=u===void 0?0:u,this.textOffsetY_=c===void 0?0:c,this.textRotateWithView_=f===void 0?!1:f,this.textRotation_=g===void 0?0:g,this.strokeKey_=s?(typeof s.strokeStyle=="string"?s.strokeStyle:it(s.strokeStyle))+s.lineCap+s.lineDashOffset+"|"+s.lineWidth+s.lineJoin+s.miterLimit+"["+s.lineDash.join()+"]":"",this.textKey_=n.font+n.scale+(n.textAlign||"?")+(n.repeat||"?")+(n.justify||"?")+(n.textBaseline||"?"),this.fillKey_=i&&i.fillStyle?typeof i.fillStyle=="string"?i.fillStyle:"|"+it(i.fillStyle):""}this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}const uC={Circle:wp,Default:Oa,Image:nC,LineString:sC,Polygon:wp,Text:hC};class R_{constructor(t,e,n,i){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=i,this.resolution_=n,this.buildersByZIndex_={}}finish(){const t={};for(const e in this.buildersByZIndex_){t[e]=t[e]||{};const n=this.buildersByZIndex_[e];for(const i in n){const s=n[i].finish();t[e][i]=s}}return t}getBuilder(t,e){const n=t!==void 0?t.toString():"0";let i=this.buildersByZIndex_[n];i===void 0&&(i={},this.buildersByZIndex_[n]=i);let s=i[e];if(s===void 0){const o=uC[e];s=new o(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),i[e]=s}return s}}class C_ extends _a{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.declutterExecutorGroup=null}getFeatures(t){return ut()}getData(t){return null}prepareFrame(t){return ut()}renderFrame(t,e){return ut()}loadedTileCallback(t,e,n){t[e]||(t[e]={}),t[e][n.tileCoord.toString()]=n}createLoadedTileFinder(t,e,n){return(i,s)=>{const o=this.loadedTileCallback.bind(this,n,i);return t.forEachLoadedTile(e,i,s,o)}}forEachFeatureAtCoordinate(t,e,n,i,s){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){const e=t.target;(e.getState()===et.LOADED||e.getState()===et.ERROR)&&this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return e!=et.LOADED&&e!=et.ERROR&&t.addEventListener(Lt.CHANGE,this.boundHandleImageChange_),e==et.IDLE&&(t.load(),e=t.getState()),e==et.LOADED}renderIfReadyAndVisible(){const t=this.getLayer();t&&t.getVisible()&&t.getSourceState()==="ready"&&t.changed()}renderDeferred(t){}disposeInternal(){delete this.layer_,super.disposeInternal()}}class gl extends fn{constructor(t,e,n,i){super(t),this.inversePixelTransform=e,this.frameState=n,this.context=i}}class Ud{constructor(){Oc(this,"pushMethodArgs_",(...t)=>(this.instructions_[this.zIndex+this.offset_].push(t),this)),this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(CanvasRenderingContext2D.prototype,{get:(t,e)=>{if(typeof ec()[e]=="function")return this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e),this.pushMethodArgs_},set:(t,e,n)=>(this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e,n),!0)})}getContext(){return this.context_}draw(t){this.instructions_.forEach(e=>{for(let n=0,i=e.length;n<i;n+=2){const s=e[n],o=e[n+1];if(typeof t[s]=="function")t[s](...o);else{if(typeof o=="function"){t[s]=o(t);continue}t[s]=o}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}const bp=[];let ds=null;function cC(){ds=Jt(1,1,void 0,{willReadFrequently:!0})}class Bd extends C_{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=pe(),this.pixelTransform=pe(),this.inversePixelTransform=pe(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(t,e,n){ds||cC(),ds.clearRect(0,0,1,1);let i;try{ds.drawImage(t,e,n,1,1,0,0,1,1),i=ds.getImageData(0,0,1,1).data}catch{return ds=null,null}return i}getBackground(t){let e=this.getLayer().getBackground();return typeof e=="function"&&(e=e(t.viewState.resolution)),e||void 0}useContainer(t,e,n){const i=this.getLayer().getClassName();let s,o;if(t&&t.className===i&&(!n||t&&t.style.backgroundColor&&Wi(Xr(t.style.backgroundColor),Xr(n)))){const a=t.firstElementChild;a instanceof HTMLCanvasElement&&(o=a.getContext("2d"))}if(o&&o.canvas.style.transform===e?(this.container=t,this.context=o,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){s=document.createElement("div"),s.className=i;let a=s.style;a.position="absolute",a.width="100%",a.height="100%",o=Jt();const l=o.canvas;s.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=s,this.context=o}!this.containerReused&&n&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=n)}clipUnrotated(t,e,n){const i=zn(n),s=va(n),o=ch(n),a=xa(n);ae(e.coordinateToPixelTransform,i),ae(e.coordinateToPixelTransform,s),ae(e.coordinateToPixelTransform,o),ae(e.coordinateToPixelTransform,a);const l=this.inversePixelTransform;ae(l,i),ae(l,s),ae(l,o),ae(l,a),t.save(),t.beginPath(),t.moveTo(Math.round(i[0]),Math.round(i[1])),t.lineTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(a[0]),Math.round(a[1])),t.clip()}dispatchRenderEvent_(t,e,n){const i=this.getLayer();if(i.hasListener(t)){const s=new gl(t,this.inversePixelTransform,n,e);i.dispatchEvent(s)}}preRender(t,e){this.frameState=e,!e.declutter&&this.dispatchRenderEvent_(ir.PRERENDER,t,e)}postRender(t,e){e.declutter||this.dispatchRenderEvent_(ir.POSTRENDER,t,e)}renderDeferredInternal(t){}getRenderContext(t){return t.declutter&&!this.deferredContext_&&(this.deferredContext_=new Ud),t.declutter?this.deferredContext_.getContext():this.context}renderDeferred(t){t.declutter&&(this.dispatchRenderEvent_(ir.PRERENDER,this.context,t),t.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(t),this.dispatchRenderEvent_(ir.POSTRENDER,this.context,t))}getRenderTransform(t,e,n,i,s,o,a){const l=s/2,h=o/2,u=i/e,c=-u,f=-t[0]+a,g=-t[1];return hr(this.tempTransform,l,h,u,c,-n,f,g)}disposeInternal(){delete this.frameState,super.disposeInternal()}}function dC(r,t,e,n,i,s,o,a,l,h,u,c){let f=r[t],g=r[t+1],m=0,_=0,x=0,v=0;function w(){m=f,_=g,t+=n,f=r[t],g=r[t+1],v+=x,x=Math.sqrt((f-m)*(f-m)+(g-_)*(g-_))}do w();while(t<e-n&&v+x<s);let S=x===0?0:(s-v)/x;const E=mr(m,f,S),T=mr(_,g,S),R=t-n,C=v,I=s+a*l(h,i,u);for(;t<e-n&&v+x<I;)w();S=x===0?0:(I-v)/x;const F=mr(m,f,S),U=mr(_,g,S);let j;if(c){const b=[E,T,F,U];Qm(b,0,4,2,c,b,b),j=b[0]>b[2]}else j=E>F;const B=Math.PI,d=[],p=R+n===t;t=R,x=0,v=C,f=r[t],g=r[t+1];let y;if(p){w(),y=Math.atan2(g-_,f-m),j&&(y+=y>0?-B:B);const b=(F+E)/2,M=(U+T)/2;return d[0]=[b,M,(I-s)/2,y,i],d}i=i.replace(/\n/g," ");for(let b=0,M=i.length;b<M;){w();let P=Math.atan2(g-_,f-m);if(j&&(P+=P>0?-B:B),y!==void 0){let G=P-y;if(G+=G>B?-2*B:G<-B?2*B:0,Math.abs(G)>o)return null}y=P;const A=b;let L=0;for(;b<M;++b){const G=j?M-b-1:b,H=a*l(h,i[G],u);if(t+n<e&&v+x<s+L+H/2)break;L+=H}if(b===A)continue;const D=j?i.substring(M-A,M-b):i.substring(A,b);S=x===0?0:(s+L/2-v)/x;const X=mr(m,f,S),K=mr(_,g,S);d.push([X,K,L/2,P,D]),s+=L}return d}const rs=ze(),Hn=[],vn=[],wn=[],Kn=[];function Sp(r){return r[3].declutterBox}const Ep=new RegExp("[֑-ࣿיִ-﷿ﹰ-ﻼࠀ-࿿-]");function vu(r,t){return t==="start"?t=Ep.test(r)?"right":"left":t==="end"&&(t=Ep.test(r)?"left":"right"),jl[t]}function fC(r,t,e){return e>0&&r.push(`
`,""),r.push(t,""),r}class gC{constructor(t,e,n,i,s){this.overlaps=n,this.pixelRatio=e,this.resolution=t,this.alignAndScaleFill_,this.instructions=i.instructions,this.coordinates=i.coordinates,this.coordinateCache_={},this.renderedTransform_=pe(),this.hitDetectionInstructions=i.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=i.fillStates||{},this.strokeStates=i.strokeStates||{},this.textStates=i.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=s?new Ud:null}getZIndexContext(){return this.zIndexContext_}createLabel(t,e,n,i){const s=t+e+n+i;if(this.labels_[s])return this.labels_[s];const o=i?this.strokeStates[i]:null,a=n?this.fillStates[n]:null,l=this.textStates[e],h=this.pixelRatio,u=[l.scale[0]*h,l.scale[1]*h],c=Array.isArray(t),f=l.justify?jl[l.justify]:vu(Array.isArray(t)?t[0]:t,l.textAlign||ta),g=i&&o.lineWidth?o.lineWidth:0,m=c?t:t.split(`
`).reduce(fC,[]),{width:_,height:x,widths:v,heights:w,lineWidths:S}=Xb(l,m),E=_+g,T=[],R=(E+2)*u[0],C=(x+g)*u[1],I={width:R<0?Math.floor(R):Math.ceil(R),height:C<0?Math.floor(C):Math.ceil(C),contextInstructions:T};(u[0]!=1||u[1]!=1)&&T.push("scale",u),i&&(T.push("strokeStyle",o.strokeStyle),T.push("lineWidth",g),T.push("lineCap",o.lineCap),T.push("lineJoin",o.lineJoin),T.push("miterLimit",o.miterLimit),T.push("setLineDash",[o.lineDash]),T.push("lineDashOffset",o.lineDashOffset)),n&&T.push("fillStyle",a.fillStyle),T.push("textBaseline","middle"),T.push("textAlign","center");const F=.5-f;let U=f*E+F*g;const j=[],B=[];let d=0,p=0,y=0,b=0,M;for(let P=0,A=m.length;P<A;P+=2){const L=m[P];if(L===`
`){p+=d,d=0,U=f*E+F*g,++b;continue}const D=m[P+1]||l.font;D!==M&&(i&&j.push("font",D),n&&B.push("font",D),M=D),d=Math.max(d,w[y]);const X=[L,U+F*v[y]+f*(v[y]-S[b]),.5*(g+d)+p];U+=v[y],i&&j.push("strokeText",X),n&&B.push("fillText",X),++y}return Array.prototype.push.apply(T,j),Array.prototype.push.apply(T,B),this.labels_[s]=I,I}replayTextBackground_(t,e,n,i,s,o,a){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,n),t.lineTo.apply(t,i),t.lineTo.apply(t,s),t.lineTo.apply(t,e),o&&(this.alignAndScaleFill_=o[2],this.fill_(t)),a&&(this.setStrokeStyle_(t,a),t.stroke())}calculateImageOrLabelDimensions_(t,e,n,i,s,o,a,l,h,u,c,f,g,m,_,x){a*=f[0],l*=f[1];let v=n-a,w=i-l;const S=s+h>t?t-h:s,E=o+u>e?e-u:o,T=m[3]+S*f[0]+m[1],R=m[0]+E*f[1]+m[2],C=v-m[3],I=w-m[0];(_||c!==0)&&(Hn[0]=C,Kn[0]=C,Hn[1]=I,vn[1]=I,vn[0]=C+T,wn[0]=vn[0],wn[1]=I+R,Kn[1]=wn[1]);let F;return c!==0?(F=hr(pe(),n,i,1,1,c,-n,-i),ae(F,Hn),ae(F,vn),ae(F,wn),ae(F,Kn),Br(Math.min(Hn[0],vn[0],wn[0],Kn[0]),Math.min(Hn[1],vn[1],wn[1],Kn[1]),Math.max(Hn[0],vn[0],wn[0],Kn[0]),Math.max(Hn[1],vn[1],wn[1],Kn[1]),rs)):Br(Math.min(C,C+T),Math.min(I,I+R),Math.max(C,C+T),Math.max(I,I+R),rs),g&&(v=Math.round(v),w=Math.round(w)),{drawImageX:v,drawImageY:w,drawImageW:S,drawImageH:E,originX:h,originY:u,declutterBox:{minX:rs[0],minY:rs[1],maxX:rs[2],maxY:rs[3],value:x},canvasTransform:F,scale:f}}replayImageOrLabel_(t,e,n,i,s,o,a){const l=!!(o||a),h=i.declutterBox,u=a?a[2]*i.scale[0]/2:0;return h.minX-u<=e[0]&&h.maxX+u>=0&&h.minY-u<=e[1]&&h.maxY+u>=0&&(l&&this.replayTextBackground_(t,Hn,vn,wn,Kn,o,a),Wb(t,i.canvasTransform,s,n,i.originX,i.originY,i.drawImageW,i.drawImageH,i.drawImageX,i.drawImageY,i.scale)),!0}fill_(t){const e=this.alignAndScaleFill_;if(e){const n=ae(this.renderedTransform_,[0,0]),i=512*this.pixelRatio;t.save(),t.translate(n[0]%i,n[1]%i),e!==1&&t.scale(e,e),t.rotate(this.viewRotation_)}t.fill(),e&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6])}drawLabelWithPointPlacement_(t,e,n,i){const s=this.textStates[e],o=this.createLabel(t,e,i,n),a=this.strokeStates[n],l=this.pixelRatio,h=vu(Array.isArray(t)?t[0]:t,s.textAlign||ta),u=jl[s.textBaseline||Pl],c=a&&a.lineWidth?a.lineWidth:0,f=o.width/l-2*s.scale[0],g=h*f+2*(.5-h)*c,m=u*o.height/l+2*(.5-u)*c;return{label:o,anchorX:g,anchorY:m}}execute_(t,e,n,i,s,o,a,l){const h=this.zIndexContext_;let u;this.pixelCoordinates_&&Wi(n,this.renderedTransform_)?u=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),u=li(this.coordinates,0,this.coordinates.length,2,n,this.pixelCoordinates_),jx(this.renderedTransform_,n));let c=0;const f=i.length;let g=0,m,_,x,v,w,S,E,T,R,C,I,F,U,j=0,B=0,d=null,p=null;const y=this.coordinateCache_,b=this.viewRotation_,M=Math.round(Math.atan2(-n[1],n[0])*1e12)/1e12,P={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:b},A=this.instructions!=i||this.overlaps?0:200;let L,D,X,K;for(;c<f;){const G=i[c];switch(G[0]){case ct.BEGIN_GEOMETRY:L=G[1],K=G[3],L.getGeometry()?a!==void 0&&!Qt(a,K.getExtent())?c=G[2]+1:++c:c=G[2],h&&(h.zIndex=G[4]);break;case ct.BEGIN_PATH:j>A&&(this.fill_(t),j=0),B>A&&(t.stroke(),B=0),!j&&!B&&(t.beginPath(),w=NaN,S=NaN),++c;break;case ct.CIRCLE:g=G[1];const H=u[g],Q=u[g+1],nt=u[g+2],xt=u[g+3],dt=nt-H,Tt=xt-Q,St=Math.sqrt(dt*dt+Tt*Tt);t.moveTo(H+St,Q),t.arc(H,Q,St,0,2*Math.PI,!0),++c;break;case ct.CLOSE_PATH:t.closePath(),++c;break;case ct.CUSTOM:g=G[1],m=G[2];const Dt=G[3],Yt=G[4],ce=G[5];P.geometry=Dt,P.feature=L,c in y||(y[c]=[]);const Ht=y[c];ce?ce(u,g,m,2,Ht):(Ht[0]=u[g],Ht[1]=u[g+1],Ht.length=2),h&&(h.zIndex=G[6]),Yt(Ht,P),++c;break;case ct.DRAW_IMAGE:g=G[1],m=G[2],R=G[3],_=G[4],x=G[5];let Ke=G[6];const Wa=G[7],Kh=G[8],qa=G[9],Za=G[10];let gr=G[11];const Lr=G[12];let $r=G[13];v=G[14]||"declutter";const Or=G[15];if(!R&&G.length>=20){C=G[19],I=G[20],F=G[21],U=G[22];const wr=this.drawLabelWithPointPlacement_(C,I,F,U);R=wr.label,G[3]=R;const vi=G[23];_=(wr.anchorX-vi)*this.pixelRatio,G[4]=_;const br=G[24];x=(wr.anchorY-br)*this.pixelRatio,G[5]=x,Ke=R.height,G[6]=Ke,$r=R.width,G[13]=$r}let Ki;G.length>25&&(Ki=G[25]);let Qi,Zn,pn;G.length>17?(Qi=G[16],Zn=G[17],pn=G[18]):(Qi=Ri,Zn=!1,pn=!1),Za&&M?gr+=b:!Za&&!M&&(gr-=b);let Qh=0;for(;g<m;g+=2){if(Ki&&Ki[Qh++]<$r/this.pixelRatio)continue;const wr=this.calculateImageOrLabelDimensions_(R.width,R.height,u[g],u[g+1],$r,Ke,_,x,Kh,qa,gr,Lr,s,Qi,Zn||pn,L),vi=[t,e,R,wr,Wa,Zn?d:null,pn?p:null];if(l){let br,Vr,Sr;if(Or){const de=m-g;if(!Or[de]){Or[de]={args:vi,declutterMode:v};continue}const Xe=Or[de];br=Xe.args,Vr=Xe.declutterMode,delete Or[de],Sr=Sp(br)}let mn,_n;if(br&&(Vr!=="declutter"||!l.collides(Sr))&&(mn=!0),(v!=="declutter"||!l.collides(wr.declutterBox))&&(_n=!0),Vr==="declutter"&&v==="declutter"){const de=mn&&_n;mn=de,_n=de}mn&&(Vr!=="none"&&l.insert(Sr),this.replayImageOrLabel_.apply(this,br)),_n&&(v!=="none"&&l.insert(wr.declutterBox),this.replayImageOrLabel_.apply(this,vi))}else this.replayImageOrLabel_.apply(this,vi)}++c;break;case ct.DRAW_CHARS:const Be=G[1],Zf=G[2],Jh=G[3],K1=G[4];U=G[5];const Q1=G[6],$f=G[7],Vf=G[8];F=G[9];const tu=G[10];C=G[11],I=G[12];const Yf=[G[13],G[13]];v=G[14]||"declutter";const eu=this.textStates[I],lo=eu.font,ho=[eu.scale[0]*$f,eu.scale[1]*$f];let uo;lo in this.widths_?uo=this.widths_[lo]:(uo={},this.widths_[lo]=uo);const Hf=o0(u,Be,Zf,2),Kf=Math.abs(ho[0])*Cg(lo,C,uo);if(K1||Kf<=Hf){const wr=this.textStates[I].textAlign,vi=(Hf-Kf)*vu(C,wr),br=dC(u,Be,Zf,2,C,vi,Q1,Math.abs(ho[0]),Cg,lo,uo,M?0:this.viewRotation_);t:if(br){const Vr=[];let Sr,mn,_n,de,Xe;if(F)for(Sr=0,mn=br.length;Sr<mn;++Sr){Xe=br[Sr],_n=Xe[4],de=this.createLabel(_n,I,"",F),_=Xe[2]+(ho[0]<0?-tu:tu),x=Jh*de.height+(.5-Jh)*2*tu*ho[1]/ho[0]-Vf;const yn=this.calculateImageOrLabelDimensions_(de.width,de.height,Xe[0],Xe[1],de.width,de.height,_,x,0,0,Xe[3],Yf,!1,Ri,!1,L);if(l&&v==="declutter"&&l.collides(yn.declutterBox))break t;Vr.push([t,e,de,yn,1,null,null])}if(U)for(Sr=0,mn=br.length;Sr<mn;++Sr){Xe=br[Sr],_n=Xe[4],de=this.createLabel(_n,I,U,""),_=Xe[2],x=Jh*de.height-Vf;const yn=this.calculateImageOrLabelDimensions_(de.width,de.height,Xe[0],Xe[1],de.width,de.height,_,x,0,0,Xe[3],Yf,!1,Ri,!1,L);if(l&&v==="declutter"&&l.collides(yn.declutterBox))break t;Vr.push([t,e,de,yn,1,null,null])}l&&v!=="none"&&l.load(Vr.map(Sp));for(let yn=0,J1=Vr.length;yn<J1;++yn)this.replayImageOrLabel_.apply(this,Vr[yn])}}++c;break;case ct.END_GEOMETRY:if(o!==void 0){L=G[1];const wr=o(L,K);if(wr)return wr}++c;break;case ct.FILL:A?j++:this.fill_(t),++c;break;case ct.MOVE_TO_LINE_TO:for(g=G[1],m=G[2],D=u[g],X=u[g+1],E=D+.5|0,T=X+.5|0,(E!==w||T!==S)&&(t.moveTo(D,X),w=E,S=T),g+=2;g<m;g+=2)D=u[g],X=u[g+1],E=D+.5|0,T=X+.5|0,(g==m-2||E!==w||T!==S)&&(t.lineTo(D,X),w=E,S=T);++c;break;case ct.SET_FILL_STYLE:d=G,this.alignAndScaleFill_=G[2],j&&(this.fill_(t),j=0,B&&(t.stroke(),B=0)),t.fillStyle=G[1],++c;break;case ct.SET_STROKE_STYLE:p=G,B&&(t.stroke(),B=0),this.setStrokeStyle_(t,G),++c;break;case ct.STROKE:A?B++:t.stroke(),++c;break;default:++c;break}}j&&this.fill_(t),B&&t.stroke()}execute(t,e,n,i,s,o){this.viewRotation_=i,this.execute_(t,e,n,this.instructions,s,void 0,void 0,o)}executeHitDetection(t,e,n,i,s){return this.viewRotation_=n,this.execute_(t,[t.canvas.width,t.canvas.height],e,this.hitDetectionInstructions,!0,i,s)}}const ko=["Polygon","Circle","LineString","Image","Text","Default"],zl=["Image","Text"],pC=ko.filter(r=>!zl.includes(r));class I_{constructor(t,e,n,i,s,o,a){this.maxExtent_=t,this.overlaps_=i,this.pixelRatio_=n,this.resolution_=e,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=pe(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(s,a)}clip(t,e){const n=this.getClipCoords(e);t.beginPath(),t.moveTo(n[0],n[1]),t.lineTo(n[2],n[3]),t.lineTo(n[4],n[5]),t.lineTo(n[6],n[7]),t.clip()}createExecutors_(t,e){for(const n in t){let i=this.executorsByZIndex_[n];i===void 0&&(i={},this.executorsByZIndex_[n]=i);const s=t[n];for(const o in s){const a=s[o];i[o]=new gC(this.resolution_,this.pixelRatio_,this.overlaps_,a,e)}}}hasExecutors(t){for(const e in this.executorsByZIndex_){const n=this.executorsByZIndex_[e];for(let i=0,s=t.length;i<s;++i)if(t[i]in n)return!0}return!1}forEachFeatureAtCoordinate(t,e,n,i,s,o){i=Math.round(i);const a=i*2+1,l=hr(this.hitDetectionTransform_,i+.5,i+.5,1/e,-1/e,-n,-t[0],-t[1]),h=!this.hitDetectionContext_;h&&(this.hitDetectionContext_=Jt(a,a,void 0,{willReadFrequently:!0}));const u=this.hitDetectionContext_;u.canvas.width!==a||u.canvas.height!==a?(u.canvas.width=a,u.canvas.height=a):h||u.clearRect(0,0,a,a);let c;this.renderBuffer_!==void 0&&(c=ze(),Lo(c,t),Ir(c,e*(this.renderBuffer_+i),c));const f=mC(i);let g;function m(T,R){const C=u.getImageData(0,0,a,a).data;for(let I=0,F=f.length;I<F;I++)if(C[f[I]]>0){if(!o||g!=="Image"&&g!=="Text"||o.includes(T)){const U=(f[I]-3)/4,j=i-U%a,B=i-(U/a|0),d=s(T,R,j*j+B*B);if(d)return d}u.clearRect(0,0,a,a);break}}const _=Object.keys(this.executorsByZIndex_).map(Number);_.sort(on);let x,v,w,S,E;for(x=_.length-1;x>=0;--x){const T=_[x].toString();for(w=this.executorsByZIndex_[T],v=ko.length-1;v>=0;--v)if(g=ko[v],S=w[g],S!==void 0&&(E=S.executeHitDetection(u,l,n,m,c),E))return E}}getClipCoords(t){const e=this.maxExtent_;if(!e)return null;const n=e[0],i=e[1],s=e[2],o=e[3],a=[n,i,n,o,s,o,s,i];return li(a,0,8,2,t,a),a}isEmpty(){return Fn(this.executorsByZIndex_)}execute(t,e,n,i,s,o,a){const l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(on),o=o||ko;let h,u,c,f,g,m;for(a&&l.reverse(),h=0,u=l.length;h<u;++h){const _=l[h].toString();for(g=this.executorsByZIndex_[_],c=0,f=o.length;c<f;++c){const x=o[c];if(m=g[x],m!==void 0){const v=a===null?void 0:m.getZIndexContext(),w=v?v.getContext():t,S=this.maxExtent_&&x!=="Image"&&x!=="Text";if(S&&(w.save(),this.clip(w,n)),m.execute(w,e,n,i,s,a),S&&w.restore(),v){v.offset();const E=l[h];this.deferredZIndexContexts_[E]||(this.deferredZIndexContexts_[E]=[]),this.deferredZIndexContexts_[E].push(v)}}}}this.renderedContext_=t}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){const t=this.deferredZIndexContexts_,e=Object.keys(t).map(Number).sort(on);for(let n=0,i=e.length;n<i;++n)t[e[n]].forEach(s=>{s.draw(this.renderedContext_),s.clear()})}}const wu={};function mC(r){if(wu[r]!==void 0)return wu[r];const t=r*2+1,e=r*r,n=new Array(e+1);for(let s=0;s<=r;++s)for(let o=0;o<=r;++o){const a=s*s+o*o;if(a>e)break;let l=n[a];l||(l=[],n[a]=l),l.push(((r+s)*t+(r+o))*4+3),s>0&&l.push(((r-s)*t+(r+o))*4+3),o>0&&(l.push(((r+s)*t+(r-o))*4+3),s>0&&l.push(((r-s)*t+(r-o))*4+3))}const i=[];for(let s=0,o=n.length;s<o;++s)n[s]&&i.push(...n[s]);return wu[r]=i,i}class _C extends M_{constructor(t,e,n,i,s,o,a){super(),this.context_=t,this.pixelRatio_=e,this.extent_=n,this.transform_=i,this.transformRotation_=i?ba(Math.atan2(i[1],i[0]),10):0,this.viewRotation_=s,this.squaredTolerance_=o,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=pe()}drawImages_(t,e,n,i){if(!this.image_)return;const s=li(t,e,n,i,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,l=o.globalAlpha;this.imageOpacity_!=1&&(o.globalAlpha=l*this.imageOpacity_);let h=this.imageRotation_;this.transformRotation_===0&&(h-=this.viewRotation_),this.imageRotateWithView_&&(h+=this.viewRotation_);for(let u=0,c=s.length;u<c;u+=2){const f=s[u]-this.imageAnchorX_,g=s[u+1]-this.imageAnchorY_;if(h!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const m=f+this.imageAnchorX_,_=g+this.imageAnchorY_;hr(a,m,_,1,1,h,-m,-_),o.save(),o.transform.apply(o,a),o.translate(m,_),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.restore()}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,f,g,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(o.globalAlpha=l)}drawText_(t,e,n,i){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const s=li(t,e,n,i,this.transform_,this.pixelCoordinates_),o=this.context_;let a=this.textRotation_;for(this.transformRotation_===0&&(a-=this.viewRotation_),this.textRotateWithView_&&(a+=this.viewRotation_);e<n;e+=i){const l=s[e]+this.textOffsetX_,h=s[e+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(o.save(),o.translate(l-this.textOffsetX_,h-this.textOffsetY_),o.rotate(a),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.restore()):(this.textStrokeState_&&o.strokeText(this.text_,l,h),this.textFillState_&&o.fillText(this.text_,l,h))}}moveToLineTo_(t,e,n,i,s){const o=this.context_,a=li(t,e,n,i,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);let l=a.length;s&&(l-=2);for(let h=2;h<l;h+=2)o.lineTo(a[h],a[h+1]);return s&&o.closePath(),n}drawRings_(t,e,n,i){for(let s=0,o=n.length;s<o;++s)e=this.moveToLineTo_(t,e,n[s],i,!0);return e}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Qt(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=vv(t,this.transform_,this.pixelCoordinates_),n=e[2]-e[0],i=e[3]-e[1],s=Math.sqrt(n*n+i*i),o=this.context_;o.beginPath(),o.arc(e[0],e[1],s,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break}}drawFeature(t,e){const n=e.getGeometryFunction()(t);n&&(this.setStyle(e),this.drawGeometry(n))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let n=0,i=e.length;n<i;++n)this.drawGeometry(e[n])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(e,0,e.length,n),this.text_!==""&&this.drawText_(e,0,e.length,n)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(e,0,e.length,n),this.text_!==""&&this.drawText_(e,0,e.length,n)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Qt(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,n=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(n,0,n.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(Qt(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const n=this.context_,i=t.getFlatCoordinates();let s=0;const o=t.getEnds(),a=t.getStride();n.beginPath();for(let l=0,h=o.length;l<h;++l)s=this.moveToLineTo_(i,s,o[l],a,!1);n.stroke()}if(this.text_!==""){const n=t.getFlatMidpoints();this.drawText_(n,0,n.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Qt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Qt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,n=t.getOrientedFlatCoordinates();let i=0;const s=t.getEndss(),o=t.getStride();e.beginPath();for(let a=0,l=s.length;a<l;++a){const h=s[a];i=this.drawRings_(n,i,h,o)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,n=this.contextFillState_;n?n.fillStyle!=t.fillStyle&&(n.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,n=this.contextStrokeState_;n?(n.lineCap!=t.lineCap&&(n.lineCap=t.lineCap,e.lineCap=t.lineCap),Wi(n.lineDash,t.lineDash)||e.setLineDash(n.lineDash=t.lineDash),n.lineDashOffset!=t.lineDashOffset&&(n.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),n.lineJoin!=t.lineJoin&&(n.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),n.lineWidth!=t.lineWidth&&(n.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),n.miterLimit!=t.miterLimit&&(n.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),n.strokeStyle!=t.strokeStyle&&(n.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,n=this.contextTextState_,i=t.textAlign?t.textAlign:ta;n?(n.font!=t.font&&(n.font=t.font,e.font=t.font),n.textAlign!=i&&(n.textAlign=i,e.textAlign=i),n.textBaseline!=t.textBaseline&&(n.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=i,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:i,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(!t)this.fillState_=null;else{const n=t.getColor();this.fillState_={fillStyle:rn(n||nr)}}if(!e)this.strokeState_=null;else{const n=e.getColor(),i=e.getLineCap(),s=e.getLineDash(),o=e.getLineDashOffset(),a=e.getLineJoin(),l=e.getWidth(),h=e.getMiterLimit(),u=s||An;this.strokeState_={lineCap:i!==void 0?i:Gs,lineDash:this.pixelRatio_===1?u:u.map(c=>c*this.pixelRatio_),lineDashOffset:(o||Ln)*this.pixelRatio_,lineJoin:a!==void 0?a:js,lineWidth:(l!==void 0?l:ea)*this.pixelRatio_,miterLimit:h!==void 0?h:Qo,strokeStyle:rn(n||Jo)}}}setImageStyle(t){let e;if(!t||!(e=t.getSize())){this.image_=null;return}const n=t.getPixelRatio(this.pixelRatio_),i=t.getAnchor(),s=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=i[0]*n,this.imageAnchorY_=i[1]*n,this.imageHeight_=e[1]*n,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=s[0],this.imageOriginY_=s[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const o=t.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/n,o[1]*this.pixelRatio_/n],this.imageWidth_=e[0]*n}setTextStyle(t){if(!t)this.text_="";else{const e=t.getFill();if(!e)this.textFillState_=null;else{const g=e.getColor();this.textFillState_={fillStyle:rn(g||nr)}}const n=t.getStroke();if(!n)this.textStrokeState_=null;else{const g=n.getColor(),m=n.getLineCap(),_=n.getLineDash(),x=n.getLineDashOffset(),v=n.getLineJoin(),w=n.getWidth(),S=n.getMiterLimit();this.textStrokeState_={lineCap:m!==void 0?m:Gs,lineDash:_||An,lineDashOffset:x||Ln,lineJoin:v!==void 0?v:js,lineWidth:w!==void 0?w:ea,miterLimit:S!==void 0?S:Qo,strokeStyle:rn(g||Jo)}}const i=t.getFont(),s=t.getOffsetX(),o=t.getOffsetY(),a=t.getRotateWithView(),l=t.getRotation(),h=t.getScaleArray(),u=t.getText(),c=t.getTextAlign(),f=t.getTextBaseline();this.textState_={font:i!==void 0?i:M0,textAlign:c!==void 0?c:ta,textBaseline:f!==void 0?f:Pl},this.text_=u!==void 0?Array.isArray(u)?u.reduce((g,m,_)=>g+=_%2?" ":m,""):u:"",this.textOffsetX_=s!==void 0?this.pixelRatio_*s:0,this.textOffsetY_=o!==void 0?this.pixelRatio_*o:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*h[0],this.pixelRatio_*h[1]]}}}const P_=_C,_r=.5;function A_(r,t,e,n,i,s,o,a,l){const h=l?fh(i):i,u=r[0]*_r,c=r[1]*_r,f=Jt(u,c);f.imageSmoothingEnabled=!1;const g=f.canvas,m=new P_(f,_r,i,null,o,a,l?$i(pv(),l):null),_=e.length,x=Math.floor((256*256*256-1)/_),v={};for(let S=1;S<=_;++S){const E=e[S-1],T=E.getStyleFunction()||n;if(!T)continue;let R=T(E,s);if(!R)continue;Array.isArray(R)||(R=[R]);const C=(S*x).toString(16).padStart(7,"#00000");for(let I=0,F=R.length;I<F;++I){const U=R[I],j=U.getGeometryFunction()(E);if(!j||!Qt(h,j.getExtent()))continue;const B=U.clone(),d=B.getFill();d&&d.setColor(C);const p=B.getStroke();p&&(p.setColor(C),p.setLineDash(null)),B.setText(void 0);const y=U.getImage();if(y){const A=y.getImageSize();if(!A)continue;const L=Jt(A[0],A[1],void 0,{alpha:!1}),D=L.canvas;L.fillStyle=C,L.fillRect(0,0,D.width,D.height),B.setImage(new bh({img:D,anchor:y.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:y.getOrigin(),opacity:1,size:y.getSize(),scale:y.getScale(),rotation:y.getRotation(),rotateWithView:y.getRotateWithView()}))}const b=B.getZIndex()||0;let M=v[b];M||(M={},v[b]=M,M.Polygon=[],M.Circle=[],M.LineString=[],M.Point=[]);const P=j.getType();if(P==="GeometryCollection"){const A=j.getGeometriesArrayRecursive();for(let L=0,D=A.length;L<D;++L){const X=A[L];M[X.getType().replace("Multi","")].push(X,B)}}else M[P.replace("Multi","")].push(j,B)}}const w=Object.keys(v).map(Number).sort(on);for(let S=0,E=w.length;S<E;++S){const T=v[w[S]];for(const R in T){const C=T[R];for(let I=0,F=C.length;I<F;I+=2){m.setStyle(C[I+1]);for(let U=0,j=t.length;U<j;++U)m.setTransform(t[U]),m.drawGeometry(C[I])}}}return f.getImageData(0,0,g.width,g.height)}function L_(r,t,e){const n=[];if(e){const i=Math.floor(Math.round(r[0])*_r),s=Math.floor(Math.round(r[1])*_r),o=(wt(i,0,e.width-1)+wt(s,0,e.height-1)*e.width)*4,a=e.data[o],l=e.data[o+1],h=e.data[o+2]+256*(l+256*a),u=Math.floor((256*256*256-1)/t.length);h&&h%u===0&&n.push(t[h/u-1])}return n}const yC=.5,O_={Point:MC,LineString:SC,Polygon:CC,MultiPoint:RC,MultiLineString:EC,MultiPolygon:TC,GeometryCollection:bC,Circle:vC};function xC(r,t){return parseInt(it(r),10)-parseInt(it(t),10)}function Ul(r,t){const e=F_(r,t);return e*e}function F_(r,t){return yC*r/t}function vC(r,t,e,n,i){const s=e.getFill(),o=e.getStroke();if(s||o){const l=r.getBuilder(e.getZIndex(),"Circle");l.setFillStrokeStyle(s,o),l.drawCircle(t,n,i)}const a=e.getText();if(a&&a.getText()){const l=r.getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,n)}}function Bl(r,t,e,n,i,s,o,a){const l=[],h=e.getImage();if(h){let f=!0;const g=h.getImageState();g==et.LOADED||g==et.ERROR?f=!1:g==et.IDLE&&h.load(),f&&l.push(h.ready())}const u=e.getFill();u&&u.loading()&&l.push(u.ready());const c=l.length>0;return c&&Promise.all(l).then(()=>i(null)),wC(r,t,e,n,s,o,a),c}function wC(r,t,e,n,i,s,o){const a=e.getGeometryFunction()(t);if(!a)return;const l=a.simplifyTransformed(n,i);if(e.getRenderer())N_(r,l,e,t,o);else{const h=O_[l.getType()];h(r,l,e,t,o,s)}}function N_(r,t,e,n,i){if(t.getType()=="GeometryCollection"){const s=t.getGeometries();for(let o=0,a=s.length;o<a;++o)N_(r,s[o],e,n,i);return}r.getBuilder(e.getZIndex(),"Default").drawCustom(t,n,e.getRenderer(),e.getHitDetectionRenderer(),i)}function bC(r,t,e,n,i,s){const o=t.getGeometriesArray();let a,l;for(a=0,l=o.length;a<l;++a){const h=O_[o[a].getType()];h(r,o[a],e,n,i,s)}}function SC(r,t,e,n,i){const s=e.getStroke();if(s){const a=r.getBuilder(e.getZIndex(),"LineString");a.setFillStrokeStyle(null,s),a.drawLineString(t,n,i)}const o=e.getText();if(o&&o.getText()){const a=r.getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,n,i)}}function EC(r,t,e,n,i){const s=e.getStroke();if(s){const a=r.getBuilder(e.getZIndex(),"LineString");a.setFillStrokeStyle(null,s),a.drawMultiLineString(t,n,i)}const o=e.getText();if(o&&o.getText()){const a=r.getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,n,i)}}function TC(r,t,e,n,i){const s=e.getFill(),o=e.getStroke();if(o||s){const l=r.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(s,o),l.drawMultiPolygon(t,n,i)}const a=e.getText();if(a&&a.getText()){const l=r.getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,n,i)}}function MC(r,t,e,n,i,s){const o=e.getImage(),a=e.getText(),l=a&&a.getText(),h=s&&o&&l?{}:void 0;if(o){if(o.getImageState()!=et.LOADED)return;const u=r.getBuilder(e.getZIndex(),"Image");u.setImageStyle(o,h),u.drawPoint(t,n,i)}if(l){const u=r.getBuilder(e.getZIndex(),"Text");u.setTextStyle(a,h),u.drawText(t,n,i)}}function RC(r,t,e,n,i,s){const o=e.getImage(),a=o&&o.getOpacity()!==0,l=e.getText(),h=l&&l.getText(),u=s&&a&&h?{}:void 0;if(a){if(o.getImageState()!=et.LOADED)return;const c=r.getBuilder(e.getZIndex(),"Image");c.setImageStyle(o,u),c.drawMultiPoint(t,n,i)}if(h){const c=r.getBuilder(e.getZIndex(),"Text");c.setTextStyle(l,u),c.drawText(t,n,i)}}function CC(r,t,e,n,i){const s=e.getFill(),o=e.getStroke();if(s||o){const l=r.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(s,o),l.drawPolygon(t,n,i)}const a=e.getText();if(a&&a.getText()){const l=r.getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,n,i)}}class D_ extends Bd{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=ze(),this.wrappedRenderedExtent_=ze(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(t,e,n){const i=e.extent,s=e.viewState,o=s.center,a=s.resolution,l=s.projection,h=s.rotation,u=l.getExtent(),c=this.getLayer().getSource(),f=this.getLayer().getDeclutter(),g=e.pixelRatio,m=e.viewHints,_=!(m[ee.ANIMATING]||m[ee.INTERACTING]),x=this.context,v=Math.round(yt(i)/a*g),w=Math.round(Vt(i)/a*g),S=c.getWrapX()&&l.canWrapX(),E=S?yt(u):null,T=S?Math.ceil((i[2]-u[2])/E)+1:1;let R=S?Math.floor((i[0]-u[0])/E):0;do{const C=this.getRenderTransform(o,a,h,g,v,w,R*E);t.execute(x,[x.canvas.width,x.canvas.height],C,h,_,n===void 0?ko:n?zl:pC,n?f&&e.declutter[f]:void 0)}while(++R<T)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=Jt(this.context.canvas.width,this.context.canvas.height,bp))}resetDrawContext_(){if(this.opacity_!==1){const t=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=t,Gi(this.context),bp.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(t){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,t,!0)}renderDeferredInternal(t){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.resetDrawContext_())}renderFrame(t,e){const n=t.pixelRatio,i=t.layerStatesArray[t.layerIndex];this.opacity_=i.opacity;const s=t.extent,o=t.viewState.resolution,a=Math.round(yt(s)/o*n),l=Math.round(Vt(s)/o*n);hr(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/n,1/n,0,-a/2,-l/2),uh(this.inversePixelTransform,this.pixelTransform);const h=Gc(this.pixelTransform);this.useContainer(e,h,this.getBackground(t));const u=this.context,c=u.canvas,f=this.replayGroup_;let g=f&&!f.isEmpty();if(!g&&!(this.getLayer().hasListener(ir.PRERENDER)||this.getLayer().hasListener(ir.POSTRENDER)))return null;c.width!=a||c.height!=l?(c.width=a,c.height=l,c.style.transform!==h&&(c.style.transform=h)):this.containerReused||u.clearRect(0,0,a,l),this.setDrawContext_(),this.preRender(u,t);const m=t.viewState;m.projection;let _=!1;if(g&&i.extent&&this.clipping){const x=Gr(i.extent);g=Qt(x,t.extent),_=g&&!Ze(x,t.extent),_&&this.clipUnrotated(u,t,x)}return g&&this.renderWorlds(f,t,this.getLayer().getDeclutter()?!1:void 0),_&&u.restore(),this.postRender(u,t),this.renderedRotation_!==m.rotation&&(this.renderedRotation_=m.rotation,this.hitDetectionImageData_=null),t.declutter||this.resetDrawContext_(),this.container}getFeatures(t){return new Promise(e=>{if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const n=[this.context.canvas.width,this.context.canvas.height];ae(this.pixelTransform,n);const i=this.renderedCenter_,s=this.renderedResolution_,o=this.renderedRotation_,a=this.renderedProjection_,l=this.wrappedRenderedExtent_,h=this.getLayer(),u=[],c=n[0]*_r,f=n[1]*_r;u.push(this.getRenderTransform(i,s,o,_r,c,f,0).slice());const g=h.getSource(),m=a.getExtent();if(g.getWrapX()&&a.canWrapX()&&!Ze(m,l)){let _=l[0];const x=yt(m);let v=0,w;for(;_<m[0];)--v,w=x*v,u.push(this.getRenderTransform(i,s,o,_r,c,f,w).slice()),_+=x;for(v=0,_=l[2];_>m[2];)++v,w=x*v,u.push(this.getRenderTransform(i,s,o,_r,c,f,w).slice()),_-=x}this.hitDetectionImageData_=A_(n,u,this.renderedFeatures_,h.getStyleFunction(),l,s,o,Ul(s,this.renderedPixelRatio_),null)}e(L_(t,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(t,e,n,i,s){if(!this.replayGroup_)return;const o=e.viewState.resolution,a=e.viewState.rotation,l=this.getLayer(),h={},u=function(m,_,x){const v=it(m),w=h[v];if(w){if(w!==!0&&x<w.distanceSq){if(x===0)return h[v]=!0,s.splice(s.lastIndexOf(w),1),i(m,l,_);w.geometry=_,w.distanceSq=x}}else{if(x===0)return h[v]=!0,i(m,l,_);s.push(h[v]={feature:m,layer:l,geometry:_,distanceSq:x,callback:i})}};let c;const f=[this.replayGroup_],g=this.getLayer().getDeclutter();return f.some(m=>c=m.forEachFeatureAtCoordinate(t,o,a,n,u,g&&e.declutter[g]?e.declutter[g].all().map(_=>_.value):null)),c}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){const e=this.getLayer(),n=e.getSource();if(!n)return!1;const i=t.viewHints[ee.ANIMATING],s=t.viewHints[ee.INTERACTING],o=e.getUpdateWhileAnimating(),a=e.getUpdateWhileInteracting();if(this.ready&&!o&&i||!a&&s)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const l=t.extent,h=t.viewState,u=h.projection,c=h.resolution,f=t.pixelRatio,g=e.getRevision(),m=e.getRenderBuffer();let _=e.getRenderOrder();_===void 0&&(_=xC);const x=h.center.slice(),v=Ir(l,m*c),w=v.slice(),S=[v.slice()],E=u.getExtent();if(n.getWrapX()&&u.canWrapX()&&!Ze(E,t.extent)){const p=yt(E),y=Math.max(yt(v)/2,p);v[0]=E[0]-y,v[2]=E[2]+y,Vm(x,u);const b=Xc(S[0],u);b[0]<E[0]&&b[2]<E[2]?S.push([b[0]+p,b[1],b[2]+p,b[3]]):b[0]>E[0]&&b[2]>E[2]&&S.push([b[0]-p,b[1],b[2]-p,b[3]])}if(this.ready&&this.renderedResolution_==c&&this.renderedRevision_==g&&this.renderedRenderOrder_==_&&Ze(this.wrappedRenderedExtent_,v))return Wi(this.renderedExtent_,w)||(this.hitDetectionImageData_=null,this.renderedExtent_=w),this.renderedCenter_=x,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const T=new R_(F_(c,f),v,c,f);let R;for(let p=0,y=S.length;p<y;++p)n.loadFeatures(S[p],c,u);const C=Ul(c,f);let I=!0;const F=(p,y)=>{let b;const M=p.getStyleFunction()||e.getStyleFunction();if(M&&(b=M(p,c)),b){const P=this.renderFeature(p,C,b,T,R,this.getLayer().getDeclutter(),y);I=I&&!P}},U=fh(v),j=n.getFeaturesInExtent(U);_&&j.sort(_);for(let p=0,y=j.length;p<y;++p)F(j[p],p);this.renderedFeatures_=j,this.ready=I;const B=T.finish(),d=new I_(v,c,f,n.getOverlaps(),B,e.getRenderBuffer(),!!t.declutter);return this.renderedResolution_=c,this.renderedRevision_=g,this.renderedRenderOrder_=_,this.renderedExtent_=w,this.wrappedRenderedExtent_=v,this.renderedCenter_=x,this.renderedProjection_=u,this.renderedPixelRatio_=f,this.replayGroup_=d,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,e,n,i,s,o,a){if(!n)return!1;let l=!1;if(Array.isArray(n))for(let h=0,u=n.length;h<u;++h)l=Bl(i,t,n[h],e,this.boundHandleStyleImageChange_,s,o,a)||l;else l=Bl(i,t,n,e,this.boundHandleStyleImageChange_,s,o,a);return l}}class Xd extends La{constructor(t){super(t)}createRenderer(){return new D_(this)}}class Tp{constructor(t){this.rbush_=new kd(t),this.items_={}}insert(t,e){const n={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(n),this.items_[it(e)]=n}load(t,e){const n=new Array(e.length);for(let i=0,s=e.length;i<s;i++){const o=t[i],a=e[i],l={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:a};n[i]=l,this.items_[it(a)]=l}this.rbush_.load(n)}remove(t){const e=it(t),n=this.items_[e];return delete this.items_[e],this.rbush_.remove(n)!==null}update(t,e){const n=this.items_[it(e)],i=[n.minX,n.minY,n.maxX,n.maxY];Nn(i,t)||(this.remove(e),this.insert(t,e))}getAll(){return this.rbush_.all().map(function(t){return t.value})}getInExtent(t){const e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map(function(n){return n.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,e){return this.forEach_(this.getInExtent(t),e)}forEach_(t,e){let n;for(let i=0,s=t.length;i<s;i++)if(n=e(t[i]),n)return n;return n}isEmpty(){return Fn(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){const e=this.rbush_.toJSON();return Br(e.minX,e.minY,e.maxX,e.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(const e in t.items_)this.items_[e]=t.items_[e]}}class IC extends qi{constructor(t){super(),this.projection=tt(t.projection),this.attributions_=Mp(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible!==void 0?t.attributionsCollapsible:!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const e=this;this.viewPromise_=new Promise(function(n,i){e.viewResolver=n,e.viewRejector=i})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=Mp(t),this.changed()}setState(t){this.state_=t,this.changed()}}function Mp(r){return r?Array.isArray(r)?function(t){return r}:typeof r=="function"?r:function(t){return[r]}:null}const ro=IC,De={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function PC(r,t){return[[-1/0,-1/0,1/0,1/0]]}let AC=!1;function k_(r,t,e,n,i,s,o){const a=new XMLHttpRequest;a.open("GET",typeof r=="function"?r(e,n,i):r,!0),t.getType()=="arraybuffer"&&(a.responseType="arraybuffer"),a.withCredentials=AC,a.onload=function(l){if(!a.status||a.status>=200&&a.status<300){const h=t.getType();let u;h=="json"?u=JSON.parse(a.responseText):h=="text"?u=a.responseText:h=="xml"?(u=a.responseXML,u||(u=new DOMParser().parseFromString(a.responseText,"application/xml"))):h=="arraybuffer"&&(u=a.response),u?s(t.readFeatures(u,{extent:e,featureProjection:i}),t.readProjection(u)):o()}else o()},a.onerror=o,a.send()}function Rp(r,t){return function(e,n,i,s,o){const a=this;k_(r,t,e,n,i,function(l,h){a.addFeatures(l),s!==void 0&&s(l)},o||$o)}}class Qn extends fn{constructor(t,e,n){super(t),this.feature=e,this.features=n}}class Fh extends ro{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:t.wrapX!==void 0?t.wrapX:!0}),this.on,this.once,this.un,this.loader_=$o,this.format_=t.format,this.overlaps_=t.overlaps===void 0?!0:t.overlaps,this.url_=t.url,t.loader!==void 0?this.loader_=t.loader:this.url_!==void 0&&(At(this.format_,"`format` must be set when `url` is set"),this.loader_=Rp(this.url_,this.format_)),this.strategy_=t.strategy!==void 0?t.strategy:PC;const e=t.useSpatialIndex!==void 0?t.useSpatialIndex:!0;this.featuresRtree_=e?new Tp:null,this.loadedExtentsRtree_=new Tp,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let n,i;Array.isArray(t.features)?i=t.features:t.features&&(n=t.features,i=n.getArray()),!e&&n===void 0&&(n=new Dl(i)),i!==void 0&&this.addFeaturesInternal(i),n!==void 0&&this.bindFeaturesCollection_(n)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){const e=it(t);if(!this.addToIndex_(e,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(e,t);const n=t.getGeometry();if(n){const i=n.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(i,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new Qn(De.ADDFEATURE,t))}setupChangeEvents_(t,e){e instanceof Ge||(this.featureChangeKeys_[t]=[le(e,Lt.CHANGE,this.handleFeatureChange_,this),le(e,Fc.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(t,e){let n=!0;if(e.getId()!==void 0){const i=String(e.getId());if(!(i in this.idIndex_))this.idIndex_[i]=e;else if(e instanceof Ge){const s=this.idIndex_[i];s instanceof Ge?Array.isArray(s)?s.push(e):this.idIndex_[i]=[s,e]:n=!1}else n=!1}return n&&(At(!(t in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[t]=e),n}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){const e=[],n=[],i=[];for(let s=0,o=t.length;s<o;s++){const a=t[s],l=it(a);this.addToIndex_(l,a)&&n.push(a)}for(let s=0,o=n.length;s<o;s++){const a=n[s],l=it(a);this.setupChangeEvents_(l,a);const h=a.getGeometry();if(h){const u=h.getExtent();e.push(u),i.push(a)}else this.nullGeometryFeatures_[l]=a}if(this.featuresRtree_&&this.featuresRtree_.load(e,i),this.hasListener(De.ADDFEATURE))for(let s=0,o=n.length;s<o;s++)this.dispatchEvent(new Qn(De.ADDFEATURE,n[s]))}bindFeaturesCollection_(t){let e=!1;this.addEventListener(De.ADDFEATURE,function(n){e||(e=!0,t.push(n.feature),e=!1)}),this.addEventListener(De.REMOVEFEATURE,function(n){e||(e=!0,t.remove(n.feature),e=!1)}),t.addEventListener(ii.ADD,n=>{e||(e=!0,this.addFeature(n.element),e=!1)}),t.addEventListener(ii.REMOVE,n=>{e||(e=!0,this.removeFeature(n.element),e=!1)}),this.featuresCollection_=t}clear(t){if(t){for(const n in this.featureChangeKeys_)this.featureChangeKeys_[n].forEach(ve);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const n=i=>{this.removeFeatureInternal(i)};this.featuresRtree_.forEach(n);for(const i in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[i])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const e=new Qn(De.CLEAR);this.dispatchEvent(e),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,e){const n=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(n,function(i){const s=i.getGeometry();if(s instanceof Ge||s.intersectsCoordinate(t))return e(i)})}forEachFeatureInExtent(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureIntersectingExtent(t,e){return this.forEachFeatureInExtent(t,function(n){const i=n.getGeometry();if(i instanceof Ge||i.intersectsExtent(t)){const s=e(n);if(s)return s}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),Fn(this.nullGeometryFeatures_)||Ot(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){const e=[];return this.forEachFeatureAtCoordinateDirect(t,function(n){e.push(n)}),e}getFeaturesInExtent(t,e){if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);const n=Yx(t,e);return[].concat(...n.map(i=>this.featuresRtree_.getInExtent(i)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,e){const n=t[0],i=t[1];let s=null;const o=[NaN,NaN];let a=1/0;const l=[-1/0,-1/0,1/0,1/0];return e=e||Nx,this.featuresRtree_.forEachInExtent(l,function(h){if(e(h)){const u=h.getGeometry(),c=a;if(a=u instanceof Ge?0:u.closestPointXY(n,i,o,a),a<c){s=h;const f=Math.sqrt(a);l[0]=n-f,l[1]=i-f,l[2]=n+f,l[3]=i+f}}}),s}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){const e=this.idIndex_[t.toString()];return e!==void 0?e:null}getFeatureByUid(t){const e=this.uidIndex_[t];return e!==void 0?e:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){const e=t.target,n=it(e),i=e.getGeometry();if(!i)n in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[n]=e);else{const o=i.getExtent();n in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[n],this.featuresRtree_&&this.featuresRtree_.insert(o,e)):this.featuresRtree_&&this.featuresRtree_.update(o,e)}const s=e.getId();if(s!==void 0){const o=s.toString();this.idIndex_[o]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[o]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[n]=e;this.changed(),this.dispatchEvent(new Qn(De.CHANGEFEATURE,e))}hasFeature(t){const e=t.getId();return e!==void 0?e in this.idIndex_:it(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&Fn(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(t,e,n){const i=this.loadedExtentsRtree_,s=this.strategy_(t,e,n);for(let o=0,a=s.length;o<a;++o){const l=s[o];i.forEachInExtent(l,function(h){return Ze(h.extent,l)})||(++this.loadingExtentsCount_,this.dispatchEvent(new Qn(De.FEATURESLOADSTART)),this.loader_.call(this,l,e,n,h=>{--this.loadingExtentsCount_,this.dispatchEvent(new Qn(De.FEATURESLOADEND,void 0,h))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new Qn(De.FEATURESLOADERROR))}),i.insert(l,{extent:l.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){const e=this.loadedExtentsRtree_;let n;e.forEachInExtent(t,function(i){if(Nn(i.extent,t))return n=i,!0}),n&&e.remove(n)}removeFeatures(t){const e=[];for(let n=0,i=t.length;n<i;++n){const s=t[n],o=this.removeFeatureInternal(s);o&&e.push(o)}e.length>0&&this.changed()}removeFeature(t){t&&this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){const e=it(t);e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t);const n=this.featureChangeKeys_[e];if(!n)return;n.forEach(ve),delete this.featureChangeKeys_[e];const i=t.getId();return i!==void 0&&delete this.idIndex_[i.toString()],delete this.uidIndex_[e],this.hasListener(De.REMOVEFEATURE)&&this.dispatchEvent(new Qn(De.REMOVEFEATURE,t)),t}removeFromIdIndex_(t){let e=!1;for(const n in this.idIndex_){const i=this.idIndex_[n];if(t instanceof Ge&&Array.isArray(i)&&i.includes(t))i.splice(i.indexOf(t),1);else if(this.idIndex_[n]===t){delete this.idIndex_[n],e=!0;break}}return e}setLoader(t){this.loader_=t}setUrl(t){At(this.format_,"`format` must be set when `url` is set"),this.url_=t,this.setLoader(Rp(t,this.format_))}}function LC(r){if(!(r.context instanceof CanvasRenderingContext2D))throw new Error("Only works for render events from Canvas 2D layers");const t=r.inversePixelTransform[0],e=r.inversePixelTransform[1],n=Math.sqrt(t*t+e*e),i=r.frameState,s=Vs(r.inversePixelTransform.slice(),i.coordinateToPixelTransform),o=Ul(i.viewState.resolution,n);let a;return new P_(r.context,n,i.extent,s,i.viewState.rotation,o,a)}function G_(r,t,e){const n=[];let i=r(0),s=r(1),o=t(i),a=t(s);const l=[s,i],h=[a,o],u=[1,0],c={};let f=1e5,g,m,_,x,v,w;for(;--f>0&&u.length>0;)_=u.pop(),i=l.pop(),o=h.pop(),w=_.toString(),w in c||(n.push(o[0],o[1]),c[w]=!0),x=u.pop(),s=l.pop(),a=h.pop(),v=(_+x)/2,g=r(v),m=t(g),Zm(m[0],m[1],o[0],o[1],a[0],a[1])<e?(n.push(a[0],a[1]),w=x.toString(),c[w]=!0):(u.push(x,v,v,_),h.push(a,m,m,o),l.push(s,g,g,i));return n}function OC(r,t,e,n,i){const s=tt("EPSG:4326");return G_(function(o){return[r,t+(e-t)*o]},hn(s,n),i)}function FC(r,t,e,n,i){const s=tt("EPSG:4326");return G_(function(o){return[t+(e-t)*o,r]},hn(s,n),i)}const NC=new un({color:"rgba(0,0,0,0.2)"}),DC=[90,45,30,20,10,5,2,1,30/60,20/60,10/60,5/60,2/60,1/60,30/3600,20/3600,10/3600,5/3600,2/3600,1/3600];class kC extends Xd{constructor(t){t=t||{};const e=Object.assign({updateWhileAnimating:!0,updateWhileInteracting:!0,renderBuffer:0},t);delete e.maxLines,delete e.strokeStyle,delete e.targetSize,delete e.showLabels,delete e.lonLabelFormatter,delete e.latLabelFormatter,delete e.lonLabelPosition,delete e.latLabelPosition,delete e.lonLabelStyle,delete e.latLabelStyle,delete e.intervals,super(e),this.projection_=null,this.maxLat_=1/0,this.maxLon_=1/0,this.minLat_=-1/0,this.minLon_=-1/0,this.maxX_=1/0,this.maxY_=1/0,this.minX_=-1/0,this.minY_=-1/0,this.targetSize_=t.targetSize!==void 0?t.targetSize:100,this.maxLines_=t.maxLines!==void 0?t.maxLines:100,this.meridians_=[],this.parallels_=[],this.strokeStyle_=t.strokeStyle!==void 0?t.strokeStyle:NC,this.fromLonLatTransform_=void 0,this.toLonLatTransform_=void 0,this.projectionCenterLonLat_=null,this.bottomLeft_=null,this.bottomRight_=null,this.topLeft_=null,this.topRight_=null,this.meridiansLabels_=null,this.parallelsLabels_=null,t.showLabels&&(this.lonLabelFormatter_=t.lonLabelFormatter==null?ug.bind(this,"EW"):t.lonLabelFormatter,this.latLabelFormatter_=t.latLabelFormatter==null?ug.bind(this,"NS"):t.latLabelFormatter,this.lonLabelPosition_=t.lonLabelPosition==null?0:t.lonLabelPosition,this.latLabelPosition_=t.latLabelPosition==null?1:t.latLabelPosition,this.lonLabelStyleBase_=new Ve({text:t.lonLabelStyle!==void 0?t.lonLabelStyle.clone():new ji({font:"12px Calibri,sans-serif",textBaseline:"bottom",fill:new Wr({color:"rgba(0,0,0,1)"}),stroke:new un({color:"rgba(255,255,255,1)",width:3})})}),this.lonLabelStyle_=n=>{const i=n.get("graticule_label");return this.lonLabelStyleBase_.getText().setText(i),this.lonLabelStyleBase_},this.latLabelStyleBase_=new Ve({text:t.latLabelStyle!==void 0?t.latLabelStyle.clone():new ji({font:"12px Calibri,sans-serif",textAlign:"right",fill:new Wr({color:"rgba(0,0,0,1)"}),stroke:new un({color:"rgba(255,255,255,1)",width:3})})}),this.latLabelStyle_=n=>{const i=n.get("graticule_label");return this.latLabelStyleBase_.getText().setText(i),this.latLabelStyleBase_},this.meridiansLabels_=[],this.parallelsLabels_=[],this.addEventListener(ir.POSTRENDER,this.drawLabels_.bind(this))),this.intervals_=t.intervals!==void 0?t.intervals:DC,this.setSource(new Fh({loader:this.loaderFunction.bind(this),strategy:this.strategyFunction.bind(this),features:new Dl,overlaps:!1,useSpatialIndex:!1,wrapX:t.wrapX})),this.featurePool_=[],this.lineStyle_=new Ve({stroke:this.strokeStyle_}),this.loadedExtent_=null,this.renderedExtent_=null,this.renderedResolution_=null,this.setRenderOrder(null)}strategyFunction(t,e){let n=t.slice();return this.projection_&&this.getSource().getWrapX()&&Xc(n,this.projection_),this.loadedExtent_&&(Wx(this.loadedExtent_,n,e)?n=this.loadedExtent_.slice():this.getSource().removeLoadedExtent(this.loadedExtent_)),[n]}loaderFunction(t,e,n){this.loadedExtent_=t;const i=this.getSource(),s=this.getExtent()||[-1/0,-1/0,1/0,1/0],o=we(s,t);if(this.renderedExtent_&&Nn(this.renderedExtent_,o)&&this.renderedResolution_===e||(this.renderedExtent_=o,this.renderedResolution_=e,Un(o)))return;const a=Ce(o),l=e*e/4;(!this.projection_||!Ae(this.projection_,n))&&this.updateProjectionInfo_(n),this.createGraticule_(o,a,e,l);let h=this.meridians_.length+this.parallels_.length;this.meridiansLabels_&&(h+=this.meridians_.length),this.parallelsLabels_&&(h+=this.parallels_.length);let u;for(;h>this.featurePool_.length;)u=new Se,this.featurePool_.push(u);const c=i.getFeaturesCollection();c.clear();let f=0,g,m;for(g=0,m=this.meridians_.length;g<m;++g)u=this.featurePool_[f++],u.setGeometry(this.meridians_[g]),u.setStyle(this.lineStyle_),c.push(u);for(g=0,m=this.parallels_.length;g<m;++g)u=this.featurePool_[f++],u.setGeometry(this.parallels_[g]),u.setStyle(this.lineStyle_),c.push(u)}addMeridian_(t,e,n,i,s,o){const a=this.getMeridian_(t,e,n,i,o);if(Qt(a.getExtent(),s)){if(this.meridiansLabels_){const l=this.lonLabelFormatter_(t);o in this.meridiansLabels_?this.meridiansLabels_[o].text=l:this.meridiansLabels_[o]={geom:new Re([]),text:l}}this.meridians_[o++]=a}return o}addParallel_(t,e,n,i,s,o){const a=this.getParallel_(t,e,n,i,o);if(Qt(a.getExtent(),s)){if(this.parallelsLabels_){const l=this.latLabelFormatter_(t);o in this.parallelsLabels_?this.parallelsLabels_[o].text=l:this.parallelsLabels_[o]={geom:new Re([]),text:l}}this.parallels_[o++]=a}return o}drawLabels_(t){const e=t.frameState.viewState.rotation,n=t.frameState.viewState.resolution,i=t.frameState.size,s=t.frameState.extent,o=Ce(s);let a=s;if(e){const m=i[0]*n,_=i[1]*n;a=[o[0]-m/2,o[1]-_/2,o[0]+m/2,o[1]+_/2]}let l=0,h=0,u=this.latLabelPosition_<.5;const c=this.projection_.getExtent(),f=yt(c);if(this.getSource().getWrapX()&&this.projection_.canWrapX()&&!Ze(c,s)){l=Math.floor((s[0]-c[0])/f),h=Math.ceil((s[2]-c[2])/f);const m=Math.abs(e)>Math.PI/2;u=u!==m}const g=LC(t);for(let m=l;m<=h;++m){let _=this.meridians_.length+this.parallels_.length,x,v,w,S;if(this.meridiansLabels_)for(v=0,w=this.meridiansLabels_.length;v<w;++v){const E=this.meridians_[v];if(!e&&m===0)S=this.getMeridianPoint_(E,s,v);else{const T=E.clone();T.translate(m*f,0),T.rotate(-e,o),S=this.getMeridianPoint_(T,a,v),S.rotate(e,o)}x=this.featurePool_[_++],x.setGeometry(S),x.set("graticule_label",this.meridiansLabels_[v].text),g.drawFeature(x,this.lonLabelStyle_(x))}if(this.parallelsLabels_&&(m===l&&u||m===h&&!u))for(v=0,w=this.parallels_.length;v<w;++v){const E=this.parallels_[v];if(!e&&m===0)S=this.getParallelPoint_(E,s,v);else{const T=E.clone();T.translate(m*f,0),T.rotate(-e,o),S=this.getParallelPoint_(T,a,v),S.rotate(e,o)}x=this.featurePool_[_++],x.setGeometry(S),x.set("graticule_label",this.parallelsLabels_[v].text),g.drawFeature(x,this.latLabelStyle_(x))}}}createGraticule_(t,e,n,i){const s=this.getInterval_(n);if(s==-1){this.meridians_.length=0,this.parallels_.length=0,this.meridiansLabels_&&(this.meridiansLabels_.length=0),this.parallelsLabels_&&(this.parallelsLabels_.length=0);return}let o=!1;const a=this.projection_.getExtent(),l=yt(a);this.getSource().getWrapX()&&this.projection_.canWrapX()&&!Ze(a,t)&&(yt(t)>=l?(t[0]=a[0],t[2]=a[2]):o=!0);const h=[wt(e[0],this.minX_,this.maxX_),wt(e[1],this.minY_,this.maxY_)],u=this.toLonLatTransform_(h);isNaN(u[1])&&(u[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_);let c=wt(u[0],this.minLon_,this.maxLon_),f=wt(u[1],this.minLat_,this.maxLat_);const g=this.maxLines_;let m,_,x,v,w=t;o||(w=[wt(t[0],this.minX_,this.maxX_),wt(t[1],this.minY_,this.maxY_),wt(t[2],this.minX_,this.maxX_),wt(t[3],this.minY_,this.maxY_)]);const S=Fs(w,this.toLonLatTransform_,void 0,8);let E=S[3],T=S[2],R=S[1],C=S[0];if(o||(xr(w,this.bottomLeft_)&&(C=this.minLon_,R=this.minLat_),xr(w,this.bottomRight_)&&(T=this.maxLon_,R=this.minLat_),xr(w,this.topLeft_)&&(C=this.minLon_,E=this.maxLat_),xr(w,this.topRight_)&&(T=this.maxLon_,E=this.maxLat_),E=wt(E,f,this.maxLat_),T=wt(T,c,this.maxLon_),R=wt(R,this.minLat_,f),C=wt(C,this.minLon_,c)),c=Math.floor(c/s)*s,v=wt(c,this.minLon_,this.maxLon_),_=this.addMeridian_(v,R,E,i,t,0),m=0,o)for(;(v-=s)>=C&&m++<g;)_=this.addMeridian_(v,R,E,i,t,_);else for(;v!=this.minLon_&&m++<g;)v=Math.max(v-s,this.minLon_),_=this.addMeridian_(v,R,E,i,t,_);if(v=wt(c,this.minLon_,this.maxLon_),m=0,o)for(;(v+=s)<=T&&m++<g;)_=this.addMeridian_(v,R,E,i,t,_);else for(;v!=this.maxLon_&&m++<g;)v=Math.min(v+s,this.maxLon_),_=this.addMeridian_(v,R,E,i,t,_);for(this.meridians_.length=_,this.meridiansLabels_&&(this.meridiansLabels_.length=_),f=Math.floor(f/s)*s,x=wt(f,this.minLat_,this.maxLat_),_=this.addParallel_(x,C,T,i,t,0),m=0;x!=this.minLat_&&m++<g;)x=Math.max(x-s,this.minLat_),_=this.addParallel_(x,C,T,i,t,_);for(x=wt(f,this.minLat_,this.maxLat_),m=0;x!=this.maxLat_&&m++<g;)x=Math.min(x+s,this.maxLat_),_=this.addParallel_(x,C,T,i,t,_);this.parallels_.length=_,this.parallelsLabels_&&(this.parallelsLabels_.length=_)}getInterval_(t){const e=this.projectionCenterLonLat_[0],n=this.projectionCenterLonLat_[1];let i=-1;const s=Math.pow(this.targetSize_*t,2),o=[],a=[];for(let l=0,h=this.intervals_.length;l<h;++l){const u=wt(this.intervals_[l]/2,0,90),c=wt(n,-90+u,90-u);if(o[0]=e-u,o[1]=c-u,a[0]=e+u,a[1]=c+u,this.fromLonLatTransform_(o,o),this.fromLonLatTransform_(a,a),Math.pow(a[0]-o[0],2)+Math.pow(a[1]-o[1],2)<=s)break;i=this.intervals_[l]}return i}getMeridian_(t,e,n,i,s){const o=OC(t,e,n,this.projection_,i);let a=this.meridians_[s];return a?(a.setFlatCoordinates("XY",o),a.changed()):(a=new ye(o,"XY"),this.meridians_[s]=a),a}getMeridianPoint_(t,e,n){const i=t.getFlatCoordinates();let s=1,o=i.length-1;i[s]>i[o]&&(s=o,o=1);const a=Math.max(e[1],i[s]),l=Math.min(e[3],i[o]),h=wt(e[1]+Math.abs(e[1]-e[3])*this.lonLabelPosition_,a,l),u=[i[s-1]+(i[o-1]-i[s-1])*(h-i[s])/(i[o]-i[s]),h],c=this.meridiansLabels_[n].geom;return c.setCoordinates(u),c}getMeridians(){return this.meridians_}getParallel_(t,e,n,i,s){const o=FC(t,e,n,this.projection_,i);let a=this.parallels_[s];return a?(a.setFlatCoordinates("XY",o),a.changed()):a=new ye(o,"XY"),a}getParallelPoint_(t,e,n){const i=t.getFlatCoordinates();let s=0,o=i.length-2;i[s]>i[o]&&(s=o,o=0);const a=Math.max(e[0],i[s]),l=Math.min(e[2],i[o]),h=wt(e[0]+Math.abs(e[0]-e[2])*this.latLabelPosition_,a,l),u=i[s+1]+(i[o+1]-i[s+1])*(h-i[s])/(i[o]-i[s]),c=[h,u],f=this.parallelsLabels_[n].geom;return f.setCoordinates(c),f}getParallels(){return this.parallels_}updateProjectionInfo_(t){const e=tt("EPSG:4326"),n=t.getWorldExtent();this.maxLat_=n[3],this.maxLon_=n[2],this.minLat_=n[1],this.minLon_=n[0];const i=hn(t,e);if(this.minLon_<this.maxLon_)this.toLonLatTransform_=i;else{const o=this.minLon_+this.maxLon_/2;this.maxLon_+=360,this.toLonLatTransform_=function(a,l,h){h=h||2;const u=i(a,l,h);for(let c=0,f=u.length;c<f;c+=h)u[c]<o&&(u[c]+=360);return u}}this.fromLonLatTransform_=hn(e,t);const s=Fs([this.minLon_,this.minLat_,this.maxLon_,this.maxLat_],this.fromLonLatTransform_,void 0,8);this.minX_=s[0],this.maxX_=s[2],this.minY_=s[1],this.maxY_=s[3],this.bottomLeft_=this.fromLonLatTransform_([this.minLon_,this.minLat_]),this.bottomRight_=this.fromLonLatTransform_([this.maxLon_,this.minLat_]),this.topLeft_=this.fromLonLatTransform_([this.minLon_,this.maxLat_]),this.topRight_=this.fromLonLatTransform_([this.maxLon_,this.maxLat_]),this.projectionCenterLonLat_=this.toLonLatTransform_(Ce(t.getExtent())),isNaN(this.projectionCenterLonLat_[1])&&(this.projectionCenterLonLat_[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_),this.projection_=t}}const GC=kC;class ns extends fn{constructor(t,e){super(t),this.layer=e}}const bu={LAYERS:"layers"};class Nh extends p_{constructor(t){t=t||{};const e=Object.assign({},t);delete e.layers;let n=t.layers;super(e),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(bu.LAYERS,this.handleLayersChanged_),n?Array.isArray(n)?n=new Dl(n.slice(),{unique:!0}):At(typeof n.getArray=="function","Expected `layers` to be an array or a `Collection`"):n=new Dl(void 0,{unique:!0}),this.setLayers(n)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(ve),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push(le(t,ii.ADD,this.handleLayersAdd_,this),le(t,ii.REMOVE,this.handleLayersRemove_,this));for(const n in this.listenerKeys_)this.listenerKeys_[n].forEach(ve);$s(this.listenerKeys_);const e=t.getArray();for(let n=0,i=e.length;n<i;n++){const s=e[n];this.registerLayerListeners_(s),this.dispatchEvent(new ns("addlayer",s))}this.changed()}registerLayerListeners_(t){const e=[le(t,Fc.PROPERTYCHANGE,this.handleLayerChange_,this),le(t,Lt.CHANGE,this.handleLayerChange_,this)];t instanceof Nh&&e.push(le(t,"addlayer",this.handleLayerGroupAdd_,this),le(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[it(t)]=e}handleLayerGroupAdd_(t){this.dispatchEvent(new ns("addlayer",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new ns("removelayer",t.layer))}handleLayersAdd_(t){const e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new ns("addlayer",e)),this.changed()}handleLayersRemove_(t){const e=t.element,n=it(e);this.listenerKeys_[n].forEach(ve),delete this.listenerKeys_[n],this.dispatchEvent(new ns("removelayer",e)),this.changed()}getLayers(){return this.get(bu.LAYERS)}setLayers(t){const e=this.getLayers();if(e){const n=e.getArray();for(let i=0,s=n.length;i<s;++i)this.dispatchEvent(new ns("removelayer",n[i]))}this.set(bu.LAYERS,t)}getLayersArray(t){return t=t!==void 0?t:[],this.getLayers().forEach(function(e){e.getLayersArray(t)}),t}getLayerStatesArray(t){const e=t!==void 0?t:[],n=e.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(e)});const i=this.getLayerState();let s=i.zIndex;!t&&i.zIndex===void 0&&(s=0);for(let o=n,a=e.length;o<a;o++){const l=e[o];l.opacity*=i.opacity,l.visible=l.visible&&i.visible,l.maxResolution=Math.min(l.maxResolution,i.maxResolution),l.minResolution=Math.max(l.minResolution,i.minResolution),l.minZoom=Math.max(l.minZoom,i.minZoom),l.maxZoom=Math.min(l.maxZoom,i.maxZoom),i.extent!==void 0&&(l.extent!==void 0?l.extent=we(l.extent,i.extent):l.extent=i.extent),l.zIndex===void 0&&(l.zIndex=s)}return e}getSourceState(){return"ready"}}const Dh=34962,kh=34963,jC=35040,Wd=35044,gc=35048,zC=5121,UC=5123,BC=5125,j_=5126,Cp=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function XC(r,t){t=Object.assign({preserveDrawingBuffer:!0,antialias:!Ob},t);const e=Cp.length;for(let n=0;n<e;++n)try{const i=r.getContext(Cp[n],t);if(i)return i}catch{}return null}const WC={STATIC_DRAW:Wd,STREAM_DRAW:jC,DYNAMIC_DRAW:gc};class Xl{constructor(t,e){this.array_=null,this.type_=t,At(t===Dh||t===kh,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage_=e!==void 0?e:WC.STATIC_DRAW}ofSize(t){return this.array_=new(Su(this.type_))(t),this}fromArray(t){return this.array_=Su(this.type_).from(t),this}fromArrayBuffer(t){return this.array_=new(Su(this.type_))(t),this}getType(){return this.type_}getArray(){return this.array_}getUsage(){return this.usage_}getSize(){return this.array_?this.array_.length:0}}function Su(r){switch(r){case Dh:return Float32Array;case kh:return Uint32Array;default:return Float32Array}}const ol={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"},qC=`
  precision mediump float;
  
  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;
  
  uniform vec2 u_screenSize;
   
  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,ZC=`
  precision mediump float;
   
  uniform sampler2D u_image;
  uniform float u_opacity;
   
  varying vec2 v_texCoord;
   
  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`;class Ip{constructor(t){this.gl_=t.webGlContext;const e=this.gl_;this.scaleRatio_=t.scaleRatio||1,this.renderTargetTexture_=e.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=e.createFramebuffer(),this.depthBuffer_=e.createRenderbuffer();const n=e.createShader(e.VERTEX_SHADER);e.shaderSource(n,t.vertexShader||qC),e.compileShader(n);const i=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(i,t.fragmentShader||ZC),e.compileShader(i),this.renderTargetProgram_=e.createProgram(),e.attachShader(this.renderTargetProgram_,n),e.attachShader(this.renderTargetProgram_,i),e.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=e.createBuffer();const s=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];e.bindBuffer(e.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),e.bufferData(e.ARRAY_BUFFER,new Float32Array(s),e.STATIC_DRAW),this.renderTargetAttribLocation_=e.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],t.uniforms&&Object.keys(t.uniforms).forEach(o=>{this.uniforms_.push({value:t.uniforms[o],location:e.getUniformLocation(this.renderTargetProgram_,o)})})}getGL(){return this.gl_}init(t){const e=this.getGL(),n=[e.drawingBufferWidth*this.scaleRatio_,e.drawingBufferHeight*this.scaleRatio_];if(e.bindFramebuffer(e.FRAMEBUFFER,this.getFrameBuffer()),e.bindRenderbuffer(e.RENDERBUFFER,this.getDepthBuffer()),e.viewport(0,0,n[0],n[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==n[0]||this.renderTargetTextureSize_[1]!==n[1]){this.renderTargetTextureSize_=n;const i=0,s=e.RGBA,o=0,a=e.RGBA,l=e.UNSIGNED_BYTE;e.bindTexture(e.TEXTURE_2D,this.renderTargetTexture_),e.texImage2D(e.TEXTURE_2D,i,s,n[0],n[1],o,a,l,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.renderTargetTexture_,0),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,n[0],n[1]),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this.depthBuffer_)}}apply(t,e,n,i){const s=this.getGL(),o=t.size;if(s.bindFramebuffer(s.FRAMEBUFFER,e?e.getFrameBuffer():null),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this.renderTargetTexture_),!e){const l=it(s.canvas);if(!t.renderTargets[l]){const h=s.getContextAttributes();h&&h.preserveDrawingBuffer&&(s.clearColor(0,0,0,0),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT)),t.renderTargets[l]=!0}}s.disable(s.DEPTH_TEST),s.enable(s.BLEND),s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA),s.viewport(0,0,s.drawingBufferWidth,s.drawingBufferHeight),s.bindBuffer(s.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),s.useProgram(this.renderTargetProgram_),s.enableVertexAttribArray(this.renderTargetAttribLocation_),s.vertexAttribPointer(this.renderTargetAttribLocation_,2,s.FLOAT,!1,0,0),s.uniform2f(this.renderTargetUniformLocation_,o[0],o[1]),s.uniform1i(this.renderTargetTextureLocation_,0);const a=t.layerStatesArray[t.layerIndex].opacity;s.uniform1f(this.renderTargetOpacityLocation_,a),this.applyUniforms(t),n&&n(s,t),s.drawArrays(s.TRIANGLES,0,6),i&&i(s,t)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(t){const e=this.getGL();let n,i=1;this.uniforms_.forEach(function(s){if(n=typeof s.value=="function"?s.value(t):s.value,n instanceof HTMLCanvasElement||n instanceof ImageData)s.texture||(s.texture=e.createTexture()),e.activeTexture(e[`TEXTURE${i}`]),e.bindTexture(e.TEXTURE_2D,s.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),n instanceof ImageData?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,n.width,n.height,0,e.UNSIGNED_BYTE,new Uint8Array(n.data)):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n),e.uniform1i(s.location,i++);else if(Array.isArray(n))switch(n.length){case 2:e.uniform2f(s.location,n[0],n[1]);return;case 3:e.uniform3f(s.location,n[0],n[1],n[2]);return;case 4:e.uniform4f(s.location,n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&e.uniform1f(s.location,n)})}}function z_(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function U_(r,t){return r[0]=t[0],r[1]=t[1],r[4]=t[2],r[5]=t[3],r[12]=t[4],r[13]=t[5],r}const Sn={PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},tn={UNSIGNED_BYTE:zC,UNSIGNED_SHORT:UC,UNSIGNED_INT:BC,FLOAT:j_},Wl={};function Pp(r){return"shared/"+r}let Ap=0;function $C(){const r="unique/"+Ap;return Ap+=1,r}function VC(r){let t=Wl[r];if(!t){const e=document.createElement("canvas");e.width=1,e.height=1,e.style.position="absolute",e.style.left="0",t={users:0,context:XC(e)},Wl[r]=t}return t.users+=1,t.context}function YC(r){const t=Wl[r];if(!t||(t.users-=1,t.users>0))return;const e=t.context,n=e.getExtension("WEBGL_lose_context");n&&n.loseContext();const i=e.canvas;i.width=1,i.height=1,delete Wl[r]}class HC extends Nc{constructor(t){super(),t=t||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=t.canvasCacheKey?Pp(t.canvasCacheKey):$C(),this.gl_=VC(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;const e=this.gl_.canvas;e.addEventListener(ol.LOST,this.boundHandleWebGLContextLost_),e.addEventListener(ol.RESTORED,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=pe(),this.offsetScaleMatrix_=pe(),this.tmpMat4_=z_(),this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],t.uniforms&&this.setUniforms(t.uniforms),this.postProcessPasses_=t.postProcesses?t.postProcesses.map(n=>new Ip({webGlContext:this.gl_,scaleRatio:n.scaleRatio,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,uniforms:n.uniforms})):[new Ip({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now()}setUniforms(t){this.uniforms_=[],this.addUniforms(t)}addUniforms(t){for(const e in t)this.uniforms_.push({name:e,value:t[e]})}canvasCacheKeyMatches(t){return this.canvasCacheKey_===Pp(t)}getExtension(t){if(t in this.extensionCache_)return this.extensionCache_[t];const e=this.gl_.getExtension(t);return this.extensionCache_[t]=e,e}bindBuffer(t){const e=this.gl_,n=it(t);let i=this.bufferCache_[n];if(!i){const s=e.createBuffer();i={buffer:t,webGlBuffer:s},this.bufferCache_[n]=i}e.bindBuffer(t.getType(),i.webGlBuffer)}flushBufferData(t){const e=this.gl_;this.bindBuffer(t),e.bufferData(t.getType(),t.getArray(),t.getUsage())}deleteBuffer(t){const e=this.gl_,n=it(t),i=this.bufferCache_[n];i&&!e.isContextLost()&&e.deleteBuffer(i.webGlBuffer),delete this.bufferCache_[n]}disposeInternal(){const t=this.gl_.canvas;t.removeEventListener(ol.LOST,this.boundHandleWebGLContextLost_),t.removeEventListener(ol.RESTORED,this.boundHandleWebGLContextRestored_),YC(this.canvasCacheKey_),delete this.gl_}prepareDraw(t,e,n){const i=this.gl_,s=this.getCanvas(),o=t.size,a=t.pixelRatio;(s.width!==o[0]*a||s.height!==o[1]*a)&&(s.width=o[0]*a,s.height=o[1]*a,s.style.width=o[0]+"px",s.style.height=o[1]+"px");for(let l=this.postProcessPasses_.length-1;l>=0;l--)this.postProcessPasses_[l].init(t);i.bindTexture(i.TEXTURE_2D,null),i.clearColor(0,0,0,0),i.depthRange(0,1),i.clearDepth(1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.enable(i.BLEND),i.blendFunc(i.ONE,e?i.ZERO:i.ONE_MINUS_SRC_ALPHA),n?(i.enable(i.DEPTH_TEST),i.depthFunc(i.LEQUAL)):i.disable(i.DEPTH_TEST)}bindTexture(t,e,n){const i=this.gl_;i.activeTexture(i.TEXTURE0+e),i.bindTexture(i.TEXTURE_2D,t),i.uniform1i(this.getUniformLocation(n),e)}prepareDrawToRenderTarget(t,e,n,i){const s=this.gl_,o=e.getSize();s.bindFramebuffer(s.FRAMEBUFFER,e.getFramebuffer()),s.bindRenderbuffer(s.RENDERBUFFER,e.getDepthbuffer()),s.viewport(0,0,o[0],o[1]),s.bindTexture(s.TEXTURE_2D,e.getTexture()),s.clearColor(0,0,0,0),s.depthRange(0,1),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.enable(s.BLEND),s.blendFunc(s.ONE,n?s.ZERO:s.ONE_MINUS_SRC_ALPHA),i?(s.enable(s.DEPTH_TEST),s.depthFunc(s.LEQUAL)):s.disable(s.DEPTH_TEST)}drawElements(t,e){const n=this.gl_;this.getExtension("OES_element_index_uint");const i=n.UNSIGNED_INT,s=4,o=e-t,a=t*s;n.drawElements(n.TRIANGLES,o,i,a)}finalizeDraw(t,e,n){for(let i=0,s=this.postProcessPasses_.length;i<s;i++)i===s-1?this.postProcessPasses_[i].apply(t,null,e,n):this.postProcessPasses_[i].apply(t,this.postProcessPasses_[i+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(t){const e=t.size,n=t.viewState.rotation,i=t.pixelRatio;this.setUniformFloatValue(Sn.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(Sn.ZOOM,t.viewState.zoom),this.setUniformFloatValue(Sn.RESOLUTION,t.viewState.resolution),this.setUniformFloatValue(Sn.PIXEL_RATIO,i),this.setUniformFloatVec2(Sn.VIEWPORT_SIZE_PX,[e[0],e[1]]),this.setUniformFloatValue(Sn.ROTATION,n)}applyHitDetectionUniform(t){const e=this.getUniformLocation(Sn.HIT_DETECTION);this.getGL().uniform1i(e,t?1:0),t&&this.setUniformFloatValue(Sn.PIXEL_RATIO,.5)}applyUniforms(t){const e=this.gl_;let n,i=0;this.uniforms_.forEach(s=>{if(n=typeof s.value=="function"?s.value(t):s.value,n instanceof HTMLCanvasElement||n instanceof HTMLImageElement||n instanceof ImageData||n instanceof WebGLTexture){n instanceof WebGLTexture&&!s.texture?(s.prevValue=void 0,s.texture=n):s.texture||(s.prevValue=void 0,s.texture=e.createTexture()),this.bindTexture(s.texture,i,s.name),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);const o=!(n instanceof HTMLImageElement)||n.complete;!(n instanceof WebGLTexture)&&o&&s.prevValue!==n&&(s.prevValue=n,e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)),i++}else if(Array.isArray(n)&&n.length===6)this.setUniformMatrixValue(s.name,U_(this.tmpMat4_,n));else if(Array.isArray(n)&&n.length<=4)switch(n.length){case 2:e.uniform2f(this.getUniformLocation(s.name),n[0],n[1]);return;case 3:e.uniform3f(this.getUniformLocation(s.name),n[0],n[1],n[2]);return;case 4:e.uniform4f(this.getUniformLocation(s.name),n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&e.uniform1f(this.getUniformLocation(s.name),n)})}useProgram(t,e){this.gl_.useProgram(t),this.currentProgram_=t,this.applyFrameState(e),this.applyUniforms(e)}compileShader(t,e){const n=this.gl_,i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}getProgram(t,e){const n=this.gl_,i=this.compileShader(t,n.FRAGMENT_SHADER),s=this.compileShader(e,n.VERTEX_SHADER),o=n.createProgram();if(n.attachShader(o,i),n.attachShader(o,s),n.linkProgram(o),!n.getShaderParameter(i,n.COMPILE_STATUS)){const a=`Fragment shader compilation failed: ${n.getShaderInfoLog(i)}`;throw new Error(a)}if(n.deleteShader(i),!n.getShaderParameter(s,n.COMPILE_STATUS)){const a=`Vertex shader compilation failed: ${n.getShaderInfoLog(s)}`;throw new Error(a)}if(n.deleteShader(s),!n.getProgramParameter(o,n.LINK_STATUS)){const a=`GL program linking failed: ${n.getProgramInfoLog(o)}`;throw new Error(a)}return o}getUniformLocation(t){const e=it(this.currentProgram_);return this.uniformLocationsByProgram_[e]===void 0&&(this.uniformLocationsByProgram_[e]={}),this.uniformLocationsByProgram_[e][t]===void 0&&(this.uniformLocationsByProgram_[e][t]=this.gl_.getUniformLocation(this.currentProgram_,t)),this.uniformLocationsByProgram_[e][t]}getAttributeLocation(t){const e=it(this.currentProgram_);return this.attribLocationsByProgram_[e]===void 0&&(this.attribLocationsByProgram_[e]={}),this.attribLocationsByProgram_[e][t]===void 0&&(this.attribLocationsByProgram_[e][t]=this.gl_.getAttribLocation(this.currentProgram_,t)),this.attribLocationsByProgram_[e][t]}makeProjectionTransform(t,e){const n=t.size,i=t.viewState.rotation,s=t.viewState.resolution,o=t.viewState.center;return hr(e,0,0,2/(s*n[0]),2/(s*n[1]),-i,-o[0],-o[1]),e}setUniformFloatValue(t,e){this.gl_.uniform1f(this.getUniformLocation(t),e)}setUniformFloatVec2(t,e){this.gl_.uniform2fv(this.getUniformLocation(t),e)}setUniformFloatVec4(t,e){this.gl_.uniform4fv(this.getUniformLocation(t),e)}setUniformMatrixValue(t,e){this.gl_.uniformMatrix4fv(this.getUniformLocation(t),!1,e)}enableAttributeArray_(t,e,n,i,s){const o=this.getAttributeLocation(t);o<0||(this.gl_.enableVertexAttribArray(o),this.gl_.vertexAttribPointer(o,e,n,!1,i,s))}enableAttributes(t){const e=KC(t);let n=0;for(let i=0;i<t.length;i++){const s=t[i];this.enableAttributeArray_(s.name,s.size,s.type||j_,e,n),n+=s.size*B_(s.type)}}handleWebGLContextLost(t){$s(this.bufferCache_),this.currentProgram_=null,t.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(t,e,n){const i=this.gl_;n=n||i.createTexture();const s=0,o=i.RGBA,a=0,l=i.RGBA,h=i.UNSIGNED_BYTE;return i.bindTexture(i.TEXTURE_2D,n),e?i.texImage2D(i.TEXTURE_2D,s,o,l,h,e):i.texImage2D(i.TEXTURE_2D,s,o,t[0],t[1],a,l,h,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),n}}function KC(r){let t=0;for(let e=0;e<r.length;e++){const n=r[e];t+=n.size*B_(n.type)}return t}function B_(r){switch(r){case tn.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case tn.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case tn.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case tn.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}class Gh extends C_{constructor(t,e){super(t),e=e||{},this.inversePixelTransform_=pe(),this.pixelContext_=null,this.postProcesses_=e.postProcesses,this.uniforms_=e.uniforms,this.helper,t.addChangeListener(Ut.MAP,this.removeHelper.bind(this)),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(t,e){const n=this.getLayer();if(n.hasListener(ir.PRECOMPOSE)){const i=new gl(ir.PRECOMPOSE,void 0,e,t);n.dispatchEvent(i)}}dispatchPostComposeEvent(t,e){const n=this.getLayer();if(n.hasListener(ir.POSTCOMPOSE)){const i=new gl(ir.POSTCOMPOSE,void 0,e,t);n.dispatchEvent(i)}}reset(t){this.uniforms_=t.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(t){if(this.getLayer().getRenderSource()){let e=!0,n=-1,i;for(let o=0,a=t.layerStatesArray.length;o<a;o++){const l=t.layerStatesArray[o].layer,h=l.getRenderer();if(!(h instanceof Gh)){e=!0;continue}const u=l.getClassName();if((e||u!==i)&&(n+=1,e=!1),i=u,h===this)break}const s="map/"+t.mapId+"/group/"+n;(!this.helper||!this.helper.canvasCacheKeyMatches(s)||this.helper.needsToBeRecreated())&&(this.removeHelper(),this.helper=new HC({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:s}),i&&(this.helper.getCanvas().className=i),this.afterHelperCreated())}return this.prepareFrameInternal(t)}afterHelperCreated(){}prepareFrameInternal(t){return!0}disposeInternal(){this.removeHelper(),super.disposeInternal()}dispatchRenderEvent_(t,e,n){const i=this.getLayer();if(i.hasListener(t)){hr(this.inversePixelTransform_,0,0,n.pixelRatio,-n.pixelRatio,0,0,-n.size[1]);const s=new gl(t,this.inversePixelTransform_,n,e);i.dispatchEvent(s)}}preRender(t,e){this.dispatchRenderEvent_(ir.PRERENDER,t,e)}postRender(t,e){this.dispatchRenderEvent_(ir.POSTRENDER,t,e)}}const Yr=new Uint8Array(4);class QC{constructor(t,e){this.helper_=t;const n=t.getGL();this.texture_=n.createTexture(),this.framebuffer_=n.createFramebuffer(),this.depthbuffer_=n.createRenderbuffer(),this.size_=e||[1,1],this.data_=new Uint8Array(0),this.dataCacheDirty_=!0,this.updateSize_()}setSize(t){Wi(t,this.size_)||(this.size_[0]=t[0],this.size_[1]=t[1],this.updateSize_())}getSize(){return this.size_}clearCachedData(){this.dataCacheDirty_=!0}readAll(){if(this.dataCacheDirty_){const t=this.size_,e=this.helper_.getGL();e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer_),e.readPixels(0,0,t[0],t[1],e.RGBA,e.UNSIGNED_BYTE,this.data_),this.dataCacheDirty_=!1}return this.data_}readPixel(t,e){if(t<0||e<0||t>this.size_[0]||e>=this.size_[1])return Yr[0]=0,Yr[1]=0,Yr[2]=0,Yr[3]=0,Yr;this.readAll();const n=Math.floor(t)+(this.size_[1]-Math.floor(e)-1)*this.size_[0];return Yr[0]=this.data_[n*4],Yr[1]=this.data_[n*4+1],Yr[2]=this.data_[n*4+2],Yr[3]=this.data_[n*4+3],Yr}getTexture(){return this.texture_}getFramebuffer(){return this.framebuffer_}getDepthbuffer(){return this.depthbuffer_}updateSize_(){const t=this.size_,e=this.helper_.getGL();this.texture_=this.helper_.createTexture(t,null,this.texture_),e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer_),e.viewport(0,0,t[0],t[1]),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture_,0),e.bindRenderbuffer(e.RENDERBUFFER,this.depthbuffer_),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t[0],t[1]),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this.depthbuffer_),this.data_=new Uint8Array(t[0]*t[1]*4)}}const Lp={GENERATE_POLYGON_BUFFERS:"GENERATE_POLYGON_BUFFERS",GENERATE_POINT_BUFFERS:"GENERATE_POINT_BUFFERS",GENERATE_LINE_STRING_BUFFERS:"GENERATE_LINE_STRING_BUFFERS"};var X_={exports:{}};X_.exports=jh;X_.exports.default=jh;function jh(r,t,e){e=e||2;var n=t&&t.length,i=n?t[0]*e:r.length,s=W_(r,0,i,e,!0),o=[];if(!s||s.next===s.prev)return o;var a,l,h,u,c,f,g;if(n&&(s=nI(r,t,s,e)),r.length>80*e){a=h=r[0],l=u=r[1];for(var m=e;m<i;m+=e)c=r[m],f=r[m+1],c<a&&(a=c),f<l&&(l=f),c>h&&(h=c),f>u&&(u=f);g=Math.max(h-a,u-l),g=g!==0?32767/g:0}return sa(s,o,e,a,l,g,0),o}function W_(r,t,e,n,i){var s,o;if(i===_c(r,t,e,n)>0)for(s=t;s<e;s+=n)o=Op(s,r[s],r[s+1],o);else for(s=e-n;s>=t;s-=n)o=Op(s,r[s],r[s+1],o);return o&&zh(o,o.next)&&(aa(o),o=o.next),o}function zi(r,t){if(!r)return r;t||(t=r);var e=r,n;do if(n=!1,!e.steiner&&(zh(e,e.next)||he(e.prev,e,e.next)===0)){if(aa(e),e=t=e.prev,e===e.next)break;n=!0}else e=e.next;while(n||e!==t);return t}function sa(r,t,e,n,i,s,o){if(r){!o&&s&&lI(r,n,i,s);for(var a=r,l,h;r.prev!==r.next;){if(l=r.prev,h=r.next,s?tI(r,n,i,s):JC(r)){t.push(l.i/e|0),t.push(r.i/e|0),t.push(h.i/e|0),aa(r),r=h.next,a=h.next;continue}if(r=h,r===a){o?o===1?(r=eI(zi(r),t,e),sa(r,t,e,n,i,s,2)):o===2&&rI(r,t,e,n,i,s):sa(zi(r),t,e,n,i,s,1);break}}}}function JC(r){var t=r.prev,e=r,n=r.next;if(he(t,e,n)>=0)return!1;for(var i=t.x,s=e.x,o=n.x,a=t.y,l=e.y,h=n.y,u=i<s?i<o?i:o:s<o?s:o,c=a<l?a<h?a:h:l<h?l:h,f=i>s?i>o?i:o:s>o?s:o,g=a>l?a>h?a:h:l>h?l:h,m=n.next;m!==t;){if(m.x>=u&&m.x<=f&&m.y>=c&&m.y<=g&&xs(i,a,s,l,o,h,m.x,m.y)&&he(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function tI(r,t,e,n){var i=r.prev,s=r,o=r.next;if(he(i,s,o)>=0)return!1;for(var a=i.x,l=s.x,h=o.x,u=i.y,c=s.y,f=o.y,g=a<l?a<h?a:h:l<h?l:h,m=u<c?u<f?u:f:c<f?c:f,_=a>l?a>h?a:h:l>h?l:h,x=u>c?u>f?u:f:c>f?c:f,v=pc(g,m,t,e,n),w=pc(_,x,t,e,n),S=r.prevZ,E=r.nextZ;S&&S.z>=v&&E&&E.z<=w;){if(S.x>=g&&S.x<=_&&S.y>=m&&S.y<=x&&S!==i&&S!==o&&xs(a,u,l,c,h,f,S.x,S.y)&&he(S.prev,S,S.next)>=0||(S=S.prevZ,E.x>=g&&E.x<=_&&E.y>=m&&E.y<=x&&E!==i&&E!==o&&xs(a,u,l,c,h,f,E.x,E.y)&&he(E.prev,E,E.next)>=0))return!1;E=E.nextZ}for(;S&&S.z>=v;){if(S.x>=g&&S.x<=_&&S.y>=m&&S.y<=x&&S!==i&&S!==o&&xs(a,u,l,c,h,f,S.x,S.y)&&he(S.prev,S,S.next)>=0)return!1;S=S.prevZ}for(;E&&E.z<=w;){if(E.x>=g&&E.x<=_&&E.y>=m&&E.y<=x&&E!==i&&E!==o&&xs(a,u,l,c,h,f,E.x,E.y)&&he(E.prev,E,E.next)>=0)return!1;E=E.nextZ}return!0}function eI(r,t,e){var n=r;do{var i=n.prev,s=n.next.next;!zh(i,s)&&q_(i,n,n.next,s)&&oa(i,s)&&oa(s,i)&&(t.push(i.i/e|0),t.push(n.i/e|0),t.push(s.i/e|0),aa(n),aa(n.next),n=r=s),n=n.next}while(n!==r);return zi(n)}function rI(r,t,e,n,i,s){var o=r;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&cI(o,a)){var l=Z_(o,a);o=zi(o,o.next),l=zi(l,l.next),sa(o,t,e,n,i,s,0),sa(l,t,e,n,i,s,0);return}a=a.next}o=o.next}while(o!==r)}function nI(r,t,e,n){var i=[],s,o,a,l,h;for(s=0,o=t.length;s<o;s++)a=t[s]*n,l=s<o-1?t[s+1]*n:r.length,h=W_(r,a,l,n,!1),h===h.next&&(h.steiner=!0),i.push(uI(h));for(i.sort(iI),s=0;s<i.length;s++)e=sI(i[s],e);return e}function iI(r,t){return r.x-t.x}function sI(r,t){var e=oI(r,t);if(!e)return t;var n=Z_(e,r);return zi(n,n.next),zi(e,e.next)}function oI(r,t){var e=t,n=r.x,i=r.y,s=-1/0,o;do{if(i<=e.y&&i>=e.next.y&&e.next.y!==e.y){var a=e.x+(i-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(a<=n&&a>s&&(s=a,o=e.x<e.next.x?e:e.next,a===n))return o}e=e.next}while(e!==t);if(!o)return null;var l=o,h=o.x,u=o.y,c=1/0,f;e=o;do n>=e.x&&e.x>=h&&n!==e.x&&xs(i<u?n:s,i,h,u,i<u?s:n,i,e.x,e.y)&&(f=Math.abs(i-e.y)/(n-e.x),oa(e,r)&&(f<c||f===c&&(e.x>o.x||e.x===o.x&&aI(o,e)))&&(o=e,c=f)),e=e.next;while(e!==l);return o}function aI(r,t){return he(r.prev,r,t.prev)<0&&he(t.next,r,r.next)<0}function lI(r,t,e,n){var i=r;do i.z===0&&(i.z=pc(i.x,i.y,t,e,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==r);i.prevZ.nextZ=null,i.prevZ=null,hI(i)}function hI(r){var t,e,n,i,s,o,a,l,h=1;do{for(e=r,r=null,s=null,o=0;e;){for(o++,n=e,a=0,t=0;t<h&&(a++,n=n.nextZ,!!n);t++);for(l=h;a>0||l>0&&n;)a!==0&&(l===0||!n||e.z<=n.z)?(i=e,e=e.nextZ,a--):(i=n,n=n.nextZ,l--),s?s.nextZ=i:r=i,i.prevZ=s,s=i;e=n}s.nextZ=null,h*=2}while(o>1);return r}function pc(r,t,e,n,i){return r=(r-e)*i|0,t=(t-n)*i|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,r|t<<1}function uI(r){var t=r,e=r;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==r);return e}function xs(r,t,e,n,i,s,o,a){return(i-o)*(t-a)>=(r-o)*(s-a)&&(r-o)*(n-a)>=(e-o)*(t-a)&&(e-o)*(s-a)>=(i-o)*(n-a)}function cI(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!dI(r,t)&&(oa(r,t)&&oa(t,r)&&fI(r,t)&&(he(r.prev,r,t.prev)||he(r,t.prev,t))||zh(r,t)&&he(r.prev,r,r.next)>0&&he(t.prev,t,t.next)>0)}function he(r,t,e){return(t.y-r.y)*(e.x-t.x)-(t.x-r.x)*(e.y-t.y)}function zh(r,t){return r.x===t.x&&r.y===t.y}function q_(r,t,e,n){var i=ll(he(r,t,e)),s=ll(he(r,t,n)),o=ll(he(e,n,r)),a=ll(he(e,n,t));return!!(i!==s&&o!==a||i===0&&al(r,e,t)||s===0&&al(r,n,t)||o===0&&al(e,r,n)||a===0&&al(e,t,n))}function al(r,t,e){return t.x<=Math.max(r.x,e.x)&&t.x>=Math.min(r.x,e.x)&&t.y<=Math.max(r.y,e.y)&&t.y>=Math.min(r.y,e.y)}function ll(r){return r>0?1:r<0?-1:0}function dI(r,t){var e=r;do{if(e.i!==r.i&&e.next.i!==r.i&&e.i!==t.i&&e.next.i!==t.i&&q_(e,e.next,r,t))return!0;e=e.next}while(e!==r);return!1}function oa(r,t){return he(r.prev,r,r.next)<0?he(r,t,r.next)>=0&&he(r,r.prev,t)>=0:he(r,t,r.prev)<0||he(r,r.next,t)<0}function fI(r,t){var e=r,n=!1,i=(r.x+t.x)/2,s=(r.y+t.y)/2;do e.y>s!=e.next.y>s&&e.next.y!==e.y&&i<(e.next.x-e.x)*(s-e.y)/(e.next.y-e.y)+e.x&&(n=!n),e=e.next;while(e!==r);return n}function Z_(r,t){var e=new mc(r.i,r.x,r.y),n=new mc(t.i,t.x,t.y),i=r.next,s=t.prev;return r.next=t,t.prev=r,e.next=i,i.prev=e,n.next=e,e.prev=n,s.next=n,n.prev=s,n}function Op(r,t,e,n){var i=new mc(r,t,e);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function aa(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function mc(r,t,e){this.i=r,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}jh.deviation=function(r,t,e,n){var i=t&&t.length,s=i?t[0]*e:r.length,o=Math.abs(_c(r,0,s,e));if(i)for(var a=0,l=t.length;a<l;a++){var h=t[a]*e,u=a<l-1?t[a+1]*e:r.length;o-=Math.abs(_c(r,h,u,e))}var c=0;for(a=0;a<n.length;a+=3){var f=n[a]*e,g=n[a+1]*e,m=n[a+2]*e;c+=Math.abs((r[f]-r[m])*(r[g+1]-r[f+1])-(r[f]-r[g])*(r[m+1]-r[f+1]))}return o===0&&c===0?0:Math.abs((c-o)/o)};function _c(r,t,e,n){for(var i=0,s=t,o=e-n;s<e;s+=n)i+=(r[o]-r[s])*(r[s+1]+r[o+1]),o=s;return i}jh.flatten=function(r){for(var t=r[0][0].length,e={vertices:[],holes:[],dimensions:t},n=0,i=0;i<r.length;i++){for(var s=0;s<r[i].length;s++)for(var o=0;o<t;o++)e.vertices.push(r[i][s][o]);i>0&&(n+=r[i-1].length,e.holes.push(n))}return e};const Fp=.985;function gI(r,t){t=t||[];const e=256,n=e-1;return t[0]=Math.floor(r/e/e/e)/n,t[1]=Math.floor(r/e/e)%e/n,t[2]=Math.floor(r/e)%e/n,t[3]=r%e/n,t}function pI(r){let t=0;const e=256,n=e-1;return t+=Math.round(r[0]*e*e*e*n),t+=Math.round(r[1]*e*e*n),t+=Math.round(r[2]*e*n),t+=Math.round(r[3]*n),t}function mI(){const r='const e="GENERATE_POLYGON_BUFFERS",t="GENERATE_POINT_BUFFERS",n="GENERATE_LINE_STRING_BUFFERS";function r(e,t){const n=t[0],r=t[1];return t[0]=e[0]*n+e[2]*r+e[4],t[1]=e[1]*n+e[3]*r+e[5],t}function x(e,t){const n=(r=t)[0]*r[3]-r[1]*r[2];var r;!function(e,t){if(!e)throw new Error(t)}(0!==n,"Transformation matrix cannot be inverted");const x=t[0],i=t[1],u=t[2],o=t[3],f=t[4],s=t[5];return e[0]=o/n,e[1]=-i/n,e[2]=-u/n,e[3]=x/n,e[4]=(u*s-o*f)/n,e[5]=-(x*s-i*f)/n,e}function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}new Array(6);var u={exports:{}};function o(e,t,n){n=n||2;var r,x,i,u,o,s,l,v=t&&t.length,h=v?t[0]*n:e.length,c=f(e,0,h,n,!0),g=[];if(!c||c.next===c.prev)return g;if(v&&(c=function(e,t,n,r){var x,i,u,o=[];for(x=0,i=t.length;x<i;x++)(u=f(e,t[x]*r,x<i-1?t[x+1]*r:e.length,r,!1))===u.next&&(u.steiner=!0),o.push(d(u));for(o.sort(p),x=0;x<o.length;x++)n=y(o[x],n);return n}(e,t,c,n)),e.length>80*n){r=i=e[0],x=u=e[1];for(var b=n;b<h;b+=n)(o=e[b])<r&&(r=o),(s=e[b+1])<x&&(x=s),o>i&&(i=o),s>u&&(u=s);l=0!==(l=Math.max(i-r,u-x))?32767/l:0}return a(c,g,n,r,x,l,0),g}function f(e,t,n,r,x){var i,u;if(x===O(e,t,n,r)>0)for(i=t;i<n;i+=r)u=P(i,e[i],e[i+1],u);else for(i=n-r;i>=t;i-=r)u=P(i,e[i],e[i+1],u);return u&&m(u,u.next)&&(B(u),u=u.next),u}function s(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!m(r,r.next)&&0!==w(r.prev,r,r.next))r=r.next;else{if(B(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function a(e,t,n,r,x,i,u){if(e){!u&&i&&function(e,t,n,r){var x=e;do{0===x.z&&(x.z=b(x.x,x.y,t,n,r)),x.prevZ=x.prev,x.nextZ=x.next,x=x.next}while(x!==e);x.prevZ.nextZ=null,x.prevZ=null,function(e){var t,n,r,x,i,u,o,f,s=1;do{for(n=e,e=null,i=null,u=0;n;){for(u++,r=n,o=0,t=0;t<s&&(o++,r=r.nextZ);t++);for(f=s;o>0||f>0&&r;)0!==o&&(0===f||!r||n.z<=r.z)?(x=n,n=n.nextZ,o--):(x=r,r=r.nextZ,f--),i?i.nextZ=x:e=x,x.prevZ=i,i=x;n=r}i.nextZ=null,s*=2}while(u>1)}(x)}(e,r,x,i);for(var o,f,p=e;e.prev!==e.next;)if(o=e.prev,f=e.next,i?v(e,r,x,i):l(e))t.push(o.i/n|0),t.push(e.i/n|0),t.push(f.i/n|0),B(e),e=f.next,p=f.next;else if((e=f)===p){u?1===u?a(e=h(s(e),t,n),t,n,r,x,i,2):2===u&&c(e,t,n,r,x,i):a(s(e),t,n,r,x,i,1);break}}}function l(e){var t=e.prev,n=e,r=e.next;if(w(t,n,r)>=0)return!1;for(var x=t.x,i=n.x,u=r.x,o=t.y,f=n.y,s=r.y,a=x<i?x<u?x:u:i<u?i:u,l=o<f?o<s?o:s:f<s?f:s,v=x>i?x>u?x:u:i>u?i:u,h=o>f?o>s?o:s:f>s?f:s,c=r.next;c!==t;){if(c.x>=a&&c.x<=v&&c.y>=l&&c.y<=h&&M(x,o,i,f,u,s,c.x,c.y)&&w(c.prev,c,c.next)>=0)return!1;c=c.next}return!0}function v(e,t,n,r){var x=e.prev,i=e,u=e.next;if(w(x,i,u)>=0)return!1;for(var o=x.x,f=i.x,s=u.x,a=x.y,l=i.y,v=u.y,h=o<f?o<s?o:s:f<s?f:s,c=a<l?a<v?a:v:l<v?l:v,p=o>f?o>s?o:s:f>s?f:s,y=a>l?a>v?a:v:l>v?l:v,g=b(h,c,t,n,r),d=b(p,y,t,n,r),Z=e.prevZ,m=e.nextZ;Z&&Z.z>=g&&m&&m.z<=d;){if(Z.x>=h&&Z.x<=p&&Z.y>=c&&Z.y<=y&&Z!==x&&Z!==u&&M(o,a,f,l,s,v,Z.x,Z.y)&&w(Z.prev,Z,Z.next)>=0)return!1;if(Z=Z.prevZ,m.x>=h&&m.x<=p&&m.y>=c&&m.y<=y&&m!==x&&m!==u&&M(o,a,f,l,s,v,m.x,m.y)&&w(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;Z&&Z.z>=g;){if(Z.x>=h&&Z.x<=p&&Z.y>=c&&Z.y<=y&&Z!==x&&Z!==u&&M(o,a,f,l,s,v,Z.x,Z.y)&&w(Z.prev,Z,Z.next)>=0)return!1;Z=Z.prevZ}for(;m&&m.z<=d;){if(m.x>=h&&m.x<=p&&m.y>=c&&m.y<=y&&m!==x&&m!==u&&M(o,a,f,l,s,v,m.x,m.y)&&w(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function h(e,t,n){var r=e;do{var x=r.prev,i=r.next.next;!m(x,i)&&A(x,r,r.next,i)&&z(x,i)&&z(i,x)&&(t.push(x.i/n|0),t.push(r.i/n|0),t.push(i.i/n|0),B(r),B(r.next),r=e=i),r=r.next}while(r!==e);return s(r)}function c(e,t,n,r,x,i){var u=e;do{for(var o=u.next.next;o!==u.prev;){if(u.i!==o.i&&Z(u,o)){var f=F(u,o);return u=s(u,u.next),f=s(f,f.next),a(u,t,n,r,x,i,0),void a(f,t,n,r,x,i,0)}o=o.next}u=u.next}while(u!==e)}function p(e,t){return e.x-t.x}function y(e,t){var n=function(e,t){var n,r=t,x=e.x,i=e.y,u=-1/0;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var o=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=x&&o>u&&(u=o,n=r.x<r.next.x?r:r.next,o===x))return n}r=r.next}while(r!==t);if(!n)return null;var f,s=n,a=n.x,l=n.y,v=1/0;r=n;do{x>=r.x&&r.x>=a&&x!==r.x&&M(i<l?x:u,i,a,l,i<l?u:x,i,r.x,r.y)&&(f=Math.abs(i-r.y)/(x-r.x),z(r,e)&&(f<v||f===v&&(r.x>n.x||r.x===n.x&&g(n,r)))&&(n=r,v=f)),r=r.next}while(r!==s);return n}(e,t);if(!n)return t;var r=F(n,e);return s(r,r.next),s(n,n.next)}function g(e,t){return w(e.prev,e,t.prev)<0&&w(t.next,e,e.next)<0}function b(e,t,n,r,x){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*x|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*x|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function d(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function M(e,t,n,r,x,i,u,o){return(x-u)*(t-o)>=(e-u)*(i-o)&&(e-u)*(r-o)>=(n-u)*(t-o)&&(n-u)*(i-o)>=(x-u)*(r-o)}function Z(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&A(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(z(e,t)&&z(t,e)&&function(e,t){var n=e,r=!1,x=(e.x+t.x)/2,i=(e.y+t.y)/2;do{n.y>i!=n.next.y>i&&n.next.y!==n.y&&x<(n.next.x-n.x)*(i-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(w(e.prev,e,t.prev)||w(e,t.prev,t))||m(e,t)&&w(e.prev,e,e.next)>0&&w(t.prev,t,t.next)>0)}function w(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function m(e,t){return e.x===t.x&&e.y===t.y}function A(e,t,n,r){var x=I(w(e,t,n)),i=I(w(e,t,r)),u=I(w(n,r,e)),o=I(w(n,r,t));return x!==i&&u!==o||(!(0!==x||!E(e,n,t))||(!(0!==i||!E(e,r,t))||(!(0!==u||!E(n,e,r))||!(0!==o||!E(n,t,r)))))}function E(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function I(e){return e>0?1:e<0?-1:0}function z(e,t){return w(e.prev,e,e.next)<0?w(e,t,e.next)>=0&&w(e,e.prev,t)>=0:w(e,t,e.prev)<0||w(e,e.next,t)<0}function F(e,t){var n=new _(e.i,e.x,e.y),r=new _(t.i,t.x,t.y),x=e.next,i=t.prev;return e.next=t,t.prev=e,n.next=x,x.prev=n,r.next=n,n.prev=r,i.next=r,r.prev=i,r}function P(e,t,n,r){var x=new _(e,t,n);return r?(x.next=r.next,x.prev=r,r.next.prev=x,r.next=x):(x.prev=x,x.next=x),x}function B(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function _(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function O(e,t,n,r){for(var x=0,i=t,u=n-r;i<n;i+=r)x+=(e[u]-e[i])*(e[i+1]+e[u+1]),u=i;return x}u.exports=o,u.exports.default=o,o.deviation=function(e,t,n,r){var x=t&&t.length,i=x?t[0]*n:e.length,u=Math.abs(O(e,0,i,n));if(x)for(var o=0,f=t.length;o<f;o++){var s=t[o]*n,a=o<f-1?t[o+1]*n:e.length;u-=Math.abs(O(e,s,a,n))}var l=0;for(o=0;o<r.length;o+=3){var v=r[o]*n,h=r[o+1]*n,c=r[o+2]*n;l+=Math.abs((e[v]-e[c])*(e[h+1]-e[v+1])-(e[v]-e[h])*(e[c+1]-e[v+1]))}return 0===u&&0===l?0:Math.abs((l-u)/u)},o.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,x=0;x<e.length;x++){for(var i=0;i<e[x].length;i++)for(var u=0;u<t;u++)n.vertices.push(e[x][i][u]);x>0&&(r+=e[x-1].length,n.holes.push(r))}return n};var N=i(u.exports);const R=[],S={vertexPosition:0,indexPosition:0};function T(e,t,n,r,x){e[t+0]=n,e[t+1]=r,e[t+2]=x}function U(e,t,n,r,x,i){const u=3+x,o=e[t+0],f=e[t+1],s=R;s.length=x;for(let n=0;n<s.length;n++)s[n]=e[t+2+n];let a=i?i.vertexPosition:0,l=i?i.indexPosition:0;const v=a/u;return T(n,a,o,f,0),s.length&&n.set(s,a+3),a+=u,T(n,a,o,f,1),s.length&&n.set(s,a+3),a+=u,T(n,a,o,f,2),s.length&&n.set(s,a+3),a+=u,T(n,a,o,f,3),s.length&&n.set(s,a+3),a+=u,r[l++]=v,r[l++]=v+1,r[l++]=v+3,r[l++]=v+1,r[l++]=v+2,r[l++]=v+3,S.vertexPosition=a,S.indexPosition=l,S}function k(e,t,n,x,i,u,o,f,s,a,l){const v=8+f.length,h=u.length/v,c=[e[t+0],e[t+1]],p=[e[n],e[n+1]],y=r(s,[...c]),g=r(s,[...p]);function b(e,t,n){const r=Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])),x=[(t[0]-e[0])/r,(t[1]-e[1])/r],i=[-x[1],x[0]],u=Math.sqrt((n[0]-e[0])*(n[0]-e[0])+(n[1]-e[1])*(n[1]-e[1])),o=[(n[0]-e[0])/u,(n[1]-e[1])/u],f=0===r||0===u?0:Math.acos((s=o[0]*x[0]+o[1]*x[1],a=-1,l=1,Math.min(Math.max(s,a),l)));var s,a,l;return o[0]*i[0]+o[1]*i[1]>0?f:2*Math.PI-f}let d=-1,M=-1,Z=l;const w=null!==i;if(null!==x){d=b(y,g,r(s,[...[e[x],e[x+1]]])),Math.cos(d)<=.985&&(Z+=Math.tan((d-Math.PI)/2))}if(w){M=b(g,y,r(s,[...[e[i],e[i+1]]])),Math.cos(M)<=.985&&(Z+=Math.tan((Math.PI-M)/2))}function m(e,t){return 0===t?1e4*e:Math.sign(t)*(1e4*e+Math.abs(t))}return u.push(c[0],c[1],p[0],p[1],d,M,a,m(0,l)),u.push(...f),u.push(c[0],c[1],p[0],p[1],d,M,a,m(1,l)),u.push(...f),u.push(c[0],c[1],p[0],p[1],d,M,a,m(2,l)),u.push(...f),u.push(c[0],c[1],p[0],p[1],d,M,a,m(3,l)),u.push(...f),o.push(h,h+1,h+2,h+1,h+3,h+2),{length:a+Math.sqrt((g[0]-y[0])*(g[0]-y[0])+(g[1]-y[1])*(g[1]-y[1])),angle:Z}}function G(e,t,n,r,x){const i=2+x;let u=t;const o=e.slice(u,u+x);u+=x;const f=e[u++];let s=0;const a=new Array(f-1);for(let t=0;t<f;t++)s+=e[u++],t<f-1&&(a[t]=s);const l=e.slice(u,u+2*s),v=N(l,a,2);for(let e=0;e<v.length;e++)r.push(v[e]+n.length/i);for(let e=0;e<l.length;e+=2)n.push(l[e],l[e+1],...o);return u+2*s}const j=self;j.onmessage=r=>{const i=r.data;switch(i.type){case t:{const e=3,t=2,n=i.customAttributesSize,r=t+n,x=new Float32Array(i.renderInstructions),u=x.length/r,o=4*u*(n+e),f=new Uint32Array(6*u),s=new Float32Array(o);let a;for(let e=0;e<x.length;e+=r)a=U(x,e,s,f,n,a);const l=Object.assign({vertexBuffer:s.buffer,indexBuffer:f.buffer,renderInstructions:x.buffer},i);j.postMessage(l,[s.buffer,f.buffer,x.buffer]);break}case n:{const e=[],t=[],n=i.customAttributesSize,r=2,u=new Float32Array(i.renderInstructions);let o=0;const f=[1,0,0,1,0,0];let s,a;for(x(f,i.renderInstructionsTransform);o<u.length;){a=Array.from(u.slice(o,o+n)),o+=n,s=u[o++];const x=o,i=o+(s-1)*r,l=u[x]===u[i]&&u[x+1]===u[i+1];let v=0,h=0;for(let n=0;n<s-1;n++){let c=null;n>0?c=o+(n-1)*r:l&&(c=i-r);let p=null;n<s-2?p=o+(n+2)*r:l&&(p=x+r);const y=k(u,o+n*r,o+(n+1)*r,c,p,e,t,a,f,v,h);v=y.length,h=y.angle}o+=s*r}const l=Uint32Array.from(t),v=Float32Array.from(e),h=Object.assign({vertexBuffer:v.buffer,indexBuffer:l.buffer,renderInstructions:u.buffer},i);j.postMessage(h,[v.buffer,l.buffer,u.buffer]);break}case e:{const e=[],t=[],n=i.customAttributesSize,r=new Float32Array(i.renderInstructions);let x=0;for(;x<r.length;)x=G(r,x,e,t,n);const u=Uint32Array.from(t),o=Float32Array.from(e),f=Object.assign({vertexBuffer:o.buffer,indexBuffer:u.buffer,renderInstructions:r.buffer},i);j.postMessage(f,[o.buffer,u.buffer,r.buffer]);break}}};';return new Worker(typeof Blob>"u"?"data:application/javascript;base64,"+Buffer.from(r,"binary").toString("base64"):URL.createObjectURL(new Blob([r],{type:"application/javascript"})))}function _I(r,t){const e=r.viewState.projection,n=t.getSource().getWrapX()&&e.canWrapX(),i=e.getExtent(),s=r.extent,o=n?yt(i):null,a=n?Math.ceil((s[2]-i[2])/o)+1:1;return[n?Math.floor((s[0]-i[0])/o):0,a,o]}class $_ extends Gh{constructor(t,e){const n=e.uniforms||{},i=pe();n[Sn.PROJECTION_MATRIX]=i,super(t,{uniforms:n,postProcesses:e.postProcesses}),this.sourceRevision_=-1,this.verticesBuffer_=new Xl(Dh,gc),this.indicesBuffer_=new Xl(kh,gc),this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.program_,this.hitDetectionEnabled_=e.hitDetectionEnabled??!0;const s=e.attributes?e.attributes.map(function(a){return{name:"a_prop_"+a.name,size:1,type:tn.FLOAT}}):[];this.attributes=[{name:"a_position",size:2,type:tn.FLOAT},{name:"a_index",size:1,type:tn.FLOAT}],this.hitDetectionEnabled_&&(this.attributes.push({name:"a_prop_hitColor",size:4,type:tn.FLOAT}),this.attributes.push({name:"a_featureUid",size:1,type:tn.FLOAT})),this.attributes.push(...s),this.customAttributes=e.attributes?e.attributes:[],this.previousExtent_=ze(),this.currentTransform_=i,this.renderTransform_=pe(),this.invertRenderTransform_=pe(),this.renderInstructions_=new Float32Array(0),this.hitRenderTarget_,this.lastSentId=0,this.worker_=mI(),this.worker_.addEventListener("message",a=>{const l=a.data;if(l.type===Lp.GENERATE_POINT_BUFFERS){const h=l.projectionTransform;this.verticesBuffer_.fromArrayBuffer(l.vertexBuffer),this.helper.flushBufferData(this.verticesBuffer_),this.indicesBuffer_.fromArrayBuffer(l.indexBuffer),this.helper.flushBufferData(this.indicesBuffer_),this.renderTransform_=h,uh(this.invertRenderTransform_,this.renderTransform_),this.renderInstructions_=new Float32Array(a.data.renderInstructions),l.id===this.lastSentId&&(this.ready=!0),this.getLayer().changed()}}),this.featureCache_={},this.featureCount_=0;const o=this.getLayer().getSource();this.sourceListenKeys_=[le(o,De.ADDFEATURE,this.handleSourceFeatureAdded_,this),le(o,De.CHANGEFEATURE,this.handleSourceFeatureChanged_,this),le(o,De.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),le(o,De.CLEAR,this.handleSourceFeatureClear_,this)],o.forEachFeature(a=>{this.featureCache_[it(a)]={feature:a,properties:a.getProperties(),geometry:a.getGeometry()},this.featureCount_++})}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new QC(this.helper))}handleSourceFeatureAdded_(t){const e=t.feature;this.featureCache_[it(e)]={feature:e,properties:e.getProperties(),geometry:e.getGeometry()},this.featureCount_++}handleSourceFeatureChanged_(t){const e=t.feature;this.featureCache_[it(e)]={feature:e,properties:e.getProperties(),geometry:e.getGeometry()}}handleSourceFeatureDelete_(t){const e=t.feature;delete this.featureCache_[it(e)],this.featureCount_--}handleSourceFeatureClear_(){this.featureCache_={},this.featureCount_=0}renderFrame(t){const e=this.helper.getGL();this.preRender(e,t);const[n,i,s]=_I(t,this.getLayer());return this.renderWorlds(t,!1,n,i,s),this.helper.finalizeDraw(t,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent),this.hitDetectionEnabled_&&(this.renderWorlds(t,!0,n,i,s),this.hitRenderTarget_.clearCachedData()),this.postRender(e,t),this.helper.getCanvas()}prepareFrameInternal(t){const e=this.getLayer(),n=e.getSource(),i=t.viewState,s=!t.viewHints[ee.ANIMATING]&&!t.viewHints[ee.INTERACTING],o=!Nn(this.previousExtent_,t.extent),a=this.sourceRevision_<n.getRevision();if(a&&(this.sourceRevision_=n.getRevision()),s&&(o||a)){const l=i.projection,h=i.resolution,u=e instanceof La?e.getRenderBuffer():0,c=Ir(t.extent,u*h);n.loadFeatures(c,h,l),this.rebuildBuffers_(t),this.previousExtent_=t.extent.slice()}return this.helper.useProgram(this.program_,t),this.helper.prepareDraw(t),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes),!0}rebuildBuffers_(t){const e=pe();this.helper.makeProjectionTransform(t,e);const n=(this.hitDetectionEnabled_?7:2)+this.customAttributes.length,i=n*this.featureCount_;(!this.renderInstructions_||this.renderInstructions_.length!==i)&&(this.renderInstructions_=new Float32Array(i));let s,o;const a=[],l=[];let h=-1;for(const c in this.featureCache_)if(s=this.featureCache_[c],o=s.geometry,!(!o||o.getType()!=="Point")){if(a[0]=o.getFlatCoordinates()[0],a[1]=o.getFlatCoordinates()[1],ae(e,a),this.renderInstructions_[++h]=a[0],this.renderInstructions_[++h]=a[1],this.hitDetectionEnabled_){const f=gI(h+5,l);this.renderInstructions_[++h]=f[0],this.renderInstructions_[++h]=f[1],this.renderInstructions_[++h]=f[2],this.renderInstructions_[++h]=f[3],this.renderInstructions_[++h]=Number(c)}for(let f=0;f<this.customAttributes.length;f++){const g=this.customAttributes[f].callback(s.feature,s.properties);this.renderInstructions_[++h]=g}}const u={id:++this.lastSentId,type:Lp.GENERATE_POINT_BUFFERS,renderInstructions:this.renderInstructions_.buffer,customAttributesSize:n-2};u.projectionTransform=e,this.ready=!1,this.worker_.postMessage(u,[this.renderInstructions_.buffer]),this.renderInstructions_=null}forEachFeatureAtCoordinate(t,e,n,i,s){if(At(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option."),!this.renderInstructions_||!this.hitDetectionEnabled_)return;const o=ae(e.coordinateToPixelTransform,t.slice()),a=this.hitRenderTarget_.readPixel(o[0]/2,o[1]/2),l=[a[0]/255,a[1]/255,a[2]/255,a[3]/255],h=pI(l),u=this.renderInstructions_[h],c=Math.floor(u).toString(),f=this.getLayer().getSource().getFeatureByUid(c);if(f)return i(f,this.getLayer(),null)}renderWorlds(t,e,n,i,s){let o=n;this.helper.useProgram(this.program_,t),e&&(this.hitRenderTarget_.setSize([Math.floor(t.size[0]/2),Math.floor(t.size[1]/2)]),this.helper.prepareDrawToRenderTarget(t,this.hitRenderTarget_,!0)),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes);do{this.helper.makeProjectionTransform(t,this.currentTransform_),kc(this.currentTransform_,o*s,0),Vs(this.currentTransform_,this.invertRenderTransform_),this.helper.applyUniforms(t),this.helper.applyHitDetectionUniform(e);const a=this.indicesBuffer_.getSize();this.helper.drawElements(0,a)}while(++o<i)}disposeInternal(){this.worker_.terminate(),this.layer_=null,this.sourceListenKeys_.forEach(function(t){ve(t)}),this.sourceListenKeys_=null,super.disposeInternal()}renderDeclutter(){}}class yI{constructor(t,e){this.name=t,this.data=e,this.texture_=null}getTexture(t){if(!this.texture_){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.data.length/4,1,0,t.RGBA,t.UNSIGNED_BYTE,this.data),this.texture_=e}return this.texture_}}const qd=.5,W={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class no extends ma{constructor(t,e,n){super(),n=n||{},this.tileCoord=t,this.state=e,this.interimTile=null,this.key="",this.transition_=n.transition===void 0?250:n.transition,this.transitionStarts_={},this.interpolate=!!n.interpolate}changed(){this.dispatchEvent(Lt.CHANGE)}release(){this.state===W.ERROR&&this.setState(W.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){let t=this.interimTile;if(!t)return this;do{if(t.getState()==W.LOADED)return this.transition_=0,t;t=t.interimTile}while(t);return this}refreshInterimChain(){let t=this.interimTile;if(!t)return;let e=this;do{if(t.getState()==W.LOADED){t.interimTile=null;break}t.getState()==W.LOADING?e=t:t.getState()==W.IDLE?e.interimTile=t.interimTile:e=t,t=e.interimTile}while(t)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==W.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}load(){ut()}getAlpha(t,e){if(!this.transition_)return 1;let n=this.transitionStarts_[t];if(!n)n=e,this.transitionStarts_[t]=n;else if(n===-1)return 1;const i=e-n+1e3/60;return i>=this.transition_?1:__(i/this.transition_)}inTransition(t){return this.transition_?this.transitionStarts_[t]!==-1:!1}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}}function ql(r){return r instanceof Image||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageBitmap?r:null}function yc(r){return r instanceof Uint8Array||r instanceof Uint8ClampedArray||r instanceof Float32Array||r instanceof DataView?r:null}let is=null;function xI(r){is||(is=Jt(r.width,r.height,void 0,{willReadFrequently:!0}));const t=is.canvas,e=r.width;t.width!==e&&(t.width=e);const n=r.height;return t.height!==n&&(t.height=n),is.clearRect(0,0,e,n),is.drawImage(r,0,0),is.getImageData(0,0,e,n).data}const vI=[256,256];class Zd extends no{constructor(t){const e=W.IDLE;super(t.tileCoord,e,{transition:t.transition,interpolate:t.interpolate}),this.loader_=t.loader,this.data_=null,this.error_=null,this.size_=t.size||null}getSize(){if(this.size_)return this.size_;const t=ql(this.data_);return t?[t.width,t.height]:vI}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==W.IDLE&&this.state!==W.ERROR)return;this.state=W.LOADING,this.changed();const t=this;this.loader_().then(function(e){t.data_=e,t.state=W.LOADED,t.changed()}).catch(function(e){t.error_=e,t.state=W.ERROR,t.changed()})}}const wI=10,Np=.25;class $d{constructor(t,e,n,i,s,o){this.sourceProj_=t,this.targetProj_=e;let a={};const l=hn(this.targetProj_,this.sourceProj_);this.transformInv_=function(w){const S=w[0]+"/"+w[1];return a[S]||(a[S]=l(w)),a[S]},this.maxSourceExtent_=i,this.errorThresholdSquared_=s*s,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!i&&!!this.sourceProj_.getExtent()&&yt(i)>=yt(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?yt(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?yt(this.targetProj_.getExtent()):null;const h=zn(n),u=va(n),c=ch(n),f=xa(n),g=this.transformInv_(h),m=this.transformInv_(u),_=this.transformInv_(c),x=this.transformInv_(f),v=wI+(o?Math.max(0,Math.ceil(Math.log2(Yo(n)/(o*o*256*256)))):0);if(this.addQuad_(h,u,c,f,g,m,_,x,v),this.wrapsXInSource_){let w=1/0;this.triangles_.forEach(function(S,E,T){w=Math.min(w,S.source[0][0],S.source[1][0],S.source[2][0])}),this.triangles_.forEach(S=>{if(Math.max(S.source[0][0],S.source[1][0],S.source[2][0])-w>this.sourceWorldWidth_/2){const E=[[S.source[0][0],S.source[0][1]],[S.source[1][0],S.source[1][1]],[S.source[2][0],S.source[2][1]]];E[0][0]-w>this.sourceWorldWidth_/2&&(E[0][0]-=this.sourceWorldWidth_),E[1][0]-w>this.sourceWorldWidth_/2&&(E[1][0]-=this.sourceWorldWidth_),E[2][0]-w>this.sourceWorldWidth_/2&&(E[2][0]-=this.sourceWorldWidth_);const T=Math.min(E[0][0],E[1][0],E[2][0]);Math.max(E[0][0],E[1][0],E[2][0])-T<this.sourceWorldWidth_/2&&(S.source=E)}})}a={}}addTriangle_(t,e,n,i,s,o){this.triangles_.push({source:[i,s,o],target:[t,e,n]})}addQuad_(t,e,n,i,s,o,a,l,h){const u=Os([s,o,a,l]),c=this.sourceWorldWidth_?yt(u)/this.sourceWorldWidth_:null,f=this.sourceWorldWidth_,g=this.sourceProj_.canWrapX()&&c>.5&&c<1;let m=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const x=Os([t,e,n,i]);m=yt(x)/this.targetWorldWidth_>Np||m}!g&&this.sourceProj_.isGlobal()&&c&&(m=c>Np||m)}if(!m&&this.maxSourceExtent_&&isFinite(u[0])&&isFinite(u[1])&&isFinite(u[2])&&isFinite(u[3])&&!Qt(u,this.maxSourceExtent_))return;let _=0;if(!m&&(!isFinite(s[0])||!isFinite(s[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(h>0)m=!0;else if(_=(!isFinite(s[0])||!isFinite(s[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),_!=1&&_!=2&&_!=4&&_!=8)return}if(h>0){if(!m){const x=[(t[0]+n[0])/2,(t[1]+n[1])/2],v=this.transformInv_(x);let w;g?w=(an(s[0],f)+an(a[0],f))/2-an(v[0],f):w=(s[0]+a[0])/2-v[0];const S=(s[1]+a[1])/2-v[1];m=w*w+S*S>this.errorThresholdSquared_}if(m){if(Math.abs(t[0]-n[0])<=Math.abs(t[1]-n[1])){const x=[(e[0]+n[0])/2,(e[1]+n[1])/2],v=this.transformInv_(x),w=[(i[0]+t[0])/2,(i[1]+t[1])/2],S=this.transformInv_(w);this.addQuad_(t,e,x,w,s,o,v,S,h-1),this.addQuad_(w,x,n,i,S,v,a,l,h-1)}else{const x=[(t[0]+e[0])/2,(t[1]+e[1])/2],v=this.transformInv_(x),w=[(n[0]+i[0])/2,(n[1]+i[1])/2],S=this.transformInv_(w);this.addQuad_(t,x,w,i,s,v,S,l,h-1),this.addQuad_(x,e,n,w,v,o,a,S,h-1)}return}}if(g){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}_&11||this.addTriangle_(t,n,i,s,a,l),_&14||this.addTriangle_(t,n,e,s,a,o),_&&(_&13||this.addTriangle_(e,i,t,o,l,s),_&7||this.addTriangle_(e,i,n,o,l,a))}calculateSourceExtent(){const t=ze();return this.triangles_.forEach(function(e,n,i){const s=e.source;Lo(t,s[0]),Lo(t,s[1]),Lo(t,s[2])}),t}getTriangles(){return this.triangles_}}let Eu;const On=[];function Dp(r,t,e,n,i){r.beginPath(),r.moveTo(0,0),r.lineTo(t,e),r.lineTo(n,i),r.closePath(),r.save(),r.clip(),r.fillRect(0,0,Math.max(t,n)+1,Math.max(e,i)),r.restore()}function Tu(r,t){return Math.abs(r[t*4]-210)>2||Math.abs(r[t*4+3]-.75*255)>2}function bI(){if(Eu===void 0){const r=Jt(6,6,On);r.globalCompositeOperation="lighter",r.fillStyle="rgba(210, 0, 0, 0.75)",Dp(r,4,5,4,0),Dp(r,4,5,0,5);const t=r.getImageData(0,0,3,3).data;Eu=Tu(t,0)||Tu(t,4)||Tu(t,8),Gi(r),On.push(r.canvas)}return Eu}function la(r,t,e,n){const i=dh(e,t,r);let s=dg(t,n,e);const o=t.getMetersPerUnit();o!==void 0&&(s*=o);const a=r.getMetersPerUnit();a!==void 0&&(s/=a);const l=r.getExtent();if(!l||xr(l,i)){const h=dg(r,s,i)/s;isFinite(h)&&h>0&&(s/=h)}return s}function V_(r,t,e,n){const i=Ce(e);let s=la(r,t,i,n);return(!isFinite(s)||s<=0)&&Xm(e,function(o){return s=la(r,t,o,n),isFinite(s)&&s>0}),s}function Vd(r,t,e,n,i,s,o,a,l,h,u,c,f,g){const m=Jt(Math.round(e*r),Math.round(e*t),On);if(c||(m.imageSmoothingEnabled=!1),l.length===0)return m.canvas;m.scale(e,e);function _(T){return Math.round(T*e)/e}m.globalCompositeOperation="lighter";const x=ze();l.forEach(function(T,R,C){Um(x,T.extent)});let v;const w=e/n,S=(c?1:1+Math.pow(2,-24))/w;if(!f||l.length!==1||h!==0){if(v=Jt(Math.round(yt(x)*w),Math.round(Vt(x)*w),On),c||(v.imageSmoothingEnabled=!1),i&&g){const T=(i[0]-x[0])*w,R=-(i[3]-x[3])*w,C=yt(i)*w,I=Vt(i)*w;v.rect(T,R,C,I),v.clip()}l.forEach(function(T,R,C){const I=(T.extent[0]-x[0])*w,F=-(T.extent[3]-x[3])*w,U=yt(T.extent)*w,j=Vt(T.extent)*w;T.image.width>0&&T.image.height>0&&v.drawImage(T.image,h,h,T.image.width-2*h,T.image.height-2*h,c?I:Math.round(I),c?F:Math.round(F),c?U:Math.round(I+U)-Math.round(I),c?j:Math.round(F+j)-Math.round(F))})}const E=zn(o);return a.getTriangles().forEach(function(T,R,C){const I=T.source,F=T.target;let U=I[0][0],j=I[0][1],B=I[1][0],d=I[1][1],p=I[2][0],y=I[2][1];const b=_((F[0][0]-E[0])/s),M=_(-(F[0][1]-E[1])/s),P=_((F[1][0]-E[0])/s),A=_(-(F[1][1]-E[1])/s),L=_((F[2][0]-E[0])/s),D=_(-(F[2][1]-E[1])/s),X=U,K=j;U=0,j=0,B-=X,d-=K,p-=X,y-=K;const G=[[B,d,0,0,P-b],[p,y,0,0,L-b],[0,0,B,d,A-M],[0,0,p,y,D-M]],H=sv(G);if(!H)return;if(m.save(),m.beginPath(),bI()||!c){m.moveTo(P,A);const nt=4,xt=b-P,dt=M-A;for(let Tt=0;Tt<nt;Tt++)m.lineTo(P+_((Tt+1)*xt/nt),A+_(Tt*dt/(nt-1))),Tt!=nt-1&&m.lineTo(P+_((Tt+1)*xt/nt),A+_((Tt+1)*dt/(nt-1)));m.lineTo(L,D)}else m.moveTo(P,A),m.lineTo(b,M),m.lineTo(L,D);m.clip(),m.transform(H[0],H[2],H[1],H[3],b,M),m.translate(x[0]-X,x[3]-K);let Q;if(v)Q=v.canvas,m.scale(S,-S);else{const nt=l[0],xt=nt.extent;Q=nt.image,m.scale(yt(xt)/Q.width,-Vt(xt)/Q.height)}m.drawImage(Q,0,0),m.restore()}),v&&(Gi(v),On.push(v.canvas)),u&&(m.save(),m.globalCompositeOperation="source-over",m.strokeStyle="black",m.lineWidth=1,a.getTriangles().forEach(function(T,R,C){const I=T.target,F=(I[0][0]-E[0])/s,U=-(I[0][1]-E[1])/s,j=(I[1][0]-E[0])/s,B=-(I[1][1]-E[1])/s,d=(I[2][0]-E[0])/s,p=-(I[2][1]-E[1])/s;m.beginPath(),m.moveTo(j,B),m.lineTo(F,U),m.lineTo(d,p),m.closePath(),m.stroke()}),m.restore()),m.canvas}class Yd extends Zd{constructor(t){super({tileCoord:t.tileCoord,loader:()=>Promise.resolve(new Uint8Array(4)),interpolate:t.interpolate,transition:t.transition}),this.pixelRatio_=t.pixelRatio,this.gutter_=t.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=t.sourceTileGrid,this.targetTileGrid_=t.targetTileGrid,this.wrappedTileCoord_=t.wrappedTileCoord||t.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const e=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),n=this.targetTileGrid_.getExtent();let i=this.sourceTileGrid_.getExtent();const s=n?we(e,n):e;if(Yo(s)===0){this.state=W.EMPTY;return}const o=t.sourceProj,a=o.getExtent();a&&(i?i=we(i,a):i=a);const l=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),h=t.targetProj,u=V_(o,h,s,l);if(!isFinite(u)||u<=0){this.state=W.EMPTY;return}const c=t.errorThreshold!==void 0?t.errorThreshold:qd;if(this.triangulation_=new $d(o,h,s,i,u*c,l),this.triangulation_.getTriangles().length===0){this.state=W.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(u);let f=this.triangulation_.calculateSourceExtent();if(i&&(o.canWrapX()?(f[1]=wt(f[1],i[1],i[3]),f[3]=wt(f[3],i[1],i[3])):f=we(f,i)),!Yo(f))this.state=W.EMPTY;else{const g=this.sourceTileGrid_.getTileRangeForExtentAndZ(f,this.sourceZ_),m=t.getTileFunction;for(let _=g.minX;_<=g.maxX;_++)for(let x=g.minY;x<=g.maxY;x++){const v=m(this.sourceZ_,_,x,this.pixelRatio_);v&&this.sourceTiles_.push(v)}this.sourceTiles_.length===0&&(this.state=W.EMPTY)}}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const t=[];if(this.sourceTiles_.forEach(e=>{if(!e||e.getState()!==W.LOADED)return;const n=e.getSize(),i=this.gutter_;let s;const o=yc(e.getData());o?s=o:s=xI(ql(e.getData()));const a=[n[0]+2*i,n[1]+2*i],l=s instanceof Float32Array,h=a[0]*a[1],u=l?Float32Array:Uint8Array,c=new u(s.buffer),f=u.BYTES_PER_ELEMENT,g=f*c.length/h,m=c.byteLength/a[1],_=Math.floor(m/f/a[0]),x=h*_;let v=c;if(c.length!==x){v=new u(x);let w=0,S=0;const E=a[0]*_;for(let T=0;T<a[1];++T){for(let R=0;R<E;++R)v[w++]=c[S+R];S+=m/f}}t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),data:new Uint8Array(v.buffer),dataType:u,bytesPerPixel:g,pixelSize:a})}),this.sourceTiles_.length=0,t.length===0)this.state=W.ERROR;else{const e=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(e),i=typeof n=="number"?n:n[0],s=typeof n=="number"?n:n[1],o=this.targetTileGrid_.getResolution(e),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);let h,u;const c=t[0].bytesPerPixel,f=Math.ceil(c/3);for(let g=f-1;g>=0;--g){const m=[];for(let E=0,T=t.length;E<T;++E){const R=t[E],C=R.data,I=R.pixelSize,F=I[0],U=I[1],j=Jt(F,U,On),B=j.createImageData(F,U),d=B.data;let p=g*3;for(let y=0,b=d.length;y<b;y+=4)d[y]=C[p],d[y+1]=C[p+1],d[y+2]=C[p+2],d[y+3]=255,p+=c;j.putImageData(B,0,0),m.push({extent:R.extent,image:j.canvas})}const _=Vd(i,s,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,m,this.gutter_,!1,!1,!1,!0);for(let E=0,T=m.length;E<T;++E){const R=m[E].image.getContext("2d");Gi(R),On.push(R.canvas)}const x=_.getContext("2d"),v=x.getImageData(0,0,_.width,_.height);Gi(x),On.push(_),h||(u=new Uint8Array(c*v.width*v.height),h=new t[0].dataType(u.buffer));const w=v.data;let S=g*3;for(let E=0,T=w.length;E<T;E+=4)w[E+3]===255?(u[S]=w[E],u[S+1]=w[E+1],u[S+2]=w[E+2]):(u[S]=0,u[S+1]=0,u[S+2]=0),S+=c}this.reprojData_=h,this.reprojSize_=[Math.round(i*this.pixelRatio_),Math.round(s*this.pixelRatio_)],this.state=W.LOADED}this.changed()}load(){if(this.state!==W.IDLE&&this.state!==W.ERROR)return;this.state=W.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(e=>{const n=e.getState();if(n!==W.IDLE&&n!==W.LOADING)return;t++;const i=le(e,Lt.CHANGE,function(){const s=e.getState();(s==W.LOADED||s==W.ERROR||s==W.EMPTY)&&(ve(i),t--,t===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(i)}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(e){e.getState()==W.IDLE&&e.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(ve),this.sourcesListenerKeys_=null}}class Us extends no{constructor(t,e,n,i,s,o,a,l,h,u,c,f){super(s,W.IDLE,f),this.renderEdges_=c!==void 0?c:!1,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=i,this.wrappedTileCoord_=o||s,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const g=i.getTileCoordExtent(this.wrappedTileCoord_),m=this.targetTileGrid_.getExtent();let _=this.sourceTileGrid_.getExtent();const x=m?we(g,m):g;if(Yo(x)===0){this.state=W.EMPTY;return}const v=t.getExtent();v&&(_?_=we(_,v):_=v);const w=i.getResolution(this.wrappedTileCoord_[0]),S=V_(t,n,x,w);if(!isFinite(S)||S<=0){this.state=W.EMPTY;return}const E=u!==void 0?u:qd;if(this.triangulation_=new $d(t,n,x,_,S*E,w),this.triangulation_.getTriangles().length===0){this.state=W.EMPTY;return}this.sourceZ_=e.getZForResolution(S);let T=this.triangulation_.calculateSourceExtent();if(_&&(t.canWrapX()?(T[1]=wt(T[1],_[1],_[3]),T[3]=wt(T[3],_[1],_[3])):T=we(T,_)),!Yo(T))this.state=W.EMPTY;else{const R=e.getTileRangeForExtentAndZ(T,this.sourceZ_);for(let C=R.minX;C<=R.maxX;C++)for(let I=R.minY;I<=R.maxY;I++){const F=h(this.sourceZ_,C,I,a);F&&this.sourceTiles_.push(F)}this.sourceTiles_.length===0&&(this.state=W.EMPTY)}}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach(e=>{e&&e.getState()==W.LOADED&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),image:e.getImage()})}),this.sourceTiles_.length=0,t.length===0)this.state=W.ERROR;else{const e=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(e),i=typeof n=="number"?n:n[0],s=typeof n=="number"?n:n[1],o=this.targetTileGrid_.getResolution(e),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=Vd(i,s,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=W.LOADED}this.changed()}load(){if(this.state==W.IDLE){this.state=W.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(e=>{const n=e.getState();if(n==W.IDLE||n==W.LOADING){t++;const i=le(e,Lt.CHANGE,function(s){const o=e.getState();(o==W.LOADED||o==W.ERROR||o==W.EMPTY)&&(ve(i),t--,t===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(i)}}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(e,n,i){e.getState()==W.IDLE&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(ve),this.sourcesListenerKeys_=null}release(){this.canvas_&&(Gi(this.canvas_.getContext("2d")),On.push(this.canvas_),this.canvas_=null),super.release()}}class Fa extends no{constructor(t,e,n,i,s,o){super(t,e,o),this.crossOrigin_=i,this.src_=n,this.key=n,this.image_=new Image,i!==null&&(this.image_.crossOrigin=i),this.unlisten_=null,this.tileLoadFunction_=s}getImage(){return this.image_}setImage(t){this.image_=t,this.state=W.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=W.ERROR,this.unlistenImage_(),this.image_=SI(),this.changed()}handleImageLoad_(){const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=W.LOADED:this.state=W.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==W.ERROR&&(this.state=W.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==W.IDLE&&(this.state=W.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=Nb(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function SI(){const r=Jt(1,1);return r.fillStyle="rgba(0,0,0,0)",r.fillRect(0,0,1,1),r.canvas}class EI extends ma{constructor(t){super(),this.tile,this.handleTileChange_=this.handleTileChange_.bind(this),this.gutter_=t.gutter||0,this.helper_=t.helper,this.loaded=!1,this.ready=!1}setTile(t){if(t!==this.tile)if(this.tile&&this.tile.removeEventListener(Lt.CHANGE,this.handleTileChange_),this.tile=t,this.loaded=t.getState()===W.LOADED,this.loaded)this.uploadTile();else{if(t instanceof Fa){const e=t.getImage();e instanceof Image&&!e.crossOrigin&&(e.crossOrigin="anonymous")}t.addEventListener(Lt.CHANGE,this.handleTileChange_)}}uploadTile(){ut()}setReady(){this.ready=!0,this.dispatchEvent(Lt.CHANGE)}handleTileChange_(){this.tile.getState()===W.LOADED&&(this.loaded=!0,this.uploadTile())}disposeInternal(){this.tile.removeEventListener(Lt.CHANGE,this.handleTileChange_)}}function Y_(r,t,e){const n=e?r.LINEAR:r.NEAREST;r.bindTexture(r.TEXTURE_2D,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,n)}function TI(r,t,e,n){Y_(r,t,n),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,e)}function kp(r,t,e,n,i,s){const o=r.getGL();let a,l;e instanceof Float32Array?(a=o.FLOAT,r.getExtension("OES_texture_float"),l=r.getExtension("OES_texture_float_linear")!==null):(a=o.UNSIGNED_BYTE,l=!0),Y_(o,t,s&&l);const h=e.byteLength/n[1];let u=1;h%8===0?u=8:h%4===0?u=4:h%2===0&&(u=2);let c;switch(i){case 1:{c=o.LUMINANCE;break}case 2:{c=o.LUMINANCE_ALPHA;break}case 3:{c=o.RGB;break}case 4:{c=o.RGBA;break}default:throw new Error(`Unsupported number of bands: ${i}`)}const f=o.getParameter(o.UNPACK_ALIGNMENT);o.pixelStorei(o.UNPACK_ALIGNMENT,u),o.texImage2D(o.TEXTURE_2D,0,c,n[0],n[1],0,c,a,e),o.pixelStorei(o.UNPACK_ALIGNMENT,f)}let fs=null;function MI(){fs=Jt(1,1,void 0,{willReadFrequently:!0})}class RI extends EI{constructor(t){super(t),this.textures=[],this.renderSize_=ie(t.grid.getTileSize(t.tile.tileCoord[0])),this.bandCount=NaN;const e=new Xl(Dh,Wd);e.fromArray([0,1,1,1,1,0,0,0]),this.helper_.flushBufferData(e),this.coords=e,this.setTile(t.tile)}uploadTile(){const t=this.helper_,e=t.getGL(),n=this.tile;this.textures.length=0;let i;n instanceof Fa||n instanceof Us?i=n.getImage():i=n.getData();const s=ql(i);if(s){const w=e.createTexture();this.textures.push(w),this.bandCount=4,TI(e,w,s,n.interpolate),this.setReady();return}i=yc(i);const o=n.getSize(),a=[o[0]+2*this.gutter_,o[1]+2*this.gutter_],l=i instanceof Float32Array,h=a[0]*a[1],u=l?Float32Array:Uint8Array,c=u.BYTES_PER_ELEMENT,f=i.byteLength/a[1];this.bandCount=Math.floor(f/c/a[0]);const g=Math.ceil(this.bandCount/4);if(g===1){const w=e.createTexture();this.textures.push(w),kp(t,w,i,a,this.bandCount,n.interpolate),this.setReady();return}const m=new Array(g);for(let w=0;w<g;++w){const S=e.createTexture();this.textures.push(S);const E=w<g-1?4:(this.bandCount-1)%4+1;m[w]=new u(h*E)}let _=0,x=0;const v=a[0]*this.bandCount;for(let w=0;w<a[1];++w){for(let S=0;S<v;++S){const E=i[x+S],T=Math.floor(_/this.bandCount),R=S%this.bandCount,C=Math.floor(R/4),I=m[C],F=I.length/h,U=R%4;I[T*F+U]=E,++_}x+=f/c}for(let w=0;w<g;++w){const S=this.textures[w],E=m[w],T=E.length/h;kp(t,S,E,a,T,n.interpolate)}this.setReady()}disposeInternal(){const t=this.helper_.getGL();this.helper_.deleteBuffer(this.coords);for(let e=0;e<this.textures.length;++e)t.deleteTexture(this.textures[e]);this.tile.removeEventListener(Lt.CHANGE,this.handleTileChange_)}getImagePixelData_(t,e,n){const i=this.gutter_,s=this.renderSize_[0],o=this.renderSize_[1];fs||MI(),fs.clearRect(0,0,1,1);const a=t.width,l=t.height,h=a-2*i,u=l-2*i,c=i+Math.floor(h*(e/s)),f=i+Math.floor(u*(n/o));let g;try{fs.drawImage(t,c,f,1,1,0,0,1,1),g=fs.getImageData(0,0,1,1).data}catch{return fs=null,null}return g}getArrayPixelData_(t,e,n,i){const s=this.gutter_,o=this.renderSize_[0],a=this.renderSize_[1],l=e[0],h=e[1],u=l+2*s,c=h+2*s,f=s+Math.floor(l*(n/o)),g=s+Math.floor(h*(i/a));if(t instanceof DataView){const _=t.byteLength/(u*c),x=_*(g*u+f),v=t.buffer.slice(x,x+_);return new DataView(v)}const m=this.bandCount*(g*u+f);return t.slice(m,m+this.bandCount)}getPixelData(t,e){if(!this.loaded)return null;if(this.tile instanceof Zd){const n=this.tile.getData(),i=yc(n);if(i){const s=this.tile.getSize();return this.getArrayPixelData_(i,s,t,e)}return this.getImagePixelData_(ql(n),t,e)}return this.getImagePixelData_(this.tile.getImage(),t,e)}}class Hd{constructor(t){this.highWaterMark=t!==void 0?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(t,e){const n=this.entries_[t];return At(n!==void 0,"Tried to get a value for a key that does not exist in the cache"),n===this.newest_||(n===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(n.newer.older=n.older,n.older.newer=n.newer),n.newer=null,n.older=this.newest_,this.newest_.newer=n,this.newest_=n),n.value_}remove(t){const e=this.entries_[t];return At(e!==void 0,"Tried to get a value for a key that does not exist in the cache"),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}getCount(){return this.count_}getKeys(){const t=new Array(this.count_);let e=0,n;for(n=this.newest_;n;n=n.older)t[e++]=n.key_;return t}getValues(){const t=new Array(this.count_);let e=0,n;for(n=this.newest_;n;n=n.older)t[e++]=n.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){var e;return(e=this.entries_[t])==null?void 0:e.value_}pop(){const t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(t,e){At(!(t in this.entries_),"Tried to set a value for a key that is used already");const n={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=n:this.oldest_=n,this.newest_=n,this.entries_[t]=n,++this.count_}setSize(t){this.highWaterMark=t}}class Uh{constructor(t,e,n,i){this.minX=t,this.maxX=e,this.minY=n,this.maxY=i}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function ss(r,t,e,n,i){return i!==void 0?(i.minX=r,i.maxX=t,i.minY=e,i.maxY=n,i):new Uh(r,t,e,n)}function ha(r,t,e,n){return n!==void 0?(n[0]=r,n[1]=t,n[2]=e,n):[r,t,e]}function cn(r,t,e){return r+"/"+t+"/"+e}function ei(r){return cn(r[0],r[1],r[2])}function CI(r){const[t,e,n]=r.substring(r.lastIndexOf("/")+1,r.length).split(",").map(Number);return cn(t,e,n)}function H_(r){return r.split("/").map(Number)}function Kd(r){return(r[1]<<r[0])+r[2]}function II(r,t){const e=r[0],n=r[1],i=r[2];if(t.getMinZoom()>e||e>t.getMaxZoom())return!1;const s=t.getFullTileRange(e);return s?s.containsXY(n,i):!0}const PI={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"},AI={};function Gp(r){return 1/(r+2)}function LI(){return{tileIds:new Set,representationsByZ:{}}}function jp(r,t){return r.tileIds.has(it(t))}function zp(r,t,e){const n=r.representationsByZ;e in n||(n[e]=new Set),n[e].add(t),r.tileIds.add(it(t.tile))}function Mu(r,t){const e=r.layerStatesArray[r.layerIndex];e.extent&&(t=we(t,Gr(e.extent,r.viewState.projection)));const n=e.layer.getRenderSource();if(!n.getWrapX()){const i=n.getTileGridForProjection(r.viewState.projection).getExtent();i&&(t=we(t,i))}return t}function xc(r,t){return`${r.getKey()},${ei(t)}`}class OI extends Gh{constructor(t,e){super(t,{uniforms:e.uniforms,postProcesses:e.postProcesses}),this.renderComplete=!1,this.tileTransform_=pe(),this.tempMat4=z_(),this.tempTileRange_=new Uh(0,0,0,0),this.tempTileCoord_=ha(0,0,0),this.tempSize_=[0,0];const n=e.cacheSize!==void 0?e.cacheSize:512;this.tileRepresentationCache=new Hd(n),this.frameState=null,this.projection_=void 0}reset(t){super.reset({uniforms:t.uniforms})}isDrawableTile_(t){const e=this.getLayer(),n=t.getState(),i=e.getUseInterimTilesOnError();return n==W.LOADED||n==W.EMPTY||n==W.ERROR&&!i}prepareFrameInternal(t){this.projection_?t.viewState.projection!==this.projection_&&(this.clearCache(),this.projection_=t.viewState.projection):this.projection_=t.viewState.projection;const e=this.getLayer().getRenderSource();return!e||Un(Mu(t,t.extent))?!1:e.getState()==="ready"}createTileRepresentation(t){return ut()}enqueueTiles(t,e,n,i,s){const o=t.viewState,a=this.getLayer(),l=a.getRenderSource(),h=l.getTileGridForProjection(o.projection),u=l.getGutterForProjection(o.projection),c=it(l);c in t.wantedTiles||(t.wantedTiles[c]={});const f=t.wantedTiles[c],g=this.tileRepresentationCache,m=a.getMapInternal(),_=Math.max(n-s,h.getMinZoom(),h.getZForResolution(Math.min(a.getMaxResolution(),m?m.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):h.getResolution(0)),l.zDirection));for(let x=n;x>=_;--x){const v=h.getTileRangeForExtentAndZ(e,x,this.tempTileRange_),w=h.getResolution(x);for(let S=v.minX;S<=v.maxX;++S)for(let E=v.minY;E<=v.maxY;++E){const T=ha(x,S,E,this.tempTileCoord_),R=xc(l,T);let C,I;if(g.containsKey(R)&&(C=g.get(R),I=C.tile),(!C||C.tile.key!==l.getKey())&&(I=l.getTile(x,S,E,t.pixelRatio,o.projection)),jp(i,I))continue;if(!C)C=this.createTileRepresentation({tile:I,grid:h,helper:this.helper,gutter:u}),g.set(R,C);else if(this.isDrawableTile_(I))C.setTile(I);else{const U=I.getInterimTile();C.setTile(U)}zp(i,C,x);const F=I.getKey();f[F]=!0,I.getState()===W.IDLE&&(t.tileQueue.isKeyQueued(F)||t.tileQueue.enqueue([I,c,h.getTileCoordCenter(T),w]))}}}beforeTilesRender(t,e){this.helper.prepareDraw(this.frameState,!e,!0)}beforeTilesMaskRender(t){return!1}renderTile(t,e,n,i,s,o,a,l,h,u,c){}renderTileMask(t,e,n,i){}drawTile_(t,e,n,i,s,o,a){if(!e.ready)return;const l=e.tile.tileCoord,h=ei(l),u=h in o?o[h]:1,c=a.getResolution(n),f=ie(a.getTileSize(n),this.tempSize_),g=a.getOrigin(n),m=a.getTileCoordExtent(l),_=u<1?-1:Gp(n);u<1&&(t.animate=!0);const x=t.viewState,v=x.center[0],w=x.center[1],S=f[0]+2*i,E=f[1]+2*i,T=S/E,R=(v-g[0])/(f[0]*c),C=(g[1]-w)/(f[1]*c),I=x.resolution/c,F=l[1],U=l[2];Xu(this.tileTransform_),Ao(this.tileTransform_,2/(t.size[0]*I/S),-2/(t.size[1]*I/S)),zx(this.tileTransform_,x.rotation),Ao(this.tileTransform_,1,1/T),kc(this.tileTransform_,(f[0]*(F-R)-i)/S,(f[1]*(U-C)-i)/E),this.renderTile(e,this.tileTransform_,t,s,c,f,g,m,_,i,u)}renderFrame(t){this.frameState=t,this.renderComplete=!0;const e=this.helper.getGL();this.preRender(e,t);const n=t.viewState,i=this.getLayer(),s=i.getRenderSource(),o=s.getTileGridForProjection(n.projection),a=s.getGutterForProjection(n.projection),l=Mu(t,t.extent),h=o.getZForResolution(n.resolution,s.zDirection),u=LI(),c=i.getPreload();if(t.nextExtent){const T=o.getZForResolution(n.nextResolution,s.zDirection),R=Mu(t,t.nextExtent);this.enqueueTiles(t,R,T,u,c)}this.enqueueTiles(t,l,h,u,0),c>0&&setTimeout(()=>{this.enqueueTiles(t,l,h-1,u,c-1)},0);const f={},g=it(this),m=t.time;let _=!1;for(const T of u.representationsByZ[h]){const R=T.tile;if((R instanceof Us||R instanceof Yd)&&R.getState()===W.EMPTY)continue;const C=R.tileCoord;if(T.ready){const F=R.getAlpha(g,m);if(F===1){R.endTransition(g);continue}_=!0;const U=ei(C);f[U]=F}if(this.renderComplete=!1,this.findAltTiles_(o,C,h+1,u))continue;const I=o.getMinZoom();for(let F=h-1;F>=I&&!this.findAltTiles_(o,C,F,u);--F);}const x=u.representationsByZ,v=Object.keys(x).map(Number).sort(Lx);if(this.beforeTilesMaskRender(t))for(let T=0,R=v.length;T<R;++T){const C=v[T];for(const I of x[C]){const F=I.tile.tileCoord;if(ei(F)in f)continue;const U=o.getTileCoordExtent(F);this.renderTileMask(I,C,U,Gp(C))}}this.beforeTilesRender(t,_);for(let T=0,R=v.length;T<R;++T){const C=v[T];for(const I of x[C]){const F=I.tile.tileCoord;ei(F)in f||this.drawTile_(t,I,C,a,l,f,o)}}for(const T of x[h]){const R=T.tile.tileCoord;ei(R)in f&&this.drawTile_(t,T,h,a,l,f,o)}this.helper.finalizeDraw(t,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const w=this.helper.getCanvas(),S=this.tileRepresentationCache;for(;S.canExpireCache();)S.pop().dispose();const E=function(T,R){s.updateCacheSize(.1,R.viewState.projection),s.expireCache(R.viewState.projection,AI)};return t.postRenderFunctions.push(E),this.postRender(e,t),w}findAltTiles_(t,e,n,i){const s=t.getTileRangeForTileCoordAndZ(e,n,this.tempTileRange_);if(!s)return!1;let o=!0;const a=this.tileRepresentationCache,l=this.getLayer().getRenderSource();for(let h=s.minX;h<=s.maxX;++h)for(let u=s.minY;u<=s.maxY;++u){const c=xc(l,[n,h,u]);let f=!1;if(a.containsKey(c)){const g=a.get(c);g.ready&&!jp(i,g.tile)&&(zp(i,g,n),f=!0)}f||(o=!1)}return o}clearCache(){const t=this.tileRepresentationCache;t.forEach(e=>e.dispose()),t.clear()}removeHelper(){this.helper&&this.clearCache(),super.removeHelper()}disposeInternal(){super.disposeInternal(),delete this.frameState}}const Et={...PI,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"},pl={TEXTURE_COORD:"a_textureCoord"},FI=[{name:pl.TEXTURE_COORD,size:2,type:tn.FLOAT}];class NI extends OI{constructor(t,e){super(t,e),this.program_,this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.indices_=new Xl(kh,Wd),this.indices_.fromArray([0,1,3,1,2,3]),this.paletteTextures_=e.paletteTextures||[]}reset(t){super.reset(t),this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.paletteTextures_=t.paletteTextures||[],this.helper&&(this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_))}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)}createTileRepresentation(t){return new RI(t)}beforeTilesRender(t,e){super.beforeTilesRender(t,e),this.helper.useProgram(this.program_,t)}renderTile(t,e,n,i,s,o,a,l,h,u,c){const f=this.helper.getGL();this.helper.bindBuffer(t.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(FI);let g=0;for(;g<t.textures.length;){const T=`${Et.TILE_TEXTURE_ARRAY}[${g}]`;this.helper.bindTexture(t.textures[g],g,T),++g}for(let T=0;T<this.paletteTextures_.length;++T){const R=this.paletteTextures_[T],C=R.getTexture(f);this.helper.bindTexture(C,g,R.name),++g}const m=n.viewState,_=o[0]+2*u,x=o[1]+2*u,v=t.tile.tileCoord,w=v[1],S=v[2];this.helper.setUniformMatrixValue(Et.TILE_TRANSFORM,U_(this.tempMat4,e)),this.helper.setUniformFloatValue(Et.TRANSITION_ALPHA,c),this.helper.setUniformFloatValue(Et.DEPTH,h);let E=i;u>0&&(E=l,we(E,i,E)),this.helper.setUniformFloatVec4(Et.RENDER_EXTENT,E),this.helper.setUniformFloatValue(Et.RESOLUTION,m.resolution),this.helper.setUniformFloatValue(Et.ZOOM,m.zoom),this.helper.setUniformFloatValue(Et.TEXTURE_PIXEL_WIDTH,_),this.helper.setUniformFloatValue(Et.TEXTURE_PIXEL_HEIGHT,x),this.helper.setUniformFloatValue(Et.TEXTURE_RESOLUTION,s),this.helper.setUniformFloatValue(Et.TEXTURE_ORIGIN_X,a[0]+w*o[0]*s-u*s),this.helper.setUniformFloatValue(Et.TEXTURE_ORIGIN_Y,a[1]-S*o[1]*s+u*s),this.helper.drawElements(0,this.indices_.getSize())}getData(t){if(!this.helper.getGL())return null;const e=this.frameState;if(!e)return null;const n=this.getLayer(),i=ae(e.pixelToCoordinateTransform,t.slice()),s=e.viewState,o=n.getExtent();if(o&&!xr(Gr(o,s.projection),i))return null;const a=n.getSources(Os([i]),s.resolution);let l,h,u;for(l=a.length-1;l>=0;--l)if(h=a[l],h.getState()==="ready"){if(u=h.getTileGridForProjection(s.projection),h.getWrapX())break;const f=u.getExtent();if(!f||xr(f,i))break}if(l<0)return null;const c=this.tileRepresentationCache;for(let f=u.getZForResolution(s.resolution);f>=u.getMinZoom();--f){const g=u.getTileCoordForCoordAndZ(i,f),m=xc(h,g);if(!c.containsKey(m))continue;const _=c.get(m),x=_.tile;if((x instanceof Us||x instanceof Yd)&&x.getState()===W.EMPTY)return null;if(!_.loaded)continue;const v=u.getOrigin(f),w=ie(u.getTileSize(f)),S=u.getResolution(f),E=(i[0]-v[0])/S-g[1]*w[0],T=(v[1]-i[1])/S-g[2]*w[1];return _.getPixelData(E,T)}return null}disposeInternal(){const t=this.helper;t&&(t.getGL().deleteProgram(this.program_),delete this.program_,t.deleteBuffer(this.indices_)),super.disposeInternal(),delete this.indices_}}function DI(r,t){return`operator_${r}_${Object.keys(t.functions).length}`}function Fi(r){const t=r.toString();return t.includes(".")?t:t+".0"}function Qd(r){if(r.length<2||r.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${r.length}(${r.map(Fi).join(", ")})`}function ml(r){const t=Xr(r),e=t.length>3?t[3]:1;return Qd([t[0]/255*e,t[1]/255*e,t[2]/255*e,e])}const Ru={};let kI=0;function Zl(r){return r in Ru||(Ru[r]=kI++),Ru[r]}function Mn(r){return Fi(Zl(r))}function Jd(r){return"u_var_"+r}function GI(){return{inFragmentShader:!1,variables:{},properties:{},functions:{},bandCount:0,style:{}}}const Cu="getBandValue",K_="u_paletteTextures";function jI(r,t,e,n){const i=Bt(r,e,t);if(Pa(i.type,Yi))throw new Error("No matching type was found");if(!jr(t,i.type)){const s=be(t),o=be(i.type);throw new Error(`Expected expression to be of type ${s}, got ${o}`)}return tf(i,t,n)}function kt(r){return(t,e,n)=>{const i=e.args.length,s=new Array(i);for(let o=0;o<i;++o)s[o]=tf(e.args[o],n,t);return r(s,t)}}const zI={[z.Get]:(r,t)=>{const e=t.args[0].value;return e in r.properties||(r.properties[e]={name:e,type:t.type}),(r.inFragmentShader?"v_prop_":"a_prop_")+e},[z.GeometryType]:(r,t,e)=>{const n="geometryType";return n in r.properties||(r.properties[n]={name:n,type:xe,evaluator:i=>jd(i.getGeometry())}),(r.inFragmentShader?"v_prop_":"a_prop_")+n},[z.Var]:(r,t)=>{const e=t.args[0].value;return e in r.variables||(r.variables[e]={name:e,type:t.type}),Jd(e)},[z.Resolution]:()=>"u_resolution",[z.Zoom]:()=>"u_zoom",[z.Time]:()=>"u_time",[z.Any]:kt(r=>`(${r.join(" || ")})`),[z.All]:kt(r=>`(${r.join(" && ")})`),[z.Not]:kt(([r])=>`(!${r})`),[z.Equal]:kt(([r,t])=>`(${r} == ${t})`),[z.NotEqual]:kt(([r,t])=>`(${r} != ${t})`),[z.GreaterThan]:kt(([r,t])=>`(${r} > ${t})`),[z.GreaterThanOrEqualTo]:kt(([r,t])=>`(${r} >= ${t})`),[z.LessThan]:kt(([r,t])=>`(${r} < ${t})`),[z.LessThanOrEqualTo]:kt(([r,t])=>`(${r} <= ${t})`),[z.Multiply]:kt(r=>`(${r.join(" * ")})`),[z.Divide]:kt(([r,t])=>`(${r} / ${t})`),[z.Add]:kt(r=>`(${r.join(" + ")})`),[z.Subtract]:kt(([r,t])=>`(${r} - ${t})`),[z.Clamp]:kt(([r,t,e])=>`clamp(${r}, ${t}, ${e})`),[z.Mod]:kt(([r,t])=>`mod(${r}, ${t})`),[z.Pow]:kt(([r,t])=>`pow(${r}, ${t})`),[z.Abs]:kt(([r])=>`abs(${r})`),[z.Floor]:kt(([r])=>`floor(${r})`),[z.Ceil]:kt(([r])=>`ceil(${r})`),[z.Round]:kt(([r])=>`floor(${r} + 0.5)`),[z.Sin]:kt(([r])=>`sin(${r})`),[z.Cos]:kt(([r])=>`cos(${r})`),[z.Atan]:kt(([r,t])=>t!==void 0?`atan(${r}, ${t})`:`atan(${r})`),[z.Sqrt]:kt(([r])=>`sqrt(${r})`),[z.Match]:kt(r=>{const t=r[0],e=r[r.length-1];let n=null;for(let i=r.length-3;i>=1;i-=2){const s=r[i],o=r[i+1];n=`(${t} == ${s} ? ${o} : ${n||e})`}return n}),[z.Between]:kt(([r,t,e])=>`(${r} >= ${t} && ${r} <= ${e})`),[z.Interpolate]:kt(([r,t,...e])=>{let n="";for(let i=0;i<e.length-2;i+=2){const s=e[i],o=n||e[i+1],a=e[i+2],l=e[i+3];let h;r===Fi(1)?h=`(${t} - ${s}) / (${a} - ${s})`:h=`(pow(${r}, (${t} - ${s})) - 1.0) / (pow(${r}, (${a} - ${s})) - 1.0)`,n=`mix(${o}, ${l}, clamp(${h}, 0.0, 1.0))`}return n}),[z.Case]:kt(r=>{const t=r[r.length-1];let e=null;for(let n=r.length-3;n>=0;n-=2){const i=r[n],s=r[n+1];e=`(${i} ? ${s} : ${e||t})`}return e}),[z.In]:kt(([r,...t],e)=>{const n=DI("in",e),i=[];for(let s=0;s<t.length;s+=1)i.push(`  if (inputValue == ${t[s]}) { return true; }`);return e.functions[n]=`bool ${n}(float inputValue) {
${i.join(`
`)}
  return false;
}`,`${n}(${r})`}),[z.Array]:kt(r=>`vec${r.length}(${r.join(", ")})`),[z.Color]:kt(r=>{if(r.length===1)return`vec4(vec3(${r[0]} / 255.0), 1.0)`;if(r.length===2)return`(${r[1]} * vec4(vec3(${r[0]} / 255.0), 1.0))`;const t=r.slice(0,3).map(e=>`${e} / 255.0`);return r.length===3?`vec4(${t.join(", ")}, 1.0)`:`(${r[3]} * vec4(${t.join(", ")}, 1.0))`}),[z.Band]:kt(([r,t,e],n)=>{if(!(Cu in n.functions)){let i="";const s=n.bandCount||1;for(let o=0;o<s;o++){const a=Math.floor(o/4);let l=o%4;o===s-1&&l===1&&(l=3);const h=`${Et.TILE_TEXTURE_ARRAY}[${a}]`;i+=`  if (band == ${o+1}.0) {
    return texture2D(${h}, v_textureCoord + vec2(dx, dy))[${l}];
  }
`}n.functions[Cu]=`float getBandValue(float band, float xOffset, float yOffset) {
  float dx = xOffset / ${Et.TEXTURE_PIXEL_WIDTH};
  float dy = yOffset / ${Et.TEXTURE_PIXEL_HEIGHT};
${i}
}`}return`${Cu}(${r}, ${t??"0.0"}, ${e??"0.0"})`}),[z.Palette]:(r,t)=>{const[e,...n]=t.args,i=n.length,s=new Uint8Array(i*4);for(let h=0;h<n.length;h++){const u=n[h].value,c=Xr(u),f=h*4;s[f]=c[0],s[f+1]=c[1],s[f+2]=c[2],s[f+3]=c[3]*255}r.paletteTextures||(r.paletteTextures=[]);const o=`${K_}[${r.paletteTextures.length}]`,a=new yI(o,s);r.paletteTextures.push(a);const l=tf(e,Y,r);return`texture2D(${o}, vec2((${l} + 0.5) / ${i}.0, 0.5))`}};function tf(r,t,e){if(r instanceof v_){const n=zI[r.operator];if(n===void 0)throw new Error(`No compiler defined for this operator: ${JSON.stringify(r.operator)}`);return n(e,r,t)}if((r.type&Y)>0)return Fi(r.value);if((r.type&te)>0)return r.value.toString();if((r.type&xe)>0)return Mn(r.value.toString());if((r.type&Xt)>0)return ml(r.value);if((r.type&me)>0)return Qd(r.value);throw new Error(`Unexpected expression ${r.value} (expected type ${be(t)})`)}function UI(){return{"fill-color":"rgba(255,255,255,0.4)","stroke-color":"#3399CC","stroke-width":1.25,"circle-radius":5,"circle-fill-color":"rgba(255,255,255,0.4)","circle-stroke-width":1.25,"circle-stroke-color":"#3399CC"}}const os=`#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif
uniform mat4 u_projectionMatrix;
uniform mat4 u_screenToWorldMatrix;
uniform vec2 u_viewportSizePx;
uniform float u_pixelRatio;
uniform float u_globalAlpha;
uniform float u_time;
uniform float u_zoom;
uniform float u_resolution;
uniform float u_rotation;
uniform vec4 u_renderExtent;
uniform vec2 u_patternOrigin;
uniform float u_depth;
uniform mediump int u_hitDetection;

const float PI = 3.141592653589793238;
const float TWO_PI = 2.0 * PI;

// this used to produce an alpha-premultiplied color from a texture
vec4 samplePremultiplied(sampler2D sampler, vec2 texCoord) {
  vec4 color = texture2D(sampler, texCoord);
  return vec4(color.rgb * color.a, color.a);
}
`,as=UI();class Q_{constructor(){this.uniforms_=[],this.attributes_=[],this.varyings_=[],this.hasSymbol_=!1,this.symbolSizeExpression_=`vec2(${Fi(as["circle-radius"])} + ${Fi(as["circle-stroke-width"]*.5)})`,this.symbolRotationExpression_="0.0",this.symbolOffsetExpression_="vec2(0.0)",this.symbolColorExpression_=ml(as["circle-fill-color"]),this.texCoordExpression_="vec4(0.0, 0.0, 1.0, 1.0)",this.discardExpression_="false",this.symbolRotateWithView_=!1,this.hasStroke_=!1,this.strokeWidthExpression_=Fi(as["stroke-width"]),this.strokeColorExpression_=ml(as["stroke-color"]),this.strokeOffsetExpression_="0.",this.strokeCapExpression_=Mn("round"),this.strokeJoinExpression_=Mn("round"),this.strokeMiterLimitExpression_="10.",this.strokeDistanceFieldExpression_="-1000.",this.hasFill_=!1,this.fillColorExpression_=ml(as["fill-color"]),this.vertexShaderFunctions_=[],this.fragmentShaderFunctions_=[]}addUniform(t){return this.uniforms_.push(t),this}addAttribute(t){return this.attributes_.push(t),this}addVarying(t,e,n){return this.varyings_.push({name:t,type:e,expression:n}),this}setSymbolSizeExpression(t){return this.hasSymbol_=!0,this.symbolSizeExpression_=t,this}getSymbolSizeExpression(){return this.symbolSizeExpression_}setSymbolRotationExpression(t){return this.symbolRotationExpression_=t,this}setSymbolOffsetExpression(t){return this.symbolOffsetExpression_=t,this}getSymbolOffsetExpression(){return this.symbolOffsetExpression_}setSymbolColorExpression(t){return this.hasSymbol_=!0,this.symbolColorExpression_=t,this}getSymbolColorExpression(){return this.symbolColorExpression_}setTextureCoordinateExpression(t){return this.texCoordExpression_=t,this}setFragmentDiscardExpression(t){return this.discardExpression_=t,this}getFragmentDiscardExpression(){return this.discardExpression_}setSymbolRotateWithView(t){return this.symbolRotateWithView_=t,this}setStrokeWidthExpression(t){return this.hasStroke_=!0,this.strokeWidthExpression_=t,this}setStrokeColorExpression(t){return this.hasStroke_=!0,this.strokeColorExpression_=t,this}getStrokeColorExpression(){return this.strokeColorExpression_}setStrokeOffsetExpression(t){return this.strokeOffsetExpression_=t,this}setStrokeCapExpression(t){return this.strokeCapExpression_=t,this}setStrokeJoinExpression(t){return this.strokeJoinExpression_=t,this}setStrokeMiterLimitExpression(t){return this.strokeMiterLimitExpression_=t,this}setStrokeDistanceFieldExpression(t){return this.strokeDistanceFieldExpression_=t,this}setFillColorExpression(t){return this.hasFill_=!0,this.fillColorExpression_=t,this}getFillColorExpression(){return this.fillColorExpression_}addVertexShaderFunction(t){this.vertexShaderFunctions_.includes(t)||this.vertexShaderFunctions_.push(t)}addFragmentShaderFunction(t){this.fragmentShaderFunctions_.includes(t)||this.fragmentShaderFunctions_.push(t)}getSymbolVertexShader(){return this.hasSymbol_?`${os}
${this.uniforms_.map(function(t){return"uniform "+t+";"}).join(`
`)}
attribute vec2 a_position;
attribute float a_index;
attribute vec4 a_prop_hitColor;
${this.attributes_.map(function(t){return"attribute "+t+";"}).join(`
`)}
varying vec2 v_texCoord;
varying vec2 v_quadCoord;
varying vec4 v_prop_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;
${this.varyings_.map(function(t){return"varying "+t.type+" "+t.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 pxToScreen(vec2 coordPx) {
  vec2 scaled = coordPx / u_viewportSizePx / 0.5;
  return scaled;
}

vec2 screenToPx(vec2 coordScreen) {
  return (coordScreen * 0.5 + 0.5) * u_viewportSizePx;
}

void main(void) {
  v_quadSizePx = ${this.symbolSizeExpression_};
  vec2 halfSizePx = v_quadSizePx * 0.5;
  vec2 centerOffsetPx = ${this.symbolOffsetExpression_};
  vec2 offsetPx = centerOffsetPx;
  if (a_index == 0.0) {
    offsetPx -= halfSizePx;
  } else if (a_index == 1.0) {
    offsetPx += halfSizePx * vec2(1., -1.);
  } else if (a_index == 2.0) {
    offsetPx += halfSizePx;
  } else {
    offsetPx += halfSizePx * vec2(-1., 1.);
  }
  float angle = ${this.symbolRotationExpression_};
  ${this.symbolRotateWithView_?"angle += u_rotation;":""}
  float c = cos(-angle);
  float s = sin(-angle);
  offsetPx = vec2(c * offsetPx.x - s * offsetPx.y, s * offsetPx.x + c * offsetPx.y);
  vec4 center = u_projectionMatrix * vec4(a_position, 0.0, 1.0);
  gl_Position = center + vec4(pxToScreen(offsetPx), u_depth, 0.);
  vec4 texCoord = ${this.texCoordExpression_};
  float u = a_index == 0.0 || a_index == 3.0 ? texCoord.s : texCoord.p;
  float v = a_index == 2.0 || a_index == 3.0 ? texCoord.t : texCoord.q;
  v_texCoord = vec2(u, v);
  v_prop_hitColor = a_prop_hitColor;
  v_angle = angle;
  c = cos(-v_angle);
  s = sin(-v_angle);
  centerOffsetPx = vec2(c * centerOffsetPx.x - s * centerOffsetPx.y, s * centerOffsetPx.x + c * centerOffsetPx.y); 
  v_centerPx = screenToPx(center.xy) + centerOffsetPx;
${this.varyings_.map(function(t){return"  "+t.name+" = "+t.expression+";"}).join(`
`)}
}`:null}getSymbolFragmentShader(){return this.hasSymbol_?`${os}
${this.uniforms_.map(function(t){return"uniform "+t+";"}).join(`
`)}
varying vec2 v_texCoord;
varying vec4 v_prop_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;
${this.varyings_.map(function(t){return"varying "+t.type+" "+t.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

void main(void) {
  if (${this.discardExpression_}) { discard; }
  vec2 coordsPx = gl_FragCoord.xy / u_pixelRatio - v_centerPx; // relative to center
  float c = cos(v_angle);
  float s = sin(v_angle);
  coordsPx = vec2(c * coordsPx.x - s * coordsPx.y, s * coordsPx.x + c * coordsPx.y);
  gl_FragColor = ${this.symbolColorExpression_};
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.05) { discard; };
    gl_FragColor = v_prop_hitColor;
  }
}`:null}getStrokeVertexShader(){return this.hasStroke_?`${os}
${this.uniforms_.map(function(t){return"uniform "+t+";"}).join(`
`)}
attribute vec2 a_position;
attribute float a_index;
attribute vec2 a_segmentStart;
attribute vec2 a_segmentEnd;
attribute float a_parameters;
attribute float a_distance;
attribute vec2 a_joinAngles;
attribute vec4 a_prop_hitColor;
${this.attributes_.map(function(t){return"attribute "+t+";"}).join(`
`)}
varying vec2 v_segmentStart;
varying vec2 v_segmentEnd;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_prop_hitColor;
varying float v_distanceOffsetPx;
${this.varyings_.map(function(t){return"varying "+t.type+" "+t.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

vec4 pxToScreen(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return vec4(screenPos, u_depth, 1.0);
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

vec2 getJoinOffsetDirection(vec2 normalPx, float joinAngle) {
  float halfAngle = joinAngle / 2.0;
  float c = cos(halfAngle);
  float s = sin(halfAngle);
  vec2 angleBisectorNormal = vec2(s * normalPx.x + c * normalPx.y, -c * normalPx.x + s * normalPx.y);
  float length = 1.0 / s;
  return angleBisectorNormal * length;
}

vec2 getOffsetPoint(vec2 point, vec2 normal, float joinAngle, float offsetPx) {
  // if on a cap or the join angle is too high, offset the line along the segment normal
  if (cos(joinAngle) > 0.998 || isCap(joinAngle)) {
    return point - normal * offsetPx;
  }
  // offset is applied along the inverted normal (positive offset goes "right" relative to line direction)
  return point - getJoinOffsetDirection(normal, joinAngle) * offsetPx;
}

void main(void) {
  v_angleStart = a_joinAngles.x;
  v_angleEnd = a_joinAngles.y;
  float vertexNumber = floor(abs(a_parameters) / 10000. + 0.5);
  // we're reading the fractional part while keeping the sign (so -4.12 gives -0.12, 3.45 gives 0.45)
  float angleTangentSum = fract(abs(a_parameters) / 10000.) * 10000. * sign(a_parameters);

  float lineWidth = ${this.strokeWidthExpression_};
  float lineOffsetPx = ${this.strokeOffsetExpression_};

  // compute segment start/end in px with offset
  vec2 segmentStartPx = worldToPx(a_segmentStart);
  vec2 segmentEndPx = worldToPx(a_segmentEnd);
  vec2 tangentPx = normalize(segmentEndPx - segmentStartPx);
  vec2 normalPx = vec2(-tangentPx.y, tangentPx.x);
  segmentStartPx = getOffsetPoint(segmentStartPx, normalPx, v_angleStart, lineOffsetPx),
  segmentEndPx = getOffsetPoint(segmentEndPx, normalPx, v_angleEnd, lineOffsetPx);
  
  // compute current vertex position
  float normalDir = vertexNumber < 0.5 || (vertexNumber > 1.5 && vertexNumber < 2.5) ? 1.0 : -1.0;
  float tangentDir = vertexNumber < 1.5 ? 1.0 : -1.0;
  float angle = vertexNumber < 1.5 ? v_angleStart : v_angleEnd;
  vec2 joinDirection;
  vec2 positionPx = vertexNumber < 1.5 ? segmentStartPx : segmentEndPx;
  // if angle is too high, do not make a proper join
  if (cos(angle) > ${Fp} || isCap(angle)) {
    joinDirection = normalPx * normalDir - tangentPx * tangentDir;
  } else {
    joinDirection = getJoinOffsetDirection(normalPx * normalDir, angle);
  }
  positionPx = positionPx + joinDirection * (lineWidth * 0.5 + 1.); // adding 1 pixel for antialiasing
  gl_Position = pxToScreen(positionPx);

  v_segmentStart = segmentStartPx;
  v_segmentEnd = segmentEndPx;
  v_width = lineWidth;
  v_prop_hitColor = a_prop_hitColor;
  v_distanceOffsetPx = a_distance / u_resolution - (lineOffsetPx * angleTangentSum);
${this.varyings_.map(function(t){return"  "+t.name+" = "+t.expression+";"}).join(`
`)}
}`:null}getStrokeFragmentShader(){return this.hasStroke_?`${os}
${this.uniforms_.map(function(t){return"uniform "+t+";"}).join(`
`)}
varying vec2 v_segmentStart;
varying vec2 v_segmentEnd;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_prop_hitColor;
varying float v_distanceOffsetPx;
${this.varyings_.map(function(t){return"varying "+t.type+" "+t.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

float segmentDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  vec2 tangent = normalize(end - start);
  vec2 normal = vec2(-tangent.y, tangent.x);
  vec2 startToPoint = point - start;
  return abs(dot(startToPoint, normal)) - width * 0.5;
}

float buttCapDistanceField(vec2 point, vec2 start, vec2 end) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  return dot(startToPoint, -tangent);
}

float squareCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return buttCapDistanceField(point, start, end) - width * 0.5;
}

float roundCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  float onSegment = max(0., 1000. * dot(point - start, end - start)); // this is very high when inside the segment
  return length(point - start) - width * 0.5 - onSegment;
}

float roundJoinDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return roundCapDistanceField(point, start, end, width);
}

float bevelJoinField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  float c = cos(joinAngle * 0.5);
  float s = sin(joinAngle * 0.5);
  float direction = -sign(sin(joinAngle));
  vec2 bisector = vec2(c * tangent.x - s * tangent.y, s * tangent.x + c * tangent.y);
  float radius = width * 0.5 * s;
  return dot(startToPoint, bisector * direction) - radius;
}

float miterJoinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  if (cos(joinAngle) > ${Fp}) { // avoid risking a division by zero
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  float miterLength = 1. / sin(joinAngle * 0.5);
  float miterLimit = ${this.strokeMiterLimitExpression_};
  if (miterLength > miterLimit) {
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  return -1000.;
}

float capDistanceField(vec2 point, vec2 start, vec2 end, float width, float capType) {
   if (capType == ${Mn("butt")}) {
    return buttCapDistanceField(point, start, end);
  } else if (capType == ${Mn("square")}) {
    return squareCapDistanceField(point, start, end, width);
  }
  return roundCapDistanceField(point, start, end, width);
}

float joinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float joinType) {
  if (joinType == ${Mn("bevel")}) {
    return bevelJoinField(point, start, end, width, joinAngle);
  } else if (joinType == ${Mn("miter")}) {
    return miterJoinDistanceField(point, start, end, width, joinAngle);
  }
  return roundJoinDistanceField(point, start, end, width);
}

float computeSegmentPointDistance(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float capType, float joinType) {
  if (isCap(joinAngle)) {
    return capDistanceField(point, start, end, width, capType);
  }
  return joinDistanceField(point, start, end, width, joinAngle, joinType);
}

void main(void) {
  vec2 currentPoint = gl_FragCoord.xy / u_pixelRatio;
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(currentPoint);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif
  if (${this.discardExpression_}) { discard; }

  float segmentLength = length(v_segmentEnd - v_segmentStart);
  vec2 segmentTangent = (v_segmentEnd - v_segmentStart) / segmentLength;
  vec2 segmentNormal = vec2(-segmentTangent.y, segmentTangent.x);
  vec2 startToPoint = currentPoint - v_segmentStart;
  float currentLengthPx = max(0., min(dot(segmentTangent, startToPoint), segmentLength)) + v_distanceOffsetPx; 
  float currentRadiusPx = abs(dot(segmentNormal, startToPoint));
  float currentRadiusRatio = dot(segmentNormal, startToPoint) * 2. / v_width;
  vec4 color = ${this.strokeColorExpression_} * u_globalAlpha;
  float capType = ${this.strokeCapExpression_};
  float joinType = ${this.strokeJoinExpression_};
  float segmentStartDistance = computeSegmentPointDistance(currentPoint, v_segmentStart, v_segmentEnd, v_width, v_angleStart, capType, joinType);
  float segmentEndDistance = computeSegmentPointDistance(currentPoint, v_segmentEnd, v_segmentStart, v_width, v_angleEnd, capType, joinType);
  float distance = max(
    segmentDistanceField(currentPoint, v_segmentStart, v_segmentEnd, v_width),
    max(segmentStartDistance, segmentEndDistance)
  );
  distance = max(distance, ${this.strokeDistanceFieldExpression_});
  gl_FragColor = color * smoothstep(0.5, -0.5, distance);
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_prop_hitColor;
  }
}`:null}getFillVertexShader(){return this.hasFill_?`${os}
${this.uniforms_.map(function(t){return"uniform "+t+";"}).join(`
`)}
attribute vec2 a_position;
attribute vec4 a_prop_hitColor;
${this.attributes_.map(function(t){return"attribute "+t+";"}).join(`
`)}
varying vec4 v_prop_hitColor;
${this.varyings_.map(function(t){return"varying "+t.type+" "+t.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
void main(void) {
  gl_Position = u_projectionMatrix * vec4(a_position, u_depth, 1.0);
  v_prop_hitColor = a_prop_hitColor;
${this.varyings_.map(function(t){return"  "+t.name+" = "+t.expression+";"}).join(`
`)}
}`:null}getFillFragmentShader(){return this.hasFill_?`${os}
${this.uniforms_.map(function(t){return"uniform "+t+";"}).join(`
`)}
varying vec4 v_prop_hitColor;
${this.varyings_.map(function(t){return"varying "+t.type+" "+t.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}
vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

void main(void) {
  vec2 pxPos = gl_FragCoord.xy / u_pixelRatio;
  vec2 pxOrigin = worldToPx(u_patternOrigin);
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(pxPos);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif
  if (${this.discardExpression_}) { discard; }
  gl_FragColor = ${this.fillColorExpression_} * u_globalAlpha;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_prop_hitColor;
  }
}`:null}}const Nr={BLUR:"blur",GRADIENT:"gradient",RADIUS:"radius"},BI=["#00f","#0ff","#0f0","#ff0","#f00"];class XI extends La{constructor(t){t=t||{};const e=Object.assign({},t);delete e.gradient,delete e.radius,delete e.blur,delete e.weight,super(e),this.gradient_=null,this.addChangeListener(Nr.GRADIENT,this.handleGradientChanged_),this.setGradient(t.gradient?t.gradient:BI),this.setBlur(t.blur!==void 0?t.blur:15),this.setRadius(t.radius!==void 0?t.radius:8);const n=t.weight?t.weight:"weight";typeof n=="string"?this.weightFunction_=function(i){return i.get(n)}:this.weightFunction_=n,this.setRenderOrder(null)}getBlur(){return this.get(Nr.BLUR)}getGradient(){return this.get(Nr.GRADIENT)}getRadius(){return this.get(Nr.RADIUS)}handleGradientChanged_(){this.gradient_=WI(this.getGradient())}setBlur(t){this.set(Nr.BLUR,t)}setGradient(t){this.set(Nr.GRADIENT,t)}setRadius(t){this.set(Nr.RADIUS,t)}createRenderer(){const t=new Q_().addAttribute("float a_prop_weight").addVarying("v_prop_weight","float","a_prop_weight").addUniform("float u_size").addUniform("float u_blurSlope").setSymbolSizeExpression("vec2(u_size)").setSymbolColorExpression("vec4(smoothstep(0., 1., (1. - length(coordsPx * 2. / v_quadSizePx)) * u_blurSlope) * v_prop_weight)");return new $_(this,{className:this.getClassName(),attributes:[{name:"weight",callback:e=>{const n=this.weightFunction_(e);return n!==void 0?wt(n,0,1):1}}],uniforms:{u_size:()=>(this.get(Nr.RADIUS)+this.get(Nr.BLUR))*2,u_blurSlope:()=>this.get(Nr.RADIUS)/Math.max(1,this.get(Nr.BLUR))},hitDetectionEnabled:!0,vertexShader:t.getSymbolVertexShader(),fragmentShader:t.getSymbolFragmentShader(),postProcesses:[{fragmentShader:`
            precision mediump float;

            uniform sampler2D u_image;
            uniform sampler2D u_gradientTexture;
            uniform float u_opacity;

            varying vec2 v_texCoord;

            void main() {
              vec4 color = texture2D(u_image, v_texCoord);
              gl_FragColor.a = color.a * u_opacity;
              gl_FragColor.rgb = texture2D(u_gradientTexture, vec2(0.5, color.a)).rgb;
              gl_FragColor.rgb *= gl_FragColor.a;
            }`,uniforms:{u_gradientTexture:()=>this.gradient_,u_opacity:()=>this.getOpacity()}}]})}renderDeclutter(){}}function WI(r){const t=Jt(1,256),e=t.createLinearGradient(0,0,1,256),n=1/(r.length-1);for(let i=0,s=r.length;i<s;++i)e.addColorStop(i*n,r[i]);return t.fillStyle=e,t.fillRect(0,0,1,256),t.canvas}const qI=XI;class ZI extends Ia{constructor(t){t=t||{},super(t)}}class J_ extends Bd{constructor(t){super(t),this.image_=null}getImage(){return this.image_?this.image_.getImage():null}prepareFrame(t){const e=t.layerStatesArray[t.layerIndex],n=t.pixelRatio,i=t.viewState,s=i.resolution,o=this.getLayer().getSource(),a=t.viewHints;let l=t.extent;if(e.extent!==void 0&&(l=we(l,Gr(e.extent,i.projection))),!a[ee.ANIMATING]&&!a[ee.INTERACTING]&&!Un(l))if(o){const h=i.projection,u=o.getImage(l,s,n,h);u&&(this.loadImage(u)?this.image_=u:u.getState()===et.EMPTY&&(this.image_=null))}else this.image_=null;return!!this.image_}getData(t){const e=this.frameState;if(!e)return null;const n=this.getLayer(),i=ae(e.pixelToCoordinateTransform,t.slice()),s=n.getExtent();if(s&&!xr(s,i))return null;const o=this.image_.getExtent(),a=this.image_.getImage(),l=yt(o),h=Math.floor(a.width*((i[0]-o[0])/l));if(h<0||h>=a.width)return null;const u=Vt(o),c=Math.floor(a.height*((o[3]-i[1])/u));return c<0||c>=a.height?null:this.getImageData(a,h,c)}renderFrame(t,e){const n=this.image_,i=n.getExtent(),s=n.getResolution(),[o,a]=Array.isArray(s)?s:[s,s],l=n.getPixelRatio(),h=t.layerStatesArray[t.layerIndex],u=t.pixelRatio,c=t.viewState,f=c.center,g=c.resolution,m=u*o/(g*l),_=u*a/(g*l),x=t.extent,v=c.resolution,w=c.rotation,S=Math.round(yt(x)/v*u),E=Math.round(Vt(x)/v*u);hr(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/u,1/u,w,-S/2,-E/2),uh(this.inversePixelTransform,this.pixelTransform);const T=Gc(this.pixelTransform);this.useContainer(e,T,this.getBackground(t));const R=this.getRenderContext(t),C=this.context.canvas;C.width!=S||C.height!=E?(C.width=S,C.height=E):this.containerReused||R.clearRect(0,0,S,E);let I=!1,F=!0;if(h.extent){const p=Gr(h.extent,c.projection);F=Qt(p,t.extent),I=F&&!Ze(p,t.extent),I&&this.clipUnrotated(R,t,p)}const U=n.getImage(),j=hr(this.tempTransform,S/2,E/2,m,_,0,l*(i[0]-f[0])/o,l*(f[1]-i[3])/a);this.renderedResolution=a*u/l;const B=U.width*j[0],d=U.height*j[3];if(this.getLayer().getSource().getInterpolate()||(R.imageSmoothingEnabled=!1),this.preRender(R,t),F&&B>=.5&&d>=.5){const p=j[4],y=j[5],b=h.opacity;b!==1&&(R.save(),R.globalAlpha=b),R.drawImage(U,0,0,+U.width,+U.height,p,y,B,d),b!==1&&R.restore()}return this.postRender(this.context,t),I&&R.restore(),R.imageSmoothingEnabled=!0,T!==C.style.transform&&(C.style.transform=T),this.container}}class ef extends ZI{constructor(t){super(t)}createRenderer(){return new J_(this)}getData(t){return super.getData(t)}}const ai={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class ty extends Ia{constructor(t){t=t||{};const e=Object.assign({},t);delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.setPreload(t.preload!==void 0?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0)}getPreload(){return this.get(ai.PRELOAD)}setPreload(t){this.set(ai.PRELOAD,t)}getUseInterimTilesOnError(){return this.get(ai.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(t){this.set(ai.USE_INTERIM_TILES_ON_ERROR,t)}getData(t){return super.getData(t)}}class ey extends Bd{constructor(t){super(t),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=ze(),this.tmpTileRange_=new Uh(0,0,0,0)}isDrawableTile(t){const e=this.getLayer(),n=t.getState(),i=e.getUseInterimTilesOnError();return n==W.LOADED||n==W.EMPTY||n==W.ERROR&&!i}getTile(t,e,n,i){const s=i.pixelRatio,o=i.viewState.projection,a=this.getLayer();let l=a.getSource().getTile(t,e,n,s,o);return l.getState()==W.ERROR&&a.getUseInterimTilesOnError()&&a.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(l)||(l=l.getInterimTile()),l}getData(t){const e=this.frameState;if(!e)return null;const n=this.getLayer(),i=ae(e.pixelToCoordinateTransform,t.slice()),s=n.getExtent();if(s&&!xr(s,i))return null;const o=e.pixelRatio,a=e.viewState.projection,l=e.viewState,h=n.getRenderSource(),u=h.getTileGridForProjection(l.projection),c=h.getTilePixelRatio(e.pixelRatio);for(let f=u.getZForResolution(l.resolution);f>=u.getMinZoom();--f){const g=u.getTileCoordForCoordAndZ(i,f),m=h.getTile(f,g[1],g[2],o,a);if(!(m instanceof Fa||m instanceof Us)||m instanceof Us&&m.getState()===W.EMPTY)return null;if(m.getState()!==W.LOADED)continue;const _=u.getOrigin(f),x=ie(u.getTileSize(f)),v=u.getResolution(f),w=Math.floor(c*((i[0]-_[0])/v-g[1]*x[0])),S=Math.floor(c*((_[1]-i[1])/v-g[2]*x[1])),E=Math.round(c*h.getGutterForProjection(l.projection));return this.getImageData(m.getImage(),w+E,S+E)}return null}loadedTileCallback(t,e,n){return this.isDrawableTile(n)?super.loadedTileCallback(t,e,n):!1}prepareFrame(t){return!!this.getLayer().getSource()}renderFrame(t,e){const n=t.layerStatesArray[t.layerIndex],i=t.viewState,s=i.projection,o=i.resolution,a=i.center,l=i.rotation,h=t.pixelRatio,u=this.getLayer(),c=u.getSource(),f=c.getRevision(),g=c.getTileGridForProjection(s),m=g.getZForResolution(o,c.zDirection),_=g.getResolution(m);let x=t.extent;const v=t.viewState.resolution,w=c.getTilePixelRatio(h),S=Math.round(yt(x)/v*h),E=Math.round(Vt(x)/v*h),T=n.extent&&Gr(n.extent);T&&(x=we(x,Gr(n.extent)));const R=_*S/2/w,C=_*E/2/w,I=[a[0]-R,a[1]-C,a[0]+R,a[1]+C],F=g.getTileRangeForExtentAndZ(x,m),U={};U[m]={};const j=this.createLoadedTileFinder(c,s,U),B=this.tmpExtent,d=this.tmpTileRange_;this.newTiles_=!1;const p=l?qu(i.center,v,l,t.size):void 0;for(let K=F.minX;K<=F.maxX;++K)for(let G=F.minY;G<=F.maxY;++G){if(l&&!g.tileCoordIntersectsViewport([m,K,G],p))continue;const H=this.getTile(m,K,G,t);if(this.isDrawableTile(H)){const xt=it(this);if(H.getState()==W.LOADED){U[m][H.tileCoord.toString()]=H;let dt=H.inTransition(xt);dt&&n.opacity!==1&&(H.endTransition(xt),dt=!1),!this.newTiles_&&(dt||!this.renderedTiles.includes(H))&&(this.newTiles_=!0)}if(H.getAlpha(xt,t.time)===1)continue}const Q=g.getTileCoordChildTileRange(H.tileCoord,d,B);let nt=!1;Q&&(nt=j(m+1,Q)),nt||g.forEachTileCoordParentTileRange(H.tileCoord,j,d,B)}const y=_/o*h/w;hr(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/h,1/h,l,-S/2,-E/2);const b=Gc(this.pixelTransform);this.useContainer(e,b,this.getBackground(t));const M=this.getRenderContext(t),P=this.context.canvas;uh(this.inversePixelTransform,this.pixelTransform),hr(this.tempTransform,S/2,E/2,y,y,0,-S/2,-E/2),P.width!=S||P.height!=E?(P.width=S,P.height=E):this.containerReused||M.clearRect(0,0,S,E),T&&this.clipUnrotated(M,t,T),c.getInterpolate()||(M.imageSmoothingEnabled=!1),this.preRender(M,t),this.renderedTiles.length=0;let A=Object.keys(U).map(Number);A.sort(on);let L,D,X;n.opacity===1&&(!this.containerReused||c.getOpaque(t.viewState.projection))?A=A.reverse():(L=[],D=[]);for(let K=A.length-1;K>=0;--K){const G=A[K],H=c.getTilePixelSize(G,h,s),Q=g.getResolution(G)/_,nt=H[0]*Q*y,xt=H[1]*Q*y,dt=g.getTileCoordForCoordAndZ(zn(I),G),Tt=g.getTileCoordExtent(dt),St=ae(this.tempTransform,[w*(Tt[0]-I[0])/_,w*(I[3]-Tt[3])/_]),Dt=w*c.getGutterForProjection(s),Yt=U[G];for(const ce in Yt){const Ht=Yt[ce],Ke=Ht.tileCoord,Wa=dt[1]-Ke[1],Kh=Math.round(St[0]-(Wa-1)*nt),qa=dt[2]-Ke[2],Za=Math.round(St[1]-(qa-1)*xt),gr=Math.round(St[0]-Wa*nt),Lr=Math.round(St[1]-qa*xt),$r=Kh-gr,Or=Za-Lr,Ki=m===G,Qi=Ki&&Ht.getAlpha(it(this),t.time)!==1;let Zn=!1;if(!Qi)if(L){X=[gr,Lr,gr+$r,Lr,gr+$r,Lr+Or,gr,Lr+Or];for(let pn=0,Qh=L.length;pn<Qh;++pn)if(m!==G&&G<D[pn]){const Be=L[pn];Qt([gr,Lr,gr+$r,Lr+Or],[Be[0],Be[3],Be[4],Be[7]])&&(Zn||(M.save(),Zn=!0),M.beginPath(),M.moveTo(X[0],X[1]),M.lineTo(X[2],X[3]),M.lineTo(X[4],X[5]),M.lineTo(X[6],X[7]),M.moveTo(Be[6],Be[7]),M.lineTo(Be[4],Be[5]),M.lineTo(Be[2],Be[3]),M.lineTo(Be[0],Be[1]),M.clip())}L.push(X),D.push(G)}else M.clearRect(gr,Lr,$r,Or);this.drawTileImage(Ht,t,gr,Lr,$r,Or,Dt,Ki),L&&!Qi?(Zn&&M.restore(),this.renderedTiles.unshift(Ht)):this.renderedTiles.push(Ht),this.updateUsedTiles(t.usedTiles,c,Ht)}}return this.renderedRevision=f,this.renderedResolution=_,this.extentChanged=!this.renderedExtent_||!Nn(this.renderedExtent_,I),this.renderedExtent_=I,this.renderedPixelRatio=h,this.renderedProjection=s,this.manageTilePyramid(t,c,g,h,s,x,m,u.getPreload()),this.scheduleExpireCache(t,c),this.postRender(this.context,t),n.extent&&M.restore(),M.imageSmoothingEnabled=!0,b!==P.style.transform&&(P.style.transform=b),this.container}drawTileImage(t,e,n,i,s,o,a,l){const h=this.getTileImage(t);if(!h)return;const u=this.getRenderContext(e),c=it(this),f=e.layerStatesArray[e.layerIndex],g=f.opacity*(l?t.getAlpha(c,e.time):1),m=g!==u.globalAlpha;m&&(u.save(),u.globalAlpha=g),u.drawImage(h,a,a,h.width-2*a,h.height-2*a,n,i,s,o),m&&u.restore(),g!==f.opacity?e.animate=!0:l&&t.endTransition(c)}getImage(){const t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}scheduleExpireCache(t,e){if(e.canExpireCache()){const n=function(i,s,o){const a=it(i);a in o.usedTiles&&i.expireCache(o.viewState.projection,o.usedTiles[a])}.bind(null,e);t.postRenderFunctions.push(n)}}updateUsedTiles(t,e,n){const i=it(e);i in t||(t[i]={}),t[i][n.getKey()]=!0}manageTilePyramid(t,e,n,i,s,o,a,l,h){const u=it(e);u in t.wantedTiles||(t.wantedTiles[u]={});const c=t.wantedTiles[u],f=t.tileQueue,g=n.getMinZoom(),m=t.viewState.rotation,_=m?qu(t.viewState.center,t.viewState.resolution,m,t.size):void 0;let x=0,v,w,S,E,T,R;for(R=g;R<=a;++R)for(w=n.getTileRangeForExtentAndZ(o,R,w),S=n.getResolution(R),E=w.minX;E<=w.maxX;++E)for(T=w.minY;T<=w.maxY;++T)m&&!n.tileCoordIntersectsViewport([R,E,T],_)||(a-R<=l?(++x,v=e.getTile(R,E,T,i,s),v.getState()==W.IDLE&&(c[v.getKey()]=!0,f.isKeyQueued(v.getKey())||f.enqueue([v,u,n.getTileCoordCenter(v.tileCoord),S])),h!==void 0&&h(v)):e.useTile(R,E,T,s));e.updateCacheSize(x,s)}}class $l extends ty{constructor(t){super(t)}createRenderer(){return new ey(this)}}class rf extends vh{constructor(t,e,n,i,s){const o=s!==void 0?et.IDLE:et.LOADED;super(t,e,n,o),this.loader_=s!==void 0?s:null,this.canvas_=i,this.error_=null}getError(){return this.error_}handleLoad_(t){t?(this.error_=t,this.state=et.ERROR):this.state=et.LOADED,this.changed()}load(){this.state==et.IDLE&&(this.state=et.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}}function Vl(r){return Array.isArray(r)?Math.min(...r):r}class $I extends J_{constructor(t){super(t),this.vectorRenderer_=new D_(t),this.layerImageRatio_=t.getImageRatio(),this.coordinateToVectorPixelTransform_=pe(),this.renderedPixelToCoordinateTransform_=null}disposeInternal(){this.vectorRenderer_.dispose(),super.disposeInternal()}getFeatures(t){if(!this.vectorRenderer_)return Promise.resolve([]);const e=ae(this.coordinateToVectorPixelTransform_,ae(this.renderedPixelToCoordinateTransform_,t.slice()));return this.vectorRenderer_.getFeatures(e)}handleFontsChanged(){this.vectorRenderer_.handleFontsChanged()}prepareFrame(t){const e=t.pixelRatio,n=t.viewState,i=n.resolution,s=t.viewHints,o=this.vectorRenderer_;let a=t.extent;this.layerImageRatio_!==1&&(a=a.slice(0),Wm(a,this.layerImageRatio_));const l=yt(a)/i,h=Vt(a)/i;if(!s[ee.ANIMATING]&&!s[ee.INTERACTING]&&!Un(a)){o.useContainer(null,null);const u=o.context,c=t.layerStatesArray[t.layerIndex],f=Object.assign({},c,{opacity:1}),g=Object.assign({},t,{extent:a,size:[l,h],viewState:Object.assign({},t.viewState,{rotation:0}),layerStatesArray:[f],layerIndex:0,declutter:null}),m=this.getLayer().getDeclutter();m&&(g.declutter={[m]:new kd(9)});let _=!0;const x=new rf(a,i,e,u.canvas,function(v){o.prepareFrame(g)&&o.replayGroupChanged&&(o.clipping=!1,o.renderFrame(g,null)&&(o.renderDeclutter(g),o.renderDeferred(g),_=!1),v())});x.addEventListener(Lt.CHANGE,()=>{if(x.getState()!==et.LOADED)return;this.image_=_?null:x;const v=x.getPixelRatio(),w=Vl(x.getResolution())*e/v;this.renderedResolution=w,this.coordinateToVectorPixelTransform_=hr(this.coordinateToVectorPixelTransform_,l/2,h/2,1/w,-1/w,0,-n.center[0],-n.center[1])}),x.load()}return this.image_&&(this.renderedPixelToCoordinateTransform_=t.pixelToCoordinateTransform.slice()),!!this.image_}preRender(){}postRender(){}renderDeclutter(){}forEachFeatureAtCoordinate(t,e,n,i,s){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(t,e,n,i,s):super.forEachFeatureAtCoordinate(t,e,n,i,s)}}class VI extends La{constructor(t){t=t||{};const e=Object.assign({},t);delete e.imageRatio,super(e),this.imageRatio_=t.imageRatio!==void 0?t.imageRatio:1}getImageRatio(){return this.imageRatio_}createRenderer(){return new $I(this)}}const YI=VI,HI={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},Up={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};class KI extends ey{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.renderedOpacity_=1,this.tmpTransform_=pe(),this.tileClipContexts_=null}prepareTile(t,e,n){let i;const s=t.getState();return(s===W.LOADED||s===W.ERROR)&&(this.updateExecutorGroup_(t,e,n),this.tileImageNeedsRender_(t)&&(i=!0)),i}getTile(t,e,n,i){const s=i.pixelRatio,o=i.viewState,a=o.resolution,l=o.projection,h=this.getLayer(),u=h.getSource().getTile(t,e,n,s,l),c=i.viewHints,f=!(c[ee.ANIMATING]||c[ee.INTERACTING]);return(f||!u.wantedResolution)&&(u.wantedResolution=a),this.prepareTile(u,s,l)&&(f||Date.now()-i.time<8)&&h.getRenderMode()!=="vector"&&this.renderTileImage_(u,i),super.getTile(t,e,n,i)}isDrawableTile(t){const e=this.getLayer();return super.isDrawableTile(t)&&(e.getRenderMode()==="vector"?it(e)in t.executorGroups:t.hasContext(e))}getTileImage(t){return t.getImage(this.getLayer())}prepareFrame(t){const e=this.getLayer().getRevision();return this.renderedLayerRevision_!==e&&(this.renderedLayerRevision_=e,this.renderedTiles.length=0),super.prepareFrame(t)}updateExecutorGroup_(t,e,n){var i;const s=this.getLayer(),o=s.getRevision(),a=s.getRenderOrder()||null,l=t.wantedResolution,h=t.getReplayState(s);if(!h.dirty&&h.renderedResolution===l&&h.renderedRevision==o&&h.renderedRenderOrder==a)return;const u=s.getSource(),c=!!s.getDeclutter(),f=u.getTileGrid(),g=u.getTileGridForProjection(n).getTileCoordExtent(t.wrappedTileCoord),m=u.getSourceTiles(e,n,t),_=it(s);delete t.hitDetectionImageData[_],t.executorGroups[_]=[],h.dirty=!1;for(let x=0,v=m.length;x<v;++x){const w=m[x];if(w.getState()!=W.LOADED)continue;const S=w.tileCoord,E=f.getTileCoordExtent(S),T=we(g,E),R=Ir(T,s.getRenderBuffer()*l,this.tmpExtent),C=Nn(E,T)?null:R,I=new R_(0,T,l,e),F=Ul(l,e),U=function(y,b){let M;const P=y.getStyleFunction()||s.getStyleFunction();if(P&&(M=P(y,l)),M){const A=this.renderFeature(y,F,M,I,c,b);h.dirty=h.dirty||A}},j=w.getFeatures();a&&a!==h.renderedRenderOrder&&j.sort(a);for(let y=0,b=j.length;y<b;++y){const M=j[y];(!C||Qt(C,M.getGeometry().getExtent()))&&U.call(this,M,y)}const B=I.finish(),d=s.getRenderMode()!=="vector"&&c&&m.length===1?null:T,p=new I_(d,l,e,u.getOverlaps(),B,s.getRenderBuffer(),!!((i=this.frameState)!=null&&i.declutter));t.executorGroups[_].push(p)}h.renderedRevision=o,h.renderedRenderOrder=a,h.renderedResolution=l}forEachFeatureAtCoordinate(t,e,n,i,s){const o=e.viewState.resolution,a=e.viewState.rotation;n=n??0;const l=this.getLayer(),h=l.getSource().getTileGridForProjection(e.viewState.projection),u=Os([t]);Ir(u,o*n,u);const c={},f=function(_,x,v){let w=_.getId();w===void 0&&(w=it(_));const S=c[w];if(S){if(S!==!0&&v<S.distanceSq){if(v===0)return c[w]=!0,s.splice(s.lastIndexOf(S),1),i(_,l,x);S.geometry=x,S.distanceSq=v}}else{if(v===0)return c[w]=!0,i(_,l,x);s.push(c[w]={feature:_,layer:l,geometry:x,distanceSq:v,callback:i})}},g=this.renderedTiles;let m;for(let _=0,x=g.length;!m&&_<x;++_){const v=g[_],w=h.getTileCoordExtent(v.wrappedTileCoord);if(!Qt(w,u))continue;const S=it(l),E=[v.executorGroups[S]],T=l.getDeclutter();E.some(R=>{const C=T?e.declutter[T].all().map(I=>I.value):null;for(let I=0,F=R.length;I<F;++I)if(m=R[I].forEachFeatureAtCoordinate(t,o,a,n,f,C),m)return!0})}return m}getFeatures(t){return new Promise((e,n)=>{const i=this.getLayer(),s=it(i),o=i.getSource(),a=this.renderedProjection,l=a.getExtent(),h=this.renderedResolution,u=o.getTileGridForProjection(a),c=ae(this.renderedPixelToCoordinateTransform_,t.slice()),f=u.getTileCoordForCoordAndResolution(c,h);let g;for(let S=0,E=this.renderedTiles.length;S<E;++S)if(f.toString()===this.renderedTiles[S].tileCoord.toString()){if(g=this.renderedTiles[S],g.getState()===W.LOADED){const T=u.getTileCoordExtent(g.tileCoord);o.getWrapX()&&a.canWrapX()&&!Ze(l,T)&&Vm(c,a);break}g=void 0}if(!g||g.loadingSourceTiles>0){e([]);return}const m=u.getTileCoordExtent(g.wrappedTileCoord),_=zn(m),x=[(c[0]-_[0])/h,(_[1]-c[1])/h],v=g.getSourceTiles().reduce(function(S,E){return S.concat(E.getFeatures())},[]);let w=g.hitDetectionImageData[s];if(!w){const S=ie(u.getTileSize(u.getZForResolution(h,o.zDirection))),E=this.renderedRotation_,T=[this.getRenderTransform(u.getTileCoordCenter(g.wrappedTileCoord),h,0,_r,S[0]*_r,S[1]*_r,0)];w=A_(S,T,v,i.getStyleFunction(),u.getTileCoordExtent(g.wrappedTileCoord),g.getReplayState(i).renderedResolution,E),g.hitDetectionImageData[s]=w}e(L_(x,v,w))})}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.renderedLayerRevision_!==void 0&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}renderDeclutter(t,e){const n=this.context,i=n.globalAlpha;n.globalAlpha=e.opacity;const s=t.viewHints,o=!(s[ee.ANIMATING]||s[ee.INTERACTING]),a=this.renderedTiles;for(let l=0,h=a.length;l<h;++l){const u=a[l],c=u.executorGroups[it(this.getLayer())],f=this.getLayer().getDeclutter();if(c)for(let g=c.length-1;g>=0;--g)c[g].execute(this.context,[this.context.canvas.width,this.context.canvas.height],this.getTileRenderTransform(u,t),t.viewState.rotation,o,zl,f?t.declutter[f]:void 0)}n.globalAlpha=i}renderDeferredInternal(t){const e=this.renderedTiles.reduce((i,s,o)=>(s.executorGroups[it(this.getLayer())].forEach(a=>i.push({executorGroup:a,index:o})),i),[]),n=e.map(({executorGroup:i})=>i.getDeferredZIndexContexts());n.map(i=>Object.keys(i)).flat().sort(on).map(Number).forEach(i=>{n.forEach((s,o)=>{s[i]&&s[i].forEach(a=>{const{executorGroup:l,index:h}=e[o],u=l.getRenderedContext(),c=u.globalAlpha;u.globalAlpha=this.renderedOpacity_;const f=this.tileClipContexts_[h];f&&f.draw(u),a.draw(u),f&&u.restore(),u.globalAlpha=c,a.clear()})})})}getTileRenderTransform(t,e){const n=e.pixelRatio,i=e.viewState,s=i.center,o=i.resolution,a=i.rotation,l=e.size,h=Math.round(l[0]*n),u=Math.round(l[1]*n),c=this.getLayer().getSource().getTileGridForProjection(e.viewState.projection),f=t.tileCoord,g=c.getTileCoordExtent(t.wrappedTileCoord),m=c.getTileCoordExtent(f,this.tmpExtent)[0]-g[0];return Vs(Ao(this.inversePixelTransform.slice(),1/n,1/n),this.getRenderTransform(s,o,a,n,h,u,m))}postRender(t,e){const n=e.viewHints,i=!(n[ee.ANIMATING]||n[ee.INTERACTING]);this.renderedPixelToCoordinateTransform_=e.pixelToCoordinateTransform.slice(),this.renderedRotation_=e.viewState.rotation,this.renderedOpacity_=e.layerStatesArray[e.layerIndex].opacity;const s=this.getLayer(),o=s.getRenderMode(),a=t.globalAlpha;t.globalAlpha=this.renderedOpacity_;const l=s.getDeclutter(),h=l?Up[o].filter(S=>!zl.includes(S)):Up[o],u=e.viewState,c=u.rotation,f=s.getSource(),g=f.getTileGridForProjection(u.projection).getZForResolution(u.resolution,f.zDirection),m=this.renderedTiles,_=[],x=[],v=[];let w=!0;for(let S=m.length-1;S>=0;--S){const E=m[S];w=w&&!E.getReplayState(s).dirty;const T=E.executorGroups[it(s)].filter(B=>B.hasExecutors(h));if(T.length===0)continue;const R=this.getTileRenderTransform(E,e),C=E.tileCoord[0];let I=!1;const F=T[0].getClipCoords(R);let U=t,j;if(F){l&&(j=new Ud,U=j.getContext());for(let B=0,d=_.length;B<d;++B)if(g!==C&&C<x[B]){const p=_[B];Qt([F[0],F[3],F[4],F[7]],[p[0],p[3],p[4],p[7]])&&(I||(U.save(),I=!0),U.beginPath(),U.moveTo(F[0],F[1]),U.lineTo(F[2],F[3]),U.lineTo(F[4],F[5]),U.lineTo(F[6],F[7]),U.moveTo(p[6],p[7]),U.lineTo(p[4],p[5]),U.lineTo(p[2],p[3]),U.lineTo(p[0],p[1]),U.clip())}_.push(F),x.push(C)}for(let B=0,d=T.length;B<d;++B)T[B].execute(t,[t.canvas.width,t.canvas.height],R,c,i,h);I&&(U===t?U.restore():v[S]=j)}t.globalAlpha=a,this.ready=w,this.tileClipContexts_=v,super.postRender(t,e)}renderFeature(t,e,n,i,s,o){if(!n)return!1;let a=!1;if(Array.isArray(n))for(let l=0,h=n.length;l<h;++l)a=Bl(i,t,n[l],e,this.boundHandleStyleImageChange_,void 0,s,o)||a;else a=Bl(i,t,n,e,this.boundHandleStyleImageChange_,void 0,s,o);return a}tileImageNeedsRender_(t){const e=this.getLayer();if(e.getRenderMode()==="vector")return!1;const n=t.getReplayState(e),i=e.getRevision(),s=t.wantedResolution;return n.renderedTileResolution!==s||n.renderedTileRevision!==i}renderTileImage_(t,e){const n=this.getLayer(),i=t.getReplayState(n),s=n.getRevision(),o=t.executorGroups[it(n)];i.renderedTileRevision=s;const a=t.wrappedTileCoord,l=a[0],h=n.getSource();let u=e.pixelRatio;const c=e.viewState.projection,f=h.getTileGridForProjection(c),g=f.getResolution(t.tileCoord[0]),m=e.pixelRatio/t.wantedResolution*g,_=f.getResolution(l),x=t.getContext(n);u=Math.round(Math.max(u,m/u));const v=h.getTilePixelSize(l,u,c);x.canvas.width=v[0],x.canvas.height=v[1];const w=u/m;if(w!==1){const R=Xu(this.tmpTransform_);Ao(R,w,w),x.setTransform.apply(x,R)}const S=f.getTileCoordExtent(a,this.tmpExtent),E=m/_,T=Xu(this.tmpTransform_);Ao(T,E,-E),kc(T,-S[0],-S[3]);for(let R=0,C=o.length;R<C;++R)o[R].execute(x,[x.canvas.width*w,x.canvas.height*w],T,0,!0,HI[n.getRenderMode()],null);i.renderedTileResolution=t.wantedResolution}}class ry extends La{constructor(t){t=t||{};const e=Object.assign({},t);delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un;const n=t.renderMode||"hybrid";At(n=="hybrid"||n=="vector","`renderMode` must be `'hybrid'` or `'vector'`"),this.renderMode_=n,this.setPreload(t.preload?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0),this.getBackground,this.setBackground}createRenderer(){return new KI(this)}getFeatures(t){return super.getFeatures(t)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(ai.PRELOAD)}getUseInterimTilesOnError(){return this.get(ai.USE_INTERIM_TILES_ON_ERROR)}setPreload(t){this.set(ai.PRELOAD,t)}setUseInterimTilesOnError(t){this.set(ai.USE_INTERIM_TILES_ON_ERROR,t)}}function _t(r,t,e){const n=Gd();return n.style=r.style,jI(t,e,n,r)}function Bp(r){const t=Xr(r),e=t[0]*256,n=t[1],i=t[2]*256,s=Math.round(t[3]*255);return[e+n,i+s]}const QI=`vec4 unpackColor(vec2 packedColor) {
  return fract(packedColor[1] / 256.0) * vec4(
    fract(floor(packedColor[0] / 256.0) / 256.0),
    fract(packedColor[0] / 256.0),
    fract(floor(packedColor[1] / 256.0) / 256.0),
    1.0
  );
}`;function ny(r){return r===Xt?2:r===me?4:1}function Iu(r){const t=ny(r);return t>1?`vec${t}`:"float"}function Yl(r){return(JSON.stringify(r).split("").reduce((t,e)=>(t<<5)-t+e.charCodeAt(0),0)>>>0).toString()}function nf(r,t,e,n){if(`${n}radius`in r&&n!=="icon-"){let i=_t(e,r[`${n}radius`],Y);if(`${n}radius2`in r){const s=_t(e,r[`${n}radius2`],Y);i=`max(${i}, ${s})`}`${n}stroke-width`in r&&(i=`(${i} + ${_t(e,r[`${n}stroke-width`],Y)} * 0.5)`),t.setSymbolSizeExpression(`vec2(${i} * 2. + 0.5)`)}if(`${n}scale`in r){const i=_t(e,r[`${n}scale`],Y|me);t.setSymbolSizeExpression(`${t.getSymbolSizeExpression()} * ${i}`)}`${n}displacement`in r&&t.setSymbolOffsetExpression(_t(e,r[`${n}displacement`],me)),`${n}rotation`in r&&t.setSymbolRotationExpression(_t(e,r[`${n}rotation`],Y)),`${n}rotate-with-view`in r&&t.setSymbolRotateWithView(!!r[`${n}rotate-with-view`])}function iy(r,t,e,n,i){let s="vec4(0.)";if(t!==null&&(s=t),e!==null&&n!==null){const l=`smoothstep(-${n} + 0.63, -${n} - 0.58, ${r})`;s=`mix(${e}, ${s}, ${l})`}const o=`(1.0 - smoothstep(-0.63, 0.58, ${r}))`;let a=`${s} * ${o}`;return i!==null&&(a=`${a} * ${i}`),a}function sf(r,t,e,n,i){const s=new Image;let o;return s.crossOrigin=r[`${n}cross-origin`]===void 0?"anonymous":r[`${n}cross-origin`],s.src=r[`${n}src`],s.complete&&s.width&&s.height?o=Qd([s.width,s.height]):(e[`u_texture${i}_size`]=()=>s.complete?[s.width,s.height]:[0,0],t.addUniform(`vec2 u_texture${i}_size`),o=`u_texture${i}_size`),e[`u_texture${i}`]=s,t.addUniform(`sampler2D u_texture${i}`),o}function of(r,t,e,n,i){let s=_t(e,r[`${t}offset`],me);if(`${t}offset-origin`in r)switch(r[`${t}offset-origin`]){case"top-right":s=`vec2(${n}.x, 0.) + ${i} * vec2(-1., 0.) + ${s} * vec2(-1., 1.)`;break;case"bottom-left":s=`vec2(0., ${n}.y) + ${i} * vec2(0., -1.) + ${s} * vec2(1., -1.)`;break;case"bottom-right":s=`${n} - ${i} - ${s}`;break}return s}function JI(r,t,e,n,i){i.functions.circleDistanceField=`float circleDistanceField(vec2 point, float radius) {
  return length(point) - radius;
}`,nf(r,t,n,"circle-");let s=null;"circle-opacity"in r&&(s=_t(i,r["circle-opacity"],Y));let o="coordsPx";"circle-scale"in r&&(o=`coordsPx / ${_t(i,r["circle-scale"],Y|me)}`);let a=null;"circle-fill-color"in r&&(a=_t(i,r["circle-fill-color"],Xt));let l=null;"circle-stroke-color"in r&&(l=_t(i,r["circle-stroke-color"],Xt));let h=_t(i,r["circle-radius"],Y),u=null;"circle-stroke-width"in r&&(u=_t(i,r["circle-stroke-width"],Y),h=`(${h} + ${u} * 0.5)`);const c=`circleDistanceField(${o}, ${h})`,f=iy(c,a,l,u,s);t.setSymbolColorExpression(f)}function tP(r,t,e,n,i){i.functions.round=`float round(float v) {
  return sign(v) * floor(abs(v) + 0.5);
}`,i.functions.starDistanceField=`float starDistanceField(vec2 point, float numPoints, float radius, float radius2, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round(beta / alpha) * alpha; // angle in sector
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  vec2 tipToPoint = inSector + vec2(-radius, 0.);
  vec2 edgeNormal = vec2(radius2 * sin(alpha * 0.5), -radius2 * cos(alpha * 0.5) + radius);
  return dot(normalize(edgeNormal), tipToPoint);
}`,i.functions.regularDistanceField=`float regularDistanceField(vec2 point, float numPoints, float radius, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float radiusIn = radius * cos(PI / numPoints);
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round((beta - alpha * 0.5) / alpha) * alpha + alpha * 0.5; // angle in sector from mid
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  return inSector.x - radiusIn;
}`,nf(r,t,n,"shape-");let s=null;"shape-opacity"in r&&(s=_t(i,r["shape-opacity"],Y));let o="coordsPx";"shape-scale"in r&&(o=`coordsPx / ${_t(i,r["shape-scale"],Y|me)}`);let a=null;"shape-fill-color"in r&&(a=_t(i,r["shape-fill-color"],Xt));let l=null;"shape-stroke-color"in r&&(l=_t(i,r["shape-stroke-color"],Xt));let h=null;"shape-stroke-width"in r&&(h=_t(i,r["shape-stroke-width"],Y));const u=_t(i,r["shape-points"],Y);let c="0.";"shape-angle"in r&&(c=_t(i,r["shape-angle"],Y));let f,g=_t(i,r["shape-radius"],Y);if(h!==null&&(g=`${g} + ${h} * 0.5`),"shape-radius2"in r){let _=_t(i,r["shape-radius2"],Y);h!==null&&(_=`${_} + ${h} * 0.5`),f=`starDistanceField(${o}, ${u}, ${g}, ${_}, ${c})`}else f=`regularDistanceField(${o}, ${u}, ${g}, ${c})`;const m=iy(f,a,l,h,s);t.setSymbolColorExpression(m)}function eP(r,t,e,n,i){let s="vec4(1.0)";"icon-color"in r&&(s=_t(i,r["icon-color"],Xt)),"icon-opacity"in r&&(s=`${s} * ${_t(i,r["icon-opacity"],Y)}`);const o=Yl(r["icon-src"]),a=sf(r,t,e,"icon-",o);if(t.setSymbolColorExpression(`${s} * samplePremultiplied(u_texture${o}, v_texCoord)`).setSymbolSizeExpression(a),"icon-width"in r&&"icon-height"in r&&t.setSymbolSizeExpression(`vec2(${_t(n,r["icon-width"],Y)}, ${_t(n,r["icon-height"],Y)})`),"icon-offset"in r&&"icon-size"in r){const l=_t(n,r["icon-size"],me),h=t.getSymbolSizeExpression();t.setSymbolSizeExpression(l);const u=of(r,"icon-",n,"v_quadSizePx",l);t.setTextureCoordinateExpression(`(vec4((${u}).xyxy) + vec4(0., 0., ${l})) / (${h}).xyxy`)}if(nf(r,t,n,"icon-"),"icon-anchor"in r){const l=_t(n,r["icon-anchor"],me);let h="1.0";"icon-scale"in r&&(h=_t(n,r["icon-scale"],Y|me));let u;r["icon-anchor-x-units"]==="pixels"&&r["icon-anchor-y-units"]==="pixels"?u=`${l} * ${h}`:r["icon-anchor-x-units"]==="pixels"?u=`${l} * vec2(vec2(${h}).x, v_quadSizePx.y)`:r["icon-anchor-y-units"]==="pixels"?u=`${l} * vec2(v_quadSizePx.x, vec2(${h}).x)`:u=`${l} * v_quadSizePx`;let c=`v_quadSizePx * vec2(0.5, -0.5) + ${u} * vec2(-1., 1.)`;if("icon-anchor-origin"in r)switch(r["icon-anchor-origin"]){case"top-right":c=`v_quadSizePx * -0.5 + ${u}`;break;case"bottom-left":c=`v_quadSizePx * 0.5 - ${u}`;break;case"bottom-right":c=`v_quadSizePx * vec2(-0.5, 0.5) + ${u} * vec2(1., -1.)`;break}t.setSymbolOffsetExpression(`${t.getSymbolOffsetExpression()} + ${c}`)}}function rP(r,t,e,n,i){if("stroke-color"in r&&t.setStrokeColorExpression(_t(i,r["stroke-color"],Xt)),"stroke-pattern-src"in r){const s=Yl(r["stroke-pattern-src"]),o=sf(r,t,e,"stroke-pattern-",s);let a=o,l="vec2(0.)";"stroke-pattern-offset"in r&&"stroke-pattern-size"in r&&(a=_t(i,r["stroke-pattern-size"],me),l=of(r,"stroke-pattern-",i,o,a));let h="0.";"stroke-pattern-spacing"in r&&(h=_t(i,r["stroke-pattern-spacing"],Y)),i.functions.sampleStrokePattern=`vec4 sampleStrokePattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, float spacingPx, float currentLengthPx, float currentRadiusRatio, float lineWidth) {
  float currentLengthScaled = currentLengthPx * sampleSize.y / lineWidth;
  float spacingScaled = spacingPx * sampleSize.y / lineWidth;
  float uCoordPx = mod(currentLengthScaled, (sampleSize.x + spacingScaled));
  // make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  uCoordPx = clamp(uCoordPx, 0.5, sampleSize.x - 0.5);
  float vCoordPx = (-currentRadiusRatio * 0.5 + 0.5) * sampleSize.y;
  vec2 texCoord = (vec2(uCoordPx, vCoordPx) + textureOffset) / textureSize;
  return samplePremultiplied(texture, texCoord);
}`;const u=`u_texture${s}`;let c="1.";"stroke-color"in r&&(c=t.getStrokeColorExpression()),t.setStrokeColorExpression(`${c} * sampleStrokePattern(${u}, ${o}, ${l}, ${a}, ${h}, currentLengthPx, currentRadiusRatio, v_width)`)}if("stroke-width"in r&&t.setStrokeWidthExpression(_t(n,r["stroke-width"],Y)),"stroke-offset"in r&&t.setStrokeOffsetExpression(_t(n,r["stroke-offset"],Y)),"stroke-line-cap"in r&&t.setStrokeCapExpression(_t(n,r["stroke-line-cap"],xe)),"stroke-line-join"in r&&t.setStrokeJoinExpression(_t(n,r["stroke-line-join"],xe)),"stroke-miter-limit"in r&&t.setStrokeMiterLimitExpression(_t(n,r["stroke-miter-limit"],Y)),"stroke-line-dash"in r){i.functions.getSingleDashDistance=`float getSingleDashDistance(float distance, float radius, float dashOffset, float dashLength, float dashLengthTotal, float capType) {
  float localDistance = mod(distance, dashLengthTotal);
  float distanceSegment = abs(localDistance - dashOffset - dashLength * 0.5) - dashLength * 0.5;
  distanceSegment = min(distanceSegment, dashLengthTotal - localDistance);
  if (capType == ${Mn("square")}) {
    distanceSegment -= v_width * 0.5;
  } else if (capType == ${Mn("round")}) {
    distanceSegment = min(distanceSegment, sqrt(distanceSegment * distanceSegment + radius * radius) - v_width * 0.5);
  }
  return distanceSegment;
}`;let s=r["stroke-line-dash"].map(f=>_t(i,f,Y));s.length%2===1&&(s=[...s,...s]);let o="0.";"stroke-line-dash-offset"in r&&(o=_t(n,r["stroke-line-dash-offset"],Y));const a=`dashDistanceField_${Yl(r["stroke-line-dash"])}`,l=s.map((f,g)=>`float dashLength${g} = ${f};`),h=s.map((f,g)=>`dashLength${g}`).join(" + ");let u="0.",c=`getSingleDashDistance(distance, radius, ${u}, dashLength0, totalDashLength, capType)`;for(let f=2;f<s.length;f+=2)u=`${u} + dashLength${f-2} + dashLength${f-1}`,c=`min(${c}, getSingleDashDistance(distance, radius, ${u}, dashLength${f}, totalDashLength, capType))`;i.functions[a]=`float ${a}(float distance, float radius, float capType) {
  ${l.join(`
  `)}
  float totalDashLength = ${h};
  return ${c};
}`,t.setStrokeDistanceFieldExpression(`${a}(currentLengthPx + ${o}, currentRadiusPx, capType)`)}}function nP(r,t,e,n,i){if("fill-color"in r&&t.setFillColorExpression(_t(i,r["fill-color"],Xt)),"fill-pattern-src"in r){const s=Yl(r["fill-pattern-src"]),o=sf(r,t,e,"fill-pattern-",s);let a=o,l="vec2(0.)";"fill-pattern-offset"in r&&"fill-pattern-size"in r&&(a=_t(i,r["fill-pattern-size"],me),l=of(r,"fill-pattern-",i,o,a)),i.functions.sampleFillPattern=`vec4 sampleFillPattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, vec2 pxOrigin, vec2 pxPosition) {
  float scaleRatio = pow(2., mod(u_zoom + 0.5, 1.) - 0.5);
  vec2 pxRelativePos = pxPosition - pxOrigin;
  // rotate the relative position from origin by the current view rotation
  pxRelativePos = vec2(pxRelativePos.x * cos(u_rotation) - pxRelativePos.y * sin(u_rotation), pxRelativePos.x * sin(u_rotation) + pxRelativePos.y * cos(u_rotation));
  // sample position is computed according to the sample offset & size
  vec2 samplePos = mod(pxRelativePos / scaleRatio, sampleSize);
  // also make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  samplePos = clamp(samplePos, vec2(0.5), sampleSize - vec2(0.5));
  samplePos.y = sampleSize.y - samplePos.y; // invert y axis so that images appear upright
  return samplePremultiplied(texture, (samplePos + textureOffset) / textureSize);
}`;const h=`u_texture${s}`;let u="1.";"fill-color"in r&&(u=t.getFillColorExpression()),t.setFillColorExpression(`${u} * sampleFillPattern(${h}, ${o}, ${l}, ${a}, pxOrigin, pxPos)`)}}function iP(r){const t={inFragmentShader:!1,properties:{},variables:{},functions:{},style:r},e={inFragmentShader:!0,variables:t.variables,properties:{},functions:{},style:r},n=new Q_,i={};if("icon-src"in r?eP(r,n,i,t,e):"shape-points"in r?tP(r,n,i,t,e):"circle-radius"in r&&JI(r,n,i,t,e),rP(r,n,i,t,e),nP(r,n,i,t,e),r.filter){const o=_t(e,r.filter,te);n.setFragmentDiscardExpression(`!${o}`)}Object.keys(e.variables).forEach(function(o){const a=e.variables[o],l=Jd(a.name);n.addUniform(`${Iu(a.type)} ${l}`);let h;a.type===xe?h=()=>Zl(r.variables[a.name]):a.type===Xt?h=()=>Bp([...Xr(r.variables[a.name]||"#eee")]):a.type===te?h=()=>r.variables[a.name]?1:0:h=()=>r.variables[a.name],i[l]=h}),Object.keys(e.properties).forEach(function(o){const a=e.properties[o];t.properties[o]||(t.properties[o]=a);let l=Iu(a.type),h=`a_prop_${a.name}`;a.type===Xt&&(l="vec4",h=`unpackColor(${h})`,n.addVertexShaderFunction(QI)),n.addVarying(`v_prop_${a.name}`,l,h)}),Object.keys(t.properties).forEach(function(o){const a=t.properties[o];n.addAttribute(`${Iu(a.type)} a_prop_${a.name}`)});const s=Object.keys(t.properties).map(function(o){const a=t.properties[o];let l;return a.evaluator?l=a.evaluator:a.type===xe?l=h=>Zl(h.get(a.name)):a.type===Xt?l=h=>Bp([...Xr(h.get(a.name)||"#eee")]):a.type===te?l=h=>h.get(a.name)?1:0:l=h=>h.get(a.name),{name:a.name,size:ny(a.type),callback:l}});for(const o in t.functions)n.addVertexShaderFunction(t.functions[o]);for(const o in e.functions)n.addFragmentShaderFunction(e.functions[o]);return{builder:n,attributes:s.reduce((o,a)=>({...o,[a.name]:{callback:a.callback,size:a.size}}),{}),uniforms:i}}class sP extends Ia{constructor(t){const e=Object.assign({},t);super(e),this.parseResult_=iP(t.style),this.styleVariables_=t.style.variables||{},this.hitDetectionDisabled_=!!t.disableHitDetection}createRenderer(){const t=Object.keys(this.parseResult_.attributes).map(e=>({name:e,...this.parseResult_.attributes[e]}));return new $_(this,{vertexShader:this.parseResult_.builder.getSymbolVertexShader(),fragmentShader:this.parseResult_.builder.getSymbolFragmentShader(),hitDetectionEnabled:!this.hitDetectionDisabled_,uniforms:this.parseResult_.uniforms,attributes:t})}updateStyleVariables(t){Object.assign(this.styleVariables_,t),this.changed()}}const oP=sP;function Xp(r,t){const e=`
    attribute vec2 ${pl.TEXTURE_COORD};
    uniform mat4 ${Et.TILE_TRANSFORM};
    uniform float ${Et.TEXTURE_PIXEL_WIDTH};
    uniform float ${Et.TEXTURE_PIXEL_HEIGHT};
    uniform float ${Et.TEXTURE_RESOLUTION};
    uniform float ${Et.TEXTURE_ORIGIN_X};
    uniform float ${Et.TEXTURE_ORIGIN_Y};
    uniform float ${Et.DEPTH};

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;

    void main() {
      v_textureCoord = ${pl.TEXTURE_COORD};
      v_mapCoord = vec2(
        ${Et.TEXTURE_ORIGIN_X} + ${Et.TEXTURE_RESOLUTION} * ${Et.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],
        ${Et.TEXTURE_ORIGIN_Y} - ${Et.TEXTURE_RESOLUTION} * ${Et.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]
      );
      gl_Position = ${Et.TILE_TRANSFORM} * vec4(${pl.TEXTURE_COORD}, ${Et.DEPTH}, 1.0);
    }
  `,n={...GI(),inFragmentShader:!0,bandCount:t,style:r},i=[];if(r.color!==void 0){const c=_t(n,r.color,Xt);i.push(`color = ${c};`)}if(r.contrast!==void 0){const c=_t(n,r.contrast,Y);i.push(`color.rgb = clamp((${c} + 1.0) * color.rgb - (${c} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(r.exposure!==void 0){const c=_t(n,r.exposure,Y);i.push(`color.rgb = clamp((${c} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(r.saturation!==void 0){const c=_t(n,r.saturation,Y);i.push(`
      float saturation = ${c} + 1.0;
      float sr = (1.0 - saturation) * 0.2126;
      float sg = (1.0 - saturation) * 0.7152;
      float sb = (1.0 - saturation) * 0.0722;
      mat3 saturationMatrix = mat3(
        sr + saturation, sr, sr,
        sg, sg + saturation, sg,
        sb, sb, sb + saturation
      );
      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));
    `)}if(r.gamma!==void 0){const c=_t(n,r.gamma,Y);i.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${c}));`)}if(r.brightness!==void 0){const c=_t(n,r.brightness,Y);i.push(`color.rgb = clamp(color.rgb + ${c}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}const s={},o=Object.keys(n.variables).length;if(o>1&&!r.variables)throw new Error(`Missing variables in style (expected ${n.variables})`);for(let c=0;c<o;++c){const f=n.variables[Object.keys(n.variables)[c]];if(!(f.name in r.variables))throw new Error(`Missing '${f.name}' in style variables`);const g=Jd(f.name);s[g]=function(){let m=r.variables[f.name];return typeof m=="string"&&(m=Zl(m)),m!==void 0?m:-9999999}}const a=Object.keys(s).map(function(c){return`uniform float ${c};`}),l=Math.ceil(t/4);a.push(`uniform sampler2D ${Et.TILE_TEXTURE_ARRAY}[${l}];`),n.paletteTextures&&a.push(`uniform sampler2D ${K_}[${n.paletteTextures.length}];`);const h=Object.keys(n.functions).map(function(c){return n.functions[c]}),u=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;
    uniform vec4 ${Et.RENDER_EXTENT};
    uniform float ${Et.TRANSITION_ALPHA};
    uniform float ${Et.TEXTURE_PIXEL_WIDTH};
    uniform float ${Et.TEXTURE_PIXEL_HEIGHT};
    uniform float ${Et.RESOLUTION};
    uniform float ${Et.ZOOM};

    ${a.join(`
`)}

    ${h.join(`
`)}

    void main() {
      if (
        v_mapCoord[0] < ${Et.RENDER_EXTENT}[0] ||
        v_mapCoord[1] < ${Et.RENDER_EXTENT}[1] ||
        v_mapCoord[0] > ${Et.RENDER_EXTENT}[2] ||
        v_mapCoord[1] > ${Et.RENDER_EXTENT}[3]
      ) {
        discard;
      }

      vec4 color = texture2D(${Et.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);

      ${i.join(`
`)}

      gl_FragColor = color;
      gl_FragColor.rgb *= gl_FragColor.a;
      gl_FragColor *= ${Et.TRANSITION_ALPHA};
    }`;return{vertexShader:e,fragmentShader:u,uniforms:s,paletteTextures:n.paletteTextures}}class Hl extends ty{constructor(t){t=t?Object.assign({},t):{};const e=t.style||{};delete t.style;const n=t.cacheSize;delete t.cacheSize,super(t),this.sources_=t.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=e,this.cacheSize_=n,this.styleVariables_=this.style_.variables||{},this.addChangeListener(Ut.SOURCE,this.handleSourceUpdate_)}getSources(t,e){const n=this.getSource();return this.sources_?typeof this.sources_=="function"?this.sources_(t,e):this.sources_:n?[n]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){const t=this.getRenderSource();return t?t.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache(),this.getSource()&&this.setStyle(this.style_)}getSourceBandCount_(){const t=Number.MAX_SAFE_INTEGER,e=this.getSources([-t,-t,t,t],t);return e&&e.length&&"bandCount"in e[0]?e[0].bandCount:4}createRenderer(){const t=Xp(this.style_,this.getSourceBandCount_());return new NI(this,{vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,cacheSize:this.cacheSize_,paletteTextures:t.paletteTextures})}renderSources(t,e){const n=this.getRenderer();let i;for(let s=0,o=e.length;s<o;++s)this.renderedSource_=e[s],n.prepareFrame(t)&&(i=n.renderFrame(t));return i}render(t,e){this.rendered=!0;const n=t.viewState,i=this.getSources(t.extent,n.resolution);let s=!0;for(let a=0,l=i.length;a<l;++a){const h=i[a],u=h.getState();if(u=="loading"){const c=()=>{h.getState()=="ready"&&(h.removeEventListener("change",c),this.changed())};h.addEventListener("change",c)}s=s&&u=="ready"}const o=this.renderSources(t,i);if(this.getRenderer().renderComplete&&s)return this.renderedResolution_=n.resolution,o;if(this.renderedResolution_>.5*n.resolution){const a=this.getSources(t.extent,this.renderedResolution_).filter(l=>!i.includes(l));if(a.length>0)return this.renderSources(t,a)}return o}setStyle(t){this.styleVariables_=t.variables||{},this.style_=t;const e=Xp(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,paletteTextures:e.paletteTextures}),this.changed()}updateStyleVariables(t){Object.assign(this.styleVariables_,t),this.changed()}}Hl.prototype.dispose;const aP=Object.freeze(Object.defineProperty({__proto__:null,Graticule:GC,Group:Nh,Heatmap:qI,Image:ef,Layer:Ia,Tile:$l,Vector:Xd,VectorImage:YI,VectorTile:ry,WebGLPoints:oP,WebGLTile:Hl},Symbol.toStringTag,{value:"Module"}));var qe=(r,t,e)=>new Promise((n,i)=>{var s=l=>{try{a(e.next(l))}catch(h){i(h)}},o=l=>{try{a(e.throw(l))}catch(h){i(h)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(s,o);a((e=e.apply(r,t)).next())}),yr=Uint8Array,Go=Uint16Array,lP=Int32Array,sy=new yr([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),oy=new yr([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),hP=new yr([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ay=function(r,t){for(var e=new Go(31),n=0;n<31;++n)e[n]=t+=1<<r[n-1];for(var i=new lP(e[30]),n=1;n<30;++n)for(var s=e[n];s<e[n+1];++s)i[s]=s-e[n]<<5|n;return{b:e,r:i}},ly=ay(sy,2),hy=ly.b,uP=ly.r;hy[28]=258,uP[258]=28;var cP=ay(oy,0),dP=cP.b,uy=new Go(32768);for(Wt=0;Wt<32768;++Wt)bn=(Wt&43690)>>1|(Wt&21845)<<1,bn=(bn&52428)>>2|(bn&13107)<<2,bn=(bn&61680)>>4|(bn&3855)<<4,uy[Wt]=((bn&65280)>>8|(bn&255)<<8)>>1;var bn,Wt,jo=function(r,t,e){for(var n=r.length,i=0,s=new Go(t);i<n;++i)r[i]&&++s[r[i]-1];var o=new Go(t);for(i=1;i<t;++i)o[i]=o[i-1]+s[i-1]<<1;var a;{a=new Go(1<<t);var l=15-t;for(i=0;i<n;++i)if(r[i])for(var h=i<<4|r[i],u=t-r[i],c=o[r[i]-1]++<<u,f=c|(1<<u)-1;c<=f;++c)a[uy[c]>>l]=h}return a},Na=new yr(288);for(Wt=0;Wt<144;++Wt)Na[Wt]=8;var Wt;for(Wt=144;Wt<256;++Wt)Na[Wt]=9;var Wt;for(Wt=256;Wt<280;++Wt)Na[Wt]=7;var Wt;for(Wt=280;Wt<288;++Wt)Na[Wt]=8;var Wt,cy=new yr(32);for(Wt=0;Wt<32;++Wt)cy[Wt]=5;var Wt,fP=jo(Na,9),gP=jo(cy,5),Pu=function(r){for(var t=r[0],e=1;e<r.length;++e)r[e]>t&&(t=r[e]);return t},Dr=function(r,t,e){var n=t/8|0;return(r[n]|r[n+1]<<8)>>(t&7)&e},Au=function(r,t){var e=t/8|0;return(r[e]|r[e+1]<<8|r[e+2]<<16)>>(t&7)},pP=function(r){return(r+7)/8|0},mP=function(r,t,e){(e==null||e>r.length)&&(e=r.length);var n=new yr(e-t);return n.set(r.subarray(t,e)),n},_P=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],pr=function(r,t,e){var n=new Error(t||_P[r]);if(n.code=r,Error.captureStackTrace&&Error.captureStackTrace(n,pr),!e)throw n;return n},af=function(r,t,e,n){var i=r.length,s=0;if(!i||t.f&&!t.l)return e||new yr(0);var o=!e||t.i!=2,a=t.i;e||(e=new yr(i*3));var l=function(Tt){var St=e.length;if(Tt>St){var Dt=new yr(Math.max(St*2,Tt));Dt.set(e),e=Dt}},h=t.f||0,u=t.p||0,c=t.b||0,f=t.l,g=t.d,m=t.m,_=t.n,x=i*8;do{if(!f){h=Dr(r,u,1);var v=Dr(r,u+1,3);if(u+=3,v)if(v==1)f=fP,g=gP,m=9,_=5;else if(v==2){var w=Dr(r,u,31)+257,S=Dr(r,u+10,15)+4,E=w+Dr(r,u+5,31)+1;u+=14;for(var T=new yr(E),R=new yr(19),C=0;C<S;++C)R[hP[C]]=Dr(r,u+C*3,7);u+=S*3;for(var I=Pu(R),F=(1<<I)-1,U=jo(R,I),C=0;C<E;){var j=U[Dr(r,u,F)];u+=j&15;var B=j>>4;if(B<16)T[C++]=B;else{var d=0,p=0;for(B==16?(p=3+Dr(r,u,3),u+=2,d=T[C-1]):B==17?(p=3+Dr(r,u,7),u+=3):B==18&&(p=11+Dr(r,u,127),u+=7);p--;)T[C++]=d}}var y=T.subarray(0,w),b=T.subarray(w);m=Pu(y),_=Pu(b),f=jo(y,m),g=jo(b,_)}else pr(1);else{var B=pP(u)+4,M=r[B-4]|r[B-3]<<8,P=B+M;if(P>i){a&&pr(0);break}o&&l(c+M),e.set(r.subarray(B,P),c),t.b=c+=M,t.p=u=P*8,t.f=h;continue}if(u>x){a&&pr(0);break}}o&&l(c+131072);for(var A=(1<<m)-1,L=(1<<_)-1,D=u;;D=u){var d=f[Au(r,u)&A],X=d>>4;if(u+=d&15,u>x){a&&pr(0);break}if(d||pr(2),X<256)e[c++]=X;else if(X==256){D=u,f=null;break}else{var K=X-254;if(X>264){var C=X-257,G=sy[C];K=Dr(r,u,(1<<G)-1)+hy[C],u+=G}var H=g[Au(r,u)&L],Q=H>>4;H||pr(3),u+=H&15;var b=dP[Q];if(Q>3){var G=oy[Q];b+=Au(r,u)&(1<<G)-1,u+=G}if(u>x){a&&pr(0);break}o&&l(c+131072);var nt=c+K;if(c<b){var xt=s-b,dt=Math.min(b,nt);for(xt+c<0&&pr(3);c<dt;++c)e[c]=n[xt+c]}for(;c<nt;c+=4)e[c]=e[c-b],e[c+1]=e[c+1-b],e[c+2]=e[c+2-b],e[c+3]=e[c+3-b];c=nt}}t.l=f,t.p=D,t.b=c,t.f=h,f&&(h=1,t.m=m,t.d=g,t.n=_)}while(!h);return c==e.length?e:mP(e,0,c)},yP=new yr(0),xP=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&pr(6,"invalid gzip data");var t=r[3],e=10;t&4&&(e+=(r[10]|r[11]<<8)+2);for(var n=(t>>3&1)+(t>>4&1);n>0;n-=!r[e++]);return e+(t&2)},vP=function(r){var t=r.length;return(r[t-4]|r[t-3]<<8|r[t-2]<<16|r[t-1]<<24)>>>0},wP=function(r,t){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&pr(6,"invalid zlib data"),(r[1]>>5&1)==+!t&&pr(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function bP(r,t){return af(r,{i:2},t,t)}function SP(r,t){var e=xP(r);return e+8>r.length&&pr(6,"invalid gzip data"),af(r.subarray(e,-8),{i:2},new yr(vP(r)),t)}function EP(r,t){return af(r.subarray(wP(r,t),-4),{i:2},t,t)}function vc(r,t){return r[0]==31&&r[1]==139&&r[2]==8?SP(r,t):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?bP(r,t):EP(r,t)}var TP=typeof TextDecoder<"u"&&new TextDecoder,MP=0;try{TP.decode(yP,{stream:!0}),MP=1}catch{}var dy=(r,t)=>r*Math.pow(2,t),mo=(r,t)=>Math.floor(r/Math.pow(2,t)),Kl=(r,t)=>dy(r.getUint16(t+1,!0),8)+r.getUint8(t),fy=(r,t)=>dy(r.getUint32(t+2,!0),16)+r.getUint16(t,!0),RP=(r,t,e,n,i)=>{if(r!=n.getUint8(i))return r-n.getUint8(i);const s=Kl(n,i+1);if(t!=s)return t-s;const o=Kl(n,i+4);return e!=o?e-o:0},CP=(r,t,e,n)=>{const i=gy(r,t|128,e,n);return i?{z:t,x:e,y:n,offset:i[0],length:i[1],is_dir:!0}:null},Wp=(r,t,e,n)=>{const i=gy(r,t,e,n);return i?{z:t,x:e,y:n,offset:i[0],length:i[1],is_dir:!1}:null},gy=(r,t,e,n)=>{let i=0,s=r.byteLength/17-1;for(;i<=s;){const o=s+i>>1,a=RP(t,e,n,r,o*17);if(a>0)i=o+1;else if(a<0)s=o-1;else return[fy(r,o*17+7),r.getUint32(o*17+13,!0)]}return null},IP=(r,t)=>r.is_dir&&!t.is_dir?1:!r.is_dir&&t.is_dir?-1:r.z!==t.z?r.z-t.z:r.x!==t.x?r.x-t.x:r.y-t.y,py=(r,t)=>{const e=r.getUint8(t*17);return{z:e&127,x:Kl(r,t*17+1),y:Kl(r,t*17+4),offset:fy(r,t*17+7),length:r.getUint32(t*17+13,!0),is_dir:e>>7===1}},qp=r=>{const t=[],e=new DataView(r);for(let n=0;n<e.byteLength/17;n++)t.push(py(e,n));return PP(t)},PP=r=>{r.sort(IP);const t=new ArrayBuffer(17*r.length),e=new Uint8Array(t);for(let n=0;n<r.length;n++){const i=r[n];let s=i.z;i.is_dir&&(s=s|128),e[n*17]=s,e[n*17+1]=i.x&255,e[n*17+2]=i.x>>8&255,e[n*17+3]=i.x>>16&255,e[n*17+4]=i.y&255,e[n*17+5]=i.y>>8&255,e[n*17+6]=i.y>>16&255,e[n*17+7]=i.offset&255,e[n*17+8]=mo(i.offset,8)&255,e[n*17+9]=mo(i.offset,16)&255,e[n*17+10]=mo(i.offset,24)&255,e[n*17+11]=mo(i.offset,32)&255,e[n*17+12]=mo(i.offset,48)&255,e[n*17+13]=i.length&255,e[n*17+14]=i.length>>8&255,e[n*17+15]=i.length>>16&255,e[n*17+16]=i.length>>24&255}return t},AP=(r,t)=>{if(r.byteLength<17)return null;const e=r.byteLength/17,n=py(r,e-1);if(n.is_dir){const i=n.z,s=t.z-i,o=Math.trunc(t.x/(1<<s)),a=Math.trunc(t.y/(1<<s));return{z:i,x:o,y:a}}return null};function LP(r){return qe(this,null,function*(){const t=yield r.getBytes(0,512e3),e=new DataView(t.data),n=e.getUint32(4,!0),i=e.getUint16(8,!0),s=new TextDecoder("utf-8"),o=JSON.parse(s.decode(new DataView(t.data,10,n)));let a=0;o.compression==="gzip"&&(a=2);let l=0;"minzoom"in o&&(l=+o.minzoom);let h=0;"maxzoom"in o&&(h=+o.maxzoom);let u=0,c=0,f=0,g=-180,m=-85,_=180,x=85;if(o.bounds){const v=o.bounds.split(",");g=+v[0],m=+v[1],_=+v[2],x=+v[3]}if(o.center){const v=o.center.split(",");u=+v[0],c=+v[1],f=+v[2]}return{specVersion:e.getUint16(2,!0),rootDirectoryOffset:10+n,rootDirectoryLength:i*17,jsonMetadataOffset:10,jsonMetadataLength:n,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:a,tileType:1,minZoom:l,maxZoom:h,minLon:g,minLat:m,maxLon:_,maxLat:x,centerZoom:f,centerLon:u,centerLat:c,etag:t.etag}})}function OP(r,t,e,n,i,s,o){return qe(this,null,function*(){let a=yield e.getArrayBuffer(t,r.rootDirectoryOffset,r.rootDirectoryLength,r);r.specVersion===1&&(a=qp(a));const l=Wp(new DataView(a),n,i,s);if(l){let u=(yield t.getBytes(l.offset,l.length,o)).data;const c=new DataView(u);return c.getUint8(0)==31&&c.getUint8(1)==139&&(u=vc(new Uint8Array(u))),{data:u}}const h=AP(new DataView(a),{z:n,x:i,y:s});if(h){const u=CP(new DataView(a),h.z,h.x,h.y);if(u){let c=yield e.getArrayBuffer(t,u.offset,u.length,r);r.specVersion===1&&(c=qp(c));const f=Wp(new DataView(c),n,i,s);if(f){let g=(yield t.getBytes(f.offset,f.length,o)).data;const m=new DataView(g);return m.getUint8(0)==31&&m.getUint8(1)==139&&(g=vc(new Uint8Array(g))),{data:g}}}}})}var my={getHeader:LP,getZxy:OP};function FP(r,t){return(t>>>0)*4294967296+(r>>>0)}function NP(r,t){const e=t.buf;let n,i;if(i=e[t.pos++],n=(i&112)>>4,i<128||(i=e[t.pos++],n|=(i&127)<<3,i<128)||(i=e[t.pos++],n|=(i&127)<<10,i<128)||(i=e[t.pos++],n|=(i&127)<<17,i<128)||(i=e[t.pos++],n|=(i&127)<<24,i<128)||(i=e[t.pos++],n|=(i&1)<<31,i<128))return FP(r,n);throw new Error("Expected varint not more than 10 bytes")}function _o(r){const t=r.buf;let e,n;return n=t[r.pos++],e=n&127,n<128||(n=t[r.pos++],e|=(n&127)<<7,n<128)||(n=t[r.pos++],e|=(n&127)<<14,n<128)||(n=t[r.pos++],e|=(n&127)<<21,n<128)?e:(n=t[r.pos],e|=(n&15)<<28,NP(e,r))}function DP(r,t,e,n){if(n==0){e==1&&(t[0]=r-1-t[0],t[1]=r-1-t[1]);const i=t[0];t[0]=t[1],t[1]=i}}var kP=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function GP(r,t,e){if(r>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(t>Math.pow(2,r)-1||e>Math.pow(2,r)-1)throw Error("tile x/y outside zoom level bounds");const n=kP[r],i=Math.pow(2,r);let s=0,o=0,a=0;const l=[t,e];let h=i/2;for(;h>0;)s=(l[0]&h)>0?1:0,o=(l[1]&h)>0?1:0,a+=h*h*(3*s^o),DP(h,l,s,o),h=h/2;return n+a}function _y(r,t){return qe(this,null,function*(){if(t===1||t===0)return r;if(t===2){if(typeof globalThis.DecompressionStream>"u")return vc(new Uint8Array(r));{let e=new Response(r).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(e).arrayBuffer()}}else throw Error("Compression method not supported")})}var gs=(r=>(r[r.Unknown=0]="Unknown",r[r.Mvt=1]="Mvt",r[r.Png=2]="Png",r[r.Jpeg=3]="Jpeg",r[r.Webp=4]="Webp",r[r.Avif=5]="Avif",r))(gs||{}),jP=127;function zP(r,t){let e=0,n=r.length-1;for(;e<=n;){const i=n+e>>1,s=t-r[i].tileId;if(s>0)e=i+1;else if(s<0)n=i-1;else return r[i]}return n>=0&&(r[n].runLength===0||t-r[n].tileId<r[n].runLength)?r[n]:null}var UP=class{constructor(r,t=new Headers){this.url=r,this.customHeaders=t}getKey(){return this.url}setHeaders(r){this.customHeaders=r}getBytes(r,t,e){return qe(this,null,function*(){let n;e||(n=new AbortController,e=n.signal);const i=new Headers(this.customHeaders);i.set("Range","bytes="+r+"-"+(r+t-1));let s=yield fetch(this.url,{signal:e,headers:i});if(s.status===416&&r===0){const a=s.headers.get("Content-Range");if(!a||!a.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const l=+a.substr(8);s=yield fetch(this.url,{signal:e,headers:{Range:"bytes=0-"+(l-1)}})}if(s.status>=300)throw Error("Bad response code: "+s.status);const o=s.headers.get("Content-Length");if(s.status===200&&(!o||+o>t))throw n&&n.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield s.arrayBuffer(),etag:s.headers.get("ETag")||void 0,cacheControl:s.headers.get("Cache-Control")||void 0,expires:s.headers.get("Expires")||void 0}})}};function kr(r,t){const e=r.getUint32(t+4,!0),n=r.getUint32(t+0,!0);return e*Math.pow(2,32)+n}function BP(r,t){const e=new DataView(r),n=e.getUint8(7);if(n>3)throw Error(`Archive is spec version ${n} but this library supports up to spec version 3`);return{specVersion:n,rootDirectoryOffset:kr(e,8),rootDirectoryLength:kr(e,16),jsonMetadataOffset:kr(e,24),jsonMetadataLength:kr(e,32),leafDirectoryOffset:kr(e,40),leafDirectoryLength:kr(e,48),tileDataOffset:kr(e,56),tileDataLength:kr(e,64),numAddressedTiles:kr(e,72),numTileEntries:kr(e,80),numTileContents:kr(e,88),clustered:e.getUint8(96)===1,internalCompression:e.getUint8(97),tileCompression:e.getUint8(98),tileType:e.getUint8(99),minZoom:e.getUint8(100),maxZoom:e.getUint8(101),minLon:e.getInt32(102,!0)/1e7,minLat:e.getInt32(106,!0)/1e7,maxLon:e.getInt32(110,!0)/1e7,maxLat:e.getInt32(114,!0)/1e7,centerZoom:e.getUint8(118),centerLon:e.getInt32(119,!0)/1e7,centerLat:e.getInt32(123,!0)/1e7,etag:t}}function yy(r){const t={buf:new Uint8Array(r),pos:0},e=_o(t),n=[];let i=0;for(let s=0;s<e;s++){const o=_o(t);n.push({tileId:i+o,offset:0,length:0,runLength:1}),i+=o}for(let s=0;s<e;s++)n[s].runLength=_o(t);for(let s=0;s<e;s++)n[s].length=_o(t);for(let s=0;s<e;s++){const o=_o(t);o===0&&s>0?n[s].offset=n[s-1].offset+n[s-1].length:n[s].offset=o-1}return n}function XP(r){const t=new DataView(r);return t.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):t.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var vs=class extends Error{};function WP(r,t,e,n){return qe(this,null,function*(){const i=yield r.getBytes(0,16384);if(new DataView(i.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(XP(i.data)<3)return[yield my.getHeader(r)];const s=i.data.slice(0,jP);let o=i.etag;n&&i.etag!=n&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+r.getKey()),o=void 0);const a=BP(s,o);if(e){const l=i.data.slice(a.rootDirectoryOffset,a.rootDirectoryOffset+a.rootDirectoryLength),h=r.getKey()+"|"+(a.etag||"")+"|"+a.rootDirectoryOffset+"|"+a.rootDirectoryLength,u=yy(yield t(l,a.internalCompression));return[a,[h,u.length,u]]}return[a,void 0]})}function qP(r,t,e,n,i){return qe(this,null,function*(){const s=yield r.getBytes(e,n);if(i.etag&&i.etag!==s.etag)throw new vs(s.etag);const o=yield t(s.data,i.internalCompression),a=yy(o);if(a.length===0)throw new Error("Empty directory is invalid");return a})}var ZP=class{constructor(r=100,t=!0,e=_y){this.cache=new Map,this.maxCacheEntries=r,this.counter=1,this.prefetch=t,this.decompress=e}getHeader(r,t){return qe(this,null,function*(){const e=r.getKey();if(this.cache.has(e))return this.cache.get(e).lastUsed=this.counter++,yield this.cache.get(e).data;const n=new Promise((i,s)=>{WP(r,this.decompress,this.prefetch,t).then(o=>{o[1]&&this.cache.set(o[1][0],{lastUsed:this.counter++,data:Promise.resolve(o[1][2])}),i(o[0]),this.prune()}).catch(o=>{s(o)})});return this.cache.set(e,{lastUsed:this.counter++,data:n}),n})}getDirectory(r,t,e,n){return qe(this,null,function*(){const i=r.getKey()+"|"+(n.etag||"")+"|"+t+"|"+e;if(this.cache.has(i))return this.cache.get(i).lastUsed=this.counter++,yield this.cache.get(i).data;const s=new Promise((o,a)=>{qP(r,this.decompress,t,e,n).then(l=>{o(l),this.prune()}).catch(l=>{a(l)})});return this.cache.set(i,{lastUsed:this.counter++,data:s}),s})}getArrayBuffer(r,t,e,n){return qe(this,null,function*(){const i=r.getKey()+"|"+(n.etag||"")+"|"+t+"|"+e;if(this.cache.has(i))return this.cache.get(i).lastUsed=this.counter++,yield this.cache.get(i).data;const s=new Promise((o,a)=>{r.getBytes(t,e).then(l=>{if(n.etag&&n.etag!==l.etag)throw new vs(l.etag);o(l.data),this.cache.has(i),this.prune()}).catch(l=>{a(l)})});return this.cache.set(i,{lastUsed:this.counter++,data:s}),s})}prune(){if(this.cache.size>=this.maxCacheEntries){let r=1/0,t;this.cache.forEach((e,n)=>{e.lastUsed<r&&(r=e.lastUsed,t=n)}),t&&this.cache.delete(t)}}invalidate(r,t){return qe(this,null,function*(){this.cache.delete(r.getKey()),yield this.getHeader(r,t)})}},lf=class{constructor(r,t,e){typeof r=="string"?this.source=new UP(r):this.source=r,e?this.decompress=e:this.decompress=_y,t?this.cache=t:this.cache=new ZP}getHeader(){return qe(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(r,t,e,n){return qe(this,null,function*(){const i=GP(r,t,e),s=yield this.cache.getHeader(this.source);if(s.specVersion<3)return my.getZxy(s,this.source,this.cache,r,t,e,n);if(r<s.minZoom||r>s.maxZoom)return;let o=s.rootDirectoryOffset,a=s.rootDirectoryLength;for(let l=0;l<=3;l++){const h=yield this.cache.getDirectory(this.source,o,a,s),u=zP(h,i);if(u)if(u.runLength>0){const c=yield this.source.getBytes(s.tileDataOffset+u.offset,u.length,n);if(s.etag&&s.etag!==c.etag)throw new vs(c.etag);return{data:yield this.decompress(c.data,s.tileCompression),cacheControl:c.cacheControl,expires:c.expires}}else o=s.leafDirectoryOffset+u.offset,a=u.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(r,t,e,n){return qe(this,null,function*(){try{return yield this.getZxyAttempt(r,t,e,n)}catch(i){if(i instanceof vs)return this.cache.invalidate(this.source,i.message),yield this.getZxyAttempt(r,t,e,n);throw i}})}getMetadataAttempt(){return qe(this,null,function*(){const r=yield this.cache.getHeader(this.source),t=yield this.source.getBytes(r.jsonMetadataOffset,r.jsonMetadataLength);if(r.etag&&r.etag!==t.etag)throw new vs(t.etag);const e=yield this.decompress(t.data,r.internalCompression),n=new TextDecoder("utf-8");return JSON.parse(n.decode(e))})}getMetadata(){return qe(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(r){if(r instanceof vs)return this.cache.invalidate(this.source,r.message),yield this.getMetadataAttempt();throw r}})}};class $P extends fn{constructor(t){super(Lt.ERROR),this.error=t}}class Bh extends Hd{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(t){for(;this.canExpireCache()&&!(this.peekLast().getKey()in t);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;const t=this.peekFirstKey(),e=H_(t)[0];this.forEach(n=>{n.tileCoord[0]!==e&&(this.remove(ei(n.tileCoord)),n.release())})}}const Is={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"},ls=[0,0,0],Jn=5;class _i{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,At(Fx(this.resolutions_,(i,s)=>s-i),"`resolutions` must be sorted in descending order");let e;if(!t.origins){for(let i=0,s=this.resolutions_.length-1;i<s;++i)if(!e)e=this.resolutions_[i]/this.resolutions_[i+1];else if(this.resolutions_[i]/this.resolutions_[i+1]!==e){e=void 0;break}}this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,At(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const n=t.extent;n!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=zn(n)),At(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,At(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:zs,At(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=n!==void 0?n:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map((i,s)=>{const o=new Uh(Math.min(0,i[0]),Math.max(i[0]-1,-1),Math.min(0,i[1]),Math.max(i[1]-1,-1));if(n){const a=this.getTileRangeForExtentAndZ(n,s);o.minX=Math.max(a.minX,o.minX),o.maxX=Math.min(a.maxX,o.maxX),o.minY=Math.max(a.minY,o.minY),o.maxY=Math.min(a.maxY,o.maxY)}return o}):n&&this.calculateTileRanges_(n)}forEachTileCoord(t,e,n){const i=this.getTileRangeForExtentAndZ(t,e);for(let s=i.minX,o=i.maxX;s<=o;++s)for(let a=i.minY,l=i.maxY;a<=l;++a)n([e,s,a])}forEachTileCoordParentTileRange(t,e,n,i){let s,o,a,l=null,h=t[0]-1;for(this.zoomFactor_===2?(o=t[1],a=t[2]):l=this.getTileCoordExtent(t,i);h>=this.minZoom;){if(o!==void 0&&a!==void 0?(o=Math.floor(o/2),a=Math.floor(a/2),s=ss(o,o,a,a,n)):s=this.getTileRangeForExtentAndZ(l,h,n),e(h,s))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,n){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){const s=t[1]*2,o=t[2]*2;return ss(s,s+1,o,o+1,e)}const i=this.getTileCoordExtent(t,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(i,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,n){if(e>this.maxZoom||e<this.minZoom)return null;const i=t[0],s=t[1],o=t[2];if(e===i)return ss(s,o,s,o,n);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,e-i),h=Math.floor(s*l),u=Math.floor(o*l);if(e<i)return ss(h,h,u,u,n);const c=Math.floor(l*(s+1))-1,f=Math.floor(l*(o+1))-1;return ss(h,c,u,f,n)}const a=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,e,n)}getTileRangeForExtentAndZ(t,e,n){this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,ls);const i=ls[1],s=ls[2];this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,ls);const o=ls[1],a=ls[2];return ss(i,o,s,a,n)}getTileCoordCenter(t){const e=this.getOrigin(t[0]),n=this.getResolution(t[0]),i=ie(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*i[0]*n,e[1]-(t[2]+.5)*i[1]*n]}getTileCoordExtent(t,e){const n=this.getOrigin(t[0]),i=this.getResolution(t[0]),s=ie(this.getTileSize(t[0]),this.tmpSize_),o=n[0]+t[1]*s[0]*i,a=n[1]-(t[2]+1)*s[1]*i,l=o+s[0]*i,h=a+s[1]*i;return Br(o,a,l,h,e)}getTileCoordForCoordAndResolution(t,e,n){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,n)}getTileCoordForXYAndResolution_(t,e,n,i,s){const o=this.getZForResolution(n),a=n/this.getResolution(o),l=this.getOrigin(o),h=ie(this.getTileSize(o),this.tmpSize_);let u=a*(t-l[0])/n/h[0],c=a*(l[1]-e)/n/h[1];return i?(u=ri(u,Jn)-1,c=ri(c,Jn)-1):(u=ys(u,Jn),c=ys(c,Jn)),ha(o,u,c,s)}getTileCoordForXYAndZ_(t,e,n,i,s){const o=this.getOrigin(n),a=this.getResolution(n),l=ie(this.getTileSize(n),this.tmpSize_);let h=(t-o[0])/a/l[0],u=(o[1]-e)/a/l[1];return i?(h=ri(h,Jn)-1,u=ri(u,Jn)-1):(h=ys(h,Jn),u=ys(u,Jn)),ha(n,h,u,s)}getTileCoordForCoordAndZ(t,e,n){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,n)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){const n=lh(this.resolutions_,t,e||0);return wt(n,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return i0(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const e=this.resolutions_.length,n=new Array(e);for(let i=this.minZoom;i<e;++i)n[i]=this.getTileRangeForExtentAndZ(t,i);this.fullTileRanges_=n}}class VP extends _i{constructor(t){super({extent:t.extent,origin:t.origin,origins:t.origins,resolutions:t.resolutions,tileSize:t.tileSize,tileSizes:t.tileSizes,sizes:t.sizes}),this.matrixIds_=t.matrixIds}getMatrixId(t){return this.matrixIds_[t]}getMatrixIds(){return this.matrixIds_}}function YP(r,t,e){const n=[],i=[],s=[],o=[],a=[];e=e!==void 0?e:[];const l="SupportedCRS",h="TileMatrix",u="Identifier",c="ScaleDenominator",f="TopLeftCorner",g="TileWidth",m="TileHeight",_=r[l],x=tt(_),v=x.getMetersPerUnit(),w=x.getAxisOrientation().substr(0,2)=="ne";return r[h].sort(function(S,E){return E[c]-S[c]}),r[h].forEach(function(S){let E;if(e.length>0?E=e.find(function(T){return S[u]==T[h]?!0:S[u].includes(":")?!1:r[u]+":"+S[u]===T[h]}):E=!0,E){i.push(S[u]);const T=S[c]*28e-5/v,R=S[g],C=S[m];w?s.push([S[f][1],S[f][0]]):s.push(S[f]),n.push(T),o.push(R==C?R:[R,C]),a.push([S.MatrixWidth,S.MatrixHeight])}}),new VP({extent:t,origins:s,resolutions:n,matrixIds:i,tileSizes:o,sizes:a})}function hf(r){let t=r.getDefaultTileGrid();return t||(t=QP(r),r.setDefaultTileGrid(t)),t}function HP(r,t,e){const n=t[0],i=r.getTileCoordCenter(t),s=Wn(e);if(!xr(s,i)){const o=yt(s),a=Math.ceil((s[0]-i[0])/o);return i[0]+=o*a,r.getTileCoordForCoordAndZ(i,n)}return t}function KP(r,t,e,n){n=n!==void 0?n:"top-left";const i=xy(r,t,e);return new _i({extent:r,origin:Zx(r,n),resolutions:i,tileSize:e})}function Hi(r){const t=r||{},e=t.extent||tt("EPSG:3857").getExtent(),n={extent:e,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:xy(e,t.maxZoom,t.tileSize,t.maxResolution)};return new _i(n)}function xy(r,t,e,n){t=t!==void 0?t:m_,e=ie(e!==void 0?e:zs);const i=Vt(r),s=yt(r);n=n>0?n:Math.max(s/e[0],i/e[1]);const o=t+1,a=new Array(o);for(let l=0;l<o;++l)a[l]=n/Math.pow(2,l);return a}function QP(r,t,e,n){const i=Wn(r);return KP(i,t,e,n)}function Wn(r){r=tt(r);let t=r.getExtent();if(!t){const e=180*Wc.degrees/r.getMetersPerUnit();t=Br(-e,-e,e,e)}return t}class JP extends ro{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.opaque_=t.opaque!==void 0?t.opaque:!1,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;const e=[256,256];this.tileGrid&&ie(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),e),this.tileCache=new Bh(t.cacheSize||0),this.tmpSize=[0,0],this.key_=t.key||"",this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(t,e){const n=this.getTileCacheForProjection(t);n&&n.expireCache(e)}forEachLoadedTile(t,e,n,i){const s=this.getTileCacheForProjection(t);if(!s)return!1;let o=!0,a,l,h;for(let u=n.minX;u<=n.maxX;++u)for(let c=n.minY;c<=n.maxY;++c)l=cn(e,u,c),h=!1,s.containsKey(l)&&(a=s.get(l),h=a.getState()===W.LOADED,h&&(h=i(a)!==!1)),h||(o=!1);return o}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getOpaque(t){return this.opaque_}getResolutions(t){const e=t?this.getTileGridForProjection(t):this.tileGrid;return e?e.getResolutions():null}getTile(t,e,n,i,s){return ut()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:hf(t)}getTileCacheForProjection(t){const e=this.getProjection();return At(e===null||Ae(e,t),"A VectorTile source can only be rendered if it has a projection compatible with the view projection."),this.tileCache}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,n){const i=this.getTileGridForProjection(n),s=this.getTilePixelRatio(e),o=ie(i.getTileSize(t),this.tmpSize);return s==1?o:E0(o,s,this.tmpSize)}getTileCoordForTileUrlFunction(t,e){e=e!==void 0?e:this.getProjection();const n=this.getTileGridForProjection(e);return this.getWrapX()&&e.isGlobal()&&(t=HP(n,t,e)),II(t,n)?t:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(t,e){const n=this.getTileCacheForProjection(e);t>n.highWaterMark&&(n.highWaterMark=t)}useTile(t,e,n,i){}}class vy extends fn{constructor(t,e){super(t),this.tile=e}}const Da=JP;class uf extends Da{constructor(t){const e=t.projection===void 0?"EPSG:3857":t.projection;let n=t.tileGrid;n===void 0&&e&&(n=Hi({extent:Wn(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize})),super({cacheSize:.1,attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:e,tileGrid:n,opaque:t.opaque,state:t.state,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate}),this.gutter_=t.gutter!==void 0?t.gutter:0,this.tileSize_=t.tileSize?ie(t.tileSize):null,this.tileSizes_=null,this.tileLoadingKeys_={},this.loader_=t.loader,this.handleTileChange_=this.handleTileChange_.bind(this),this.bandCount=t.bandCount===void 0?4:t.bandCount,this.tileGridForProjection_={},this.tileCacheForProjection_={}}setTileSizes(t){this.tileSizes_=t}getTileSize(t){if(this.tileSizes_)return this.tileSizes_[t];if(this.tileSize_)return this.tileSize_;const e=this.getTileGrid();return e?ie(e.getTileSize(t)):[256,256]}getGutterForProjection(t){const e=this.getProjection();return!e||Ae(e,t)?this.gutter_:0}setLoader(t){this.loader_=t}getReprojTile_(t,e,n,i,s){const o=this.getTileCacheForProjection(i),a=cn(t,e,n);if(o.containsKey(a)){const x=o.get(a);if(x&&x.key==this.getKey())return x}const l=this.getTileGrid(),h=Math.max.apply(null,l.getResolutions().map((x,v)=>{const w=ie(l.getTileSize(v)),S=this.getTileSize(v);return Math.max(S[0]/w[0],S[1]/w[1])})),u=this.getTileGridForProjection(s),c=this.getTileGridForProjection(i),f=[t,e,n],g=this.getTileCoordForTileUrlFunction(f,i),m=Object.assign({sourceProj:s,sourceTileGrid:u,targetProj:i,targetTileGrid:c,tileCoord:f,wrappedTileCoord:g,pixelRatio:h,gutter:this.getGutterForProjection(s),getTileFunction:(x,v,w,S)=>this.getTile(x,v,w,S,s)},this.tileOptions),_=new Yd(m);return _.key=this.getKey(),_}getTile(t,e,n,i,s){const o=this.getProjection();if(o&&s&&!Ae(o,s))return this.getReprojTile_(t,e,n,s,o);const a=this.getTileSize(t),l=cn(t,e,n);if(this.tileCache.containsKey(l))return this.tileCache.get(l);const h=this.loader_;function u(){return zm(function(){return h(t,e,n)})}const c=Object.assign({tileCoord:[t,e,n],loader:u,size:a},this.tileOptions),f=new Zd(c);return f.key=this.getKey(),f.addEventListener(Lt.CHANGE,this.handleTileChange_),this.tileCache.set(l,f),f}handleTileChange_(t){const e=t.target,n=it(e),i=e.getState();let s;i==W.LOADING?(this.tileLoadingKeys_[n]=!0,s=Is.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],s=i==W.ERROR?Is.TILELOADERROR:i==W.LOADED?Is.TILELOADEND:void 0),s&&this.dispatchEvent(new vy(s,e))}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||Ae(e,t)))return this.tileGrid;const n=it(t);return n in this.tileGridForProjection_||(this.tileGridForProjection_[n]=hf(t)),this.tileGridForProjection_[n]}setTileGridForProjection(t,e){const n=tt(t);if(n){const i=it(n);i in this.tileGridForProjection_||(this.tileGridForProjection_[i]=e)}}getTileCacheForProjection(t){const e=this.getProjection();if(!e||Ae(e,t))return this.tileCache;const n=it(t);return n in this.tileCacheForProjection_||(this.tileCacheForProjection_[n]=new Bh(.1)),this.tileCacheForProjection_[n]}expireCache(t,e){const n=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==n?e:{});for(const i in this.tileCacheForProjection_){const s=this.tileCacheForProjection_[i];s.expireCache(s==n?e:{})}}clear(){super.clear();for(const t in this.tileCacheForProjection_)this.tileCacheForProjection_[t].clear()}}function Fe(r){return(t,...e)=>tA(r,t,e)}function io(r,t){return Fe(wy(r,t).get)}const{apply:tA,construct:P5,defineProperty:A5,get:L5,getOwnPropertyDescriptor:wy,getPrototypeOf:cf,has:O5,ownKeys:eA,set:F5,setPrototypeOf:N5}=Reflect,{iterator:ka,species:D5,toStringTag:rA,for:k5}=Symbol,nA=Object,{create:df,defineProperty:iA,freeze:G5,is:j5}=nA,sA=Array,oA=sA.prototype,by=oA[ka],aA=Fe(by),Sy=ArrayBuffer,lA=Sy.prototype;io(lA,"byteLength");const Zp=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;Zp&&io(Zp.prototype,"byteLength");const Ey=cf(Uint8Array);Ey.from;const He=Ey.prototype;He[ka];Fe(He.keys);Fe(He.values);Fe(He.entries);Fe(He.set);Fe(He.reverse);Fe(He.fill);Fe(He.copyWithin);Fe(He.sort);Fe(He.slice);Fe(He.subarray);io(He,"buffer");io(He,"byteOffset");io(He,"length");io(He,rA);const hA=Uint8Array,Ty=Uint16Array,ff=Uint32Array,uA=Float32Array,ua=cf([][ka]()),My=Fe(ua.next),cA=Fe(function*(){}().next),dA=cf(ua),fA=DataView.prototype,gA=Fe(fA.getUint16),gf=WeakMap,Ry=gf.prototype,Cy=Fe(Ry.get),pA=Fe(Ry.set),Iy=new gf,mA=df(null,{next:{value:function(){const r=Cy(Iy,this);return My(r)}},[ka]:{value:function(){return this}}});function _A(r){if(r[ka]===by&&ua.next===My)return r;const t=df(mA);return pA(Iy,t,aA(r)),t}const yA=new gf,xA=df(dA,{next:{value:function(){const r=Cy(yA,this);return cA(r)},writable:!0,configurable:!0}});for(const r of eA(ua))r!=="next"&&iA(xA,r,wy(ua,r));const Py=new Sy(4),vA=new uA(Py),wA=new ff(Py),Hr=new Ty(512),Kr=new hA(512);for(let r=0;r<256;++r){const t=r-127;t<-27?(Hr[r]=0,Hr[r|256]=32768,Kr[r]=24,Kr[r|256]=24):t<-14?(Hr[r]=1024>>-t-14,Hr[r|256]=1024>>-t-14|32768,Kr[r]=-t-1,Kr[r|256]=-t-1):t<=15?(Hr[r]=t+15<<10,Hr[r|256]=t+15<<10|32768,Kr[r]=13,Kr[r|256]=13):t<128?(Hr[r]=31744,Hr[r|256]=64512,Kr[r]=24,Kr[r|256]=24):(Hr[r]=31744,Hr[r|256]=64512,Kr[r]=13,Kr[r|256]=13)}const pf=new ff(2048);for(let r=1;r<1024;++r){let t=r<<13,e=0;for(;!(t&8388608);)t<<=1,e-=8388608;t&=-8388609,e+=947912704,pf[r]=t|e}for(let r=1024;r<2048;++r)pf[r]=939524096+(r-1024<<13);const so=new ff(64);for(let r=1;r<31;++r)so[r]=r<<23;so[31]=1199570944;so[32]=2147483648;for(let r=33;r<63;++r)so[r]=2147483648+(r-32<<23);so[63]=3347054592;const Ay=new Ty(64);for(let r=1;r<64;++r)r!==32&&(Ay[r]=1024);function bA(r){const t=r>>10;return wA[0]=pf[Ay[t]+(r&1023)]+so[t],vA[0]}function Ly(r,t,...e){return bA(gA(r,t,..._A(e)))}var mf={exports:{}};function Oy(r,t,e){const n=e&&e.debug||!1;n&&console.log("[xml-utils] getting "+t+" in "+r);const i=typeof r=="object"?r.outer:r,s=i.slice(0,i.indexOf(">")+1),o=['"',"'"];for(let a=0;a<o.length;a++){const l=o[a],h=t+"\\="+l+"([^"+l+"]*)"+l;n&&console.log("[xml-utils] pattern:",h);const u=new RegExp(h).exec(s);if(n&&console.log("[xml-utils] match:",u),u)return u[1]}}mf.exports=Oy;mf.exports.default=Oy;var SA=mf.exports;const Lu=Ks(SA);var _f={exports:{}},yf={exports:{}},xf={exports:{}};function Fy(r,t,e){const n=new RegExp(t).exec(r.slice(e));return n?e+n.index:-1}xf.exports=Fy;xf.exports.default=Fy;var EA=xf.exports,vf={exports:{}};function Ny(r,t,e){const n=new RegExp(t).exec(r.slice(e));return n?e+n.index+n[0].length-1:-1}vf.exports=Ny;vf.exports.default=Ny;var TA=vf.exports,wf={exports:{}};function Dy(r,t){const e=new RegExp(t,"g"),n=r.match(e);return n?n.length:0}wf.exports=Dy;wf.exports.default=Dy;var MA=wf.exports;const RA=EA,Ou=TA,$p=MA;function ky(r,t,e){const n=e&&e.debug||!1,i=!(e&&typeof e.nested===!1),s=e&&e.startIndex||0;n&&console.log("[xml-utils] starting findTagByName with",t," and ",e);const o=RA(r,`<${t}[ 
>/]`,s);if(n&&console.log("[xml-utils] start:",o),o===-1)return;const a=r.slice(o+t.length);let l=Ou(a,"^[^<]*[ /]>",0);const h=l!==-1&&a[l-1]==="/";if(n&&console.log("[xml-utils] selfClosing:",h),h===!1)if(i){let g=0,m=1,_=0;for(;(l=Ou(a,"[ /]"+t+">",g))!==-1;){const x=a.substring(g,l+1);if(m+=$p(x,"<"+t+`[ 
	>]`),_+=$p(x,"</"+t+">"),_>=m)break;g=l}}else l=Ou(a,"[ /]"+t+">",0);const u=o+t.length+l+1;if(n&&console.log("[xml-utils] end:",u),u===-1)return;const c=r.slice(o,u);let f;return h?f=null:f=c.slice(c.indexOf(">")+1,c.lastIndexOf("<")),{inner:f,outer:c,start:o,end:u}}yf.exports=ky;yf.exports.default=ky;var CA=yf.exports;const IA=CA;function Gy(r,t,e){const n=[],i=e&&e.debug||!1,s=e&&typeof e.nested=="boolean"?e.nested:!0;let o=e&&e.startIndex||0,a;for(;a=IA(r,t,{debug:i,startIndex:o});)s?o=a.start+1+t.length:o=a.end,n.push(a);return i&&console.log("findTagsByName found",n.length,"tags"),n}_f.exports=Gy;_f.exports.default=Gy;var PA=_f.exports;const AA=Ks(PA),zo={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},Jr={};for(const r in zo)zo.hasOwnProperty(r)&&(Jr[zo[r]]=parseInt(r,10));const LA=[Jr.BitsPerSample,Jr.ExtraSamples,Jr.SampleFormat,Jr.StripByteCounts,Jr.StripOffsets,Jr.StripRowCounts,Jr.TileByteCounts,Jr.TileOffsets,Jr.SubIFDs],Fu={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},Mt={};for(const r in Fu)Fu.hasOwnProperty(r)&&(Mt[Fu[r]]=parseInt(r,10));const Qe={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},OA={Unspecified:0,Assocalpha:1,Unassalpha:2},z5={Version:0,AddCompression:1},U5={None:0,Deflate:1,Zstandard:2},FA={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function NA(r,t){const{width:e,height:n}=r,i=new Uint8Array(e*n*3);let s;for(let o=0,a=0;o<r.length;++o,a+=3)s=256-r[o]/t*256,i[a]=s,i[a+1]=s,i[a+2]=s;return i}function DA(r,t){const{width:e,height:n}=r,i=new Uint8Array(e*n*3);let s;for(let o=0,a=0;o<r.length;++o,a+=3)s=r[o]/t*256,i[a]=s,i[a+1]=s,i[a+2]=s;return i}function kA(r,t){const{width:e,height:n}=r,i=new Uint8Array(e*n*3),s=t.length/3,o=t.length/3*2;for(let a=0,l=0;a<r.length;++a,l+=3){const h=r[a];i[l]=t[h]/65536*256,i[l+1]=t[h+s]/65536*256,i[l+2]=t[h+o]/65536*256}return i}function GA(r){const{width:t,height:e}=r,n=new Uint8Array(t*e*3);for(let i=0,s=0;i<r.length;i+=4,s+=3){const o=r[i],a=r[i+1],l=r[i+2],h=r[i+3];n[s]=255*((255-o)/256)*((255-h)/256),n[s+1]=255*((255-a)/256)*((255-h)/256),n[s+2]=255*((255-l)/256)*((255-h)/256)}return n}function jA(r){const{width:t,height:e}=r,n=new Uint8ClampedArray(t*e*3);for(let i=0,s=0;i<r.length;i+=3,s+=3){const o=r[i],a=r[i+1],l=r[i+2];n[s]=o+1.402*(l-128),n[s+1]=o-.34414*(a-128)-.71414*(l-128),n[s+2]=o+1.772*(a-128)}return n}const zA=.95047,UA=1,BA=1.08883;function XA(r){const{width:t,height:e}=r,n=new Uint8Array(t*e*3);for(let i=0,s=0;i<r.length;i+=3,s+=3){const o=r[i+0],a=r[i+1]<<24>>24,l=r[i+2]<<24>>24;let h=(o+16)/116,u=a/500+h,c=h-l/200,f,g,m;u=zA*(u*u*u>.008856?u*u*u:(u-16/116)/7.787),h=UA*(h*h*h>.008856?h*h*h:(h-16/116)/7.787),c=BA*(c*c*c>.008856?c*c*c:(c-16/116)/7.787),f=u*3.2406+h*-1.5372+c*-.4986,g=u*-.9689+h*1.8758+c*.0415,m=u*.0557+h*-.204+c*1.057,f=f>.0031308?1.055*f**(1/2.4)-.055:12.92*f,g=g>.0031308?1.055*g**(1/2.4)-.055:12.92*g,m=m>.0031308?1.055*m**(1/2.4)-.055:12.92*m,n[s]=Math.max(0,Math.min(1,f))*255,n[s+1]=Math.max(0,Math.min(1,g))*255,n[s+2]=Math.max(0,Math.min(1,m))*255}return n}const jy=new Map;function yi(r,t){Array.isArray(r)||(r=[r]),r.forEach(e=>jy.set(e,t))}async function zy(r){const t=jy.get(r.Compression);if(!t)throw new Error(`Unknown compression method identifier: ${r.Compression}`);const e=await t();return new e(r)}yi([void 0,1],()=>jn(()=>import("./raw-CcGKjn8q-MKTGGSca.js"),__vite__mapDeps([0,1])).then(r=>r.default));yi(5,()=>jn(()=>import("./lzw-BOMhmEDy-CRQZVFv2.js"),__vite__mapDeps([2,1])).then(r=>r.default));yi(6,()=>{throw new Error("old style JPEG compression is not supported.")});yi(7,()=>jn(()=>import("./jpeg-DNfUpLwy-CrsOgAb-.js"),__vite__mapDeps([3,1])).then(r=>r.default));yi([8,32946],()=>jn(()=>import("./deflate-Be2Arps5-XLmgg930.js"),__vite__mapDeps([4,5,1])).then(r=>r.default));yi(32773,()=>jn(()=>import("./packbits-DaUD6MLm-DnF8Bj-8.js"),__vite__mapDeps([6,1])).then(r=>r.default));yi(34887,()=>jn(()=>import("./lerc-_E46UbWQ-CcZaAEsU.js"),__vite__mapDeps([7,5,1,8,9,10,11])).then(async r=>(await r.zstd.init(),r)).then(r=>r.default));yi(50001,()=>jn(()=>import("./webimage-D2c098k3-CiG7DZmh.js"),__vite__mapDeps([12,1])).then(r=>r.default));function Xh(r,t,e,n=1){return new(Object.getPrototypeOf(r)).constructor(t*e*n)}function WA(r,t,e,n,i){const s=t/n,o=e/i;return r.map(a=>{const l=Xh(a,n,i);for(let h=0;h<i;++h){const u=Math.min(Math.round(o*h),e-1);for(let c=0;c<n;++c){const f=Math.min(Math.round(s*c),t-1),g=a[u*t+f];l[h*n+c]=g}}return l})}function Ps(r,t,e){return(1-e)*r+e*t}function qA(r,t,e,n,i){const s=t/n,o=e/i;return r.map(a=>{const l=Xh(a,n,i);for(let h=0;h<i;++h){const u=o*h,c=Math.floor(u),f=Math.min(Math.ceil(u),e-1);for(let g=0;g<n;++g){const m=s*g,_=m%1,x=Math.floor(m),v=Math.min(Math.ceil(m),t-1),w=a[c*t+x],S=a[c*t+v],E=a[f*t+x],T=a[f*t+v],R=Ps(Ps(w,S,_),Ps(E,T,_),u%1);l[h*n+g]=R}}return l})}function ZA(r,t,e,n,i,s="nearest"){switch(s.toLowerCase()){case"nearest":return WA(r,t,e,n,i);case"bilinear":case"linear":return qA(r,t,e,n,i);default:throw new Error(`Unsupported resampling method: '${s}'`)}}function $A(r,t,e,n,i,s){const o=t/n,a=e/i,l=Xh(r,n,i,s);for(let h=0;h<i;++h){const u=Math.min(Math.round(a*h),e-1);for(let c=0;c<n;++c){const f=Math.min(Math.round(o*c),t-1);for(let g=0;g<s;++g){const m=r[u*t*s+f*s+g];l[h*n*s+c*s+g]=m}}}return l}function VA(r,t,e,n,i,s){const o=t/n,a=e/i,l=Xh(r,n,i,s);for(let h=0;h<i;++h){const u=a*h,c=Math.floor(u),f=Math.min(Math.ceil(u),e-1);for(let g=0;g<n;++g){const m=o*g,_=m%1,x=Math.floor(m),v=Math.min(Math.ceil(m),t-1);for(let w=0;w<s;++w){const S=r[c*t*s+x*s+w],E=r[c*t*s+v*s+w],T=r[f*t*s+x*s+w],R=r[f*t*s+v*s+w],C=Ps(Ps(S,E,_),Ps(T,R,_),u%1);l[h*n*s+g*s+w]=C}}}return l}function YA(r,t,e,n,i,s,o="nearest"){switch(o.toLowerCase()){case"nearest":return $A(r,t,e,n,i,s);case"bilinear":case"linear":return VA(r,t,e,n,i,s);default:throw new Error(`Unsupported resampling method: '${o}'`)}}function HA(r,t,e){let n=0;for(let i=t;i<e;++i)n+=r[i];return n}function wc(r,t,e){switch(r){case 1:if(t<=8)return new Uint8Array(e);if(t<=16)return new Uint16Array(e);if(t<=32)return new Uint32Array(e);break;case 2:if(t===8)return new Int8Array(e);if(t===16)return new Int16Array(e);if(t===32)return new Int32Array(e);break;case 3:switch(t){case 16:case 32:return new Float32Array(e);case 64:return new Float64Array(e)}break}throw Error("Unsupported data format/bitsPerSample")}function KA(r,t){return(r===1||r===2)&&t<=32&&t%8===0?!1:!(r===3&&(t===16||t===32||t===64))}function QA(r,t,e,n,i,s,o){const a=new DataView(r),l=e===2?o*s:o*s*n,h=e===2?1:n,u=wc(t,i,l),c=parseInt("1".repeat(i),2);if(t===1){let f;e===1?f=n*i:f=i;let g=s*f;g&7&&(g=g+7&-8);for(let m=0;m<o;++m){const _=m*g;for(let x=0;x<s;++x){const v=_+x*h*i;for(let w=0;w<h;++w){const S=v+w*i,E=(m*s+x)*h+w,T=Math.floor(S/8),R=S%8;if(R+i<=8)u[E]=a.getUint8(T)>>8-i-R&c;else if(R+i<=16)u[E]=a.getUint16(T)>>16-i-R&c;else if(R+i<=24){const C=a.getUint16(T)<<8|a.getUint8(T+2);u[E]=C>>24-i-R&c}else u[E]=a.getUint32(T)>>32-i-R&c}}}}return u.buffer}class Uy{constructor(t,e,n,i,s,o){this.fileDirectory=t,this.geoKeys=e,this.dataView=n,this.littleEndian=i,this.tiles=s?{}:null,this.isTiled=!t.StripOffsets;const a=t.PlanarConfiguration;if(this.planarConfiguration=typeof a>"u"?1:a,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=o}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(t){return this.isTiled||(t+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-t*this.getTileHeight()}getBytesPerPixel(){let t=0;for(let e=0;e<this.fileDirectory.BitsPerSample.length;++e)t+=this.getSampleByteSize(e);return t}getSampleByteSize(t){if(t>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${t} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[t]/8)}getReaderForSample(t){const e=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[t]:1,n=this.fileDirectory.BitsPerSample[t];switch(e){case 1:if(n<=8)return DataView.prototype.getUint8;if(n<=16)return DataView.prototype.getUint16;if(n<=32)return DataView.prototype.getUint32;break;case 2:if(n<=8)return DataView.prototype.getInt8;if(n<=16)return DataView.prototype.getInt16;if(n<=32)return DataView.prototype.getInt32;break;case 3:switch(n){case 16:return function(i,s){return Ly(this,i,s)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(t=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[t]:1}getBitsPerSample(t=0){return this.fileDirectory.BitsPerSample[t]}getArrayForSample(t,e){const n=this.getSampleFormat(t),i=this.getBitsPerSample(t);return wc(n,i,e)}async getTileOrStrip(t,e,n,i,s){const o=Math.ceil(this.getWidth()/this.getTileWidth()),a=Math.ceil(this.getHeight()/this.getTileHeight());let l;const{tiles:h}=this;this.planarConfiguration===1?l=e*o+t:this.planarConfiguration===2&&(l=n*o*a+e*o+t);let u,c;this.isTiled?(u=this.fileDirectory.TileOffsets[l],c=this.fileDirectory.TileByteCounts[l]):(u=this.fileDirectory.StripOffsets[l],c=this.fileDirectory.StripByteCounts[l]);const f=(await this.source.fetch([{offset:u,length:c}],s))[0];let g;return h===null||!h[l]?(g=(async()=>{let m=await i.decode(this.fileDirectory,f);const _=this.getSampleFormat(),x=this.getBitsPerSample();return KA(_,x)&&(m=QA(m,_,this.planarConfiguration,this.getSamplesPerPixel(),x,this.getTileWidth(),this.getBlockHeight(e))),m})(),h!==null&&(h[l]=g)):g=h[l],{x:t,y:e,sample:n,data:await g}}async _readRaster(t,e,n,i,s,o,a,l,h){const u=this.getTileWidth(),c=this.getTileHeight(),f=this.getWidth(),g=this.getHeight(),m=Math.max(Math.floor(t[0]/u),0),_=Math.min(Math.ceil(t[2]/u),Math.ceil(f/u)),x=Math.max(Math.floor(t[1]/c),0),v=Math.min(Math.ceil(t[3]/c),Math.ceil(g/c)),w=t[2]-t[0];let S=this.getBytesPerPixel();const E=[],T=[];for(let I=0;I<e.length;++I)this.planarConfiguration===1?E.push(HA(this.fileDirectory.BitsPerSample,0,e[I])/8):E.push(0),T.push(this.getReaderForSample(e[I]));const R=[],{littleEndian:C}=this;for(let I=x;I<v;++I)for(let F=m;F<_;++F){let U;this.planarConfiguration===1&&(U=this.getTileOrStrip(F,I,0,s,h));for(let j=0;j<e.length;++j){const B=j,d=e[j];this.planarConfiguration===2&&(S=this.getSampleByteSize(d),U=this.getTileOrStrip(F,I,d,s,h));const p=U.then(y=>{const b=y.data,M=new DataView(b),P=this.getBlockHeight(y.y),A=y.y*c,L=y.x*u,D=A+P,X=(y.x+1)*u,K=T[B],G=Math.min(P,P-(D-t[3]),g-A),H=Math.min(u,u-(X-t[2]),f-L);for(let Q=Math.max(0,t[1]-A);Q<G;++Q)for(let nt=Math.max(0,t[0]-L);nt<H;++nt){const xt=(Q*u+nt)*S,dt=K.call(M,xt+E[B],C);let Tt;i?(Tt=(Q+A-t[1])*w*e.length+(nt+L-t[0])*e.length+B,n[Tt]=dt):(Tt=(Q+A-t[1])*w+nt+L-t[0],n[B][Tt]=dt)}});R.push(p)}}if(await Promise.all(R),o&&t[2]-t[0]!==o||a&&t[3]-t[1]!==a){let I;return i?I=YA(n,t[2]-t[0],t[3]-t[1],o,a,e.length,l):I=ZA(n,t[2]-t[0],t[3]-t[1],o,a,l),I.width=o,I.height=a,I}return n.width=o||t[2]-t[0],n.height=a||t[3]-t[1],n}async readRasters({window:t,samples:e=[],interleave:n,pool:i=null,width:s,height:o,resampleMethod:a,fillValue:l,signal:h}={}){const u=t||[0,0,this.getWidth(),this.getHeight()];if(u[0]>u[2]||u[1]>u[3])throw new Error("Invalid subsets");const c=u[2]-u[0],f=u[3]-u[1],g=c*f,m=this.getSamplesPerPixel();if(!e||!e.length)for(let v=0;v<m;++v)e.push(v);else for(let v=0;v<e.length;++v)if(e[v]>=m)return Promise.reject(new RangeError(`Invalid sample index '${e[v]}'.`));let _;if(n){const v=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,w=Math.max.apply(null,this.fileDirectory.BitsPerSample);_=wc(v,w,g*e.length),l&&_.fill(l)}else{_=[];for(let v=0;v<e.length;++v){const w=this.getArrayForSample(e[v],g);Array.isArray(l)&&v<l.length?w.fill(l[v]):l&&!Array.isArray(l)&&w.fill(l),_.push(w)}}const x=i||await zy(this.fileDirectory);return await this._readRaster(u,e,_,n,x,s,o,a,h)}async readRGB({window:t,interleave:e=!0,pool:n=null,width:i,height:s,resampleMethod:o,enableAlpha:a=!1,signal:l}={}){const h=t||[0,0,this.getWidth(),this.getHeight()];if(h[0]>h[2]||h[1]>h[3])throw new Error("Invalid subsets");const u=this.fileDirectory.PhotometricInterpretation;if(u===Qe.RGB){let v=[0,1,2];if(this.fileDirectory.ExtraSamples!==OA.Unspecified&&a){v=[];for(let w=0;w<this.fileDirectory.BitsPerSample.length;w+=1)v.push(w)}return this.readRasters({window:t,interleave:e,samples:v,pool:n,width:i,height:s,resampleMethod:o,signal:l})}let c;switch(u){case Qe.WhiteIsZero:case Qe.BlackIsZero:case Qe.Palette:c=[0];break;case Qe.CMYK:c=[0,1,2,3];break;case Qe.YCbCr:case Qe.CIELab:c=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const f={window:h,interleave:!0,samples:c,pool:n,width:i,height:s,resampleMethod:o,signal:l},{fileDirectory:g}=this,m=await this.readRasters(f),_=2**this.fileDirectory.BitsPerSample[0];let x;switch(u){case Qe.WhiteIsZero:x=NA(m,_);break;case Qe.BlackIsZero:x=DA(m,_);break;case Qe.Palette:x=kA(m,g.ColorMap);break;case Qe.CMYK:x=GA(m);break;case Qe.YCbCr:x=jA(m);break;case Qe.CIELab:x=XA(m);break;default:throw new Error("Unsupported photometric interpretation.")}if(!e){const v=new Uint8Array(x.length/3),w=new Uint8Array(x.length/3),S=new Uint8Array(x.length/3);for(let E=0,T=0;E<x.length;E+=3,++T)v[T]=x[E],w[T]=x[E+1],S[T]=x[E+2];x=[v,w,S]}return x.width=m.width,x.height=m.height,x}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const t=[];for(let e=0;e<this.fileDirectory.ModelTiepoint.length;e+=6)t.push({i:this.fileDirectory.ModelTiepoint[e],j:this.fileDirectory.ModelTiepoint[e+1],k:this.fileDirectory.ModelTiepoint[e+2],x:this.fileDirectory.ModelTiepoint[e+3],y:this.fileDirectory.ModelTiepoint[e+4],z:this.fileDirectory.ModelTiepoint[e+5]});return t}getGDALMetadata(t=null){const e={};if(!this.fileDirectory.GDAL_METADATA)return null;const n=this.fileDirectory.GDAL_METADATA;let i=AA(n,"Item");t===null?i=i.filter(s=>Lu(s,"sample")===void 0):i=i.filter(s=>Number(Lu(s,"sample"))===t);for(let s=0;s<i.length;++s){const o=i[s];e[Lu(o,"name")]=o.inner}return e}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const t=this.fileDirectory.GDAL_NODATA;return Number(t.substring(0,t.length-1))}getOrigin(){const t=this.fileDirectory.ModelTiepoint,e=this.fileDirectory.ModelTransformation;if(t&&t.length===6)return[t[3],t[4],t[5]];if(e)return[e[3],e[7],e[11]];throw new Error("The image does not have an affine transformation.")}getResolution(t=null){const e=this.fileDirectory.ModelPixelScale,n=this.fileDirectory.ModelTransformation;if(e)return[e[0],-e[1],e[2]];if(n)return[n[0],-n[5],n[10]];if(t){const[i,s,o]=t.getResolution();return[i*t.getWidth()/this.getWidth(),s*t.getHeight()/this.getHeight(),o*t.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(){const t=this.getHeight(),e=this.getWidth();if(this.fileDirectory.ModelTransformation){const[n,i,s,o,a,l,h,u]=this.fileDirectory.ModelTransformation,c=[[0,0],[0,t],[e,0],[e,t]].map(([m,_])=>[o+n*m+i*_,u+a*m+l*_]),f=c.map(m=>m[0]),g=c.map(m=>m[1]);return[Math.min(...f),Math.min(...g),Math.max(...f),Math.max(...g)]}else{const n=this.getOrigin(),i=this.getResolution(),s=n[0],o=n[1],a=s+i[0]*this.getWidth(),l=o+i[1]*this.getHeight();return[Math.min(s,a),Math.min(o,l),Math.max(s,a),Math.max(o,l)]}}}class JA{constructor(t){this._dataView=new DataView(t)}get buffer(){return this._dataView.buffer}getUint64(t,e){const n=this.getUint32(t,e),i=this.getUint32(t+4,e);let s;if(e){if(s=n+2**32*i,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}if(s=2**32*n+i,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}getInt64(t,e){let n=0;const i=(this._dataView.getUint8(t+(e?7:0))&128)>0;let s=!0;for(let o=0;o<8;o++){let a=this._dataView.getUint8(t+(e?o:7-o));i&&(s?a!==0&&(a=~(a-1)&255,s=!1):a=~a&255),n+=a*256**o}return i&&(n=-n),n}getUint8(t,e){return this._dataView.getUint8(t,e)}getInt8(t,e){return this._dataView.getInt8(t,e)}getUint16(t,e){return this._dataView.getUint16(t,e)}getInt16(t,e){return this._dataView.getInt16(t,e)}getUint32(t,e){return this._dataView.getUint32(t,e)}getInt32(t,e){return this._dataView.getInt32(t,e)}getFloat16(t,e){return Ly(this._dataView,t,e)}getFloat32(t,e){return this._dataView.getFloat32(t,e)}getFloat64(t,e){return this._dataView.getFloat64(t,e)}}class tL{constructor(t,e,n,i){this._dataView=new DataView(t),this._sliceOffset=e,this._littleEndian=n,this._bigTiff=i}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(t,e){return this.sliceOffset<=t&&this.sliceTop>=t+e}readUint8(t){return this._dataView.getUint8(t-this._sliceOffset,this._littleEndian)}readInt8(t){return this._dataView.getInt8(t-this._sliceOffset,this._littleEndian)}readUint16(t){return this._dataView.getUint16(t-this._sliceOffset,this._littleEndian)}readInt16(t){return this._dataView.getInt16(t-this._sliceOffset,this._littleEndian)}readUint32(t){return this._dataView.getUint32(t-this._sliceOffset,this._littleEndian)}readInt32(t){return this._dataView.getInt32(t-this._sliceOffset,this._littleEndian)}readFloat32(t){return this._dataView.getFloat32(t-this._sliceOffset,this._littleEndian)}readFloat64(t){return this._dataView.getFloat64(t-this._sliceOffset,this._littleEndian)}readUint64(t){const e=this.readUint32(t),n=this.readUint32(t+4);let i;if(this._littleEndian){if(i=e+2**32*n,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}if(i=2**32*e+n,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}readInt64(t){let e=0;const n=(this._dataView.getUint8(t+(this._littleEndian?7:0))&128)>0;let i=!0;for(let s=0;s<8;s++){let o=this._dataView.getUint8(t+(this._littleEndian?s:7-s));n&&(i?o!==0&&(o=~(o-1)&255,i=!1):o=~o&255),e+=o*256**s}return n&&(e=-e),e}readOffset(t){return this._bigTiff?this.readUint64(t):this.readUint32(t)}}const eL=typeof navigator<"u"&&navigator.hardwareConcurrency||2;class rL{constructor(t=eL,e){this.workers=null,this._awaitingDecoder=null,this.size=t,this.messageId=0,t&&(this._awaitingDecoder=e?Promise.resolve(e):new Promise(n=>{jn(()=>import("./decoder-HRvnjnEI-BkmEI0my.js"),__vite__mapDeps([13,8,9,10,11])).then(i=>{n(i.create)})}),this._awaitingDecoder.then(n=>{this._awaitingDecoder=null,this.workers=[];for(let i=0;i<t;i++)this.workers.push({worker:n(),idle:!0})}))}async decode(t,e){return this._awaitingDecoder&&await this._awaitingDecoder,this.size===0?zy(t).then(n=>n.decode(t,e)):new Promise(n=>{const i=this.workers.find(a=>a.idle)||this.workers[Math.floor(Math.random()*this.size)];i.idle=!1;const s=this.messageId++,o=a=>{a.data.id===s&&(i.idle=!0,n(a.data.decoded),i.worker.removeEventListener("message",o))};i.worker.addEventListener("message",o),i.worker.postMessage({fileDirectory:t,buffer:e,id:s},[e])})}destroy(){this.workers&&(this.workers.forEach(t=>{t.worker.terminate()}),this.workers=null)}}const Vp=`\r
\r
`;function By(r){if(typeof Object.fromEntries<"u")return Object.fromEntries(r);const t={};for(const[e,n]of r)t[e.toLowerCase()]=n;return t}function nL(r){const t=r.split(`\r
`).map(e=>{const n=e.split(":").map(i=>i.trim());return n[0]=n[0].toLowerCase(),n});return By(t)}function iL(r){const[t,...e]=r.split(";").map(i=>i.trim()),n=e.map(i=>i.split("="));return{type:t,params:By(n)}}function bc(r){let t,e,n;return r&&([,t,e,n]=r.match(/bytes (\d+)-(\d+)\/(\d+)/),t=parseInt(t,10),e=parseInt(e,10),n=parseInt(n,10)),{start:t,end:e,total:n}}function sL(r,t){let e=null;const n=new TextDecoder("ascii"),i=[],s=`--${t}`,o=`${s}--`;for(let a=0;a<10;++a)n.decode(new Uint8Array(r,a,s.length))===s&&(e=a);if(e===null)throw new Error("Could not find initial boundary");for(;e<r.byteLength;){const a=n.decode(new Uint8Array(r,e,Math.min(s.length+1024,r.byteLength-e)));if(a.length===0||a.startsWith(o))break;if(!a.startsWith(s))throw new Error("Part does not start with boundary");const l=a.substr(s.length+2);if(l.length===0)break;const h=l.indexOf(Vp),u=nL(l.substr(0,h)),{start:c,end:f,total:g}=bc(u["content-range"]),m=e+s.length+h+Vp.length,_=parseInt(f,10)+1-parseInt(c,10);i.push({headers:u,data:r.slice(m,m+_),offset:c,length:_,fileSize:g}),e=m+_+4}return i}class bf{async fetch(t,e=void 0){return Promise.all(t.map(n=>this.fetchSlice(n,e)))}async fetchSlice(t){throw new Error(`fetching of slice ${t} not possible, not implemented`)}get fileSize(){return null}async close(){}}class oL extends Map{constructor(t={}){if(super(),!(t.maxSize&&t.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof t.maxAge=="number"&&t.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=t.maxSize,this.maxAge=t.maxAge||Number.POSITIVE_INFINITY,this.onEviction=t.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(t){if(typeof this.onEviction=="function")for(const[e,n]of t)this.onEviction(e,n.value)}_deleteIfExpired(t,e){return typeof e.expiry=="number"&&e.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(t,e.value),this.delete(t)):!1}_getOrDeleteIfExpired(t,e){if(this._deleteIfExpired(t,e)===!1)return e.value}_getItemValue(t,e){return e.expiry?this._getOrDeleteIfExpired(t,e):e.value}_peek(t,e){const n=e.get(t);return this._getItemValue(t,n)}_set(t,e){this.cache.set(t,e),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(t,e){this.oldCache.delete(t),this._set(t,e)}*_entriesAscending(){for(const t of this.oldCache){const[e,n]=t;this.cache.has(e)||this._deleteIfExpired(e,n)===!1&&(yield t)}for(const t of this.cache){const[e,n]=t;this._deleteIfExpired(e,n)===!1&&(yield t)}}get(t){if(this.cache.has(t)){const e=this.cache.get(t);return this._getItemValue(t,e)}if(this.oldCache.has(t)){const e=this.oldCache.get(t);if(this._deleteIfExpired(t,e)===!1)return this._moveToRecent(t,e),e.value}}set(t,e,{maxAge:n=this.maxAge}={}){const i=typeof n=="number"&&n!==Number.POSITIVE_INFINITY?Date.now()+n:void 0;return this.cache.has(t)?this.cache.set(t,{value:e,expiry:i}):this._set(t,{value:e,expiry:i}),this}has(t){return this.cache.has(t)?!this._deleteIfExpired(t,this.cache.get(t)):this.oldCache.has(t)?!this._deleteIfExpired(t,this.oldCache.get(t)):!1}peek(t){if(this.cache.has(t))return this._peek(t,this.cache);if(this.oldCache.has(t))return this._peek(t,this.oldCache)}delete(t){const e=this.cache.delete(t);return e&&this._size--,this.oldCache.delete(t)||e}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(t){if(!(t&&t>0))throw new TypeError("`maxSize` must be a number greater than 0");const e=[...this._entriesAscending()],n=e.length-t;n<0?(this.cache=new Map(e),this.oldCache=new Map,this._size=e.length):(n>0&&this._emitEvictions(e.slice(0,n)),this.oldCache=new Map(e.slice(n)),this.cache=new Map,this._size=0),this.maxSize=t}*keys(){for(const[t]of this)yield t}*values(){for(const[,t]of this)yield t}*[Symbol.iterator](){for(const t of this.cache){const[e,n]=t;this._deleteIfExpired(e,n)===!1&&(yield[e,n.value])}for(const t of this.oldCache){const[e,n]=t;this.cache.has(e)||this._deleteIfExpired(e,n)===!1&&(yield[e,n.value])}}*entriesDescending(){let t=[...this.cache];for(let e=t.length-1;e>=0;--e){const n=t[e],[i,s]=n;this._deleteIfExpired(i,s)===!1&&(yield[i,s.value])}t=[...this.oldCache];for(let e=t.length-1;e>=0;--e){const n=t[e],[i,s]=n;this.cache.has(i)||this._deleteIfExpired(i,s)===!1&&(yield[i,s.value])}}*entriesAscending(){for(const[t,e]of this._entriesAscending())yield[t,e.value]}get size(){if(!this._size)return this.oldCache.size;let t=0;for(const e of this.oldCache.keys())this.cache.has(e)||t++;return Math.min(this._size+t,this.maxSize)}entries(){return this.entriesAscending()}forEach(t,e=this){for(const[n,i]of this.entriesAscending())t.call(e,i,n,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}async function aL(r){return new Promise(t=>setTimeout(t,r))}function lL(r,t){const e=Array.isArray(r)?r:Array.from(r),n=Array.isArray(t)?t:Array.from(t);return e.map((i,s)=>[i,n[s]])}class Bs extends Error{constructor(t){super(t),Error.captureStackTrace&&Error.captureStackTrace(this,Bs),this.name="AbortError"}}class hL extends Error{constructor(t,e){super(e),this.errors=t,this.message=e,this.name="AggregateError"}}const uL=hL;class cL{constructor(t,e,n=null){this.offset=t,this.length=e,this.data=n}get top(){return this.offset+this.length}}class Yp{constructor(t,e,n){this.offset=t,this.length=e,this.blockIds=n}}class dL extends bf{constructor(t,{blockSize:e=65536,cacheSize:n=100}={}){super(),this.source=t,this.blockSize=e,this.blockCache=new oL({maxSize:n,onEviction:(i,s)=>{this.evictedBlocks.set(i,s)}}),this.evictedBlocks=new Map,this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(t,e){const n=[],i=[],s=[];this.evictedBlocks.clear();for(const{offset:f,length:g}of t){let m=f+g;const{fileSize:_}=this;_!==null&&(m=Math.min(m,_));const x=Math.floor(f/this.blockSize)*this.blockSize;for(let v=x;v<m;v+=this.blockSize){const w=Math.floor(v/this.blockSize);!this.blockCache.has(w)&&!this.blockRequests.has(w)&&(this.blockIdsToFetch.add(w),i.push(w)),this.blockRequests.has(w)&&n.push(this.blockRequests.get(w)),s.push(w)}}await aL(),this.fetchBlocks(e);const o=[];for(const f of i)this.blockRequests.has(f)&&o.push(this.blockRequests.get(f));await Promise.allSettled(n),await Promise.allSettled(o);const a=[],l=s.filter(f=>this.abortedBlockIds.has(f)||!this.blockCache.has(f));if(l.forEach(f=>this.blockIdsToFetch.add(f)),l.length>0&&e&&!e.aborted){this.fetchBlocks(null);for(const f of l){const g=this.blockRequests.get(f);if(!g)throw new Error(`Block ${f} is not in the block requests`);a.push(g)}await Promise.allSettled(a)}if(e&&e.aborted)throw new Bs("Request was aborted");const h=s.map(f=>this.blockCache.get(f)||this.evictedBlocks.get(f)),u=h.filter(f=>!f);if(u.length)throw new uL(u,"Request failed");const c=new Map(lL(s,h));return this.readSliceData(t,c)}fetchBlocks(t){if(this.blockIdsToFetch.size>0){const e=this.groupBlocks(this.blockIdsToFetch),n=this.source.fetch(e,t);for(let i=0;i<e.length;++i){const s=e[i];for(const o of s.blockIds)this.blockRequests.set(o,(async()=>{try{const a=(await n)[i],l=o*this.blockSize,h=l-a.offset,u=Math.min(h+this.blockSize,a.data.byteLength),c=a.data.slice(h,u),f=new cL(l,c.byteLength,c,o);this.blockCache.set(o,f),this.abortedBlockIds.delete(o)}catch(a){if(a.name==="AbortError")a.signal=t,this.blockCache.delete(o),this.abortedBlockIds.add(o);else throw a}finally{this.blockRequests.delete(o)}})())}this.blockIdsToFetch.clear()}}groupBlocks(t){const e=Array.from(t).sort((o,a)=>o-a);if(e.length===0)return[];let n=[],i=null;const s=[];for(const o of e)i===null||i+1===o?(n.push(o),i=o):(s.push(new Yp(n[0]*this.blockSize,n.length*this.blockSize,n)),n=[o],i=o);return s.push(new Yp(n[0]*this.blockSize,n.length*this.blockSize,n)),s}readSliceData(t,e){return t.map(n=>{let i=n.offset+n.length;this.fileSize!==null&&(i=Math.min(this.fileSize,i));const s=Math.floor(n.offset/this.blockSize),o=Math.floor(i/this.blockSize),a=new ArrayBuffer(n.length),l=new Uint8Array(a);for(let h=s;h<=o;++h){const u=e.get(h),c=u.offset-n.offset,f=u.top-i;let g=0,m=0,_;c<0?g=-c:c>0&&(m=c),f<0?_=u.length-g:_=i-u.offset-g;const x=new Uint8Array(u.data,g,_);l.set(x,m)}return a})}}class Sf{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(t){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}class Ef{constructor(t){this.url=t}async request({headers:t,credentials:e,signal:n}={}){throw new Error("request is not implemented")}}class fL extends Sf{constructor(t){super(),this.response=t}get status(){return this.response.status}getHeader(t){return this.response.headers.get(t)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class gL extends Ef{constructor(t,e){super(t),this.credentials=e}async request({headers:t,credentials:e,signal:n}={}){const i=await fetch(this.url,{headers:t,credentials:e,signal:n});return new fL(i)}}class pL extends Sf{constructor(t,e){super(),this.xhr=t,this.data=e}get status(){return this.xhr.status}getHeader(t){return this.xhr.getResponseHeader(t)}async getData(){return this.data}}class mL extends Ef{constructRequest(t,e){return new Promise((n,i)=>{const s=new XMLHttpRequest;s.open("GET",this.url),s.responseType="arraybuffer";for(const[o,a]of Object.entries(t))s.setRequestHeader(o,a);s.onload=()=>{const o=s.response;n(new pL(s,o))},s.onerror=i,s.onabort=()=>i(new Bs("Request aborted")),s.send(),e&&(e.aborted&&s.abort(),e.addEventListener("abort",()=>s.abort()))})}async request({headers:t,signal:e}={}){return await this.constructRequest(t,e)}}const Hp={};class _L extends Sf{constructor(t,e){super(),this.response=t,this.dataPromise=e}get status(){return this.response.statusCode}getHeader(t){return this.response.headers[t]}async getData(){return await this.dataPromise}}class yL extends Ef{constructor(t){super(t),this.parsedUrl=Hp.parse(this.url),this.httpApi=(this.parsedUrl.protocol,Hp)}constructRequest(t,e){return new Promise((n,i)=>{const s=this.httpApi.get({...this.parsedUrl,headers:t},o=>{const a=new Promise(l=>{const h=[];o.on("data",u=>{h.push(u)}),o.on("end",()=>{const u=Buffer.concat(h).buffer;l(u)}),o.on("error",i)});n(new _L(o,a))});s.on("error",i),e&&(e.aborted&&s.destroy(new Bs("Request aborted")),e.addEventListener("abort",()=>s.destroy(new Bs("Request aborted"))))})}async request({headers:t,signal:e}={}){return await this.constructRequest(t,e)}}class Tf extends bf{constructor(t,e,n,i){super(),this.client=t,this.headers=e,this.maxRanges=n,this.allowFullFile=i,this._fileSize=null}async fetch(t,e){return this.maxRanges>=t.length?this.fetchSlices(t,e):(this.maxRanges>0&&t.length>1,Promise.all(t.map(n=>this.fetchSlice(n,e))))}async fetchSlices(t,e){const n=await this.client.request({headers:{...this.headers,Range:`bytes=${t.map(({offset:i,length:s})=>`${i}-${i+s}`).join(",")}`},signal:e});if(n.ok)if(n.status===206){const{type:i,params:s}=iL(n.getHeader("content-type"));if(i==="multipart/byteranges"){const c=sL(await n.getData(),s.boundary);return this._fileSize=c[0].fileSize||null,c}const o=await n.getData(),{start:a,end:l,total:h}=bc(n.getHeader("content-range"));this._fileSize=h||null;const u=[{data:o,offset:a,length:l-a}];if(t.length>1){const c=await Promise.all(t.slice(1).map(f=>this.fetchSlice(f,e)));return u.concat(c)}return u}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const i=await n.getData();return this._fileSize=i.byteLength,[{data:i,offset:0,length:i.byteLength}]}else throw new Error("Error fetching data.")}async fetchSlice(t,e){const{offset:n,length:i}=t,s=await this.client.request({headers:{...this.headers,Range:`bytes=${n}-${n+i}`},signal:e});if(s.ok)if(s.status===206){const o=await s.getData(),{total:a}=bc(s.getHeader("content-range"));return this._fileSize=a||null,{data:o,offset:n,length:i}}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const o=await s.getData();return this._fileSize=o.byteLength,{data:o,offset:0,length:o.byteLength}}else throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function Mf(r,{blockSize:t,cacheSize:e}){return t===null?r:new dL(r,{blockSize:t,cacheSize:e})}function xL(r,{headers:t={},credentials:e,maxRanges:n=0,allowFullFile:i=!1,...s}={}){const o=new gL(r,e),a=new Tf(o,t,n,i);return Mf(a,s)}function vL(r,{headers:t={},maxRanges:e=0,allowFullFile:n=!1,...i}={}){const s=new mL(r),o=new Tf(s,t,e,n);return Mf(o,i)}function wL(r,{headers:t={},maxRanges:e=0,allowFullFile:n=!1,...i}={}){const s=new yL(r),o=new Tf(s,t,e,n);return Mf(o,i)}function Sc(r,{forceXHR:t=!1,...e}={}){return typeof fetch=="function"&&!t?xL(r,e):typeof XMLHttpRequest<"u"?vL(r,e):wL(r,e)}class bL extends bf{constructor(t){super(),this.file=t}async fetchSlice(t,e){return new Promise((n,i)=>{const s=this.file.slice(t.offset,t.offset+t.length),o=new FileReader;o.onload=a=>n(a.target.result),o.onerror=i,o.onabort=i,o.readAsArrayBuffer(s),e&&e.addEventListener("abort",()=>o.abort())})}}function SL(r){return new bL(r)}function Ec(r){switch(r){case Mt.BYTE:case Mt.ASCII:case Mt.SBYTE:case Mt.UNDEFINED:return 1;case Mt.SHORT:case Mt.SSHORT:return 2;case Mt.LONG:case Mt.SLONG:case Mt.FLOAT:case Mt.IFD:return 4;case Mt.RATIONAL:case Mt.SRATIONAL:case Mt.DOUBLE:case Mt.LONG8:case Mt.SLONG8:case Mt.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${r}`)}}function EL(r){const t=r.GeoKeyDirectory;if(!t)return null;const e={};for(let n=4;n<=t[3]*4;n+=4){const i=FA[t[n]],s=t[n+1]?zo[t[n+1]]:null,o=t[n+2],a=t[n+3];let l=null;if(!s)l=a;else{if(l=r[s],typeof l>"u"||l===null)throw new Error(`Could not get value of geoKey '${i}'.`);typeof l=="string"?l=l.substring(a,a+o-1):l.subarray&&(l=l.subarray(a,a+o),o===1&&(l=l[0]))}e[i]=l}return e}function hs(r,t,e,n){let i=null,s=null;const o=Ec(t);switch(t){case Mt.BYTE:case Mt.ASCII:case Mt.UNDEFINED:i=new Uint8Array(e),s=r.readUint8;break;case Mt.SBYTE:i=new Int8Array(e),s=r.readInt8;break;case Mt.SHORT:i=new Uint16Array(e),s=r.readUint16;break;case Mt.SSHORT:i=new Int16Array(e),s=r.readInt16;break;case Mt.LONG:case Mt.IFD:i=new Uint32Array(e),s=r.readUint32;break;case Mt.SLONG:i=new Int32Array(e),s=r.readInt32;break;case Mt.LONG8:case Mt.IFD8:i=new Array(e),s=r.readUint64;break;case Mt.SLONG8:i=new Array(e),s=r.readInt64;break;case Mt.RATIONAL:i=new Uint32Array(e*2),s=r.readUint32;break;case Mt.SRATIONAL:i=new Int32Array(e*2),s=r.readInt32;break;case Mt.FLOAT:i=new Float32Array(e),s=r.readFloat32;break;case Mt.DOUBLE:i=new Float64Array(e),s=r.readFloat64;break;default:throw new RangeError(`Invalid field type: ${t}`)}if(t===Mt.RATIONAL||t===Mt.SRATIONAL)for(let a=0;a<e;a+=2)i[a]=s.call(r,n+a*o),i[a+1]=s.call(r,n+(a*o+4));else for(let a=0;a<e;++a)i[a]=s.call(r,n+a*o);return t===Mt.ASCII?new TextDecoder("utf-8").decode(i):i}class TL{constructor(t,e,n){this.fileDirectory=t,this.geoKeyDirectory=e,this.nextIFDByteOffset=n}}class hl extends Error{constructor(t){super(`No image at index ${t}`),this.index=t}}class Xy{async readRasters(t={}){const{window:e,width:n,height:i}=t;let{resX:s,resY:o,bbox:a}=t;const l=await this.getImage();let h=l;const u=await this.getImageCount(),c=l.getBoundingBox();if(e&&a)throw new Error('Both "bbox" and "window" passed.');if(n||i){if(e){const[m,_]=l.getOrigin(),[x,v]=l.getResolution();a=[m+e[0]*x,_+e[1]*v,m+e[2]*x,_+e[3]*v]}const g=a||c;if(n){if(s)throw new Error("Both width and resX passed");s=(g[2]-g[0])/n}if(i){if(o)throw new Error("Both width and resY passed");o=(g[3]-g[1])/i}}if(s||o){const g=[];for(let m=0;m<u;++m){const _=await this.getImage(m),{SubfileType:x,NewSubfileType:v}=_.fileDirectory;(m===0||x===2||v&1)&&g.push(_)}g.sort((m,_)=>m.getWidth()-_.getWidth());for(let m=0;m<g.length;++m){const _=g[m],x=(c[2]-c[0])/_.getWidth(),v=(c[3]-c[1])/_.getHeight();if(h=_,s&&s>x||o&&o>v)break}}let f=e;if(a){const[g,m]=l.getOrigin(),[_,x]=h.getResolution(l);f=[Math.round((a[0]-g)/_),Math.round((a[1]-m)/x),Math.round((a[2]-g)/_),Math.round((a[3]-m)/x)],f=[Math.min(f[0],f[2]),Math.min(f[1],f[3]),Math.max(f[0],f[2]),Math.max(f[1],f[3])]}return h.readRasters({...t,window:f})}}class Xs extends Xy{constructor(t,e,n,i,s={}){super(),this.source=t,this.littleEndian=e,this.bigTiff=n,this.firstIFDOffset=i,this.cache=s.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(t,e){const n=this.bigTiff?4048:1024;return new tL((await this.source.fetch([{offset:t,length:typeof e<"u"?e:n}]))[0],t,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(t){const e=this.bigTiff?20:12,n=this.bigTiff?8:2;let i=await this.getSlice(t);const s=this.bigTiff?i.readUint64(t):i.readUint16(t),o=s*e+(this.bigTiff?16:6);i.covers(t,o)||(i=await this.getSlice(t,o));const a={};let l=t+(this.bigTiff?8:2);for(let c=0;c<s;l+=e,++c){const f=i.readUint16(l),g=i.readUint16(l+2),m=this.bigTiff?i.readUint64(l+4):i.readUint32(l+4);let _,x;const v=Ec(g),w=l+(this.bigTiff?12:8);if(v*m<=(this.bigTiff?8:4))_=hs(i,g,m,w);else{const S=i.readOffset(w),E=Ec(g)*m;if(i.covers(S,E))_=hs(i,g,m,S);else{const T=await this.getSlice(S,E);_=hs(T,g,m,S)}}m===1&&LA.indexOf(f)===-1&&!(g===Mt.RATIONAL||g===Mt.SRATIONAL)?x=_[0]:x=_,a[zo[f]]=x}const h=EL(a),u=i.readOffset(t+n+e*s);return new TL(a,h,u)}async requestIFD(t){if(this.ifdRequests[t])return this.ifdRequests[t];if(t===0)return this.ifdRequests[t]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[t];if(!this.ifdRequests[t-1])try{this.ifdRequests[t-1]=this.requestIFD(t-1)}catch(e){throw e instanceof hl?new hl(t):e}return this.ifdRequests[t]=(async()=>{const e=await this.ifdRequests[t-1];if(e.nextIFDByteOffset===0)throw new hl(t);return this.parseFileDirectoryAt(e.nextIFDByteOffset)})(),this.ifdRequests[t]}async getImage(t=0){const e=await this.requestIFD(t);return new Uy(e.fileDirectory,e.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let t=0,e=!0;for(;e;)try{await this.requestIFD(t),++t}catch(n){if(n instanceof hl)e=!1;else throw n}return t}async getGhostValues(){const t=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const e="GDAL_STRUCTURAL_METADATA_SIZE=",n=e.length+100;let i=await this.getSlice(t,n);if(e===hs(i,Mt.ASCII,e.length,t)){const s=hs(i,Mt.ASCII,n,t).split(`
`)[0],o=Number(s.split("=")[1].split(" ")[0])+s.length;o>n&&(i=await this.getSlice(t,o));const a=hs(i,Mt.ASCII,o,t);this.ghostValues={},a.split(`
`).filter(l=>l.length>0).map(l=>l.split("=")).forEach(([l,h])=>{this.ghostValues[l]=h})}return this.ghostValues}static async fromSource(t,e,n){const i=(await t.fetch([{offset:0,length:1024}],n))[0],s=new JA(i),o=s.getUint16(0,0);let a;if(o===18761)a=!0;else if(o===19789)a=!1;else throw new TypeError("Invalid byte order value.");const l=s.getUint16(2,a);let h;if(l===42)h=!1;else if(l===43){if(h=!0,s.getUint16(4,a)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const u=h?s.getUint64(8,a):s.getUint32(4,a);return new Xs(t,a,h,u,e)}close(){return typeof this.source.close=="function"?this.source.close():!1}}class ML extends Xy{constructor(t,e){super(),this.mainFile=t,this.overviewFiles=e,this.imageFiles=[t].concat(e),this.fileDirectoriesPerFile=null,this.fileDirectoriesPerFileParsing=null,this.imageCount=null}async parseFileDirectoriesPerFile(){const t=[this.mainFile.parseFileDirectoryAt(this.mainFile.firstIFDOffset)].concat(this.overviewFiles.map(e=>e.parseFileDirectoryAt(e.firstIFDOffset)));return this.fileDirectoriesPerFile=await Promise.all(t),this.fileDirectoriesPerFile}async getImage(t=0){await this.getImageCount(),await this.parseFileDirectoriesPerFile();let e=0,n=0;for(let i=0;i<this.imageFiles.length;i++){const s=this.imageFiles[i];for(let o=0;o<this.imageCounts[i];o++){if(t===e){const a=await s.requestIFD(n);return new Uy(a.fileDirectory,a.geoKeyDirectory,s.dataView,s.littleEndian,s.cache,s.source)}e++,n++}n=0}throw new RangeError("Invalid image index")}async getImageCount(){if(this.imageCount!==null)return this.imageCount;const t=[this.mainFile.getImageCount()].concat(this.overviewFiles.map(e=>e.getImageCount()));return this.imageCounts=await Promise.all(t),this.imageCount=this.imageCounts.reduce((e,n)=>e+n,0),this.imageCount}}async function RL(r,t={},e){return Xs.fromSource(Sc(r,t),e)}async function CL(r,t){return Xs.fromSource(SL(r),t)}async function IL(r,t=[],e={},n){const i=await Xs.fromSource(Sc(r,e),n),s=await Promise.all(t.map(o=>Xs.fromSource(Sc(o,e))));return new ML(i,s)}function PL(r){return((r.fileDirectory.NewSubfileType||0)&4)===4}function AL(r,t){if(!r)return!1;if(r===!0)return!0;if(t.getSamplesPerPixel()!==3)return!1;const e=t.fileDirectory.PhotometricInterpretation,n=Qe;return e===n.CMYK||e===n.YCbCr||e===n.CIELab||e===n.ICCLab}const Kp="STATISTICS_MAXIMUM",Qp="STATISTICS_MINIMUM",Nu=256;let Du;function LL(){return Du||(Du=new rL),Du}function OL(r){try{return r.getBoundingBox()}catch{return[0,0,r.getWidth(),r.getHeight()]}}function FL(r){try{return r.getOrigin().slice(0,2)}catch{return[0,r.getHeight()]}}function NL(r,t){try{return r.getResolution(t)}catch{return[t.getWidth()/r.getWidth(),t.getHeight()/r.getHeight()]}}function DL(r){const t=r.geoKeys;if(!t)return null;if(t.ProjectedCSTypeGeoKey&&t.ProjectedCSTypeGeoKey!==32767){const e="EPSG:"+t.ProjectedCSTypeGeoKey;let n=tt(e);if(!n){const i=og(t.ProjLinearUnitsGeoKey);i&&(n=new Ns({code:e,units:i}))}return n}if(t.GeographicTypeGeoKey&&t.GeographicTypeGeoKey!==32767){const e="EPSG:"+t.GeographicTypeGeoKey;let n=tt(e);if(!n){const i=og(t.GeogAngularUnitsGeoKey);i&&(n=new Ns({code:e,units:i}))}return n}return null}function kL(r){return r.getImageCount().then(function(t){const e=new Array(t);for(let n=0;n<t;++n)e[n]=r.getImage(n);return Promise.all(e)})}function GL(r,t){let e;return r.blob?e=CL(r.blob):r.overviews?e=IL(r.url,r.overviews,t):e=RL(r.url,t),e.then(kL)}function To(r,t,e,n,i){if(Array.isArray(r)){const s=r.length;if(!Array.isArray(t)||s!=t.length){const o=new Error(n);throw i(o),o}for(let o=0;o<s;++o)To(r[o],t[o],e,n,i);return}if(t=t,Math.abs(r-t)>e*r)throw new Error(n)}function jL(r){return r instanceof Int8Array?-128:r instanceof Int16Array?-32768:r instanceof Int32Array?-2147483648:r instanceof Float32Array?12e-39:0}function zL(r){return r instanceof Int8Array?127:r instanceof Uint8Array||r instanceof Uint8ClampedArray?255:r instanceof Int16Array?32767:r instanceof Uint16Array?65535:r instanceof Int32Array?2147483647:r instanceof Uint32Array?4294967295:r instanceof Float32Array?34e37:255}class Rf extends uf{constructor(t){super({state:"loading",tileGrid:null,projection:t.projection||null,opaque:t.opaque,transition:t.transition,interpolate:t.interpolate!==!1,wrapX:t.wrapX}),this.sourceInfo_=t.sources;const e=this.sourceInfo_.length;this.sourceOptions_=t.sourceOptions,this.sourceImagery_=new Array(e),this.sourceMasks_=new Array(e),this.resolutionFactors_=new Array(e),this.samplesPerPixel_,this.nodataValues_,this.metadata_,this.normalize_=t.normalize!==!1,this.addAlpha_=!1,this.error_=null,this.convertToRGB_=t.convertToRGB||!1,this.setKey(this.sourceInfo_.map(s=>s.url).join(","));const n=this,i=new Array(e);for(let s=0;s<e;++s)i[s]=GL(this.sourceInfo_[s],this.sourceOptions_);Promise.all(i).then(function(s){n.configure_(s)}).catch(function(s){El(s),n.error_=s,n.setState("error")})}getError(){return this.error_}determineProjection(t){const e=t[0];for(let n=e.length-1;n>=0;--n){const i=e[n],s=DL(i);if(s){this.projection=s;break}}}configure_(t){let e,n,i,s,o;const a=new Array(t.length),l=new Array(t.length),h=new Array(t.length);let u=0;const c=t.length;for(let _=0;_<c;++_){const x=[],v=[];t[_].forEach(I=>{PL(I)?v.push(I):x.push(I)});const w=x.length;if(v.length>0&&v.length!==w)throw new Error(`Expected one mask per image found ${v.length} masks and ${w} images`);let S,E;const T=new Array(w),R=new Array(w),C=new Array(w);l[_]=new Array(w),h[_]=new Array(w);for(let I=0;I<w;++I){const F=x[I],U=F.getGDALNoData();h[_][I]=F.getGDALMetadata(0),l[_][I]=U;const j=this.sourceInfo_[_].bands;a[_]=j?j.length:F.getSamplesPerPixel();const B=w-(I+1);S||(S=OL(F)),E||(E=FL(F));const d=NL(F,x[0]);C[B]=d[0];const p=[F.getTileWidth(),F.getTileHeight()];p[0]!==p[1]&&p[1]<Nu&&(p[0]=Nu,p[1]=Nu),T[B]=p;const y=d[0]/Math.abs(d[1]);R[B]=[p[0],p[1]/y]}if(e?we(e,S,e):e=S,!n)n=E;else{const I=`Origin mismatch for source ${_}, got [${E}] but expected [${n}]`;To(n,E,0,I,this.viewRejector)}if(!o)o=C,this.resolutionFactors_[_]=1;else{o.length-u>C.length&&(u=o.length-C.length);const I=o[o.length-1]/C[C.length-1];this.resolutionFactors_[_]=I;const F=C.map(j=>j*=I),U=`Resolution mismatch for source ${_}, got [${F}] but expected [${o}]`;To(o.slice(u,o.length),F,.02,U,this.viewRejector)}i?To(i.slice(u,i.length),R,.01,`Tile size mismatch for source ${_}`,this.viewRejector):i=R,s?To(s.slice(u,s.length),T,0,`Tile size mismatch for source ${_}`,this.viewRejector):s=T,this.sourceImagery_[_]=x.reverse(),this.sourceMasks_[_]=v.reverse()}for(let _=0,x=this.sourceImagery_.length;_<x;++_){const v=this.sourceImagery_[_];for(;v.length<o.length;)v.unshift(void 0)}this.getProjection()||this.determineProjection(t),this.samplesPerPixel_=a,this.nodataValues_=l,this.metadata_=h;t:for(let _=0;_<c;++_){if(this.sourceInfo_[_].nodata!==void 0){this.addAlpha_=!0;break}if(this.sourceMasks_[_].length){this.addAlpha_=!0;break}const x=l[_],v=this.sourceInfo_[_].bands;if(v){for(let w=0;w<v.length;++w)if(x[v[w]-1]!==null){this.addAlpha_=!0;break t}continue}for(let w=0;w<x.length;++w)if(x[w]!==null){this.addAlpha_=!0;break t}}let f=this.addAlpha_?1:0;for(let _=0;_<c;++_)f+=a[_];this.bandCount=f;const g=new _i({extent:e,minZoom:u,origin:n,resolutions:o,tileSizes:i});this.tileGrid=g,this.setTileSizes(s),this.setLoader(this.loadTile_.bind(this)),this.setState("ready"),o.length===2?o=[o[0],o[1],o[1]/2]:o.length===1&&(o=[o[0]*2,o[0],o[0]/2]),this.viewResolver({showFullExtent:!0,projection:this.projection,resolutions:o,center:Yu(Ce(e),this.projection),extent:fh(e,this.projection),zoom:1})}loadTile_(t,e,n){const i=this.getTileSize(t),s=this.sourceImagery_.length,o=new Array(s*2),a=this.nodataValues_,l=this.sourceInfo_,h=LL();for(let u=0;u<s;++u){const c=l[u],f=this.resolutionFactors_[u],g=[Math.round(e*(i[0]*f)),Math.round(n*(i[1]*f)),Math.round((e+1)*(i[0]*f)),Math.round((n+1)*(i[1]*f))],m=this.sourceImagery_[u][t];let _;c.bands&&(_=c.bands.map(function(E){return E-1}));let x;"nodata"in c&&c.nodata!==null?x=c.nodata:_?x=_.map(function(E){return a[u][E]}):x=a[u];const v={window:g,width:i[0],height:i[1],samples:_,fillValue:x,pool:h,interleave:!1};AL(this.convertToRGB_,m)?o[u]=m.readRGB(v):o[u]=m.readRasters(v);const w=s+u,S=this.sourceMasks_[u][t];if(!S){o[w]=Promise.resolve(null);continue}o[w]=S.readRasters({window:g,width:i[0],height:i[1],samples:[0],pool:h,interleave:!1})}return Promise.all(o).then(this.composeTile_.bind(this,i)).catch(function(u){throw El(u),u})}composeTile_(t,e){const n=this.metadata_,i=this.sourceInfo_,s=this.sourceImagery_.length,o=this.bandCount,a=this.samplesPerPixel_,l=this.nodataValues_,h=this.normalize_,u=this.addAlpha_,c=t[0]*t[1],f=c*o;let g;h?g=new Uint8Array(f):g=new Float32Array(f);let m=0;for(let _=0;_<c;++_){let x=u;for(let v=0;v<s;++v){const w=i[v];let S=w.min,E=w.max,T,R;if(h){const C=n[v][0];S===void 0&&(C&&Qp in C?S=parseFloat(C[Qp]):S=jL(e[v][0])),E===void 0&&(C&&Kp in C?E=parseFloat(C[Kp]):E=zL(e[v][0])),T=255/(E-S),R=-S*T}for(let C=0;C<a[v];++C){const I=e[v][C][_];let F;if(h?F=wt(T*I+R,0,255):F=I,!u)g[m]=F;else{let U=w.nodata;if(U===void 0){let B;w.bands?B=w.bands[C]-1:B=C,U=l[v][B]}const j=isNaN(U);(!j&&I!==U||j&&!isNaN(I))&&(x=!1,g[m]=F)}m++}if(!x){const C=s+v,I=e[C];I&&!I[0][_]&&(x=!0)}}u&&(x||(g[m]=255),m++)}return g}}Rf.prototype.getView;class re{constructor(t){this.name=t}toString(){return this.name}}re.GeoTIFF=new re("GeoTIFF");re.ImageStatic=new re("ImageStatic");re.PMTilesRaster=new re("PMTilesRaster");re.PMTilesVector=new re("PMTilesVector");re.TileJSON=new re("TileJSON");re.TileWMS=new re("TileWMS");re.WMTS=new re("WMTS");re.XYZ=new re("XYZ");class UL extends vh{constructor(t,e,n,i,s,o,a){let l=t.getExtent();l&&t.canWrapX()&&(l=l.slice(),l[0]=-1/0,l[2]=1/0);let h=e.getExtent();h&&e.canWrapX()&&(h=h.slice(),h[0]=-1/0,h[2]=1/0);const u=h?we(n,h):n,c=Ce(u),f=la(t,e,c,i),g=qd,m=new $d(t,e,u,l,f*g,i),_=m.calculateSourceExtent(),x=Un(_)?null:o(_,f,s),v=x?et.IDLE:et.EMPTY,w=x?x.getPixelRatio():1;super(n,i,w,v),this.targetProj_=e,this.maxSourceExtent_=l,this.triangulation_=m,this.targetResolution_=i,this.targetExtent_=n,this.sourceImage_=x,this.sourcePixelRatio_=w,this.interpolate_=a,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==et.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const t=this.sourceImage_.getState();if(t==et.LOADED){const e=yt(this.targetExtent_)/this.targetResolution_,n=Vt(this.targetExtent_)/this.targetResolution_;this.canvas_=Vd(e,n,this.sourcePixelRatio_,Vl(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=t,this.changed()}load(){if(this.state==et.IDLE){this.state=et.LOADING,this.changed();const t=this.sourceImage_.getState();t==et.LOADED||t==et.ERROR?this.reproject_():(this.sourceListenerKey_=le(this.sourceImage_,Lt.CHANGE,function(e){const n=this.sourceImage_.getState();(n==et.LOADED||n==et.ERROR)&&(this.unlistenSource_(),this.reproject_())},this),this.sourceImage_.load())}}unlistenSource_(){ve(this.sourceListenerKey_),this.sourceListenerKey_=null}}const nn=4,ku={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class BL extends fn{constructor(t,e){super(t),this.image=e}}class XL extends ro{constructor(t){super({attributions:t.attributions,projection:t.projection,state:t.state,interpolate:t.interpolate!==void 0?t.interpolate:!0}),this.on,this.once,this.un,this.loader=t.loader||null,this.resolutions_=t.resolutions!==void 0?t.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=t.loader?t.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(t){this.resolutions_=t}findNearestResolution(t){const e=this.getResolutions();if(e){const n=lh(e,t,0);t=e[n]}return t}getImage(t,e,n,i){const s=this.getProjection();if(!s||!i||Ae(s,i))return s&&(i=s),this.getImageInternal(t,e,n,i);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&Ae(this.reprojectedImage_.getProjection(),i)&&this.reprojectedImage_.getResolution()==e&&Nn(this.reprojectedImage_.getExtent(),t))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new UL(s,i,t,e,n,(o,a,l)=>this.getImageInternal(o,a,l,s),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(t,e,n,i){if(this.loader){const s=qh(t,e,n,1),o=this.findNearestResolution(e);if(this.image&&(this.static_||this.wantedProjection_===i&&(this.wantedExtent_&&Ze(this.wantedExtent_,s)||Ze(this.image.getExtent(),s))&&(this.wantedResolution_&&Vl(this.wantedResolution_)===o||Vl(this.image.getResolution())===o)))return this.image;this.wantedProjection_=i,this.wantedExtent_=s,this.wantedResolution_=o,this.image=new vh(s,o,n,this.loader),this.image.addEventListener(Lt.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(t){const e=t.target;let n;switch(e.getState()){case et.LOADING:this.loading=!0,n=ku.IMAGELOADSTART;break;case et.LOADED:this.loading=!1,n=ku.IMAGELOADEND;break;case et.ERROR:this.loading=!1,n=ku.IMAGELOADERROR;break;default:return}this.hasListener(n)&&this.dispatchEvent(new BL(n,e))}}function Wh(r,t){r.getImage().src=t}function qh(r,t,e,n){const i=t/e,s=Ce(r),o=ri(yt(r)/i,nn),a=ri(Vt(r)/i,nn),l=ri((n-1)*o/2,nn),h=o+2*l,u=ri((n-1)*a/2,nn),c=a+2*u;return Bc(s,i,0,[h,c])}const xi=XL;function Wy(r){const t=r.load||mi,e=r.imageExtent,n=new Image;return r.crossOrigin!==null&&(n.crossOrigin=r.crossOrigin),()=>t(n,r.url).then(i=>{const s=yt(e)/i.width,o=Vt(e)/i.height;return{image:i,extent:e,resolution:s!==o?[s,o]:o,pixelRatio:1}})}class qy extends xi{constructor(t){const e=t.crossOrigin!==void 0?t.crossOrigin:null,n=t.imageLoadFunction!==void 0?t.imageLoadFunction:Wh;super({attributions:t.attributions,interpolate:t.interpolate,projection:tt(t.projection)}),this.url_=t.url,this.imageExtent_=t.imageExtent,this.image=null,this.image=new vh(this.imageExtent_,void 0,1,Wy({url:t.url,imageExtent:t.imageExtent,crossOrigin:e,load:(i,s)=>(this.image.setImage(i),n(this.image,s),mi(i))})),this.image.addEventListener(Lt.CHANGE,this.handleImageChange.bind(this))}getImageExtent(){return this.imageExtent_}getImageInternal(t,e,n,i){return Qt(t,this.image.getExtent())?this.image:null}getUrl(){return this.url_}}function WL(r,t){const e=/\{z\}/g,n=/\{x\}/g,i=/\{y\}/g,s=/\{-y\}/g;return function(o,a,l){if(o)return r.replace(e,o[0].toString()).replace(n,o[1].toString()).replace(i,o[2].toString()).replace(s,function(){const h=o[0],u=t.getFullTileRange(h);if(!u)throw new Error("The {-y} placeholder requires a tile grid with extent");return(u.getHeight()-o[2]-1).toString()})}}function Cf(r,t){const e=r.length,n=new Array(e);for(let i=0;i<e;++i)n[i]=WL(r[i],t);return Ws(n)}function Ws(r){return r.length===1?r[0]:function(t,e,n){if(!t)return;const i=Kd(t),s=an(i,r.length);return r[s](t,e,n)}}function qL(r,t,e){}function If(r){const t=[];let e=/\{([a-z])-([a-z])\}/.exec(r);if(e){const n=e[1].charCodeAt(0),i=e[2].charCodeAt(0);let s;for(s=n;s<=i;++s)t.push(r.replace(e[0],String.fromCharCode(s)));return t}if(e=/\{(\d+)-(\d+)\}/.exec(r),e){const n=parseInt(e[2],10);for(let i=parseInt(e[1],10);i<=n;i++)t.push(r.replace(e[0],i.toString()));return t}return t.push(r),t}class Pf extends Da{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===Pf.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const e=t.target,n=it(e),i=e.getState();let s;i==W.LOADING?(this.tileLoadingKeys_[n]=!0,s=Is.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],s=i==W.ERROR?Is.TILELOADERROR:i==W.LOADED?Is.TILELOADEND:void 0),s!=null&&this.dispatchEvent(new vy(s,e))}setTileLoadFunction(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),typeof e<"u"?this.setKey(e):this.changed()}setUrl(t){const e=If(t);this.urls=e,this.setUrls(e)}setUrls(t){this.urls=t;const e=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(Cf(t,this.tileGrid),e):this.setKey(e)}tileUrlFunction(t,e,n){}useTile(t,e,n){const i=cn(t,e,n);this.tileCache.containsKey(i)&&this.tileCache.get(i)}}const Af=Pf;class Ar extends Af{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:ZL,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate!==void 0?t.interpolate:!0,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=t.crossOrigin!==void 0?t.crossOrigin:null,this.tileClass=t.tileClass!==void 0?t.tileClass:Fa,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1}expireCache(t,e){const n=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==n?e:{});for(const i in this.tileCacheForProjection){const s=this.tileCacheForProjection[i];s.expireCache(s==n?e:{})}}getGutterForProjection(t){return this.getProjection()&&t&&!Ae(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getOpaque(t){return this.getProjection()&&t&&!Ae(this.getProjection(),t)?!1:super.getOpaque(t)}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||Ae(e,t)))return this.tileGrid;const n=it(t);return n in this.tileGridForProjection||(this.tileGridForProjection[n]=hf(t)),this.tileGridForProjection[n]}getTileCacheForProjection(t){const e=this.getProjection();if(!e||Ae(e,t))return this.tileCache;const n=it(t);return n in this.tileCacheForProjection||(this.tileCacheForProjection[n]=new Bh(this.tileCache.highWaterMark)),this.tileCacheForProjection[n]}createTile_(t,e,n,i,s,o){const a=[t,e,n],l=this.getTileCoordForTileUrlFunction(a,s),h=l?this.tileUrlFunction(l,i,s):void 0,u=new this.tileClass(a,h!==void 0?W.IDLE:W.EMPTY,h!==void 0?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return u.key=o,u.addEventListener(Lt.CHANGE,this.handleTileChange.bind(this)),u}getTile(t,e,n,i,s){const o=this.getProjection();if(!o||!s||Ae(o,s))return this.getTileInternal(t,e,n,i,o||s);const a=this.getTileCacheForProjection(s),l=[t,e,n];let h;const u=ei(l);a.containsKey(u)&&(h=a.get(u));const c=this.getKey();if(h&&h.key==c)return h;const f=this.getTileGridForProjection(o),g=this.getTileGridForProjection(s),m=this.getTileCoordForTileUrlFunction(l,s),_=new Us(o,f,s,g,l,m,this.getTilePixelRatio(i),this.getGutter(),(x,v,w,S)=>this.getTileInternal(x,v,w,S,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return _.key=c,h?(_.interimTile=h,_.refreshInterimChain(),a.replace(u,_)):a.set(u,_),_}getTileInternal(t,e,n,i,s){let o=null;const a=cn(t,e,n),l=this.getKey();if(!this.tileCache.containsKey(a))o=this.createTile_(t,e,n,i,s,l),this.tileCache.set(a,o);else if(o=this.tileCache.get(a),o.key!=l){const h=o;o=this.createTile_(t,e,n,i,s,l),h.getState()==W.IDLE?o.interimTile=h.interimTile:o.interimTile=h,o.refreshInterimChain(),this.tileCache.replace(a,o)}return o}setRenderReprojectionEdges(t){if(this.renderReprojectionEdges_!=t){this.renderReprojectionEdges_=t;for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}}setTileGridForProjection(t,e){const n=tt(t);if(n){const i=it(n);i in this.tileGridForProjection||(this.tileGridForProjection[i]=e)}}clear(){super.clear();for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear()}}function ZL(r,t){r.getImage().src=t}function Lf(r,t,e,n){const i=document.createElement("script"),s="olc_"+it(t);function o(){delete window[s],i.parentNode.removeChild(i)}i.async=!0,i.src=r+(r.includes("?")?"&":"?")+"callback="+s;const a=setTimeout(function(){o(),e&&e()},1e4);window[s]=function(l){clearTimeout(a),o(),t(l)},document.head.appendChild(i)}class $L extends Error{constructor(t){const e="Unexpected response status: "+t.status;super(e),this.name="ResponseError",this.response=t}}class VL extends Error{constructor(t){super("Failed to issue request"),this.name="ClientError",this.client=t}}function Zy(r){return new Promise(function(t,e){function n(o){const a=o.target;if(!a.status||a.status>=200&&a.status<300){let l;try{l=JSON.parse(a.responseText)}catch(h){const u="Error parsing response text as JSON: "+h.message;e(new Error(u));return}t(l);return}e(new $L(a))}function i(o){e(new VL(o.target))}const s=new XMLHttpRequest;s.addEventListener("load",n),s.addEventListener("error",i),s.open("GET",r),s.setRequestHeader("Accept","application/json"),s.send()})}function $y(r,t){return t.includes("://")?t:new URL(t,r).href}class Vy extends Ar{constructor(t){if(super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:tt("EPSG:3857"),reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:"loading",tileLoadFunction:t.tileLoadFunction,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,zDirection:t.zDirection}),this.tileJSON_=null,this.tileSize_=t.tileSize,t.url)if(t.jsonp)Lf(t.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const e=new XMLHttpRequest;e.addEventListener("load",this.onXHRLoad_.bind(this)),e.addEventListener("error",this.onXHRError_.bind(this)),e.open("GET",t.url),e.send()}else if(t.tileJSON)this.handleTileJSONResponse(t.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(t){const e=t.target;if(!e.status||e.status>=200&&e.status<300){let n;try{n=JSON.parse(e.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(n)}else this.handleTileJSONError()}onXHRError_(t){this.handleTileJSONError()}getTileJSON(){return this.tileJSON_}handleTileJSONResponse(t){const e=tt("EPSG:4326"),n=this.getProjection();let i;if(t.bounds!==void 0){const h=$i(e,n);i=Fs(t.bounds,h)}const s=Wn(n),o=t.minzoom||0,a=t.maxzoom||22,l=Hi({extent:s,maxZoom:a,minZoom:o,tileSize:this.tileSize_});if(this.tileGrid=l,this.tileUrlFunction=Cf(t.tiles,l),t.attribution&&!this.getAttributions()){const h=i!==void 0?i:s;this.setAttributions(function(u){return Qt(h,u.extent)?[t.attribution]:null})}this.tileJSON_=t,this.setState("ready")}handleTileJSONError(){this.setState("error")}}let YL=class extends no{constructor(r,t,e,n,i,s){super(r,t,s),this.extent=null,this.format_=n,this.features_=null,this.loader_,this.projection=null,this.resolution,this.tileLoadFunction_=i,this.url_=e,this.key=e}getFormat(){return this.format_}getFeatures(){return this.features_}load(){this.state==W.IDLE&&(this.setState(W.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))}onLoad(r,t){this.setFeatures(r)}onError(){this.setState(W.ERROR)}setFeatures(r){this.features_=r,this.setState(W.LOADED)}setLoader(r){this.loader_=r}};const Jp=[];class HL extends no{constructor(t,e,n,i){super(t,e,{transition:0}),this.context_={},this.executorGroups={},this.loadingSourceTiles=0,this.hitDetectionImageData={},this.replayState_={},this.sourceTiles=[],this.errorTileKeys={},this.wantedResolution,this.getSourceTiles=i.bind(void 0,this),this.wrappedTileCoord=n}getContext(t){const e=it(t);return e in this.context_||(this.context_[e]=Jt(1,1,Jp)),this.context_[e]}hasContext(t){return it(t)in this.context_}getImage(t){return this.hasContext(t)?this.getContext(t).canvas:null}getReplayState(t){const e=it(t);return e in this.replayState_||(this.replayState_[e]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[e]}load(){this.getSourceTiles()}release(){for(const t in this.context_){const e=this.context_[t];Gi(e),Jp.push(e.canvas),delete this.context_[t]}super.release()}}class Zh extends Af{constructor(t){const e=t.projection||"EPSG:3857",n=t.extent||Wn(e),i=t.tileGrid||Hi({extent:n,maxResolution:t.maxResolution,maxZoom:t.maxZoom!==void 0?t.maxZoom:22,minZoom:t.minZoom,tileSize:t.tileSize||512});super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,interpolate:!0,opaque:!1,projection:e,state:t.state,tileGrid:i,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:KL,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX===void 0?!0:t.wrapX,transition:t.transition,zDirection:t.zDirection===void 0?1:t.zDirection}),this.format_=t.format?t.format:null,this.sourceTileCache=new Bh(this.tileCache.highWaterMark),this.overlaps_=t.overlaps==null?!0:t.overlaps,this.tileClass=t.tileClass?t.tileClass:YL,this.tileGrids_={}}getFeaturesInExtent(t){const e=[],n=this.tileCache;if(n.getCount()===0)return e;const i=H_(n.peekFirstKey())[0],s=this.tileGrid;return n.forEach(function(o){if(o.tileCoord[0]!==i||o.getState()!==W.LOADED)return;const a=o.getSourceTiles();for(let l=0,h=a.length;l<h;++l){const u=a[l],c=u.tileCoord;if(Qt(t,s.getTileCoordExtent(c))){const f=u.getFeatures();if(f)for(let g=0,m=f.length;g<m;++g){const _=f[g],x=_.getGeometry();Qt(t,x.getExtent())&&e.push(_)}}}}),e}getOverlaps(){return this.overlaps_}clear(){this.tileCache.clear(),this.sourceTileCache.clear()}expireCache(t,e){const n=this.getTileCacheForProjection(t),i=Object.keys(e).reduce((s,o)=>{const a=CI(o),l=n.peek(a);if(l){const h=l.sourceTiles;for(let u=0,c=h.length;u<c;++u)s[h[u].getKey()]=!0}return s},{});super.expireCache(t,e),this.sourceTileCache.expireCache(i)}getSourceTiles(t,e,n){if(n.getState()===W.IDLE){n.setState(W.LOADING);const i=n.wrappedTileCoord,s=this.getTileGridForProjection(e),o=s.getTileCoordExtent(i),a=i[0],l=s.getResolution(a);Ir(o,-l,o);const h=this.tileGrid,u=h.getExtent();u&&we(o,u,o);const c=h.getZForResolution(l,this.zDirection);h.forEachTileCoord(o,c,f=>{const g=this.tileUrlFunction(f,t,e),m=this.sourceTileCache.containsKey(g)?this.sourceTileCache.get(g):new this.tileClass(f,g?W.IDLE:W.EMPTY,g,this.format_,this.tileLoadFunction);n.sourceTiles.push(m);const _=m.getState();if(_<W.LOADED){const x=v=>{this.handleTileChange(v);const w=m.getState();if(w===W.LOADED||w===W.ERROR){const S=m.getKey();S in n.errorTileKeys?m.getState()===W.LOADED&&delete n.errorTileKeys[S]:n.loadingSourceTiles--,w===W.ERROR?n.errorTileKeys[S]=!0:m.removeEventListener(Lt.CHANGE,x),n.loadingSourceTiles===0&&n.setState(Fn(n.errorTileKeys)?W.LOADED:W.ERROR)}};m.addEventListener(Lt.CHANGE,x),n.loadingSourceTiles++}_===W.IDLE&&(m.extent=h.getTileCoordExtent(f),m.projection=e,m.resolution=h.getResolution(f[0]),this.sourceTileCache.set(g,m),m.load())}),n.loadingSourceTiles||n.setState(n.sourceTiles.some(f=>f.getState()===W.ERROR)?W.ERROR:W.LOADED)}return n.sourceTiles}getTile(t,e,n,i,s){const o=cn(t,e,n),a=this.getKey();let l;if(this.tileCache.containsKey(o)&&(l=this.tileCache.get(o),l.key===a))return l;const h=[t,e,n];let u=this.getTileCoordForTileUrlFunction(h,s);const c=this.getTileGrid().getExtent(),f=this.getTileGridForProjection(s);if(u&&c){const _=f.getTileCoordExtent(u);Ir(_,-f.getResolution(t),_),Qt(c,_)||(u=null)}let g=!0;if(u!==null){const _=this.tileGrid,x=f.getResolution(t),v=_.getZForResolution(x,1),w=f.getTileCoordExtent(u);Ir(w,-x,w),_.forEachTileCoord(w,v,S=>{g=g&&!this.tileUrlFunction(S,i,s)})}const m=new HL(h,g?W.EMPTY:W.IDLE,u,this.getSourceTiles.bind(this,i,s));return m.key=a,l?(m.interimTile=l,m.refreshInterimChain(),this.tileCache.replace(o,m)):this.tileCache.set(o,m),m}getTileGridForProjection(t){const e=t.getCode();let n=this.tileGrids_[e];if(!n){const i=this.tileGrid,s=i.getResolutions().slice(),o=s.map(function(h,u){return i.getOrigin(u)}),a=s.map(function(h,u){return i.getTileSize(u)}),l=m_+1;for(let h=s.length;h<l;++h)s.push(s[h-1]/2),o.push(o[h-1]),a.push(a[h-1]);n=new _i({extent:i.getExtent(),origins:o,resolutions:s,tileSizes:a}),this.tileGrids_[e]=n}return n}getTilePixelRatio(t){return t}getTilePixelSize(t,e,n){const i=this.getTileGridForProjection(n),s=ie(i.getTileSize(t),this.tmpSize);return[Math.round(s[0]*e),Math.round(s[1]*e)]}updateCacheSize(t,e){super.updateCacheSize(t*2,e),this.sourceTileCache.highWaterMark=this.getTileCacheForProjection(e).highWaterMark}}function KL(r,t){r.setLoader(function(e,n,i){k_(t,r.getFormat(),e,n,i,r.onLoad.bind(r),r.onError.bind(r))})}function Gn(r,t){const e=[];Object.keys(t).forEach(function(i){t[i]!==null&&t[i]!==void 0&&e.push(i+"="+encodeURIComponent(t[i]))});const n=e.join("&");return r=r.replace(/[?&]$/,""),r+=r.includes("?")?"&":"?",r+n}const Ql="1.3.0",tm=[101,101];function Yy(r,t,e,n,i){i.WIDTH=e[0],i.HEIGHT=e[1];const s=n.getAxisOrientation();let o;const a=qc(i.VERSION,"1.3")>=0;return i[a?"CRS":"SRS"]=n.getCode(),a&&s.substr(0,2)=="ne"?o=[t[1],t[0],t[3],t[2]]:o=t,i.BBOX=o.join(","),Gn(r,i)}function Hy(r,t,e,n,i,s,o){s=Object.assign({REQUEST:"GetMap"},s);const a=t/e,l=[bl(yt(r)/a,nn),bl(Vt(r)/a,nn)];if(e!=1)switch(o){case"geoserver":const h=90*e+.5|0;"FORMAT_OPTIONS"in s?s.FORMAT_OPTIONS+=";dpi:"+h:s.FORMAT_OPTIONS="dpi:"+h;break;case"mapserver":s.MAP_RESOLUTION=90*e;break;case"carmentaserver":case"qgis":s.DPI=90*e;break;default:throw new Error("Unknown `serverType` configured")}return Yy(i,r,l,n,s)}function Jl(r,t){return Object.assign({REQUEST:t,SERVICE:"WMS",VERSION:Ql,FORMAT:"image/png",STYLES:"",TRANSPARENT:!0},r)}function Ky(r){const t=r.hidpi===void 0?!0:r.hidpi,e=tt(r.projection||"EPSG:3857"),n=r.ratio||1.5,i=r.load||mi;return(s,o,a)=>{s=qh(s,o,a,n),a!=1&&(!t||r.serverType===void 0)&&(a=1);const l=Hy(s,o,a,e,r.url,Jl(r.params,"GetMap"),r.serverType),h=new Image;return r.crossOrigin!==null&&(h.crossOrigin=r.crossOrigin),i(h,l).then(u=>({image:u,extent:s,pixelRatio:a}))}}function QL(r,t,e){if(r.url===void 0)return;const n=tt(r.projection||"EPSG:3857"),i=Bc(t,e,0,tm),s={QUERY_LAYERS:r.params.LAYERS,INFO_FORMAT:"application/json"};Object.assign(s,Jl(r.params,"GetFeatureInfo"),r.params);const o=ys((t[0]-i[0])/e,nn),a=ys((i[3]-t[1])/e,nn),l=qc(s.VERSION,"1.3")>=0;return s[l?"I":"X"]=o,s[l?"J":"Y"]=a,Yy(r.url,i,tm,n,s)}function JL(r,t){if(r.url===void 0)return;const e={SERVICE:"WMS",VERSION:Ql,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(r.params===void 0||r.params.LAYER===void 0){const n=r.params.LAYERS;if(!(!Array.isArray(n)||n.length===1))return;e.LAYER=n}if(t!==void 0){const n=tt(r.projection||"EPSG:3857").getMetersPerUnit()||1,i=28e-5;e.SCALE=t*n/i}return Object.assign(e,r.params),Gn(r.url,e)}class Qy extends Ar{constructor(t){t=t||{};const e=Object.assign({},t.params),n="TRANSPARENT"in e?e.TRANSPARENT:!0;super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,opaque:!n,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:t.tileClass,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0,this.params_=e,this.v13_=!0,this.serverType_=t.serverType,this.hidpi_=t.hidpi!==void 0?t.hidpi:!0,this.tmpExtent_=ze(),this.updateV13_(),this.setKey(this.getKeyForParams_())}getFeatureInfoUrl(t,e,n,i){const s=tt(n),o=this.getProjection()||s;let a=this.getTileGrid();a||(a=this.getTileGridForProjection(o));const l=dh(t,s,o),h=la(o,s,t,e),u=a.getZForResolution(h,this.zDirection),c=a.getResolution(u),f=a.getTileCoordForCoordAndZ(l,u);if(a.getResolutions().length<=f[0])return;let g=a.getTileCoordExtent(f,this.tmpExtent_);const m=this.gutter_;m!==0&&(g=Ir(g,c*m,g));const _={QUERY_LAYERS:this.params_.LAYERS};Object.assign(_,Jl(this.params_,"GetFeatureInfo"),i);const x=Math.floor((l[0]-g[0])/c),v=Math.floor((g[3]-l[1])/c);return _[this.v13_?"I":"X"]=x,_[this.v13_?"J":"Y"]=v,this.getRequestUrl_(f,g,1,o||s,_)}getLegendUrl(t,e){if(this.urls[0]===void 0)return;const n={SERVICE:"WMS",VERSION:Ql,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(e===void 0||e.LAYER===void 0){const i=this.params_.LAYERS;if(!(!Array.isArray(i)||i.length===1))return;n.LAYER=i}if(t!==void 0){const i=this.getProjection()?this.getProjection().getMetersPerUnit():1,s=28e-5;n.SCALE=t*i/s}return Object.assign(n,e),Gn(this.urls[0],n)}getGutter(){return this.gutter_}getParams(){return this.params_}getRequestUrl_(t,e,n,i,s){const o=this.urls;if(!o)return;let a;if(o.length==1)a=o[0];else{const l=an(Kd(t),o.length);a=o[l]}return Hy(e,(this.tileGrid||this.getTileGridForProjection(i)).getResolution(t[0]),n,i,a,s,this.serverType_)}getTilePixelRatio(t){return!this.hidpi_||this.serverType_===void 0?1:t}getKeyForParams_(){let t=0;const e=[];for(const n in this.params_)e[t++]=n+"-"+this.params_[n];return e.join("/")}updateParams(t){Object.assign(this.params_,t),this.updateV13_(),this.setKey(this.getKeyForParams_())}updateV13_(){const t=this.params_.VERSION||Ql;this.v13_=qc(t,"1.3")>=0}tileUrlFunction(t,e,n){let i=this.getTileGrid();if(i||(i=this.getTileGridForProjection(n)),i.getResolutions().length<=t[0])return;e!=1&&(!this.hidpi_||this.serverType_===void 0)&&(e=1);const s=i.getResolution(t[0]);let o=i.getTileCoordExtent(t,this.tmpExtent_);const a=this.gutter_;a!==0&&(o=Ir(o,s*a,o));const l=Object.assign({},Jl(this.params_,"GetMap"));return this.getRequestUrl_(t,o,e,n,l)}}class Jy extends Ar{constructor(t){const e=t.requestEncoding!==void 0?t.requestEncoding:"KVP",n=t.tileGrid;let i=t.urls;i===void 0&&t.url!==void 0&&(i=If(t.url)),super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:t.tileClass,tileGrid:n,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,urls:i,wrapX:t.wrapX!==void 0?t.wrapX:!1,transition:t.transition,zDirection:t.zDirection}),this.version_=t.version!==void 0?t.version:"1.0.0",this.format_=t.format!==void 0?t.format:"image/jpeg",this.dimensions_=t.dimensions!==void 0?t.dimensions:{},this.layer_=t.layer,this.matrixSet_=t.matrixSet,this.style_=t.style,this.requestEncoding_=e,this.setKey(this.getKeyForDimensions_()),i&&i.length>0&&(this.tileUrlFunction=Ws(i.map(this.createFromWMTSTemplate.bind(this))))}setUrls(t){this.urls=t;const e=t.join(`
`);this.setTileUrlFunction(Ws(t.map(this.createFromWMTSTemplate.bind(this))),e)}getDimensions(){return this.dimensions_}getFormat(){return this.format_}getLayer(){return this.layer_}getMatrixSet(){return this.matrixSet_}getRequestEncoding(){return this.requestEncoding_}getStyle(){return this.style_}getVersion(){return this.version_}getKeyForDimensions_(){const t=this.urls?this.urls.slice(0):[];for(const e in this.dimensions_)t.push(e+"-"+this.dimensions_[e]);return t.join("/")}updateDimensions(t){Object.assign(this.dimensions_,t),this.setKey(this.getKeyForDimensions_())}createFromWMTSTemplate(t){const e=this.requestEncoding_,n={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};e=="KVP"&&Object.assign(n,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),t=e=="KVP"?Gn(t,n):t.replace(/\{(\w+?)\}/g,function(o,a){return a.toLowerCase()in n?n[a.toLowerCase()]:o});const i=this.tileGrid,s=this.dimensions_;return function(o,a,l){if(!o)return;const h={TileMatrix:i.getMatrixId(o[0]),TileCol:o[1],TileRow:o[2]};Object.assign(h,s);let u=t;return e=="KVP"?u=Gn(u,h):u=u.replace(/\{(\w+?)\}/g,function(c,f){return h[f]}),u}}}function t1(r,t){const e=r.Contents.Layer,n=e?.find(function(j){return j.Identifier==t.layer});if(!n)return null;const i=r.Contents.TileMatrixSet;let s;n.TileMatrixSetLink.length>1?"projection"in t?s=n.TileMatrixSetLink.findIndex(function(j){const B=i.find(function(y){return y.Identifier==j.TileMatrixSet}).SupportedCRS,d=tt(B),p=tt(t.projection);return d&&p?Ae(d,p):B==t.projection}):s=n.TileMatrixSetLink.findIndex(function(j){return j.TileMatrixSet==t.matrixSet}):s=0,s<0&&(s=0);const o=n.TileMatrixSetLink[s].TileMatrixSet,a=n.TileMatrixSetLink[s].TileMatrixSetLimits;let l=n.Format[0];"format"in t&&(l=t.format),s=n.Style.findIndex(function(j){return"style"in t?j.Title==t.style:j.isDefault}),s<0&&(s=0);const h=n.Style[s].Identifier,u={};"Dimension"in n&&n.Dimension.forEach(function(j,B,d){const p=j.Identifier;let y=j.Default;y===void 0&&(y=j.Value[0]),u[p]=y});const c=r.Contents.TileMatrixSet.find(function(j){return j.Identifier==o});let f;const g=c.SupportedCRS;if(g&&(f=tt(g)),"projection"in t){const j=tt(t.projection);j&&(!f||Ae(j,f))&&(f=j)}let m=!1;const _=f.getAxisOrientation().substr(0,2)=="ne";let x=c.TileMatrix[0],v={MinTileCol:0,MinTileRow:0,MaxTileCol:x.MatrixWidth-1,MaxTileRow:x.MatrixHeight-1};if(a){v=a[a.length-1];const j=c.TileMatrix.find(B=>B.Identifier===v.TileMatrix||c.Identifier+":"+B.Identifier===v.TileMatrix);j&&(x=j)}const w=x.ScaleDenominator*28e-5/f.getMetersPerUnit(),S=_?[x.TopLeftCorner[1],x.TopLeftCorner[0]]:x.TopLeftCorner,E=x.TileWidth*w,T=x.TileHeight*w;let R=c.BoundingBox;R&&_&&(R=[R[1],R[0],R[3],R[2]]);let C=[S[0]+E*v.MinTileCol,S[1]-T*(1+v.MaxTileRow),S[0]+E*(1+v.MaxTileCol),S[1]-T*v.MinTileRow];if(R!==void 0&&!Ze(R,C)){const j=n.WGS84BoundingBox,B=tt("EPSG:4326").getExtent();if(C=R,j)m=j[0]===B[0]&&j[2]===B[2];else{const d=Vc(R,c.SupportedCRS,"EPSG:4326");m=d[0]-1e-10<=B[0]&&d[2]+1e-10>=B[2]}}const I=YP(c,C,a),F=[];let U=t.requestEncoding;if(U=U!==void 0?U:"","OperationsMetadata"in r&&"GetTile"in r.OperationsMetadata){const j=r.OperationsMetadata.GetTile.DCP.HTTP.Get;for(let B=0,d=j.length;B<d;++B)if(j[B].Constraint){const p=j[B].Constraint.find(function(y){return y.name=="GetEncoding"}).AllowedValues.Value;if(U===""&&(U=p[0]),U==="KVP")p.includes("KVP")&&F.push(j[B].href);else break}else j[B].href&&(U="KVP",F.push(j[B].href))}return F.length===0&&(U="REST",n.ResourceURL.forEach(function(j){j.resourceType==="tile"&&(l=j.format,F.push(j.template))})),{urls:F,layer:t.layer,matrixSet:o,format:l,projection:f,requestEncoding:U,tileGrid:I,style:h,dimensions:u,wrapX:m,crossOrigin:t.crossOrigin}}class Ui extends Ar{constructor(t){t=t||{};const e=t.projection!==void 0?t.projection:"EPSG:3857",n=t.tileGrid!==void 0?t.tileGrid:Hi({extent:Wn(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,opaque:t.opaque,projection:e,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:n,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0}getGutter(){return this.gutter_}}var e1={exports:{}};(function(r,t){(function(e,n){r.exports=n()})(Oi,function(){var e=/^v?(?:\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+))?(?:-[\da-z\-]+(?:\.[\da-z\-]+)*)?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i;function n(c,f){return c.indexOf(f)===-1?c.length:c.indexOf(f)}function i(c){var f=c.replace(/^v/,"").replace(/\+.*$/,""),g=n(f,"-"),m=f.substring(0,g).split(".");return m.push(f.substring(g+1)),m}function s(c){return isNaN(Number(c))?c:Number(c)}function o(c){if(typeof c!="string")throw new TypeError("Invalid argument expected string");if(!e.test(c))throw new Error("Invalid argument not valid semver ('"+c+"' received)")}function a(c,f){[c,f].forEach(o);for(var g=i(c),m=i(f),_=0;_<Math.max(g.length-1,m.length-1);_++){var x=parseInt(g[_]||0,10),v=parseInt(m[_]||0,10);if(x>v)return 1;if(v>x)return-1}var w=g[g.length-1],S=m[m.length-1];if(w&&S){var E=w.split(".").map(s),T=S.split(".").map(s);for(_=0;_<Math.max(E.length,T.length);_++){if(E[_]===void 0||typeof T[_]=="string"&&typeof E[_]=="number")return-1;if(T[_]===void 0||typeof E[_]=="string"&&typeof T[_]=="number"||E[_]>T[_])return 1;if(T[_]>E[_])return-1}}else if(w||S)return w?-1:1;return 0}var l=[">",">=","=","<","<="],h={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]};function u(c){if(typeof c!="string")throw new TypeError("Invalid operator type, expected string but got "+typeof c);if(l.indexOf(c)===-1)throw new TypeError("Invalid operator, expected one of "+l.join("|"))}return a.validate=function(c){return typeof c=="string"&&e.test(c)},a.compare=function(c,f,g){u(g);var m=a(c,f);return h[g].indexOf(m)>-1},a})})(e1);var tO=e1.exports,Tc=tO;const Of="1.0.0",ft={classification:"https://stac-extensions.github.io/classification/v1.1.0/schema.json",datacube:"https://stac-extensions.github.io/datacube/v2.1.0/schema.json",eo:"https://stac-extensions.github.io/eo/v1.0.0/schema.json",file:"https://stac-extensions.github.io/file/v1.0.0/schema.json","item-assets":"https://stac-extensions.github.io/item-assets/v1.0.0/schema.json",label:"https://stac-extensions.github.io/label/v1.0.1/schema.json",pointcloud:"https://stac-extensions.github.io/pointcloud/v1.0.0/schema.json",processing:"https://stac-extensions.github.io/processing/v1.1.0/schema.json",projection:"https://stac-extensions.github.io/projection/v1.0.0/schema.json",raster:"https://stac-extensions.github.io/raster/v1.1.0/schema.json",sar:"https://stac-extensions.github.io/sar/v1.0.0/schema.json",sat:"https://stac-extensions.github.io/sat/v1.0.0/schema.json",scientific:"https://stac-extensions.github.io/scientific/v1.0.0/schema.json",table:"https://stac-extensions.github.io/table/v1.2.0/schema.json",timestamps:"https://stac-extensions.github.io/timestamps/v1.0.0/schema.json",version:"https://stac-extensions.github.io/version/v1.0.0/schema.json",view:"https://stac-extensions.github.io/view/v1.0.0/schema.json"},Ni={itemAndCollection:{"cube:":ft.datacube,"eo:":ft.eo,"file:":ft.file,"label:":ft.label,"pc:":ft.pointcloud,"processing:":ft.processing,"proj:":ft.projection,"raster:":ft.raster,"sar:":ft.sar,"sat:":ft.sat,"sci:":ft.scientific,"view:":ft.view,version:ft.version,deprecated:ft.version,published:ft.timestamps,expires:ft.timestamps,unpublished:ft.timestamps},catalog:{},collection:{item_assets:ft["item-assets"]},item:{}};Ni.collection=Object.assign(Ni.collection,Ni.itemAndCollection);Ni.item=Object.assign(Ni.item,Ni.itemAndCollection);var Mo={parseUrl(r){let t=r.match(/^https?:\/\/stac-extensions.github.io\/([^\/]+)\/v([^\/]+)\/[^.]+.json$/i);if(t)return{id:t[1],version:t[2]}}},Ft={version:Of,extensions:{},set(r){if(typeof r.stac_version!="string"?Ft.version="0.6.0":Ft.version=r.stac_version,Array.isArray(r.stac_extensions))for(let t of r.stac_extensions){let e=Mo.parseUrl(t);e&&(Ft.extensions[e.id]=e.version)}},before(r,t=null){let e=t?Ft.extensions[t]:Ft.version;return typeof e>"u"?!1:Tc.compare(e,r,"<")}},k={type(r){let t=typeof r;if(t==="object"){if(r===null)return"null";if(Array.isArray(r))return"array"}return t},is(r,t){return k.type(r)===t},isDefined(r){return typeof r<"u"},isObject(r){return typeof r=="object"&&r===Object(r)&&!Array.isArray(r)},rename(r,t,e){return typeof r[t]<"u"&&typeof r[e]>"u"?(r[e]=r[t],delete r[t],!0):!1},forAll(r,t,e){if(r[t]&&typeof r[t]=="object")for(let n in r[t])e(r[t][n])},toArray(r,t){return typeof r[t]<"u"&&!Array.isArray(r[t])?(r[t]=[r[t]],!0):!1},flattenArray(r,t,e,n=!1){if(Array.isArray(r[t])){for(let i in r[t])if(typeof e[i]=="string"){let s=r[t][i];r[e[i]]=n?[s]:s}return delete r[t],!0}return!1},flattenOneElementArray(r,t,e=!1){return!e&&Array.isArray(r[t])?r[t].length===1?(r[t]=r[t][0],!0):!1:!0},removeFromArray(r,t,e){if(Array.isArray(r[t])){let n=r[t].indexOf(e);return n>-1&&r[t].splice(n,1),!0}return!1},ensure(r,t,e){return k.type(e)!==k.type(r[t])&&(r[t]=e),!0},upgradeExtension(r,t){let{id:e,version:n}=Mo.parseUrl(t),i=r.stac_extensions.findIndex(s=>{let o=Mo.parseUrl(s);return o&&o.id===e&&Tc.compare(o.version,n,"<")});return i!==-1?(r.stac_extensions[i]=t,!0):!1},addExtension(r,t){let{id:e,version:n}=Mo.parseUrl(t),i=r.stac_extensions.findIndex(s=>{if(s===t)return!0;let o=Mo.parseUrl(s);return!!(o&&o.id===e&&Tc.compare(o.version,n,"<"))});return i===-1?r.stac_extensions.push(t):r.stac_extensions[i]=t,r.stac_extensions.sort(),!0},removeExtension(r,t){return k.removeFromArray(r,"stac_extensions",t)},migrateExtensionShortnames(r){let t=Object.keys(ft),e=Object.values(ft);return k.mapValues(r,"stac_extensions",t,e)},populateExtensions(r,t){let e=[];(t=="catalog"||t=="collection")&&e.push(r),(t=="item"||t=="collection")&&k.isObject(r.assets)&&(e=e.concat(Object.values(r.assets))),t=="collection"&&k.isObject(r.item_assets)&&(e=e.concat(Object.values(r.item_assets))),t=="collection"&&k.isObject(r.summaries)&&e.push(r.summaries),t=="item"&&k.isObject(r.properties)&&e.push(r.properties);for(let n of e)Object.keys(n).forEach(i=>{let s=i.match(/^(\w+:|[^:]+$)/i);if(Array.isArray(s)){let o=Ni[t][s[0]];k.is(o,"string")&&k.addExtension(r,o)}})},mapValues(r,t,e,n){let i=s=>{let o=e.indexOf(s);return o>=0?n[o]:s};return Array.isArray(r[t])?r[t]=r[t].map(i):typeof r[t]<"u"&&(r[t]=i(r[t])),!0},mapObject(r,t){for(let e in r)r[e]=t(r[e],e)},moveTo(r,t,e,n=!1,i=!1){let s;return n?i?s=o=>Array.isArray(o):s=o=>Array.isArray(o)&&o.length===1:s=k.isDefined,s(r[t])?(e[t]=n&&!i?r[t][0]:r[t],delete r[t],!0):!1},runAll(r,t,e,n){for(let i in r)i.startsWith("migrate")||r[i](t,e,n)},toUTC(r,t){if(typeof r[t]=="string")try{return r[t]=this.toISOString(r[t]),!0}catch{}return delete r[t],!1},toISOString(r){return r instanceof Date||(r=new Date(r)),r.toISOString().replace(".000","")}},en={multihash:null,hexToUint8(r){if(r.length===0||r.length%2!==0)throw new Error(`The string "${r}" is not valid hex.`);return new Uint8Array(r.match(/.{1,2}/g).map(t=>parseInt(t,16)))},uint8ToHex(r){return r.reduce((t,e)=>t+e.toString(16).padStart(2,"0"),"")},toMultihash(r,t,e){if(!en.multihash||!k.is(r[t],"string"))return!1;try{const n=en.multihash.encode(en.hexToUint8(r[t]),e);return r[t]=en.uint8ToHex(n),!0}catch(n){return console.warn(n),!1}}},Ff={migrate(r,t=!0){return Ft.set(r),t&&(r.stac_version=Of),r.type="Catalog",k.ensure(r,"stac_extensions",[]),Ft.before("1.0.0-rc.1")&&k.migrateExtensionShortnames(r),k.ensure(r,"id",""),k.ensure(r,"description",""),k.ensure(r,"links",[]),k.runAll(Ff,r,r),Ft.before("0.8.0")&&k.populateExtensions(r,"catalog"),r}},Nf={migrate(r,t=!0){return Ff.migrate(r,t),r.type="Collection",Ft.before("1.0.0-rc.1")&&k.migrateExtensionShortnames(r),k.ensure(r,"license","proprietary"),k.ensure(r,"extent",{spatial:{bbox:[]},temporal:{interval:[]}}),k.runAll(Nf,r,r),k.isObject(r.properties)&&(k.removeFromArray(r,"stac_extensions","commons"),delete r.properties),Ft.before("0.8.0")&&k.populateExtensions(r,"collection"),Ft.before("1.0.0-beta.1")&&k.mapValues(r,"stac_extensions",["assets"],["item-assets"]),r},extent(r){if(k.ensure(r,"extent",{}),Ft.before("0.8.0")&&(Array.isArray(r.extent.spatial)&&(r.extent.spatial={bbox:[r.extent.spatial]}),Array.isArray(r.extent.temporal)&&(r.extent.temporal={interval:[r.extent.temporal]})),k.ensure(r.extent,"spatial",{}),k.ensure(r.extent.spatial,"bbox",[]),k.ensure(r.extent,"temporal",{}),k.ensure(r.extent.temporal,"interval",[]),Ft.before("1.0.0-rc.3")){if(r.extent.temporal.interval.length>1){let t,e;for(let n of r.extent.temporal.interval){if(n[0]===null)t=null;else if(typeof n[0]=="string"&&t!==null)try{let i=new Date(n[0]);(typeof t>"u"||i<t)&&(t=i)}catch{}if(n[1]===null)e=null;else if(typeof n[1]=="string"&&e!==null)try{let i=new Date(n[1]);(typeof e>"u"||i>e)&&(e=i)}catch{}}r.extent.temporal.interval.unshift([t?k.toISOString(t):null,e?k.toISOString(e):null])}if(r.extent.spatial.bbox.length>1){let t=r.extent.spatial.bbox.reduce((e,n)=>Array.isArray(n)?Math.max(n.length,e):e,4);if(t>=4){let e=new Array(t).fill(null),n=t/2;for(let i of r.extent.spatial.bbox){if(!Array.isArray(i)||i.length<4)break;for(let s in i){let o=i[s];e[s]===null?e[s]=o:s<n?e[s]=Math.min(o,e[s]):e[s]=Math.max(o,e[s])}}e.findIndex(i=>i===null)===-1&&r.extent.spatial.bbox.unshift(e)}}}},collectionAssets(r){Ft.before("1.0.0-rc.1")&&k.removeExtension(r,"collection-assets"),ca.migrateAll(r)},itemAsset(r){Ft.before("1.0.0-beta.2")&&k.rename(r,"item_assets","assets"),ca.migrateAll(r,"item_assets")},summaries(r){if(k.ensure(r,"summaries",{}),Ft.before("0.8.0")&&k.isObject(r.other_properties)){for(let t in r.other_properties){let e=r.other_properties[t];Array.isArray(e.extent)&&e.extent.length===2?r.summaries[t]={minimum:e.extent[0],maximum:e.extent[1]}:Array.isArray(e.values)&&(e.values.filter(n=>Array.isArray(n)).length===e.values.length?r.summaries[t]=e.values.reduce((n,i)=>n.concat(i),[]):r.summaries[t]=e.values)}delete r.other_properties}if(Ft.before("1.0.0-beta.1")&&k.isObject(r.properties)&&!r.links.find(t=>["child","item"].includes(t.rel)))for(let t in r.properties){let e=r.properties[t];Array.isArray(e)||(e=[e]),r.summaries[t]=e}Ft.before("1.0.0-rc.1")&&k.mapObject(r.summaries,t=>(k.rename(t,"min","minimum"),k.rename(t,"max","maximum"),t)),$h.migrate(r.summaries,r,!0),k.moveTo(r.summaries,"sci:doi",r,!0)&&k.addExtension(r,ft.scientific),k.moveTo(r.summaries,"sci:publications",r,!0,!0)&&k.addExtension(r,ft.scientific),k.moveTo(r.summaries,"sci:citation",r,!0)&&k.addExtension(r,ft.scientific),k.moveTo(r.summaries,"cube:dimensions",r,!0)&&k.addExtension(r,ft.datacube),Object.keys(r.summaries).length===0&&delete r.summaries}},Df={migrate(r,t=null,e=!0){Ft.set(r),e&&(r.stac_version=Of),k.ensure(r,"stac_extensions",[]),Ft.before("1.0.0-rc.1")&&k.migrateExtensionShortnames(r),k.ensure(r,"id",""),k.ensure(r,"type","Feature"),k.isObject(r.geometry)||(r.geometry=null),r.geometry!==null&&k.ensure(r,"bbox",[]),k.ensure(r,"properties",{}),k.ensure(r,"links",[]),k.ensure(r,"assets",{});let n=!1;return k.isObject(t)&&k.isObject(t.properties)&&(k.removeFromArray(r,"stac_extensions","commons"),r.properties=Object.assign({},t.properties,r.properties),n=!0),k.runAll(Df,r,r),$h.migrate(r.properties,r),ca.migrateAll(r),(Ft.before("0.8.0")||n)&&k.populateExtensions(r,"item"),r}},r1={migrate(r,t=!0){return k.ensure(r,"collections",[]),k.ensure(r,"links",[]),k.runAll(r1,r,r),r.collections=r.collections.map(e=>Nf.migrate(e,t)),r}},n1={migrate(r,t=!0){return k.ensure(r,"type","FeatureCollection"),k.ensure(r,"features",[]),k.ensure(r,"links",[]),k.runAll(n1,r,r),r.features=r.features.map(e=>Df.migrate(e,null,t)),r}},ca={migrateAll(r,t="assets"){for(let e in r[t])ca.migrate(r[t][e],r)},migrate(r,t){return k.runAll(ca,r,t),$h.migrate(r,t),r},mediaTypes(r){k.is(r.type,"string")&&k.mapValues(r,"type",["image/vnd.stac.geotiff","image/vnd.stac.geotiff; cloud-optimized=true"],["image/tiff; application=geotiff","image/tiff; application=geotiff; profile=cloud-optimized"])},eo(r,t){let e=k.isObject(t.properties)&&Array.isArray(t.properties["eo:bands"])?t.properties["eo:bands"]:[];if(Array.isArray(r["eo:bands"]))for(let n in r["eo:bands"]){let i=r["eo:bands"][n];k.is(i,"number")&&k.isObject(e[i])?i=e[i]:k.isObject(i)||(i={}),r["eo:bands"][n]=i}}},$h={migrate(r,t,e=!1){return k.runAll($h,r,t,e),r},_commonMetadata(r){Ft.before("1.0.0-rc.3")&&(k.toUTC(r,"created"),k.toUTC(r,"updated"))},_timestamps(r,t){k.toUTC(r,"published"),k.toUTC(r,"expires"),k.toUTC(r,"unpublished"),k.upgradeExtension(t,ft.timestamps)},_versioningIndicator(r,t){k.upgradeExtension(t,ft.version)},checksum(r,t){Ft.before("0.9.0")&&en.multihash&&(k.rename(r,"checksum:md5","checksum:multihash")&&en.toMultihash(r,"checksum:multihash","md5"),k.rename(r,"checksum:sha1","checksum:multihash")&&en.toMultihash(r,"checksum:multihash","sha1"),k.rename(r,"checksum:sha2","checksum:multihash")&&en.toMultihash(r,"checksum:multihash","sha2-256"),k.rename(r,"checksum:sha3","checksum:multihash")&&en.toMultihash(r,"checksum:multihash","sha3-256")),Ft.before("1.0.0-rc.1")&&k.rename(r,"checksum:multihash","file:checksum")&&k.addExtension(t,ft.file),k.removeExtension(t,"checksum")},classification(r,t){Ft.before("1.1.0","classification")&&k.forAll(r,"classification:classes",e=>k.rename(e,"color-hint","color_hint")),k.upgradeExtension(t,ft.classification)},cube(r,t){k.upgradeExtension(t,ft.datacube)},dtr(r,t){Ft.before("0.9.0")&&(k.rename(r,"dtr:start_datetime","start_datetime"),k.rename(r,"dtr:end_datetime","end_datetime"),k.removeExtension(t,"datetime-range"))},eo(r,t){Ft.before("0.9.0")&&(k.rename(r,"eo:epsg","proj:epsg")&&k.addExtension(t,ft.projection),k.rename(r,"eo:platform","platform"),k.rename(r,"eo:instrument","instruments")&&k.toArray(r,"instruments"),k.rename(r,"eo:constellation","constellation"),k.rename(r,"eo:off_nadir","view:off_nadir")&&k.addExtension(t,ft.view),k.rename(r,"eo:azimuth","view:azimuth")&&k.addExtension(t,ft.view),k.rename(r,"eo:incidence_angle","view:incidence_angle")&&k.addExtension(t,ft.view),k.rename(r,"eo:sun_azimuth","view:sun_azimuth")&&k.addExtension(t,ft.view),k.rename(r,"eo:sun_elevation","view:sun_elevation")&&k.addExtension(t,ft.view)),Ft.before("1.0.0-beta.1")&&k.rename(r,"eo:gsd","gsd"),k.upgradeExtension(t,ft.eo)},file(r,t){k.upgradeExtension(t,ft.file)},label(r,t){Ft.before("0.8.0")&&(k.rename(r,"label:property","label:properties"),k.rename(r,"label:task","label:tasks"),k.rename(r,"label:overview","label:overviews")&&k.toArray(r,"label:overviews"),k.rename(r,"label:method","label:methods"),k.toArray(r,"label:classes")),k.upgradeExtension(t,ft.label)},pc(r,t){Ft.before("0.8.0")&&k.rename(r,"pc:schema","pc:schemas"),k.upgradeExtension(t,ft.pointcloud)},processing(r,t){k.upgradeExtension(t,ft.processing)},proj(r,t){k.upgradeExtension(t,ft.projection)},raster(r,t){k.upgradeExtension(t,ft.raster)},sar(r,t,e){k.rename(r,"sar:incidence_angle","view:incidence_angle")&&k.addExtension(t,ft.view),k.rename(r,"sar:pass_direction","sat:orbit_state")&&k.mapValues(r,"sat:orbit_state",[null],["geostationary"])&&k.addExtension(t,ft.sat),Ft.before("0.7.0")&&(k.flattenArray(r,"sar:resolution",["sar:resolution_range","sar:resolution_azimuth"],e),k.flattenArray(r,"sar:pixel_spacing",["sar:pixel_spacing_range","sar:pixel_spacing_azimuth"],e),k.flattenArray(r,"sar:looks",["sar:looks_range","sar:looks_azimuth","sar:looks_equivalent_number"],e),k.rename(r,"sar:off_nadir","view:off_nadir")&&k.addExtension(t,ft.view)),Ft.before("0.9.0")&&(k.rename(r,"sar:platform","platform"),k.rename(r,"sar:instrument","instruments")&&k.toArray(r,"instruments"),k.rename(r,"sar:constellation","constellation"),k.rename(r,"sar:type","sar:product_type"),k.rename(r,"sar:polarization","sar:polarizations"),k.flattenOneElementArray(r,"sar:absolute_orbit",e)&&k.rename(r,"sar:absolute_orbit","sat:absolute_orbit")&&k.addExtension(t,ft.sat),k.flattenOneElementArray(r,"sar:relative_orbit",e)&&k.rename(r,"sar:relative_orbit","sat:relative_orbit")&&k.addExtension(t,ft.sat)),k.upgradeExtension(t,ft.sar)},sat(r,t){Ft.before("0.9.0")&&(k.rename(r,"sat:off_nadir_angle","sat:off_nadir"),k.rename(r,"sat:azimuth_angle","sat:azimuth"),k.rename(r,"sat:sun_azimuth_angle","sat:sun_azimuth"),k.rename(r,"sat:sun_elevation_angle","sat:sun_elevation")),k.upgradeExtension(t,ft.sat)},sci(r,t){k.upgradeExtension(t,ft.scientific)},item(r){Ft.before("0.8.0")&&(k.rename(r,"item:license","license"),k.rename(r,"item:providers","providers"))},table(r,t){k.upgradeExtension(t,ft.table)},view(r,t){k.upgradeExtension(t,ft.view)}},ps={item(r,t=null,e=!0){return Df.migrate(r,t,e)},catalog(r,t=!0){return Ff.migrate(r,t)},collection(r,t=!0){return Nf.migrate(r,t)},collectionCollection(r,t=!0){return r1.migrate(r,t)},itemCollection(r,t=!0){return n1.migrate(r,t)},stac(r,t=!0){return r.type==="Feature"?ps.item(r,null,t):r.type==="FeatureCollection"?ps.itemCollection(r,t):r.type==="Collection"||!r.type&&k.isDefined(r.extent)&&k.isDefined(r.license)?ps.collection(r,t):!r.type&&Array.isArray(r.collections)?ps.collectionCollection(r,t):ps.catalog(r,t)},enableMultihash(r){en.multihash=r}},eO=ps;const rO=Ks(eO);function oo(r){let t=r.length>=6,e=r[0],n=r[t?3:2],i=r[1],s=r[t?4:3],o={west:e,east:n,south:i,north:s};return t&&(o.base=r[2],o.height=r[5]),o}function Gu(r){let{west:t,east:e,south:n,north:i}=oo(r);return[[[t,i],[t,n],[e,n],[e,i],[t,i]]]}function nO(r){if(!zr(r))return null;let t=oo(r),e=[];if(s1(r)){let n=(t.west+360+t.east)/2;n>180&&(n-=360),e.push(n)}else e.push((t.west+t.east)/2);return e.push((t.south+t.north)/2),typeof t.base<"u"&&e.push((t.base+t.height)/2),e}function i1(r){if(zr(r)?r=[r]:Array.isArray(r)&&(r=r.filter(n=>zr(n))),!Array.isArray(r)||r.length===0)return null;let t=r.reduce((n,i)=>{if(s1(i)){let{west:s,east:o,south:a,north:l}=oo(i);n.push(Gu([-180,a,o,l])),n.push(Gu([s,a,180,l]))}else n.push(Gu(i));return n},[]),e=null;if(t.length===1?e={type:"Polygon",coordinates:t[0]}:t.length>1&&(e={type:"MultiPolygon",coordinates:t}),e)return{type:"Feature",geometry:e,properties:{}}}function zr(r){if(!Array.isArray(r)||![4,6].includes(r.length)||r.some(s=>typeof s!="number"))return!1;let{west:t,east:e,south:n,north:i}=oo(r);return n<=i&&t>=-180&&t<=180&&n>=-90&&e<=180&&e>=-180&&i<=90}function s1(r){if(!zr(r))return!1;let{west:t,east:e}=oo(r);return t>e}function o1(r){if(!Array.isArray(r)||r.length===0)return null;let t={west:180,south:90,east:-180,north:-90};r.forEach(n=>{if(!zr(n))return;let i=oo(n),s=["west","south"];for(let o in i){let a=s.includes(o)?Math.min:Math.max;t[o]=a(t[o],i[o])}});let e=[t.west,t.south,t.east,t.north];return zr(e)?e:null}function ar(r){return typeof r=="string"&&r.length>0}function er(r){return typeof r=="object"&&r===Object(r)&&!Array.isArray(r)}function a1(...r){if(r=r.filter(t=>Array.isArray(t)),r.length>1){let t=Math.max(...r.map(n=>n.length)),e=[];for(let n=0;n<t;n++)e.push(Object.assign({},...r.map(i=>i[n])));return e}else if(r.length===1)return r[0];return[]}function iO(r){switch(r){case"int8":return-128;case"int16":return-32768;case"int32":return-2147483648}return r.startsWith("u")?0:null}function sO(r){switch(r){case"int8":return 127;case"uint8":return 255;case"int16":return 32767;case"uint16":return 65535;case"int32":return 2147483647;case"uint32":return 4294967295}return null}class Vh{constructor(t,e={},n=[]){if(!er(t))throw new Error("Given data is not an object");if(t instanceof Vh){for(let i of n)this[i]=t[i];t=t.toJSON()}this._keyMap=e,this._privateKeys=["_keyMap","_privateKeys"].concat(n);for(let i in t)typeof this[i]>"u"&&(i in e?this[i]=e[i](t[i],this):this[i]=t[i])}isItem(){return this.type==="Feature"}isCatalog(){return this.type==="Catalog"}isCatalogLike(){return this.isCatalog()||this.isCollection()}isCollection(){return this.type==="Collection"}isItemCollection(){return this.type==="FeatureCollection"}isCollectionCollection(){return!1}isAsset(){return!1}isLink(){return!1}getObjectType(){}getAbsoluteUrl(){return null}getMetadata(t){return this[t]}toGeoJSON(){return null}getBoundingBox(){return null}getCenter(){return nO(this.getBoundingBox())}getBoundingBoxes(){return[]}toJSON(){let t={};return Object.keys(this).forEach(e=>{if(typeof this[e]=="function"||this._privateKeys.includes(e))return;let n=this[e];if(e in this._keyMap){let i=Array.isArray(n)?[]:{};for(let s in n)i[s]=n[s].toJSON();n=i}t[e]=n}),t}}var l1={exports:{}},_l={exports:{}};/*! https://mths.be/punycode v1.4.0 by @mathias */_l.exports;var em;function oO(){return em||(em=1,function(r,t){(function(e){var n=t&&!t.nodeType&&t,i=r&&!r.nodeType&&r,s=typeof Oi=="object"&&Oi;(s.global===s||s.window===s||s.self===s)&&(e=s);var o,a=2147483647,l=36,h=1,u=26,c=38,f=700,g=72,m=128,_="-",x=/^xn--/,v=/[^\x20-\x7E]/,w=/[\x2E\u3002\uFF0E\uFF61]/g,S={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},E=l-h,T=Math.floor,R=String.fromCharCode,C;function I(L){throw new RangeError(S[L])}function F(L,D){for(var X=L.length,K=[];X--;)K[X]=D(L[X]);return K}function U(L,D){var X=L.split("@"),K="";X.length>1&&(K=X[0]+"@",L=X[1]),L=L.replace(w,".");var G=L.split("."),H=F(G,D).join(".");return K+H}function j(L){for(var D=[],X=0,K=L.length,G,H;X<K;)G=L.charCodeAt(X++),G>=55296&&G<=56319&&X<K?(H=L.charCodeAt(X++),(H&64512)==56320?D.push(((G&1023)<<10)+(H&1023)+65536):(D.push(G),X--)):D.push(G);return D}function B(L){return F(L,function(D){var X="";return D>65535&&(D-=65536,X+=R(D>>>10&1023|55296),D=56320|D&1023),X+=R(D),X}).join("")}function d(L){return L-48<10?L-22:L-65<26?L-65:L-97<26?L-97:l}function p(L,D){return L+22+75*(L<26)-((D!=0)<<5)}function y(L,D,X){var K=0;for(L=X?T(L/f):L>>1,L+=T(L/D);L>E*u>>1;K+=l)L=T(L/E);return T(K+(E+1)*L/(L+c))}function b(L){var D=[],X=L.length,K,G=0,H=m,Q=g,nt,xt,dt,Tt,St,Dt,Yt,ce,Ht;for(nt=L.lastIndexOf(_),nt<0&&(nt=0),xt=0;xt<nt;++xt)L.charCodeAt(xt)>=128&&I("not-basic"),D.push(L.charCodeAt(xt));for(dt=nt>0?nt+1:0;dt<X;){for(Tt=G,St=1,Dt=l;dt>=X&&I("invalid-input"),Yt=d(L.charCodeAt(dt++)),(Yt>=l||Yt>T((a-G)/St))&&I("overflow"),G+=Yt*St,ce=Dt<=Q?h:Dt>=Q+u?u:Dt-Q,!(Yt<ce);Dt+=l)Ht=l-ce,St>T(a/Ht)&&I("overflow"),St*=Ht;K=D.length+1,Q=y(G-Tt,K,Tt==0),T(G/K)>a-H&&I("overflow"),H+=T(G/K),G%=K,D.splice(G++,0,H)}return B(D)}function M(L){var D,X,K,G,H,Q,nt,xt,dt,Tt,St,Dt=[],Yt,ce,Ht,Ke;for(L=j(L),Yt=L.length,D=m,X=0,H=g,Q=0;Q<Yt;++Q)St=L[Q],St<128&&Dt.push(R(St));for(K=G=Dt.length,G&&Dt.push(_);K<Yt;){for(nt=a,Q=0;Q<Yt;++Q)St=L[Q],St>=D&&St<nt&&(nt=St);for(ce=K+1,nt-D>T((a-X)/ce)&&I("overflow"),X+=(nt-D)*ce,D=nt,Q=0;Q<Yt;++Q)if(St=L[Q],St<D&&++X>a&&I("overflow"),St==D){for(xt=X,dt=l;Tt=dt<=H?h:dt>=H+u?u:dt-H,!(xt<Tt);dt+=l)Ke=xt-Tt,Ht=l-Tt,Dt.push(R(p(Tt+Ke%Ht,0))),xt=T(Ke/Ht);Dt.push(R(p(xt,0))),H=y(X,ce,K==G),X=0,++K}++X,++D}return Dt.join("")}function P(L){return U(L,function(D){return x.test(D)?b(D.slice(4).toLowerCase()):D})}function A(L){return U(L,function(D){return v.test(D)?"xn--"+M(D):D})}if(o={version:"1.3.2",ucs2:{decode:j,encode:B},decode:b,encode:M,toASCII:A,toUnicode:P},n&&i)if(r.exports==n)i.exports=o;else for(C in o)o.hasOwnProperty(C)&&(n[C]=o[C]);else e.punycode=o})(Oi)}(_l,_l.exports)),_l.exports}var rm={exports:{}};/*!
 * URI.js - Mutating URLs
 * IPv6 Support
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */var nm;function aO(){return nm||(nm=1,function(r){(function(t,e){r.exports?r.exports=e():t.IPv6=e(t)})(Oi,function(t){var e=t&&t.IPv6;function n(s){var o=s.toLowerCase(),a=o.split(":"),l=a.length,h=8;a[0]===""&&a[1]===""&&a[2]===""?(a.shift(),a.shift()):a[0]===""&&a[1]===""?a.shift():a[l-1]===""&&a[l-2]===""&&a.pop(),l=a.length,a[l-1].indexOf(".")!==-1&&(h=7);var u;for(u=0;u<l&&a[u]!=="";u++);if(u<h)for(a.splice(u,1,"0000");a.length<h;)a.splice(u,0,"0000");for(var c,f=0;f<h;f++){c=a[f].split("");for(var g=0;g<3&&c[0]==="0"&&c.length>1;g++)c.splice(0,1);a[f]=c.join("")}var m=-1,_=0,x=0,v=-1,w=!1;for(f=0;f<h;f++)w?a[f]==="0"?x+=1:(w=!1,x>_&&(m=v,_=x)):a[f]==="0"&&(w=!0,v=f,x=1);x>_&&(m=v,_=x),_>1&&a.splice(m,_,""),l=a.length;var S="";for(a[0]===""&&(S=":"),f=0;f<l&&(S+=a[f],f!==l-1);f++)S+=":";return a[l-1]===""&&(S+=":"),S}function i(){return t.IPv6===this&&(t.IPv6=e),this}return{best:n,noConflict:i}})}(rm)),rm.exports}var im={exports:{}};/*!
 * URI.js - Mutating URLs
 * Second Level Domain (SLD) Support
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */var sm;function lO(){return sm||(sm=1,function(r){(function(t,e){r.exports?r.exports=e():t.SecondLevelDomains=e(t)})(Oi,function(t){var e=t&&t.SecondLevelDomains,n={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ",do:" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",hu:" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ",in:" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch ",com:"ar br cn de eu gb gr hu jpn kr no qc ru sa se uk us uy za ",net:"gb jp se uk ",org:"ae",de:"com "},has:function(i){var s=i.lastIndexOf(".");if(s<=0||s>=i.length-1)return!1;var o=i.lastIndexOf(".",s-1);if(o<=0||o>=s-1)return!1;var a=n.list[i.slice(s+1)];return a?a.indexOf(" "+i.slice(o+1,s)+" ")>=0:!1},is:function(i){var s=i.lastIndexOf(".");if(s<=0||s>=i.length-1)return!1;var o=i.lastIndexOf(".",s-1);if(o>=0)return!1;var a=n.list[i.slice(s+1)];return a?a.indexOf(" "+i.slice(0,s)+" ")>=0:!1},get:function(i){var s=i.lastIndexOf(".");if(s<=0||s>=i.length-1)return null;var o=i.lastIndexOf(".",s-1);if(o<=0||o>=s-1)return null;var a=n.list[i.slice(s+1)];return!a||a.indexOf(" "+i.slice(o+1,s)+" ")<0?null:i.slice(o+1)},noConflict:function(){return t.SecondLevelDomains===this&&(t.SecondLevelDomains=e),this}};return n})}(im)),im.exports}/*!
 * URI.js - Mutating URLs
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */(function(r){(function(t,e){r.exports?r.exports=e(oO(),aO(),lO()):t.URI=e(t.punycode,t.IPv6,t.SecondLevelDomains,t)})(Oi,function(t,e,n,i){var s=i&&i.URI;function o(d,p){var y=arguments.length>=1,b=arguments.length>=2;if(!(this instanceof o))return y?b?new o(d,p):new o(d):new o;if(d===void 0){if(y)throw new TypeError("undefined is not a valid argument for URI");typeof location<"u"?d=location.href+"":d=""}if(d===null&&y)throw new TypeError("null is not a valid argument for URI");return this.href(d),p!==void 0?this.absoluteTo(p):this}function a(d){return/^[0-9]+$/.test(d)}o.version="1.19.11";var l=o.prototype,h=Object.prototype.hasOwnProperty;function u(d){return d.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function c(d){return d===void 0?"Undefined":String(Object.prototype.toString.call(d)).slice(8,-1)}function f(d){return c(d)==="Array"}function g(d,p){var y={},b,M;if(c(p)==="RegExp")y=null;else if(f(p))for(b=0,M=p.length;b<M;b++)y[p[b]]=!0;else y[p]=!0;for(b=0,M=d.length;b<M;b++){var P=y&&y[d[b]]!==void 0||!y&&p.test(d[b]);P&&(d.splice(b,1),M--,b--)}return d}function m(d,p){var y,b;if(f(p)){for(y=0,b=p.length;y<b;y++)if(!m(d,p[y]))return!1;return!0}var M=c(p);for(y=0,b=d.length;y<b;y++)if(M==="RegExp"){if(typeof d[y]=="string"&&d[y].match(p))return!0}else if(d[y]===p)return!0;return!1}function _(d,p){if(!f(d)||!f(p)||d.length!==p.length)return!1;d.sort(),p.sort();for(var y=0,b=d.length;y<b;y++)if(d[y]!==p[y])return!1;return!0}function x(d){var p=/^\/+|\/+$/g;return d.replace(p,"")}o._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,preventInvalidHostname:o.preventInvalidHostname,duplicateQueryParameters:o.duplicateQueryParameters,escapeQuerySpace:o.escapeQuerySpace}},o.preventInvalidHostname=!1,o.duplicateQueryParameters=!1,o.escapeQuerySpace=!0,o.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,o.idn_expression=/[^a-z0-9\._-]/i,o.punycode_expression=/(xn--)/i,o.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,o.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,o.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/ig,o.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g},o.leading_whitespace_expression=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,o.ascii_tab_whitespace=/[\u0009\u000A\u000D]+/g,o.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},o.hostProtocols=["http","https"],o.invalid_hostname_characters=/[^a-zA-Z0-9\.\-:_]/,o.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},o.getDomAttribute=function(d){if(!(!d||!d.nodeName)){var p=d.nodeName.toLowerCase();if(!(p==="input"&&d.type!=="image"))return o.domAttributes[p]}};function v(d){return escape(d)}function w(d){return encodeURIComponent(d).replace(/[!'()*]/g,v).replace(/\*/g,"%2A")}o.encode=w,o.decode=decodeURIComponent,o.iso8859=function(){o.encode=escape,o.decode=unescape},o.unicode=function(){o.encode=w,o.decode=decodeURIComponent},o.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/ig,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},o.encodeQuery=function(d,p){var y=o.encode(d+"");return p===void 0&&(p=o.escapeQuerySpace),p?y.replace(/%20/g,"+"):y},o.decodeQuery=function(d,p){d+="",p===void 0&&(p=o.escapeQuerySpace);try{return o.decode(p?d.replace(/\+/g,"%20"):d)}catch{return d}};var S={encode:"encode",decode:"decode"},E,T=function(d,p){return function(y){try{return o[p](y+"").replace(o.characters[d][p].expression,function(b){return o.characters[d][p].map[b]})}catch{return y}}};for(E in S)o[E+"PathSegment"]=T("pathname",S[E]),o[E+"UrnPathSegment"]=T("urnpath",S[E]);var R=function(d,p,y){return function(b){var M;y?M=function(D){return o[p](o[y](D))}:M=o[p];for(var P=(b+"").split(d),A=0,L=P.length;A<L;A++)P[A]=M(P[A]);return P.join(d)}};o.decodePath=R("/","decodePathSegment"),o.decodeUrnPath=R(":","decodeUrnPathSegment"),o.recodePath=R("/","encodePathSegment","decode"),o.recodeUrnPath=R(":","encodeUrnPathSegment","decode"),o.encodeReserved=T("reserved","encode"),o.parse=function(d,p){var y;return p||(p={preventInvalidHostname:o.preventInvalidHostname}),d=d.replace(o.leading_whitespace_expression,""),d=d.replace(o.ascii_tab_whitespace,""),y=d.indexOf("#"),y>-1&&(p.fragment=d.substring(y+1)||null,d=d.substring(0,y)),y=d.indexOf("?"),y>-1&&(p.query=d.substring(y+1)||null,d=d.substring(0,y)),d=d.replace(/^(https?|ftp|wss?)?:+[/\\]*/i,"$1://"),d=d.replace(/^[/\\]{2,}/i,"//"),d.substring(0,2)==="//"?(p.protocol=null,d=d.substring(2),d=o.parseAuthority(d,p)):(y=d.indexOf(":"),y>-1&&(p.protocol=d.substring(0,y)||null,p.protocol&&!p.protocol.match(o.protocol_expression)?p.protocol=void 0:d.substring(y+1,y+3).replace(/\\/g,"/")==="//"?(d=d.substring(y+3),d=o.parseAuthority(d,p)):(d=d.substring(y+1),p.urn=!0))),p.path=d,p},o.parseHost=function(d,p){d||(d=""),d=d.replace(/\\/g,"/");var y=d.indexOf("/"),b,M;if(y===-1&&(y=d.length),d.charAt(0)==="[")b=d.indexOf("]"),p.hostname=d.substring(1,b)||null,p.port=d.substring(b+2,y)||null,p.port==="/"&&(p.port=null);else{var P=d.indexOf(":"),A=d.indexOf("/"),L=d.indexOf(":",P+1);L!==-1&&(A===-1||L<A)?(p.hostname=d.substring(0,y)||null,p.port=null):(M=d.substring(0,y).split(":"),p.hostname=M[0]||null,p.port=M[1]||null)}return p.hostname&&d.substring(y).charAt(0)!=="/"&&(y++,d="/"+d),p.preventInvalidHostname&&o.ensureValidHostname(p.hostname,p.protocol),p.port&&o.ensureValidPort(p.port),d.substring(y)||"/"},o.parseAuthority=function(d,p){return d=o.parseUserinfo(d,p),o.parseHost(d,p)},o.parseUserinfo=function(d,p){var y=d,b=d.indexOf("\\");b!==-1&&(d=d.replace(/\\/g,"/"));var M=d.indexOf("/"),P=d.lastIndexOf("@",M>-1?M:d.length-1),A;return P>-1&&(M===-1||P<M)?(A=d.substring(0,P).split(":"),p.username=A[0]?o.decode(A[0]):null,A.shift(),p.password=A[0]?o.decode(A.join(":")):null,d=y.substring(P+1)):(p.username=null,p.password=null),d},o.parseQuery=function(d,p){if(!d)return{};if(d=d.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!d)return{};for(var y={},b=d.split("&"),M=b.length,P,A,L,D=0;D<M;D++)P=b[D].split("="),A=o.decodeQuery(P.shift(),p),L=P.length?o.decodeQuery(P.join("="),p):null,A!=="__proto__"&&(h.call(y,A)?((typeof y[A]=="string"||y[A]===null)&&(y[A]=[y[A]]),y[A].push(L)):y[A]=L);return y},o.build=function(d){var p="",y=!1;return d.protocol&&(p+=d.protocol+":"),!d.urn&&(p||d.hostname)&&(p+="//",y=!0),p+=o.buildAuthority(d)||"",typeof d.path=="string"&&(d.path.charAt(0)!=="/"&&y&&(p+="/"),p+=d.path),typeof d.query=="string"&&d.query&&(p+="?"+d.query),typeof d.fragment=="string"&&d.fragment&&(p+="#"+d.fragment),p},o.buildHost=function(d){var p="";if(d.hostname)o.ip6_expression.test(d.hostname)?p+="["+d.hostname+"]":p+=d.hostname;else return"";return d.port&&(p+=":"+d.port),p},o.buildAuthority=function(d){return o.buildUserinfo(d)+o.buildHost(d)},o.buildUserinfo=function(d){var p="";return d.username&&(p+=o.encode(d.username)),d.password&&(p+=":"+o.encode(d.password)),p&&(p+="@"),p},o.buildQuery=function(d,p,y){var b="",M,P,A,L;for(P in d)if(P!=="__proto__"&&h.call(d,P))if(f(d[P]))for(M={},A=0,L=d[P].length;A<L;A++)d[P][A]!==void 0&&M[d[P][A]+""]===void 0&&(b+="&"+o.buildQueryParameter(P,d[P][A],y),p!==!0&&(M[d[P][A]+""]=!0));else d[P]!==void 0&&(b+="&"+o.buildQueryParameter(P,d[P],y));return b.substring(1)},o.buildQueryParameter=function(d,p,y){return o.encodeQuery(d,y)+(p!==null?"="+o.encodeQuery(p,y):"")},o.addQuery=function(d,p,y){if(typeof p=="object")for(var b in p)h.call(p,b)&&o.addQuery(d,b,p[b]);else if(typeof p=="string"){if(d[p]===void 0){d[p]=y;return}else typeof d[p]=="string"&&(d[p]=[d[p]]);f(y)||(y=[y]),d[p]=(d[p]||[]).concat(y)}else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter")},o.setQuery=function(d,p,y){if(typeof p=="object")for(var b in p)h.call(p,b)&&o.setQuery(d,b,p[b]);else if(typeof p=="string")d[p]=y===void 0?null:y;else throw new TypeError("URI.setQuery() accepts an object, string as the name parameter")},o.removeQuery=function(d,p,y){var b,M,P;if(f(p))for(b=0,M=p.length;b<M;b++)d[p[b]]=void 0;else if(c(p)==="RegExp")for(P in d)p.test(P)&&(d[P]=void 0);else if(typeof p=="object")for(P in p)h.call(p,P)&&o.removeQuery(d,P,p[P]);else if(typeof p=="string")y!==void 0?c(y)==="RegExp"?!f(d[p])&&y.test(d[p])?d[p]=void 0:d[p]=g(d[p],y):d[p]===String(y)&&(!f(y)||y.length===1)?d[p]=void 0:f(d[p])&&(d[p]=g(d[p],y)):d[p]=void 0;else throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter")},o.hasQuery=function(d,p,y,b){switch(c(p)){case"String":break;case"RegExp":for(var M in d)if(h.call(d,M)&&p.test(M)&&(y===void 0||o.hasQuery(d,M,y)))return!0;return!1;case"Object":for(var P in p)if(h.call(p,P)&&!o.hasQuery(d,P,p[P]))return!1;return!0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(c(y)){case"Undefined":return p in d;case"Boolean":var A=!!(f(d[p])?d[p].length:d[p]);return y===A;case"Function":return!!y(d[p],p,d);case"Array":if(!f(d[p]))return!1;var L=b?m:_;return L(d[p],y);case"RegExp":return f(d[p])?b?m(d[p],y):!1:!!(d[p]&&d[p].match(y));case"Number":y=String(y);case"String":return f(d[p])?b?m(d[p],y):!1:d[p]===y;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},o.joinPaths=function(){for(var d=[],p=[],y=0,b=0;b<arguments.length;b++){var M=new o(arguments[b]);d.push(M);for(var P=M.segment(),A=0;A<P.length;A++)typeof P[A]=="string"&&p.push(P[A]),P[A]&&y++}if(!p.length||!y)return new o("");var L=new o("").segment(p);return(d[0].path()===""||d[0].path().slice(0,1)==="/")&&L.path("/"+L.path()),L.normalize()},o.commonPath=function(d,p){var y=Math.min(d.length,p.length),b;for(b=0;b<y;b++)if(d.charAt(b)!==p.charAt(b)){b--;break}return b<1?d.charAt(0)===p.charAt(0)&&d.charAt(0)==="/"?"/":"":((d.charAt(b)!=="/"||p.charAt(b)!=="/")&&(b=d.substring(0,b).lastIndexOf("/")),d.substring(0,b+1))},o.withinString=function(d,p,y){y||(y={});var b=y.start||o.findUri.start,M=y.end||o.findUri.end,P=y.trim||o.findUri.trim,A=y.parens||o.findUri.parens,L=/[a-z0-9-]=["']?$/i;for(b.lastIndex=0;;){var D=b.exec(d);if(!D)break;var X=D.index;if(y.ignoreHtml){var K=d.slice(Math.max(X-3,0),X);if(K&&L.test(K))continue}for(var G=X+d.slice(X).search(M),H=d.slice(X,G),Q=-1;;){var nt=A.exec(H);if(!nt)break;var xt=nt.index+nt[0].length;Q=Math.max(Q,xt)}if(Q>-1?H=H.slice(0,Q)+H.slice(Q).replace(P,""):H=H.replace(P,""),!(H.length<=D[0].length)&&!(y.ignore&&y.ignore.test(H))){G=X+H.length;var dt=p(H,X,G,d);if(dt===void 0){b.lastIndex=G;continue}dt=String(dt),d=d.slice(0,X)+dt+d.slice(G),b.lastIndex=X+dt.length}}return b.lastIndex=0,d},o.ensureValidHostname=function(d,p){var y=!!d,b=!!p,M=!1;if(b&&(M=m(o.hostProtocols,p)),M&&!y)throw new TypeError("Hostname cannot be empty, if protocol is "+p);if(d&&d.match(o.invalid_hostname_characters)){if(!t)throw new TypeError('Hostname "'+d+'" contains characters other than [A-Z0-9.-:_] and Punycode.js is not available');if(t.toASCII(d).match(o.invalid_hostname_characters))throw new TypeError('Hostname "'+d+'" contains characters other than [A-Z0-9.-:_]')}},o.ensureValidPort=function(d){if(d){var p=Number(d);if(!(a(p)&&p>0&&p<65536))throw new TypeError('Port "'+d+'" is not a valid port')}},o.noConflict=function(d){if(d){var p={URI:this.noConflict()};return i.URITemplate&&typeof i.URITemplate.noConflict=="function"&&(p.URITemplate=i.URITemplate.noConflict()),i.IPv6&&typeof i.IPv6.noConflict=="function"&&(p.IPv6=i.IPv6.noConflict()),i.SecondLevelDomains&&typeof i.SecondLevelDomains.noConflict=="function"&&(p.SecondLevelDomains=i.SecondLevelDomains.noConflict()),p}else i.URI===this&&(i.URI=s);return this},l.build=function(d){return d===!0?this._deferred_build=!0:(d===void 0||this._deferred_build)&&(this._string=o.build(this._parts),this._deferred_build=!1),this},l.clone=function(){return new o(this)},l.valueOf=l.toString=function(){return this.build(!1)._string};function C(d){return function(p,y){return p===void 0?this._parts[d]||"":(this._parts[d]=p||null,this.build(!y),this)}}function I(d,p){return function(y,b){return y===void 0?this._parts[d]||"":(y!==null&&(y=y+"",y.charAt(0)===p&&(y=y.substring(1))),this._parts[d]=y,this.build(!b),this)}}l.protocol=C("protocol"),l.username=C("username"),l.password=C("password"),l.hostname=C("hostname"),l.port=C("port"),l.query=I("query","?"),l.fragment=I("fragment","#"),l.search=function(d,p){var y=this.query(d,p);return typeof y=="string"&&y.length?"?"+y:y},l.hash=function(d,p){var y=this.fragment(d,p);return typeof y=="string"&&y.length?"#"+y:y},l.pathname=function(d,p){if(d===void 0||d===!0){var y=this._parts.path||(this._parts.hostname?"/":"");return d?(this._parts.urn?o.decodeUrnPath:o.decodePath)(y):y}else return this._parts.urn?this._parts.path=d?o.recodeUrnPath(d):"":this._parts.path=d?o.recodePath(d):"/",this.build(!p),this},l.path=l.pathname,l.href=function(d,p){var y;if(d===void 0)return this.toString();this._string="",this._parts=o._parts();var b=d instanceof o,M=typeof d=="object"&&(d.hostname||d.path||d.pathname);if(d.nodeName){var P=o.getDomAttribute(d);d=d[P]||"",M=!1}if(!b&&M&&d.pathname!==void 0&&(d=d.toString()),typeof d=="string"||d instanceof String)this._parts=o.parse(String(d),this._parts);else if(b||M){var A=b?d._parts:d;for(y in A)y!=="query"&&h.call(this._parts,y)&&(this._parts[y]=A[y]);A.query&&this.query(A.query,!1)}else throw new TypeError("invalid input");return this.build(!p),this},l.is=function(d){var p=!1,y=!1,b=!1,M=!1,P=!1,A=!1,L=!1,D=!this._parts.urn;switch(this._parts.hostname&&(D=!1,y=o.ip4_expression.test(this._parts.hostname),b=o.ip6_expression.test(this._parts.hostname),p=y||b,M=!p,P=M&&n&&n.has(this._parts.hostname),A=M&&o.idn_expression.test(this._parts.hostname),L=M&&o.punycode_expression.test(this._parts.hostname)),d.toLowerCase()){case"relative":return D;case"absolute":return!D;case"domain":case"name":return M;case"sld":return P;case"ip":return p;case"ip4":case"ipv4":case"inet4":return y;case"ip6":case"ipv6":case"inet6":return b;case"idn":return A;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return L}return null};var F=l.protocol,U=l.port,j=l.hostname;l.protocol=function(d,p){if(d&&(d=d.replace(/:(\/\/)?$/,""),!d.match(o.protocol_expression)))throw new TypeError('Protocol "'+d+`" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]`);return F.call(this,d,p)},l.scheme=l.protocol,l.port=function(d,p){return this._parts.urn?d===void 0?"":this:(d!==void 0&&(d===0&&(d=null),d&&(d+="",d.charAt(0)===":"&&(d=d.substring(1)),o.ensureValidPort(d))),U.call(this,d,p))},l.hostname=function(d,p){if(this._parts.urn)return d===void 0?"":this;if(d!==void 0){var y={preventInvalidHostname:this._parts.preventInvalidHostname},b=o.parseHost(d,y);if(b!=="/")throw new TypeError('Hostname "'+d+'" contains characters other than [A-Z0-9.-]');d=y.hostname,this._parts.preventInvalidHostname&&o.ensureValidHostname(d,this._parts.protocol)}return j.call(this,d,p)},l.origin=function(d,p){if(this._parts.urn)return d===void 0?"":this;if(d===void 0){var y=this.protocol(),b=this.authority();return b?(y?y+"://":"")+this.authority():""}else{var M=o(d);return this.protocol(M.protocol()).authority(M.authority()).build(!p),this}},l.host=function(d,p){if(this._parts.urn)return d===void 0?"":this;if(d===void 0)return this._parts.hostname?o.buildHost(this._parts):"";var y=o.parseHost(d,this._parts);if(y!=="/")throw new TypeError('Hostname "'+d+'" contains characters other than [A-Z0-9.-]');return this.build(!p),this},l.authority=function(d,p){if(this._parts.urn)return d===void 0?"":this;if(d===void 0)return this._parts.hostname?o.buildAuthority(this._parts):"";var y=o.parseAuthority(d,this._parts);if(y!=="/")throw new TypeError('Hostname "'+d+'" contains characters other than [A-Z0-9.-]');return this.build(!p),this},l.userinfo=function(d,p){if(this._parts.urn)return d===void 0?"":this;if(d===void 0){var y=o.buildUserinfo(this._parts);return y&&y.substring(0,y.length-1)}else return d[d.length-1]!=="@"&&(d+="@"),o.parseUserinfo(d,this._parts),this.build(!p),this},l.resource=function(d,p){var y;return d===void 0?this.path()+this.search()+this.hash():(y=o.parse(d),this._parts.path=y.path,this._parts.query=y.query,this._parts.fragment=y.fragment,this.build(!p),this)},l.subdomain=function(d,p){if(this._parts.urn)return d===void 0?"":this;if(d===void 0){if(!this._parts.hostname||this.is("IP"))return"";var y=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,y)||""}else{var b=this._parts.hostname.length-this.domain().length,M=this._parts.hostname.substring(0,b),P=new RegExp("^"+u(M));if(d&&d.charAt(d.length-1)!=="."&&(d+="."),d.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");return d&&o.ensureValidHostname(d,this._parts.protocol),this._parts.hostname=this._parts.hostname.replace(P,d),this.build(!p),this}},l.domain=function(d,p){if(this._parts.urn)return d===void 0?"":this;if(typeof d=="boolean"&&(p=d,d=void 0),d===void 0){if(!this._parts.hostname||this.is("IP"))return"";var y=this._parts.hostname.match(/\./g);if(y&&y.length<2)return this._parts.hostname;var b=this._parts.hostname.length-this.tld(p).length-1;return b=this._parts.hostname.lastIndexOf(".",b-1)+1,this._parts.hostname.substring(b)||""}else{if(!d)throw new TypeError("cannot set domain empty");if(d.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");if(o.ensureValidHostname(d,this._parts.protocol),!this._parts.hostname||this.is("IP"))this._parts.hostname=d;else{var M=new RegExp(u(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(M,d)}return this.build(!p),this}},l.tld=function(d,p){if(this._parts.urn)return d===void 0?"":this;if(typeof d=="boolean"&&(p=d,d=void 0),d===void 0){if(!this._parts.hostname||this.is("IP"))return"";var y=this._parts.hostname.lastIndexOf("."),b=this._parts.hostname.substring(y+1);return p!==!0&&n&&n.list[b.toLowerCase()]&&n.get(this._parts.hostname)||b}else{var M;if(d)if(d.match(/[^a-zA-Z0-9-]/))if(n&&n.is(d))M=new RegExp(u(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(M,d);else throw new TypeError('TLD "'+d+'" contains characters other than [A-Z0-9]');else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");M=new RegExp(u(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(M,d)}else throw new TypeError("cannot set TLD empty");return this.build(!p),this}},l.directory=function(d,p){if(this._parts.urn)return d===void 0?"":this;if(d===void 0||d===!0){if(!this._parts.path&&!this._parts.hostname)return"";if(this._parts.path==="/")return"/";var y=this._parts.path.length-this.filename().length-1,b=this._parts.path.substring(0,y)||(this._parts.hostname?"/":"");return d?o.decodePath(b):b}else{var M=this._parts.path.length-this.filename().length,P=this._parts.path.substring(0,M),A=new RegExp("^"+u(P));return this.is("relative")||(d||(d="/"),d.charAt(0)!=="/"&&(d="/"+d)),d&&d.charAt(d.length-1)!=="/"&&(d+="/"),d=o.recodePath(d),this._parts.path=this._parts.path.replace(A,d),this.build(!p),this}},l.filename=function(d,p){if(this._parts.urn)return d===void 0?"":this;if(typeof d!="string"){if(!this._parts.path||this._parts.path==="/")return"";var y=this._parts.path.lastIndexOf("/"),b=this._parts.path.substring(y+1);return d?o.decodePathSegment(b):b}else{var M=!1;d.charAt(0)==="/"&&(d=d.substring(1)),d.match(/\.?\//)&&(M=!0);var P=new RegExp(u(this.filename())+"$");return d=o.recodePath(d),this._parts.path=this._parts.path.replace(P,d),M?this.normalizePath(p):this.build(!p),this}},l.suffix=function(d,p){if(this._parts.urn)return d===void 0?"":this;if(d===void 0||d===!0){if(!this._parts.path||this._parts.path==="/")return"";var y=this.filename(),b=y.lastIndexOf("."),M,P;return b===-1?"":(M=y.substring(b+1),P=/^[a-z0-9%]+$/i.test(M)?M:"",d?o.decodePathSegment(P):P)}else{d.charAt(0)==="."&&(d=d.substring(1));var A=this.suffix(),L;if(A)d?L=new RegExp(u(A)+"$"):L=new RegExp(u("."+A)+"$");else{if(!d)return this;this._parts.path+="."+o.recodePath(d)}return L&&(d=o.recodePath(d),this._parts.path=this._parts.path.replace(L,d)),this.build(!p),this}},l.segment=function(d,p,y){var b=this._parts.urn?":":"/",M=this.path(),P=M.substring(0,1)==="/",A=M.split(b);if(d!==void 0&&typeof d!="number"&&(y=p,p=d,d=void 0),d!==void 0&&typeof d!="number")throw new Error('Bad segment "'+d+'", must be 0-based integer');if(P&&A.shift(),d<0&&(d=Math.max(A.length+d,0)),p===void 0)return d===void 0?A:A[d];if(d===null||A[d]===void 0)if(f(p)){A=[];for(var L=0,D=p.length;L<D;L++)!p[L].length&&(!A.length||!A[A.length-1].length)||(A.length&&!A[A.length-1].length&&A.pop(),A.push(x(p[L])))}else(p||typeof p=="string")&&(p=x(p),A[A.length-1]===""?A[A.length-1]=p:A.push(p));else p?A[d]=x(p):A.splice(d,1);return P&&A.unshift(""),this.path(A.join(b),y)},l.segmentCoded=function(d,p,y){var b,M,P;if(typeof d!="number"&&(y=p,p=d,d=void 0),p===void 0){if(b=this.segment(d,p,y),!f(b))b=b!==void 0?o.decode(b):void 0;else for(M=0,P=b.length;M<P;M++)b[M]=o.decode(b[M]);return b}if(!f(p))p=typeof p=="string"||p instanceof String?o.encode(p):p;else for(M=0,P=p.length;M<P;M++)p[M]=o.encode(p[M]);return this.segment(d,p,y)};var B=l.query;return l.query=function(d,p){if(d===!0)return o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof d=="function"){var y=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace),b=d.call(this,y);return this._parts.query=o.buildQuery(b||y,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!p),this}else return d!==void 0&&typeof d!="string"?(this._parts.query=o.buildQuery(d,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!p),this):B.call(this,d,p)},l.setQuery=function(d,p,y){var b=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof d=="string"||d instanceof String)b[d]=p!==void 0?p:null;else if(typeof d=="object")for(var M in d)h.call(d,M)&&(b[M]=d[M]);else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");return this._parts.query=o.buildQuery(b,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof d!="string"&&(y=p),this.build(!y),this},l.addQuery=function(d,p,y){var b=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.addQuery(b,d,p===void 0?null:p),this._parts.query=o.buildQuery(b,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof d!="string"&&(y=p),this.build(!y),this},l.removeQuery=function(d,p,y){var b=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.removeQuery(b,d,p),this._parts.query=o.buildQuery(b,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof d!="string"&&(y=p),this.build(!y),this},l.hasQuery=function(d,p,y){var b=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.hasQuery(b,d,p,y)},l.setSearch=l.setQuery,l.addSearch=l.addQuery,l.removeSearch=l.removeQuery,l.hasSearch=l.hasQuery,l.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},l.normalizeProtocol=function(d){return typeof this._parts.protocol=="string"&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!d)),this},l.normalizeHostname=function(d){return this._parts.hostname&&(this.is("IDN")&&t?this._parts.hostname=t.toASCII(this._parts.hostname):this.is("IPv6")&&e&&(this._parts.hostname=e.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!d)),this},l.normalizePort=function(d){return typeof this._parts.protocol=="string"&&this._parts.port===o.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!d)),this},l.normalizePath=function(d){var p=this._parts.path;if(!p)return this;if(this._parts.urn)return this._parts.path=o.recodeUrnPath(this._parts.path),this.build(!d),this;if(this._parts.path==="/")return this;p=o.recodePath(p);var y,b="",M,P;for(p.charAt(0)!=="/"&&(y=!0,p="/"+p),(p.slice(-3)==="/.."||p.slice(-2)==="/.")&&(p+="/"),p=p.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),y&&(b=p.substring(1).match(/^(\.\.\/)+/)||"",b&&(b=b[0]));M=p.search(/\/\.\.(\/|$)/),M!==-1;){if(M===0){p=p.substring(3);continue}P=p.substring(0,M).lastIndexOf("/"),P===-1&&(P=M),p=p.substring(0,P)+p.substring(M+3)}return y&&this.is("relative")&&(p=b+p.substring(1)),this._parts.path=p,this.build(!d),this},l.normalizePathname=l.normalizePath,l.normalizeQuery=function(d){return typeof this._parts.query=="string"&&(this._parts.query.length?this.query(o.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!d)),this},l.normalizeFragment=function(d){return this._parts.fragment||(this._parts.fragment=null,this.build(!d)),this},l.normalizeSearch=l.normalizeQuery,l.normalizeHash=l.normalizeFragment,l.iso8859=function(){var d=o.encode,p=o.decode;o.encode=escape,o.decode=decodeURIComponent;try{this.normalize()}finally{o.encode=d,o.decode=p}return this},l.unicode=function(){var d=o.encode,p=o.decode;o.encode=w,o.decode=unescape;try{this.normalize()}finally{o.encode=d,o.decode=p}return this},l.readable=function(){var d=this.clone();d.username("").password("").normalize();var p="";if(d._parts.protocol&&(p+=d._parts.protocol+"://"),d._parts.hostname&&(d.is("punycode")&&t?(p+=t.toUnicode(d._parts.hostname),d._parts.port&&(p+=":"+d._parts.port)):p+=d.host()),d._parts.hostname&&d._parts.path&&d._parts.path.charAt(0)!=="/"&&(p+="/"),p+=d.path(!0),d._parts.query){for(var y="",b=0,M=d._parts.query.split("&"),P=M.length;b<P;b++){var A=(M[b]||"").split("=");y+="&"+o.decodeQuery(A[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),A[1]!==void 0&&(y+="="+o.decodeQuery(A[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}p+="?"+y.substring(1)}return p+=o.decodeQuery(d.hash(),!0),p},l.absoluteTo=function(d){var p=this.clone(),y=["protocol","username","password","hostname","port"],b,M,P;if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(d instanceof o||(d=new o(d)),p._parts.protocol||(p._parts.protocol=d._parts.protocol,this._parts.hostname))return p;for(M=0;P=y[M];M++)p._parts[P]=d._parts[P];return p._parts.path?(p._parts.path.substring(-2)===".."&&(p._parts.path+="/"),p.path().charAt(0)!=="/"&&(b=d.directory(),b=b||(d.path().indexOf("/")===0?"/":""),p._parts.path=(b?b+"/":"")+p._parts.path,p.normalizePath())):(p._parts.path=d._parts.path,p._parts.query||(p._parts.query=d._parts.query)),p.build(),p},l.relativeTo=function(d){var p=this.clone().normalize(),y,b,M,P,A;if(p._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(d=new o(d).normalize(),y=p._parts,b=d._parts,P=p.path(),A=d.path(),P.charAt(0)!=="/")throw new Error("URI is already relative");if(A.charAt(0)!=="/")throw new Error("Cannot calculate a URI relative to another relative URI");if(y.protocol===b.protocol&&(y.protocol=null),y.username!==b.username||y.password!==b.password||y.protocol!==null||y.username!==null||y.password!==null)return p.build();if(y.hostname===b.hostname&&y.port===b.port)y.hostname=null,y.port=null;else return p.build();if(P===A)return y.path="",p.build();if(M=o.commonPath(P,A),!M)return p.build();var L=b.path.substring(M.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return y.path=L+y.path.substring(M.length)||"./",p.build()},l.equals=function(d){var p=this.clone(),y=new o(d),b={},M={},P={},A,L,D;if(p.normalize(),y.normalize(),p.toString()===y.toString())return!0;if(A=p.query(),L=y.query(),p.query(""),y.query(""),p.toString()!==y.toString()||A.length!==L.length)return!1;b=o.parseQuery(A,this._parts.escapeQuerySpace),M=o.parseQuery(L,this._parts.escapeQuerySpace);for(D in b)if(h.call(b,D)){if(f(b[D])){if(!_(b[D],M[D]))return!1}else if(b[D]!==M[D])return!1;P[D]=!0}for(D in M)if(h.call(M,D)&&!P[D])return!1;return!0},l.preventInvalidHostname=function(d){return this._parts.preventInvalidHostname=!!d,this},l.duplicateQueryParameters=function(d){return this._parts.duplicateQueryParameters=!!d,this},l.escapeQuerySpace=function(d){return this._parts.escapeQuerySpace=!!d,this},o})})(l1);var hO=l1.exports;const Mc=Ks(hO),om=["http","https"];function uO(r){return typeof r=="string"&&r.startsWith("/vsi")&&!r.startsWith("/vsicurl/")}function cO(r,t,e=!0){return dO(r,t,!1,e)}function dO(r,t=null,e=!1,n=!0){typeof r=="string"&&r.startsWith("/vsicurl/")&&(r=r.replace(/^\/vsicurl\//,""));let i=Mc(r);if(t&&i.is("relative")&&!uO(r)){let s=Mc(t),o=s.path();!o.endsWith("/")&&!o.endsWith(".json")&&s.path(o+"/"),i=i.absoluteTo(s)}return i.normalize(),e&&(i.query(""),i.fragment("")),n?i.toString():i}const fO="application/geo+json",gO=["application/json",fO,"text/json"],am=["image/gif","image/jpeg","image/apng","image/png","image/webp"],h1=["image/tiff; application=geotiff; profile=cloud-optimized","image/vnd.stac.geotiff; cloud-optimized=true"],u1=["application/geotiff","image/tiff; application=geotiff","image/vnd.stac.geotiff"].concat(h1);function kf(r,t,e=!1){return Array.isArray(t)||(t=[t]),e&&typeof r>"u"?!0:typeof r!="string"?!1:(t=t.map(n=>n.toLowerCase()),t.includes(r.toLowerCase()))}function pO(r,t=!1){return kf(r,gO,t)}class c1 extends Vh{constructor(t,e=null,n={},i=[]){super(t,n,["_context"].concat(i)),this._context||(this._context=e)}getAbsoluteUrl(t=!0){return this._context?cO(this.href,this._context.getAbsoluteUrl(),t):this.href.includes("://")?this.href:null}getContext(){return this._context}canBrowserDisplayImage(t=!1){if(typeof this.href!="string"||!t&&typeof this.type>"u")return!1;let e=new Mc(this.href),n=e.protocol().toLowerCase(),i=e.suffix().toLowerCase();return ar(n)&&!om.includes(n)?!1:ar(this.type)&&am.includes(this.type.toLowerCase())?!0:!!(typeof this.type>"u"&&ar(i)&&(i==="jpg"||am.includes("image/"+i)))}isType(t){return ar(this.type)&&kf(this.type,t)}isGeoTIFF(){return this.isType(u1)}isCOG(){return this.isType(h1)}isHTTP(){let t=this.getAbsoluteUrl(!1).protocol().toLowerCase();return ar(t)&&om.includes(t)}}class Gf extends c1{constructor(t,e=null){super(t,e)}isLink(){return!0}getObjectType(){return"Link"}static fromLinks(t,e=null){return Array.isArray(t)?t.map(n=>er(n)?new Gf(n,e):n):[]}}class d1 extends Vh{constructor(t,e=null,n={},i=[]){if(super(t,Object.assign({links:Gf.fromLinks},n),["_url"].concat(i)),!this._url&&(this._url=e,!this._url)){let s=this.getSelfLink();s&&(this._url=s.href)}}getAbsoluteUrl(){return this._url}setAbsoluteUrl(t){this._url=t}getStacLinksWithRel(t,e=!0){return this.getLinksWithRels([t]).filter(n=>pO(n.type,e))}getStacLinkWithRel(t,e=!0){const n=this.getStacLinksWithRel(t,e);return n.length>0?n[0]:null}getLinks(){return Array.isArray(this.links)?this.links.filter(t=>er(t)&&ar(t.href)):[]}getLinkWithRel(t){return this.getLinks().find(e=>e.rel===t)||null}getLinksWithRels(t){return this.getLinks().filter(e=>t.includes(e.rel))}getLinksWithOtherRels(t){return this.getLinks().filter(e=>!t.includes(e.rel))}getSelfLink(){return this.getStacLinkWithRel("self")}getRootLink(){return this.getStacLinkWithRel("root")}getParentLink(){return this.getStacLinkWithRel("parent")}}class f1 extends d1{constructor(t,e=null,n={},i=[]){super(t,e,n,i)}getAll(){return[]}}class hi extends c1{constructor(t,e=null,n=null){super(t,n,{},["_key"]),this._key||(this._key=e)}getObjectType(){return"Asset"}isAsset(){return!0}getAbsoluteUrl(t=!0){return this.isDefinition()?null:super.getAbsoluteUrl(t)}getKey(){return this._key}getMetadata(t){if(typeof this[t]<"u")return this[t];if(this._context)return this._context.getMetadata(t)}getBands(){return a1(this["eo:bands"],this["raster:bands"])}findVisualBands(){let t={red:null,green:null,blue:null},e=this.getBands();for(let n in e){let i=parseInt(n,10),s=e[i];er(s)&&ar(s.common_name)&&s.common_name in t&&(t[s.common_name]={index:i,band:s})}return Object.values(t).every(n=>n!==null)?t:null}findBand(t,e="name",n=null){Array.isArray(t)||(t=[t]),er(n)||(n=this.getBands());let i=n.findIndex(s=>er(s)&&t.includes(s[e]));return i>=0?{index:i,band:n[i]}:null}getBand(t){return er(t)||t===null?t:this.getBands()[t]||null}getMinMaxValues(t=null){t=this.getBand(t);const e={minimum:null,maximum:null},n=a=>a.minimum!==null&&a.maximum!==null;if(t&&(er(t.statistics)&&(typeof t.statistics.minimum=="number"&&(e.minimum=t.statistics.minimum),typeof t.statistics.maximum=="number"&&(e.maximum=t.statistics.maximum),n(e))||er(t.histogram)&&(typeof t.histogram.min=="number"&&(e.minimum=t.histogram.min),typeof t.histogram.max=="number"&&(e.maximum=t.histogram.max),n(e))))return e;let i=this.getMetadata("classification:classes");if(Array.isArray(i)&&(i.reduce((a,l)=>(a.minimum=Math.min(a.minimum,l.value),a.maximum=Math.max(a.maximum,l.value),a),e),n(e)))return e;let s=this.getMetadata("file:values");if(Array.isArray(s)&&(s.reduce((a,l)=>(a.minimum=Math.min(a.minimum,...l.values),a.maximum=Math.max(a.maximum,...l.values),a),e),n(e)))return e;let o=er(t)&&t.data_type||this.getMetadata("file:data_type");return o&&(e.minimum=iO(o),e.maximum=sO(o)),e}getNoDataValues(t=null){t=this.getBand(t);let e=[];if(t&&typeof t.nodata<"u")e.push(t.nodata);else{let n=this.getMetadata("file:nodata");if(typeof n<"u")e=n;else{let i=this.getMetadata("classification:classes");Array.isArray(i)&&(e=i.filter(s=>!!s.nodata).map(s=>s.value))}}return e.map(n=>n==="nan"?NaN:n==="+inf"?1/0:n==="-inf"?-1/0:n)}isDefinition(){return!ar(this.href)}isHTTP(){return this.isDefinition()?null:super.isHTTP()}hasRole(t,e=!1){return Array.isArray(t)||(t=[t]),e&&t.includes(this.getKey())?!0:Array.isArray(this.roles)&&!!this.roles.find(n=>t.includes(n))}static fromAssets(t,e=null){let n={};if(er(t))for(let i in t)n[i]=new hi(t[i],i,e);return n}}class Ga extends d1{constructor(t,e=null,n={},i=[]){super(t,e,n,i)}getTemporalExtent(){return null}getTemporalExtents(){return[]}getIcons(t=!0){return this.getLinksWithRels(["icon"]).filter(e=>e.canBrowserDisplayImage(t))}getThumbnails(t=!0,e=null){let n=this.getAssetsWithRoles(["thumbnail","overview"],!0);if(n.length===0&&(n=this.getLinksWithRels(["preview"])),t&&(n=n.filter(i=>i.canBrowserDisplayImage())),e&&n.length>1){let i=s=>Array.isArray(s.roles)&&s.roles.includes(e)||s.getKey()===e;n=n.filter(i).concat(n.filter(s=>!i(s)))}return n}getDefaultGeoTIFF(t=!0,e=!1){var n;return(n=this.rankGeoTIFFs(t,e)[0])==null?void 0:n.asset}rankGeoTIFFs(t=!0,e=!1,n=null,i=null){er(n)||(n={data:1,visual:2,thumbnail:2,overview:3});let s=[],o=this.getAssetsByTypes(u1);t&&(o=o.filter(l=>l.isHTTP()&&(!e||l.isCOG())));let a=Object.entries(n);for(let l of o){let h=0;if(a.length>0){let u=a.filter(([c])=>l.hasRole(c,!0)).map(([,c])=>c);u.length>0&&(h+=Math.max(...u))}!e&&l.isCOG()&&(h+=2),l.findVisualBands()&&(h+=1),typeof i=="function"&&(h+=i(l)),s.push({asset:l,score:h})}return s.sort((l,h)=>h.score-l.score),s}findVisualAssets(){let t={red:null,green:null,blue:null},e=Object.keys(t),n=this.getAssets();for(let i of n){let s=i.getBands();if(s.length!==1)continue;let o=i.findBand(e,"common_name",s);o&&(t[o.band.common_name]=i)}return Object.values(t).every(i=>i!==null)?t:null}getAsset(t){return er(this.assets)&&this.assets[t]||null}getAssets(){return er(this.assets)?Object.values(this.assets):[]}getAssetsWithRoles(t,e=!1){return this.getAssets().filter(n=>n.hasRole(t,e))}getAssetWithRole(t,e=!1){return this.getAssetsWithRoles([t],e)[0]||null}getAssetsByTypes(t){return this.getAssets().filter(e=>kf(e.type,t))}equals(t){return this===t?!0:!(t instanceof Ga)||this.getObjectType()!==t.getObjectType()?!1:!!(this.id&&this.id===t.id)}}class g1 extends Ga{constructor(t,e=null,n={},i=[]){super(t,e,n,i)}getObjectType(){return this.type}getSearchLink(t=null){let e=this.getStacLinksWithRel("search");return t?e[0]||null:e.find(n=>n.method===t||!t&&!n.method)||null}getApiCollectionsLink(){return this.getStacLinkWithRel("data")}getApiItemsLink(){return this.getStacLinkWithRel("items")}getChildLinks(){return this.getStacLinksWithRel("child")}getItemLinks(){return this.getStacLinksWithRel("item")}}class mO extends g1{constructor(t,e=null){super(t,e)}}function Ro(r){if(ar(r)&&r.length>=10)try{let t=r.match(/^(-?\d{1,})-(\d\d)-(\d\d)[T ](\d\d):(\d\d):(\d\d)(?:\.(\d*))?(?:Z|[+-]00:00)?$/i).slice(1).map(e=>parseInt(e,10));return new Date(Date.UTC(t[0],t[1]-1,t[2],t[3],t[4],t[5],t[6]||0))}catch{return null}return null}function _O(r,t){return new Date(r.valueOf()+(t-r)/2)}function p1(r){if(!Array.isArray(r)||r.length===0)return null;let t,e;const n=(i,s,o)=>typeof i>"u"?s:i===null||s===null?null:o(i,s);return r.forEach(([i,s])=>{t=n(t,i,Math.min),e=n(e,s,Math.max)}),[t===null?null:new Date(t),e===null?null:new Date(e)]}class m1 extends g1{constructor(t,e=null){const n={assets:hi.fromAssets,item_assets:hi.fromAssets};super(t,e,n)}toGeoJSON(){let t=i1(this.getBoundingBoxes());return t&&(t.id=this.id),t}getBoundingBox(){let t=this.getRawBoundingBoxes();return t.length>0&&zr(t[0])?t[0]:null}getBoundingBoxes(){let t=this.getRawBoundingBoxes();return t.length===1&&zr(t[0])?t:t.length>1?t.filter((e,n)=>n>0&&zr(e)):[]}getRawBoundingBoxes(){var t,e;let n=(e=(t=this.extent)==null?void 0:t.spatial)==null?void 0:e.bbox;return Array.isArray(n)&&n.length>0?n:[]}getTemporalExtent(){return this.getTemporalExtents()[0]||null}getTemporalExtents(){var t,e;let n=(e=(t=this.extent)==null?void 0:t.temporal)==null?void 0:e.interval;return Array.isArray(n)&&n.length>0?n.filter(i=>Array.isArray(i)&&(ar(i[0])||ar(i[1]))).map(i=>i.map(s=>Ro(s))):[]}getSummary(t){return this.summaries[t]}getBands(){let t=this.getSummary("eo:bands"),e=this.getSummary("raster:bands"),n=[t,e].filter(i=>Array.isArray(i));return n.length>=2?a1(...n):n.length===1?n[0]:[]}}class yO extends f1{constructor(t,e=null){const n={collections:i=>i.map(s=>new m1(s))};super(t,e,n)}getObjectType(){return"CollectionCollection"}getAll(){return this.collections}isCollectionCollection(){return!0}toGeoJSON(){return{type:"FeatureCollection",features:this.collections.map(t=>t.toGeoJSON()).filter(t=>t!==null)}}getBoundingBox(){return o1(this.getBoundingBoxes())}getBoundingBoxes(){return this.collections.map(t=>t.getBoundingBox())}getTemporalExtent(){return p1(this.getTemporalExtents())}getTemporalExtents(){return this.collections.map(t=>t.getTemporalExtent())}}class _1 extends Ga{constructor(t,e=null){super(t,e,{assets:hi.fromAssets})}getObjectType(){return"Item"}toGeoJSON(){return this.toJSON()}getBoundingBox(){return zr(this.bbox)?this.bbox:null}getBoundingBoxes(){return zr(this.bbox)?[this.bbox]:[]}getDateTime(){let t=Ro(this.properties.datetime);if(!t){let e=Ro(this.properties.start_datetime),n=Ro(this.properties.end_datetime);return e&&n?_O(e,n):e||n}return t}getTemporalExtent(){return this.getTemporalExtents()[0]||null}getTemporalExtents(){let t=[];return ar(this.properties.start_datetime)||ar(this.properties.end_datetime)?t=[[this.properties.start_datetime||null,this.properties.end_datetime||null]]:ar(this.properties.datetime)&&(t=[[this.properties.datetime,this.properties.datetime]]),t.map(e=>e.map(n=>Ro(n)))}getMetadata(t){return this.properties[t]}getBands(){let t=this.getMetadata("eo:bands");return Array.isArray(t)?t:[]}getCollectionLink(){return this.getStacLinkWithRel("collection")}}class xO extends f1{constructor(t,e=null){const n={features:i=>i.map(s=>new _1(s))};super(t,e,n)}getObjectType(){return"ItemCollection"}getAll(){return this.features}toGeoJSON(){return this.toJSON()}getBoundingBox(){return o1(this.getBoundingBoxes())}getBoundingBoxes(){return this.features.map(t=>t.getBoundingBox())}getTemporalExtent(){return p1(this.getTemporalExtents())}getTemporalExtents(){return this.features.map(t=>t.getTemporalExtent())}}function vO(r,t=!0,e=!1){return t&&(r=rO.stac(r,e)),r.type==="Feature"?new _1(r):r.type==="FeatureCollection"?new xO(r):r.type==="Collection"||!r.type&&typeof r.extent<"u"&&typeof r.license<"u"?new m1(r):!r.type&&Array.isArray(r.collections)?new yO(r):new mO(r)}class lm extends uf{constructor(t){super({...t,state:"loading"}),Oc(this,"loadImage",n=>new Promise((i,s)=>{const o=new Image;o.addEventListener("load",()=>i(o)),o.addEventListener("error",()=>s(new Error("load failed"))),o.src=n}));const e=new lf(t.url);e.getHeader().then(n=>{this.tileGrid.minZoom=n.minZoom,this.tileGrid.maxZoom=n.maxZoom,this.setLoader(async(i,s,o)=>{const a=await e.getZxy(i,s,o),l=URL.createObjectURL(new Blob([a.data])),h=await this.loadImage(l);return URL.revokeObjectURL(l),h}),this.setState("ready")})}}class wO extends Zh{constructor(t){super({...t,state:"loading",url:"pmtiles://"+t.url+"/{z}/{x}/{y}",format:new H0}),Oc(this,"tileLoadFunction",(e,n)=>{const i=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),s=n.match(i),o=+s[2],a=+s[3],l=+s[4];e.setLoader((h,u,c)=>{e.setState(W.LOADING),this.pmtiles_.getZxy(o,a,l).then(f=>{if(f){const g=e.getFormat();e.setFeatures(g.readFeatures(f.data,{extent:h,featureProjection:c})),e.setState(W.LOADED)}else e.setFeatures([]),e.setState(W.EMPTY)}).catch(f=>{e.setFeatures([]),e.setState(W.ERROR)})})}),this.pmtiles_=new lf(t.url),this.pmtiles_.getHeader().then(e=>{this.tileGrid.minZoom=e.minZoom,this.tileGrid.maxZoom=e.maxZoom,this.setTileLoadFunction(this.tileLoadFunction),this.setState("ready")})}}let jf=null;function bO(){return!!jf}function y1(r){jf=r;const t=Object.keys(r.defs),e=t.length;let n,i;for(n=0;n<e;++n){const s=t[n];if(!tt(s)){const o=r.defs(s);let a=o.units;!a&&o.projName==="longlat"&&(a="degrees"),Km(new Ns({code:s,axisOrientation:o.axis,metersPerUnit:o.to_meter,units:a}))}}for(n=0;n<e;++n){const s=t[n],o=tt(s);for(i=0;i<e;++i){const a=t[i],l=tt(a);if(!qm(s,a))if(r.defs[s]===r.defs[a])Vu([o,l]);else{const h=r(s,a);fv(o,l,pg(o,l,h.forward),pg(l,o,h.inverse))}}}}let SO=async function(r){const t=await fetch(`https://epsg.io/${r}.proj4`);if(!t.ok)throw new Error(`Unexpected response from epsg.io: ${t.status}`);return t.text()};async function EO(r){typeof r=="string"&&(r=parseInt(r.split(":").pop(),10));const t=jf;if(!t)throw new Error("Proj4 must be registered first with register(proj4)");const e="EPSG:"+r;return t.defs(e)||(t.defs(e,await SO(r)),y1(t)),tt(e)}const TO=new Ve({fill:new Wr({color:"rgba(255,255,255,0.4)"}),stroke:new un({color:"#3399CC",width:3})}),MO=new Ve({stroke:new un({color:"#ff9933",width:1})});function RO(r,t){const e={url:r.getAbsoluteUrl()};let n=null;r.getBands().length===1&&(n=0);const{minimum:i,maximum:s}=r.getMinMaxValues(n);typeof i=="number"&&(e.min=i),typeof s=="number"&&(e.max=s);const o=r.getNoDataValues(n);return o.length>0&&(e.nodata=o[0]),t.length>0&&(e.bands=t),e}async function hm(r,t=void 0){let e=t;if(bO()){const n=r.getMetadata("proj:epsg");if(n)try{e=await EO(n)}catch{}}return e}function um(r,t){const e=r.clone();return t.hasOnlyBounds()||e.setFill(null),e}function CO(r){let t=r.href;if(t.includes("{s}"))if(Array.isArray(r["href:servers"])&&r["href:servers"].length>0){const e=Math.random()*r["href:servers"].length|0;t=t.replace("{s}",r["href:servers"][e])}else return null;return t}async function IO(r){try{const t=new URL(r);t.searchParams.set("service","wmts"),t.searchParams.set("request","GetCapabilities");const e=await fetch(t);return new Fd().read(await e.text())}catch{return null}}class zf extends Nh{constructor(t){const e={};if(["opacity","visible","zIndex","minResolution","maxResolution","minZoom","maxZoom","properties"].forEach(n=>e[n]=t[n]),super(e),this.getSourceOptions_=t.getSourceOptions,this.data_,this.assets_=null,this.bands_=[],this.crossOrigin_=t.crossOrigin||null,this.displayFootprint_=t.displayFootprint!==!1,this.displayGeoTiffByDefault_=!!t.displayGeoTiffByDefault,this.displayPreview_=!!t.displayPreview,this.displayOverview_=t.displayOverview!==!1,this.displayWebMapLink_=t.displayWebMapLink||!1,this.buildTileUrlTemplate_=t.buildTileUrlTemplate||null,this.useTileLayerAsFallback_=t.useTileLayerAsFallback||!1,this.boundsStyle_=t.boundsStyle||TO,this.collectionStyle_=t.collectionStyle||MO,this.boundsLayer_=null,t.data){try{this.configure_(t.data,t.url,t.assets,t.bands)}catch(n){this.handleError_(n)}return}if(!t.url)throw new Error("Either url or data must be provided");fetch(t.url).then(n=>n.json()).then(n=>this.configure_(n,t.url,t.assets,t.bands)).catch(n=>this.handleError_(n))}getBoundsLayer(){return this.boundsLayer_}handleError_(t){this.dispatchEvent(new $P(t))}configure_(t,e=null,n=null,i=[]){t instanceof hi||t instanceof Ga?this.data_=t:this.data_=vO(t),e&&e.includes("://")&&this.data_.setAbsoluteUrl(e),this.bands_=i,this.boundsLayer_=this.addFootprint_();const s=()=>{this.boundsLayer_&&this.boundsLayer_.setStyle(um(this.boundsStyle_,this))};this.getLayers().on("add",s),this.getLayers().on("remove",s),this.setAssets(n).then(()=>this.dispatchEvent("assetsready")).catch(o=>this.handleError_(o)),this.dispatchEvent("sourceready")}async addApiCollection_(){const t=this.getData().getAll().map(e=>{const n=new zf({data:e,crossOrigin:this.crossOrigin_,boundsStyle:this.collectionStyle_,displayGeoTiffByDefault:this.displayGeoTiffByDefault_,displayOverview:this.displayOverview_,displayPreview:this.displayPreview_,displayFootprint:this.displayFootprint_});return this.addLayer_(n),n});return await Promise.all(t)}async addStacAssets_(){let t=this.getAssets();if(t===null){t=[];const n=this.getData().getDefaultGeoTIFF(!0,!this.displayGeoTiffByDefault_);if(n)t.push(n);else{const i=this.getData().getThumbnails().filter(s=>!Array.isArray(s.roles)||!s.roles.includes("example"));i.length>0&&t.push(i[0])}}const e=t.map(n=>this.addImagery_(n));return await Promise.all(e)}async addImagery_(t){if(t){if(t.isGeoTIFF())return await this.addGeoTiff_(t);if(t.canBrowserDisplayImage())return await this.addThumbnail_(t)}}async addThumbnail_(t){if(!this.displayPreview_)return;let e={url:t.getAbsoluteUrl(),projection:await hm(t,"EPSG:4326"),imageExtent:t.getContext().getBoundingBox(),crossOrigin:this.crossOrigin_};this.getSourceOptions_&&(e=await this.getSourceOptions_(re.ImageStatic,e,t));const n=new ef({source:new qy(e)});return this.addLayer_(n,t),n}async addWebMapLinks_(){const t=this.getWebMapLinks();if(t.length>0)return await this.addLayerForLink(t[0])}async addLayerForLink(t){const e=CO(t);if(!e)return;const n={attributions:t.getMetadata("attribution")||this.data_.getMetadata("attribution"),crossOrigin:this.crossOrigin_,url:e},i=async(o,a)=>(this.getSourceOptions_&&(a=await this.getSourceOptions_(o,a,t)),a),s=[];switch(t.rel){case"pmtiles":const o=await new lf(n.url).getHeader();let a;switch(o.tileType){case gs.Mvt:a=new wO(await i(re.PMTilesVector,n));break;case gs.Avif:case gs.Jpeg:case gs.Png:case gs.Webp:a=new lm(await i(re.PMTilesRaster,n));break;default:return}s.push(a);break;case"tilejson":s.push(new Vy(await i(re.TileJSON,n)));break;case"wms":if(!Array.isArray(t["wms:layers"]))break;for(const u in t["wms:layers"]){const c=t["wms:layers"][u]||"";let f="";Array.isArray(t["wms:styles"])&&typeof t["wms:styles"][u]=="string"&&(f=t["wms:styles"][u]);const g=Object.assign({LAYERS:c,STYLES:f},t["wms:dimensions"]);typeof t["wms:transparent"]=="boolean"&&(g.TRANSPARENT=String(t["wms:transparent"])),typeof t.type=="string"&&t.type.startsWith("image/")&&(g.FORMAT=t.type);const m=await i(re.TileWMS,Object.assign({},n,{params:g}));s.push(new Qy(m))}break;case"wmts":const l=await IO(e);if(!l)return;const h=Array.isArray(t["wmts:layer"])?t["wmts:layer"]:[t["wmts:layer"]];for(const u of h){let c=Object.assign({},n,{layer:u});typeof t.type=="string"&&t.type.startsWith("image/")&&(c.format=t.type),c=await i(re.WMTS,c),s.push(new Jy(t1(l,c)))}break;case"xyz":s.push(new Ui(await i(re.XYZ,n)));break;default:return}return s.map(o=>{let a;return o instanceof Zh?a=new ry({source:o,declutter:!0}):o instanceof lm?a=new Hl({source:o}):a=new $l({source:o}),this.addLayer_(a,t),a})}async addGeoTiff_(t){if(!this.displayOverview_)return;if(this.buildTileUrlTemplate_&&!this.useTileLayerAsFallback_)return await this.addTileLayerForImagery_(t);let e={sources:[RO(t,this.bands_)]};const n=await hm(t);n&&(e.projection=n),this.getSourceOptions_&&(e=await this.getSourceOptions_(re.GeoTIFF,e,t));const i=async(s,o)=>(o&&this.getLayers().remove(o),await this.addTileLayerForImagery_(s));try{const s=new Rf(e),o=new Hl({source:s});if(this.useTileLayerAsFallback_){const a=()=>i(t,o);s.on("error",a),s.on("tileloaderror",a),s.on("change",()=>{s.getState()==="error"&&i(t,o)}),o.on("error",a),await s.getView()}return this.addLayer_(o,t),o}catch(s){if(this.useTileLayerAsFallback_)return await i(t,null);this.handleError_(s)}}async addTileLayerForImagery_(t){let e={crossOrigin:this.crossOrigin_,url:this.buildTileUrlTemplate_(t)};this.getSourceOptions_&&(e=await this.getSourceOptions_(re.XYZ,e,t));const n=new $l({source:new Ui(e)});return this.addLayer_(n,t),n}addLayer_(t,e,n=0){t.set("stac",e),t.setZIndex(n),this.getLayers().push(t)}addFootprint_(){let t=null;const e=this.getData();if(e.isItemCollection()||e.isCollectionCollection()?t=i1(e.getBoundingBox()):t=e.toGeoJSON(),t){const n=new f0,i=new Fh({format:n,loader:(o,a,l)=>{const h=n.readFeatures(t,{featureProjection:l});i.addFeatures(h)}}),s=new Xd({source:i,style:um(this.boundsStyle_,this),visible:this.displayFootprint_});return s.set("bounds",!0),this.addLayer_(s,e,1),s}return null}async updateLayers_(){const t=this.getLayers();for(let n=t.getLength()-1;n>=0;n--){const i=t.item(n).get("stac");i&&(i.isLink()||i.isAsset())&&t.removeAt(n)}const e=this.getData();e.isItemCollection()||e.isCollectionCollection()?await this.addApiCollection_():(e.isItem()||e.isCollection())&&await this.addStacAssets_(),this.displayWebMapLink_&&(Array.isArray(this.displayWebMapLink_)||this.hasOnlyBounds())&&await this.addWebMapLinks_()}hasOnlyBounds(){const t=this.getBoundsLayer();return typeof this.getLayersArray().find(e=>e!==t)>"u"}getWebMapLinks(){let t=["xyz","tilejson","pmtiles","wmts","wms"];typeof this.displayWebMapLink_=="string"&&(t=[this.displayWebMapLink_]);let e=this.data_.getLinksWithRels(t);return Array.isArray(this.displayWebMapLink_)?e=this.displayWebMapLink_.map(n=>typeof n=="string"?e.find(s=>s.id===n)||null:n).filter(n=>!!n):e.sort((n,i)=>{const s=t.indexOf(n.rel),o=t.indexOf(i.rel);return s-o}),e}async setAssets(t){Array.isArray(t)?this.assets_=t.map(e=>typeof e=="string"?this.getData().getAsset(e):e instanceof hi?e:new hi(e)):this.assets_=null,await this.updateLayers_()}getData(){return this.data_}getAssets(){return this.assets_}getExtent(){if(!this.boundsLayer_)return;const t=this.boundsLayer_.getMapInternal();if(!t)return;const e=t.getView();if(!e)return;const n=this.getData();if(!n)return;const i=n.getBoundingBox();if(i)return Vc(i,"EPSG:4326",e.getProjection())}}function PO(r){r("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),r("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),r("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),r.WGS84=r["EPSG:4326"],r["EPSG:3785"]=r["EPSG:3857"],r.GOOGLE=r["EPSG:3857"],r["EPSG:900913"]=r["EPSG:3857"],r["EPSG:102113"]=r["EPSG:3857"]}var Bi=1,Xi=2,As=3,AO=4,Rc=5,cm=6378137,LO=6356752314e-3,dm=.0066943799901413165,Uo=484813681109536e-20,V=Math.PI/2,OO=.16666666666666666,FO=.04722222222222222,NO=.022156084656084655,J=1e-10,Pe=.017453292519943295,sn=57.29577951308232,Zt=Math.PI/4,da=Math.PI*2,ge=3.14159265359,fr={};fr.greenwich=0;fr.lisbon=-9.131906111111;fr.paris=2.337229166667;fr.bogota=-74.080916666667;fr.madrid=-3.687938888889;fr.rome=12.452333333333;fr.bern=7.439583333333;fr.jakarta=106.807719444444;fr.ferro=-17.666666666667;fr.brussels=4.367975;fr.stockholm=18.058277777778;fr.athens=23.7163375;fr.oslo=10.722916666667;const DO={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}};var fm=/[\s_\-\/\(\)]/g;function gi(r,t){if(r[t])return r[t];for(var e=Object.keys(r),n=t.toLowerCase().replace(fm,""),i=-1,s,o;++i<e.length;)if(s=e[i],o=s.toLowerCase().replace(fm,""),o===n)return r[s]}function Cc(r){var t={},e=r.split("+").map(function(a){return a.trim()}).filter(function(a){return a}).reduce(function(a,l){var h=l.split("=");return h.push(!0),a[h[0].toLowerCase()]=h[1],a},{}),n,i,s,o={proj:"projName",datum:"datumCode",rf:function(a){t.rf=parseFloat(a)},lat_0:function(a){t.lat0=a*Pe},lat_1:function(a){t.lat1=a*Pe},lat_2:function(a){t.lat2=a*Pe},lat_ts:function(a){t.lat_ts=a*Pe},lon_0:function(a){t.long0=a*Pe},lon_1:function(a){t.long1=a*Pe},lon_2:function(a){t.long2=a*Pe},alpha:function(a){t.alpha=parseFloat(a)*Pe},gamma:function(a){t.rectified_grid_angle=parseFloat(a)},lonc:function(a){t.longc=a*Pe},x_0:function(a){t.x0=parseFloat(a)},y_0:function(a){t.y0=parseFloat(a)},k_0:function(a){t.k0=parseFloat(a)},k:function(a){t.k0=parseFloat(a)},a:function(a){t.a=parseFloat(a)},b:function(a){t.b=parseFloat(a)},r:function(a){t.a=t.b=parseFloat(a)},r_a:function(){t.R_A=!0},zone:function(a){t.zone=parseInt(a,10)},south:function(){t.utmSouth=!0},towgs84:function(a){t.datum_params=a.split(",").map(function(l){return parseFloat(l)})},to_meter:function(a){t.to_meter=parseFloat(a)},units:function(a){t.units=a;var l=gi(DO,a);l&&(t.to_meter=l.to_meter)},from_greenwich:function(a){t.from_greenwich=a*Pe},pm:function(a){var l=gi(fr,a);t.from_greenwich=(l||parseFloat(a))*Pe},nadgrids:function(a){a==="@null"?t.datumCode="none":t.nadgrids=a},axis:function(a){var l="ewnsud";a.length===3&&l.indexOf(a.substr(0,1))!==-1&&l.indexOf(a.substr(1,1))!==-1&&l.indexOf(a.substr(2,1))!==-1&&(t.axis=a)},approx:function(){t.approx=!0}};for(n in e)i=e[n],n in o?(s=o[n],typeof s=="function"?s(i):t[s]=i):t[n]=i;return typeof t.datumCode=="string"&&t.datumCode!=="WGS84"&&(t.datumCode=t.datumCode.toLowerCase()),t}var fa=1,x1=2,v1=3,th=4,w1=5,Uf=-1,kO=/\s/,GO=/[A-Za-z]/,jO=/[A-Za-z84_]/,Yh=/[,\]]/,b1=/[\d\.E\-\+]/;function qn(r){if(typeof r!="string")throw new Error("not a string");this.text=r.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=fa}qn.prototype.readCharicter=function(){var r=this.text[this.place++];if(this.state!==th)for(;kO.test(r);){if(this.place>=this.text.length)return;r=this.text[this.place++]}switch(this.state){case fa:return this.neutral(r);case x1:return this.keyword(r);case th:return this.quoted(r);case w1:return this.afterquote(r);case v1:return this.number(r);case Uf:return}};qn.prototype.afterquote=function(r){if(r==='"'){this.word+='"',this.state=th;return}if(Yh.test(r)){this.word=this.word.trim(),this.afterItem(r);return}throw new Error(`havn't handled "`+r+'" in afterquote yet, index '+this.place)};qn.prototype.afterItem=function(r){if(r===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=fa;return}if(r==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=fa,this.currentObject=this.stack.pop(),this.currentObject||(this.state=Uf);return}};qn.prototype.number=function(r){if(b1.test(r)){this.word+=r;return}if(Yh.test(r)){this.word=parseFloat(this.word),this.afterItem(r);return}throw new Error(`havn't handled "`+r+'" in number yet, index '+this.place)};qn.prototype.quoted=function(r){if(r==='"'){this.state=w1;return}this.word+=r};qn.prototype.keyword=function(r){if(jO.test(r)){this.word+=r;return}if(r==="["){var t=[];t.push(this.word),this.level++,this.root===null?this.root=t:this.currentObject.push(t),this.stack.push(this.currentObject),this.currentObject=t,this.state=fa;return}if(Yh.test(r)){this.afterItem(r);return}throw new Error(`havn't handled "`+r+'" in keyword yet, index '+this.place)};qn.prototype.neutral=function(r){if(GO.test(r)){this.word=r,this.state=x1;return}if(r==='"'){this.word="",this.state=th;return}if(b1.test(r)){this.word=r,this.state=v1;return}if(Yh.test(r)){this.afterItem(r);return}throw new Error(`havn't handled "`+r+'" in neutral yet, index '+this.place)};qn.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===Uf)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function zO(r){var t=new qn(r);return t.output()}function gm(r,t,e){Array.isArray(t)&&(e.unshift(t),t=null);var n=t?{}:r,i=e.reduce(function(s,o){return ws(o,s),s},n);t&&(r[t]=i)}function ws(r,t){if(!Array.isArray(r)){t[r]=!0;return}var e=r.shift();if(e==="PARAMETER"&&(e=r.shift()),r.length===1){if(Array.isArray(r[0])){t[e]={},ws(r[0],t[e]);return}t[e]=r[0];return}if(!r.length){t[e]=!0;return}if(e==="TOWGS84"){t[e]=r;return}if(e==="AXIS"){e in t||(t[e]=[]),t[e].push(r);return}Array.isArray(e)||(t[e]={});var n;switch(e){case"UNIT":case"PRIMEM":case"VERT_DATUM":t[e]={name:r[0].toLowerCase(),convert:r[1]},r.length===3&&ws(r[2],t[e]);return;case"SPHEROID":case"ELLIPSOID":t[e]={name:r[0],a:r[1],rf:r[2]},r.length===4&&ws(r[3],t[e]);return;case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":r[0]=["name",r[0]],gm(t,e,r);return;default:for(n=-1;++n<r.length;)if(!Array.isArray(r[n]))return ws(r,t[e]);return gm(t,e,r)}}var UO=.017453292519943295;function BO(r,t){var e=t[0],n=t[1];!(e in r)&&n in r&&(r[e]=r[n],t.length===3&&(r[e]=t[2](r[e])))}function Qr(r){return r*UO}function XO(r){if(r.type==="GEOGCS"?r.projName="longlat":r.type==="LOCAL_CS"?(r.projName="identity",r.local=!0):typeof r.PROJECTION=="object"?r.projName=Object.keys(r.PROJECTION)[0]:r.projName=r.PROJECTION,r.AXIS){for(var t="",e=0,n=r.AXIS.length;e<n;++e){var i=[r.AXIS[e][0].toLowerCase(),r.AXIS[e][1].toLowerCase()];i[0].indexOf("north")!==-1||(i[0]==="y"||i[0]==="lat")&&i[1]==="north"?t+="n":i[0].indexOf("south")!==-1||(i[0]==="y"||i[0]==="lat")&&i[1]==="south"?t+="s":i[0].indexOf("east")!==-1||(i[0]==="x"||i[0]==="lon")&&i[1]==="east"?t+="e":(i[0].indexOf("west")!==-1||(i[0]==="x"||i[0]==="lon")&&i[1]==="west")&&(t+="w")}t.length===2&&(t+="u"),t.length===3&&(r.axis=t)}r.UNIT&&(r.units=r.UNIT.name.toLowerCase(),r.units==="metre"&&(r.units="meter"),r.UNIT.convert&&(r.type==="GEOGCS"?r.DATUM&&r.DATUM.SPHEROID&&(r.to_meter=r.UNIT.convert*r.DATUM.SPHEROID.a):r.to_meter=r.UNIT.convert));var s=r.GEOGCS;r.type==="GEOGCS"&&(s=r),s&&(s.DATUM?r.datumCode=s.DATUM.name.toLowerCase():r.datumCode=s.name.toLowerCase(),r.datumCode.slice(0,2)==="d_"&&(r.datumCode=r.datumCode.slice(2)),(r.datumCode==="new_zealand_geodetic_datum_1949"||r.datumCode==="new_zealand_1949")&&(r.datumCode="nzgd49"),(r.datumCode==="wgs_1984"||r.datumCode==="world_geodetic_system_1984")&&(r.PROJECTION==="Mercator_Auxiliary_Sphere"&&(r.sphere=!0),r.datumCode="wgs84"),r.datumCode.slice(-6)==="_ferro"&&(r.datumCode=r.datumCode.slice(0,-6)),r.datumCode.slice(-8)==="_jakarta"&&(r.datumCode=r.datumCode.slice(0,-8)),~r.datumCode.indexOf("belge")&&(r.datumCode="rnb72"),s.DATUM&&s.DATUM.SPHEROID&&(r.ellps=s.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),r.ellps.toLowerCase().slice(0,13)==="international"&&(r.ellps="intl"),r.a=s.DATUM.SPHEROID.a,r.rf=parseFloat(s.DATUM.SPHEROID.rf,10)),s.DATUM&&s.DATUM.TOWGS84&&(r.datum_params=s.DATUM.TOWGS84),~r.datumCode.indexOf("osgb_1936")&&(r.datumCode="osgb36"),~r.datumCode.indexOf("osni_1952")&&(r.datumCode="osni52"),(~r.datumCode.indexOf("tm65")||~r.datumCode.indexOf("geodetic_datum_of_1965"))&&(r.datumCode="ire65"),r.datumCode==="ch1903+"&&(r.datumCode="ch1903"),~r.datumCode.indexOf("israel")&&(r.datumCode="isr93")),r.b&&!isFinite(r.b)&&(r.b=r.a);function o(h){var u=r.to_meter||1;return h*u}var a=function(h){return BO(r,h)},l=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",Qr],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",Qr],["x0","false_easting",o],["y0","false_northing",o],["long0","central_meridian",Qr],["lat0","latitude_of_origin",Qr],["lat0","standard_parallel_1",Qr],["lat1","standard_parallel_1",Qr],["lat2","standard_parallel_2",Qr],["azimuth","Azimuth"],["alpha","azimuth",Qr],["srsCode","name"]];l.forEach(a),!r.long0&&r.longc&&(r.projName==="Albers_Conic_Equal_Area"||r.projName==="Lambert_Azimuthal_Equal_Area")&&(r.long0=r.longc),!r.lat_ts&&r.lat1&&(r.projName==="Stereographic_South_Pole"||r.projName==="Polar Stereographic (variant B)")?(r.lat0=Qr(r.lat1>0?90:-90),r.lat_ts=r.lat1):!r.lat_ts&&r.lat0&&r.projName==="Polar_Stereographic"&&(r.lat_ts=r.lat0,r.lat0=Qr(r.lat0>0?90:-90))}function S1(r){var t=zO(r),e=t.shift(),n=t.shift();t.unshift(["name",n]),t.unshift(["type",e]);var i={};return ws(t,i),XO(i),i}function We(r){var t=this;if(arguments.length===2){var e=arguments[1];typeof e=="string"?e.charAt(0)==="+"?We[r]=Cc(arguments[1]):We[r]=S1(arguments[1]):We[r]=e}else if(arguments.length===1){if(Array.isArray(r))return r.map(function(n){Array.isArray(n)?We.apply(t,n):We(n)});if(typeof r=="string"){if(r in We)return We[r]}else"EPSG"in r?We["EPSG:"+r.EPSG]=r:"ESRI"in r?We["ESRI:"+r.ESRI]=r:"IAU2000"in r?We["IAU2000:"+r.IAU2000]=r:console.log(r);return}}PO(We);function WO(r){return typeof r=="string"}function qO(r){return r in We}var ZO=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function $O(r){return ZO.some(function(t){return r.indexOf(t)>-1})}var VO=["3857","900913","3785","102113"];function YO(r){var t=gi(r,"authority");if(t){var e=gi(t,"epsg");return e&&VO.indexOf(e)>-1}}function HO(r){var t=gi(r,"extension");if(t)return gi(t,"proj4")}function KO(r){return r[0]==="+"}function QO(r){if(WO(r)){if(qO(r))return We[r];if($O(r)){var t=S1(r);if(YO(t))return We["EPSG:3857"];var e=HO(t);return e?Cc(e):t}if(KO(r))return Cc(r)}else return r}function pm(r,t){r=r||{};var e,n;if(!t)return r;for(n in t)e=t[n],e!==void 0&&(r[n]=e);return r}function dn(r,t,e){var n=r*t;return e/Math.sqrt(1-n*n)}function ja(r){return r<0?-1:1}function rt(r){return Math.abs(r)<=ge?r:r-ja(r)*da}function Ur(r,t,e){var n=r*e,i=.5*r;return n=Math.pow((1-n)/(1+n),i),Math.tan(.5*(V-t))/n}function ga(r,t){for(var e=.5*r,n,i,s=V-2*Math.atan(t),o=0;o<=15;o++)if(n=r*Math.sin(s),i=V-2*Math.atan(t*Math.pow((1-n)/(1+n),e))-s,s+=i,Math.abs(i)<=1e-10)return s;return-9999}function JO(){var r=this.b/this.a;this.es=1-r*r,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=dn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function tF(r){var t=r.x,e=r.y;if(e*sn>90&&e*sn<-90&&t*sn>180&&t*sn<-180)return null;var n,i;if(Math.abs(Math.abs(e)-V)<=J)return null;if(this.sphere)n=this.x0+this.a*this.k0*rt(t-this.long0),i=this.y0+this.a*this.k0*Math.log(Math.tan(Zt+.5*e));else{var s=Math.sin(e),o=Ur(this.e,e,s);n=this.x0+this.a*this.k0*rt(t-this.long0),i=this.y0-this.a*this.k0*Math.log(o)}return r.x=n,r.y=i,r}function eF(r){var t=r.x-this.x0,e=r.y-this.y0,n,i;if(this.sphere)i=V-2*Math.atan(Math.exp(-e/(this.a*this.k0)));else{var s=Math.exp(-e/(this.a*this.k0));if(i=ga(this.e,s),i===-9999)return null}return n=rt(this.long0+t/(this.a*this.k0)),r.x=n,r.y=i,r}var rF=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"];const nF={init:JO,forward:tF,inverse:eF,names:rF};function iF(){}function mm(r){return r}var sF=["longlat","identity"];const oF={init:iF,forward:mm,inverse:mm,names:sF};var aF=[nF,oF],yl={},eh=[];function E1(r,t){var e=eh.length;return r.names?(eh[e]=r,r.names.forEach(function(n){yl[n.toLowerCase()]=e}),this):(console.log(t),!0)}function lF(r){if(!r)return!1;var t=r.toLowerCase();if(typeof yl[t]<"u"&&eh[yl[t]])return eh[yl[t]]}function hF(){aF.forEach(E1)}const uF={start:hF,add:E1,get:lF};var bt={};bt.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"};bt.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"};bt.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"};bt.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"};bt.airy={a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"};bt.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"};bt.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"};bt.mod_airy={a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"};bt.andrae={a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"};bt.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"};bt.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"};bt.bessel={a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"};bt.bess_nam={a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"};bt.clrk66={a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"};bt.clrk80={a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."};bt.clrk80ign={a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"};bt.clrk58={a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"};bt.CPM={a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"};bt.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"};bt.engelis={a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"};bt.evrst30={a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"};bt.evrst48={a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"};bt.evrst56={a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"};bt.evrst69={a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"};bt.evrstSS={a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"};bt.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"};bt.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"};bt.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"};bt.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"};bt.hough={a:6378270,rf:297,ellipseName:"Hough"};bt.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"};bt.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"};bt.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"};bt.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"};bt.new_intl={a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"};bt.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"};bt.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"};bt.SEasia={a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"};bt.walbeck={a:6376896,b:63558348467e-4,ellipseName:"Walbeck"};bt.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"};bt.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"};bt.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var cF=bt.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};bt.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};function dF(r,t,e,n){var i=r*r,s=t*t,o=(i-s)/i,a=0;n?(r*=1-o*(OO+o*(FO+o*NO)),i=r*r,o=0):a=Math.sqrt(o);var l=(i-s)/s;return{es:o,e:a,ep2:l}}function fF(r,t,e,n,i){if(!r){var s=gi(bt,n);s||(s=cF),r=s.a,t=s.b,e=s.rf}return e&&!t&&(t=(1-1/e)*r),(e===0||Math.abs(r-t)<J)&&(i=!0,t=r),{a:r,b:t,rf:e,sphere:i}}var Ee={};Ee.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"};Ee.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"};Ee.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"};Ee.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"};Ee.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"};Ee.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"};Ee.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"};Ee.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"};Ee.militargeographische_institut={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"};Ee.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"};Ee.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"};Ee.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"};Ee.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"};Ee.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"};Ee.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"};Ee.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"};Ee.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"};Ee.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};function gF(r,t,e,n,i,s,o){var a={};return r===void 0||r==="none"?a.datum_type=Rc:a.datum_type=AO,t&&(a.datum_params=t.map(parseFloat),(a.datum_params[0]!==0||a.datum_params[1]!==0||a.datum_params[2]!==0)&&(a.datum_type=Bi),a.datum_params.length>3&&(a.datum_params[3]!==0||a.datum_params[4]!==0||a.datum_params[5]!==0||a.datum_params[6]!==0)&&(a.datum_type=Xi,a.datum_params[3]*=Uo,a.datum_params[4]*=Uo,a.datum_params[5]*=Uo,a.datum_params[6]=a.datum_params[6]/1e6+1)),o&&(a.datum_type=As,a.grids=o),a.a=e,a.b=n,a.es=i,a.ep2=s,a}var T1={};function pF(r,t){var e=new DataView(t),n=yF(e),i=xF(e,n),s=vF(e,i,n),o={header:i,subgrids:s};return T1[r]=o,o}function mF(r){if(r===void 0)return null;var t=r.split(",");return t.map(_F)}function _F(r){if(r.length===0)return null;var t=r[0]==="@";return t&&(r=r.slice(1)),r==="null"?{name:"null",mandatory:!t,grid:null,isNull:!0}:{name:r,mandatory:!t,grid:T1[r]||null,isNull:!1}}function bs(r){return r/3600*Math.PI/180}function yF(r){var t=r.getInt32(8,!1);return t===11?!1:(t=r.getInt32(8,!0),t!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function xF(r,t){return{nFields:r.getInt32(8,t),nSubgridFields:r.getInt32(24,t),nSubgrids:r.getInt32(40,t),shiftType:Ic(r,56,64).trim(),fromSemiMajorAxis:r.getFloat64(120,t),fromSemiMinorAxis:r.getFloat64(136,t),toSemiMajorAxis:r.getFloat64(152,t),toSemiMinorAxis:r.getFloat64(168,t)}}function Ic(r,t,e){return String.fromCharCode.apply(null,new Uint8Array(r.buffer.slice(t,e)))}function vF(r,t,e){for(var n=176,i=[],s=0;s<t.nSubgrids;s++){var o=bF(r,n,e),a=SF(r,n,o,e),l=Math.round(1+(o.upperLongitude-o.lowerLongitude)/o.longitudeInterval),h=Math.round(1+(o.upperLatitude-o.lowerLatitude)/o.latitudeInterval);i.push({ll:[bs(o.lowerLongitude),bs(o.lowerLatitude)],del:[bs(o.longitudeInterval),bs(o.latitudeInterval)],lim:[l,h],count:o.gridNodeCount,cvs:wF(a)}),n+=176+o.gridNodeCount*16}return i}function wF(r){return r.map(function(t){return[bs(t.longitudeShift),bs(t.latitudeShift)]})}function bF(r,t,e){return{name:Ic(r,t+8,t+16).trim(),parent:Ic(r,t+24,t+24+8).trim(),lowerLatitude:r.getFloat64(t+72,e),upperLatitude:r.getFloat64(t+88,e),lowerLongitude:r.getFloat64(t+104,e),upperLongitude:r.getFloat64(t+120,e),latitudeInterval:r.getFloat64(t+136,e),longitudeInterval:r.getFloat64(t+152,e),gridNodeCount:r.getInt32(t+168,e)}}function SF(r,t,e,n){for(var i=t+176,s=16,o=[],a=0;a<e.gridNodeCount;a++){var l={latitudeShift:r.getFloat32(i+a*s,n),longitudeShift:r.getFloat32(i+a*s+4,n),latitudeAccuracy:r.getFloat32(i+a*s+8,n),longitudeAccuracy:r.getFloat32(i+a*s+12,n)};o.push(l)}return o}function ln(r,t){if(!(this instanceof ln))return new ln(r);t=t||function(h){if(h)throw h};var e=QO(r);if(typeof e!="object"){t(r);return}var n=ln.projections.get(e.projName);if(!n){t(r);return}if(e.datumCode&&e.datumCode!=="none"){var i=gi(Ee,e.datumCode);i&&(e.datum_params=e.datum_params||(i.towgs84?i.towgs84.split(","):null),e.ellps=i.ellipse,e.datumName=i.datumName?i.datumName:e.datumCode)}e.k0=e.k0||1,e.axis=e.axis||"enu",e.ellps=e.ellps||"wgs84",e.lat1=e.lat1||e.lat0;var s=fF(e.a,e.b,e.rf,e.ellps,e.sphere),o=dF(s.a,s.b,s.rf,e.R_A),a=mF(e.nadgrids),l=e.datum||gF(e.datumCode,e.datum_params,s.a,s.b,o.es,o.ep2,a);pm(this,e),pm(this,n),this.a=s.a,this.b=s.b,this.rf=s.rf,this.sphere=s.sphere,this.es=o.es,this.e=o.e,this.ep2=o.ep2,this.datum=l,this.init(),t(null,this)}ln.projections=uF;ln.projections.start();function EF(r,t){return r.datum_type!==t.datum_type||r.a!==t.a||Math.abs(r.es-t.es)>5e-11?!1:r.datum_type===Bi?r.datum_params[0]===t.datum_params[0]&&r.datum_params[1]===t.datum_params[1]&&r.datum_params[2]===t.datum_params[2]:r.datum_type===Xi?r.datum_params[0]===t.datum_params[0]&&r.datum_params[1]===t.datum_params[1]&&r.datum_params[2]===t.datum_params[2]&&r.datum_params[3]===t.datum_params[3]&&r.datum_params[4]===t.datum_params[4]&&r.datum_params[5]===t.datum_params[5]&&r.datum_params[6]===t.datum_params[6]:!0}function M1(r,t,e){var n=r.x,i=r.y,s=r.z?r.z:0,o,a,l,h;if(i<-V&&i>-1.001*V)i=-V;else if(i>V&&i<1.001*V)i=V;else{if(i<-V)return{x:-1/0,y:-1/0,z:r.z};if(i>V)return{x:1/0,y:1/0,z:r.z}}return n>Math.PI&&(n-=2*Math.PI),a=Math.sin(i),h=Math.cos(i),l=a*a,o=e/Math.sqrt(1-t*l),{x:(o+s)*h*Math.cos(n),y:(o+s)*h*Math.sin(n),z:(o*(1-t)+s)*a}}function R1(r,t,e,n){var i=1e-12,s=i*i,o=30,a,l,h,u,c,f,g,m,_,x,v,w,S,E=r.x,T=r.y,R=r.z?r.z:0,C,I,F;if(a=Math.sqrt(E*E+T*T),l=Math.sqrt(E*E+T*T+R*R),a/e<i){if(C=0,l/e<i)return I=V,F=-n,{x:r.x,y:r.y,z:r.z}}else C=Math.atan2(T,E);h=R/l,u=a/l,c=1/Math.sqrt(1-t*(2-t)*u*u),m=u*(1-t)*c,_=h*c,S=0;do S++,g=e/Math.sqrt(1-t*_*_),F=a*m+R*_-g*(1-t*_*_),f=t*g/(g+F),c=1/Math.sqrt(1-f*(2-f)*u*u),x=u*(1-f)*c,v=h*c,w=v*m-x*_,m=x,_=v;while(w*w>s&&S<o);return I=Math.atan(v/Math.abs(x)),{x:C,y:I,z:F}}function TF(r,t,e){if(t===Bi)return{x:r.x+e[0],y:r.y+e[1],z:r.z+e[2]};if(t===Xi){var n=e[0],i=e[1],s=e[2],o=e[3],a=e[4],l=e[5],h=e[6];return{x:h*(r.x-l*r.y+a*r.z)+n,y:h*(l*r.x+r.y-o*r.z)+i,z:h*(-a*r.x+o*r.y+r.z)+s}}}function MF(r,t,e){if(t===Bi)return{x:r.x-e[0],y:r.y-e[1],z:r.z-e[2]};if(t===Xi){var n=e[0],i=e[1],s=e[2],o=e[3],a=e[4],l=e[5],h=e[6],u=(r.x-n)/h,c=(r.y-i)/h,f=(r.z-s)/h;return{x:u+l*c-a*f,y:-l*u+c+o*f,z:a*u-o*c+f}}}function ul(r){return r===Bi||r===Xi}function RF(r,t,e){if(EF(r,t)||r.datum_type===Rc||t.datum_type===Rc)return e;var n=r.a,i=r.es;if(r.datum_type===As){var s=_m(r,!1,e);if(s!==0)return;n=cm,i=dm}var o=t.a,a=t.b,l=t.es;if(t.datum_type===As&&(o=cm,a=LO,l=dm),i===l&&n===o&&!ul(r.datum_type)&&!ul(t.datum_type))return e;if(e=M1(e,i,n),ul(r.datum_type)&&(e=TF(e,r.datum_type,r.datum_params)),ul(t.datum_type)&&(e=MF(e,t.datum_type,t.datum_params)),e=R1(e,l,o,a),t.datum_type===As){var h=_m(t,!0,e);if(h!==0)return}return e}function _m(r,t,e){if(r.grids===null||r.grids.length===0)return console.log("Grid shift grids not found"),-1;var n={x:-e.x,y:e.y},i={x:Number.NaN,y:Number.NaN},s=[];t:for(var o=0;o<r.grids.length;o++){var a=r.grids[o];if(s.push(a.name),a.isNull){i=n;break}if(a.mandatory,a.grid===null){if(a.mandatory)return console.log("Unable to find mandatory grid '"+a.name+"'"),-1;continue}for(var l=a.grid.subgrids,h=0,u=l.length;h<u;h++){var c=l[h],f=(Math.abs(c.del[1])+Math.abs(c.del[0]))/1e4,g=c.ll[0]-f,m=c.ll[1]-f,_=c.ll[0]+(c.lim[0]-1)*c.del[0]+f,x=c.ll[1]+(c.lim[1]-1)*c.del[1]+f;if(!(m>n.y||g>n.x||x<n.y||_<n.x)&&(i=CF(n,t,c),!isNaN(i.x)))break t}}return isNaN(i.x)?(console.log("Failed to find a grid shift table for location '"+-n.x*sn+" "+n.y*sn+" tried: '"+s+"'"),-1):(e.x=-i.x,e.y=i.y,0)}function CF(r,t,e){var n={x:Number.NaN,y:Number.NaN};if(isNaN(r.x))return n;var i={x:r.x,y:r.y};i.x-=e.ll[0],i.y-=e.ll[1],i.x=rt(i.x-Math.PI)+Math.PI;var s=ym(i,e);if(t){if(isNaN(s.x))return n;s.x=i.x-s.x,s.y=i.y-s.y;var o=9,a=1e-12,l,h;do{if(h=ym(s,e),isNaN(h.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}l={x:i.x-(h.x+s.x),y:i.y-(h.y+s.y)},s.x+=l.x,s.y+=l.y}while(o--&&Math.abs(l.x)>a&&Math.abs(l.y)>a);if(o<0)return console.log("Inverse grid shift iterator failed to converge."),n;n.x=rt(s.x+e.ll[0]),n.y=s.y+e.ll[1]}else isNaN(s.x)||(n.x=r.x+s.x,n.y=r.y+s.y);return n}function ym(r,t){var e={x:r.x/t.del[0],y:r.y/t.del[1]},n={x:Math.floor(e.x),y:Math.floor(e.y)},i={x:e.x-1*n.x,y:e.y-1*n.y},s={x:Number.NaN,y:Number.NaN},o;if(n.x<0||n.x>=t.lim[0]||n.y<0||n.y>=t.lim[1])return s;o=n.y*t.lim[0]+n.x;var a={x:t.cvs[o][0],y:t.cvs[o][1]};o++;var l={x:t.cvs[o][0],y:t.cvs[o][1]};o+=t.lim[0];var h={x:t.cvs[o][0],y:t.cvs[o][1]};o--;var u={x:t.cvs[o][0],y:t.cvs[o][1]},c=i.x*i.y,f=i.x*(1-i.y),g=(1-i.x)*(1-i.y),m=(1-i.x)*i.y;return s.x=g*a.x+f*l.x+m*u.x+c*h.x,s.y=g*a.y+f*l.y+m*u.y+c*h.y,s}function xm(r,t,e){var n=e.x,i=e.y,s=e.z||0,o,a,l,h={};for(l=0;l<3;l++)if(!(t&&l===2&&e.z===void 0))switch(l===0?(o=n,"ew".indexOf(r.axis[l])!==-1?a="x":a="y"):l===1?(o=i,"ns".indexOf(r.axis[l])!==-1?a="y":a="x"):(o=s,a="z"),r.axis[l]){case"e":h[a]=o;break;case"w":h[a]=-o;break;case"n":h[a]=o;break;case"s":h[a]=-o;break;case"u":e[a]!==void 0&&(h.z=o);break;case"d":e[a]!==void 0&&(h.z=-o);break;default:return null}return h}function C1(r){var t={x:r[0],y:r[1]};return r.length>2&&(t.z=r[2]),r.length>3&&(t.m=r[3]),t}function IF(r){vm(r.x),vm(r.y)}function vm(r){if(typeof Number.isFinite=="function"){if(Number.isFinite(r))return;throw new TypeError("coordinates must be finite numbers")}if(typeof r!="number"||r!==r||!isFinite(r))throw new TypeError("coordinates must be finite numbers")}function PF(r,t){return(r.datum.datum_type===Bi||r.datum.datum_type===Xi||r.datum.datum_type===As)&&t.datumCode!=="WGS84"||(t.datum.datum_type===Bi||t.datum.datum_type===Xi||t.datum.datum_type===As)&&r.datumCode!=="WGS84"}function rh(r,t,e,n){var i;Array.isArray(e)?e=C1(e):e={x:e.x,y:e.y,z:e.z,m:e.m};var s=e.z!==void 0;if(IF(e),r.datum&&t.datum&&PF(r,t)&&(i=new ln("WGS84"),e=rh(r,i,e,n),r=i),n&&r.axis!=="enu"&&(e=xm(r,!1,e)),r.projName==="longlat")e={x:e.x*Pe,y:e.y*Pe,z:e.z||0};else if(r.to_meter&&(e={x:e.x*r.to_meter,y:e.y*r.to_meter,z:e.z||0}),e=r.inverse(e),!e)return;if(r.from_greenwich&&(e.x+=r.from_greenwich),e=RF(r.datum,t.datum,e),!!e)return t.from_greenwich&&(e={x:e.x-t.from_greenwich,y:e.y,z:e.z||0}),t.projName==="longlat"?e={x:e.x*sn,y:e.y*sn,z:e.z||0}:(e=t.forward(e),t.to_meter&&(e={x:e.x/t.to_meter,y:e.y/t.to_meter,z:e.z||0})),n&&t.axis!=="enu"?xm(t,!0,e):(e&&!s&&delete e.z,e)}var wm=ln("WGS84");function ju(r,t,e,n){var i,s,o;return Array.isArray(e)?(i=rh(r,t,e,n)||{x:NaN,y:NaN},e.length>2?typeof r.name<"u"&&r.name==="geocent"||typeof t.name<"u"&&t.name==="geocent"?typeof i.z=="number"?[i.x,i.y,i.z].concat(e.splice(3)):[i.x,i.y,e[2]].concat(e.splice(3)):[i.x,i.y].concat(e.splice(2)):[i.x,i.y]):(s=rh(r,t,e,n),o=Object.keys(e),o.length===2||o.forEach(function(a){if(typeof r.name<"u"&&r.name==="geocent"||typeof t.name<"u"&&t.name==="geocent"){if(a==="x"||a==="y"||a==="z")return}else if(a==="x"||a==="y")return;s[a]=e[a]}),s)}function bm(r){return r instanceof ln?r:r.oProj?r.oProj:ln(r)}function vr(r,t,e){r=bm(r);var n=!1,i;return typeof t>"u"?(t=r,r=wm,n=!0):(typeof t.x<"u"||Array.isArray(t))&&(e=t,t=r,r=wm,n=!0),t=bm(t),e?ju(r,t,e):(i={forward:function(s,o){return ju(r,t,s,o)},inverse:function(s,o){return ju(t,r,s,o)}},n&&(i.oProj=t),i)}var Sm=6,I1="AJSAJS",P1="AFAFAF",Ss=65,Je=73,Tr=79,Co=86,Io=90;const AF={forward:A1,inverse:LF,toPoint:L1};function A1(r,t){return t=t||5,NF(OF({lat:r[1],lon:r[0]}),t)}function LF(r){var t=Bf(F1(r.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat,t.lon,t.lat]:[t.left,t.bottom,t.right,t.top]}function L1(r){var t=Bf(F1(r.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat]:[(t.left+t.right)/2,(t.top+t.bottom)/2]}function zu(r){return r*(Math.PI/180)}function Em(r){return 180*(r/Math.PI)}function OF(r){var t=r.lat,e=r.lon,n=6378137,i=.00669438,s=.9996,o,a,l,h,u,c,f,g=zu(t),m=zu(e),_,x;x=Math.floor((e+180)/6)+1,e===180&&(x=60),t>=56&&t<64&&e>=3&&e<12&&(x=32),t>=72&&t<84&&(e>=0&&e<9?x=31:e>=9&&e<21?x=33:e>=21&&e<33?x=35:e>=33&&e<42&&(x=37)),o=(x-1)*6-180+3,_=zu(o),a=i/(1-i),l=n/Math.sqrt(1-i*Math.sin(g)*Math.sin(g)),h=Math.tan(g)*Math.tan(g),u=a*Math.cos(g)*Math.cos(g),c=Math.cos(g)*(m-_),f=n*((1-i/4-3*i*i/64-5*i*i*i/256)*g-(3*i/8+3*i*i/32+45*i*i*i/1024)*Math.sin(2*g)+(15*i*i/256+45*i*i*i/1024)*Math.sin(4*g)-35*i*i*i/3072*Math.sin(6*g));var v=s*l*(c+(1-h+u)*c*c*c/6+(5-18*h+h*h+72*u-58*a)*c*c*c*c*c/120)+5e5,w=s*(f+l*Math.tan(g)*(c*c/2+(5-h+9*u+4*u*u)*c*c*c*c/24+(61-58*h+h*h+600*u-330*a)*c*c*c*c*c*c/720));return t<0&&(w+=1e7),{northing:Math.round(w),easting:Math.round(v),zoneNumber:x,zoneLetter:FF(t)}}function Bf(r){var t=r.northing,e=r.easting,n=r.zoneLetter,i=r.zoneNumber;if(i<0||i>60)return null;var s=.9996,o=6378137,a=.00669438,l,h=(1-Math.sqrt(1-a))/(1+Math.sqrt(1-a)),u,c,f,g,m,_,x,v,w,S=e-5e5,E=t;n<"N"&&(E-=1e7),x=(i-1)*6-180+3,l=a/(1-a),_=E/s,v=_/(o*(1-a/4-3*a*a/64-5*a*a*a/256)),w=v+(3*h/2-27*h*h*h/32)*Math.sin(2*v)+(21*h*h/16-55*h*h*h*h/32)*Math.sin(4*v)+151*h*h*h/96*Math.sin(6*v),u=o/Math.sqrt(1-a*Math.sin(w)*Math.sin(w)),c=Math.tan(w)*Math.tan(w),f=l*Math.cos(w)*Math.cos(w),g=o*(1-a)/Math.pow(1-a*Math.sin(w)*Math.sin(w),1.5),m=S/(u*s);var T=w-u*Math.tan(w)/g*(m*m/2-(5+3*c+10*f-4*f*f-9*l)*m*m*m*m/24+(61+90*c+298*f+45*c*c-252*l-3*f*f)*m*m*m*m*m*m/720);T=Em(T);var R=(m-(1+2*c+f)*m*m*m/6+(5-2*f+28*c-3*f*f+8*l+24*c*c)*m*m*m*m*m/120)/Math.cos(w);R=x+Em(R);var C;if(r.accuracy){var I=Bf({northing:r.northing+r.accuracy,easting:r.easting+r.accuracy,zoneLetter:r.zoneLetter,zoneNumber:r.zoneNumber});C={top:I.lat,right:I.lon,bottom:T,left:R}}else C={lat:T,lon:R};return C}function FF(r){var t="Z";return 84>=r&&r>=72?t="X":72>r&&r>=64?t="W":64>r&&r>=56?t="V":56>r&&r>=48?t="U":48>r&&r>=40?t="T":40>r&&r>=32?t="S":32>r&&r>=24?t="R":24>r&&r>=16?t="Q":16>r&&r>=8?t="P":8>r&&r>=0?t="N":0>r&&r>=-8?t="M":-8>r&&r>=-16?t="L":-16>r&&r>=-24?t="K":-24>r&&r>=-32?t="J":-32>r&&r>=-40?t="H":-40>r&&r>=-48?t="G":-48>r&&r>=-56?t="F":-56>r&&r>=-64?t="E":-64>r&&r>=-72?t="D":-72>r&&r>=-80&&(t="C"),t}function NF(r,t){var e="00000"+r.easting,n="00000"+r.northing;return r.zoneNumber+r.zoneLetter+DF(r.easting,r.northing,r.zoneNumber)+e.substr(e.length-5,t)+n.substr(n.length-5,t)}function DF(r,t,e){var n=O1(e),i=Math.floor(r/1e5),s=Math.floor(t/1e5)%20;return kF(i,s,n)}function O1(r){var t=r%Sm;return t===0&&(t=Sm),t}function kF(r,t,e){var n=e-1,i=I1.charCodeAt(n),s=P1.charCodeAt(n),o=i+r-1,a=s+t,l=!1;o>Io&&(o=o-Io+Ss-1,l=!0),(o===Je||i<Je&&o>Je||(o>Je||i<Je)&&l)&&o++,(o===Tr||i<Tr&&o>Tr||(o>Tr||i<Tr)&&l)&&(o++,o===Je&&o++),o>Io&&(o=o-Io+Ss-1),a>Co?(a=a-Co+Ss-1,l=!0):l=!1,(a===Je||s<Je&&a>Je||(a>Je||s<Je)&&l)&&a++,(a===Tr||s<Tr&&a>Tr||(a>Tr||s<Tr)&&l)&&(a++,a===Je&&a++),a>Co&&(a=a-Co+Ss-1);var h=String.fromCharCode(o)+String.fromCharCode(a);return h}function F1(r){if(r&&r.length===0)throw"MGRSPoint coverting from nothing";for(var t=r.length,e=null,n="",i,s=0;!/[A-Z]/.test(i=r.charAt(s));){if(s>=2)throw"MGRSPoint bad conversion from: "+r;n+=i,s++}var o=parseInt(n,10);if(s===0||s+3>t)throw"MGRSPoint bad conversion from: "+r;var a=r.charAt(s++);if(a<="A"||a==="B"||a==="Y"||a>="Z"||a==="I"||a==="O")throw"MGRSPoint zone letter "+a+" not handled: "+r;e=r.substring(s,s+=2);for(var l=O1(o),h=GF(e.charAt(0),l),u=jF(e.charAt(1),l);u<zF(a);)u+=2e6;var c=t-s;if(c%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+r;var f=c/2,g=0,m=0,_,x,v,w,S;return f>0&&(_=1e5/Math.pow(10,f),x=r.substring(s,s+f),g=parseFloat(x)*_,v=r.substring(s+f),m=parseFloat(v)*_),w=g+h,S=m+u,{easting:w,northing:S,zoneLetter:a,zoneNumber:o,accuracy:_}}function GF(r,t){for(var e=I1.charCodeAt(t-1),n=1e5,i=!1;e!==r.charCodeAt(0);){if(e++,e===Je&&e++,e===Tr&&e++,e>Io){if(i)throw"Bad character: "+r;e=Ss,i=!0}n+=1e5}return n}function jF(r,t){if(r>"V")throw"MGRSPoint given invalid Northing "+r;for(var e=P1.charCodeAt(t-1),n=0,i=!1;e!==r.charCodeAt(0);){if(e++,e===Je&&e++,e===Tr&&e++,e>Co){if(i)throw"Bad character: "+r;e=Ss,i=!0}n+=1e5}return n}function zF(r){var t;switch(r){case"C":t=11e5;break;case"D":t=2e6;break;case"E":t=28e5;break;case"F":t=37e5;break;case"G":t=46e5;break;case"H":t=55e5;break;case"J":t=64e5;break;case"K":t=73e5;break;case"L":t=82e5;break;case"M":t=91e5;break;case"N":t=0;break;case"P":t=8e5;break;case"Q":t=17e5;break;case"R":t=26e5;break;case"S":t=35e5;break;case"T":t=44e5;break;case"U":t=53e5;break;case"V":t=62e5;break;case"W":t=7e6;break;case"X":t=79e5;break;default:t=-1}if(t>=0)return t;throw"Invalid zone letter: "+r}function qs(r,t,e){if(!(this instanceof qs))return new qs(r,t,e);if(Array.isArray(r))this.x=r[0],this.y=r[1],this.z=r[2]||0;else if(typeof r=="object")this.x=r.x,this.y=r.y,this.z=r.z||0;else if(typeof r=="string"&&typeof t>"u"){var n=r.split(",");this.x=parseFloat(n[0],10),this.y=parseFloat(n[1],10),this.z=parseFloat(n[2],10)||0}else this.x=r,this.y=t,this.z=e||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}qs.fromMGRS=function(r){return new qs(L1(r))};qs.prototype.toMGRS=function(r){return A1([this.x,this.y],r)};var UF=1,BF=.25,Tm=.046875,Mm=.01953125,Rm=.01068115234375,XF=.75,WF=.46875,qF=.013020833333333334,ZF=.007120768229166667,$F=.3645833333333333,VF=.005696614583333333,YF=.3076171875;function N1(r){var t=[];t[0]=UF-r*(BF+r*(Tm+r*(Mm+r*Rm))),t[1]=r*(XF-r*(Tm+r*(Mm+r*Rm)));var e=r*r;return t[2]=e*(WF-r*(qF+r*ZF)),e*=r,t[3]=e*($F-r*VF),t[4]=e*r*YF,t}function Hh(r,t,e,n){return e*=t,t*=t,n[0]*r-e*(n[1]+t*(n[2]+t*(n[3]+t*n[4])))}var HF=20;function D1(r,t,e){for(var n=1/(1-t),i=r,s=HF;s;--s){var o=Math.sin(i),a=1-t*o*o;if(a=(Hh(i,o,Math.cos(i),e)-r)*(a*Math.sqrt(a))*n,i-=a,Math.abs(a)<J)return i}return i}function KF(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=N1(this.es),this.ml0=Hh(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function QF(r){var t=r.x,e=r.y,n=rt(t-this.long0),i,s,o,a=Math.sin(e),l=Math.cos(e);if(this.es){var h=l*n,u=Math.pow(h,2),c=this.ep2*Math.pow(l,2),f=Math.pow(c,2),g=Math.abs(l)>J?Math.tan(e):0,m=Math.pow(g,2),_=Math.pow(m,2);i=1-this.es*Math.pow(a,2),h=h/Math.sqrt(i);var x=Hh(e,a,l,this.en);s=this.a*(this.k0*h*(1+u/6*(1-m+c+u/20*(5-18*m+_+14*c-58*m*c+u/42*(61+179*_-_*m-479*m)))))+this.x0,o=this.a*(this.k0*(x-this.ml0+a*n*h/2*(1+u/12*(5-m+9*c+4*f+u/30*(61+_-58*m+270*c-330*m*c+u/56*(1385+543*_-_*m-3111*m))))))+this.y0}else{var v=l*Math.sin(n);if(Math.abs(Math.abs(v)-1)<J)return 93;if(s=.5*this.a*this.k0*Math.log((1+v)/(1-v))+this.x0,o=l*Math.cos(n)/Math.sqrt(1-Math.pow(v,2)),v=Math.abs(o),v>=1){if(v-1>J)return 93;o=0}else o=Math.acos(o);e<0&&(o=-o),o=this.a*this.k0*(o-this.lat0)+this.y0}return r.x=s,r.y=o,r}function JF(r){var t,e,n,i,s=(r.x-this.x0)*(1/this.a),o=(r.y-this.y0)*(1/this.a);if(this.es)if(t=this.ml0+o/this.k0,e=D1(t,this.es,this.en),Math.abs(e)<V){var a=Math.sin(e),l=Math.cos(e),h=Math.abs(l)>J?Math.tan(e):0,u=this.ep2*Math.pow(l,2),c=Math.pow(u,2),f=Math.pow(h,2),g=Math.pow(f,2);t=1-this.es*Math.pow(a,2);var m=s*Math.sqrt(t)/this.k0,_=Math.pow(m,2);t=t*h,n=e-t*_/(1-this.es)*.5*(1-_/12*(5+3*f-9*u*f+u-4*c-_/30*(61+90*f-252*u*f+45*g+46*u-_/56*(1385+3633*f+4095*g+1574*g*f)))),i=rt(this.long0+m*(1-_/6*(1+2*f+u-_/20*(5+28*f+24*g+8*u*f+6*u-_/42*(61+662*f+1320*g+720*g*f))))/l)}else n=V*ja(o),i=0;else{var x=Math.exp(s/this.k0),v=.5*(x-1/x),w=this.lat0+o/this.k0,S=Math.cos(w);t=Math.sqrt((1-Math.pow(S,2))/(1+Math.pow(v,2))),n=Math.asin(t),o<0&&(n=-n),v===0&&S===0?i=0:i=rt(Math.atan2(v,S)+this.long0)}return r.x=i,r.y=n,r}var t3=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const xl={init:KF,forward:QF,inverse:JF,names:t3};function k1(r){var t=Math.exp(r);return t=(t-1/t)/2,t}function Mr(r,t){r=Math.abs(r),t=Math.abs(t);var e=Math.max(r,t),n=Math.min(r,t)/(e||1);return e*Math.sqrt(1+Math.pow(n,2))}function e3(r){var t=1+r,e=t-1;return e===0?r:r*Math.log(t)/e}function r3(r){var t=Math.abs(r);return t=e3(t*(1+t/(Mr(1,t)+1))),r<0?-t:t}function Xf(r,t){for(var e=2*Math.cos(2*t),n=r.length-1,i=r[n],s=0,o;--n>=0;)o=-s+e*i+r[n],s=i,i=o;return t+o*Math.sin(2*t)}function n3(r,t){for(var e=2*Math.cos(t),n=r.length-1,i=r[n],s=0,o;--n>=0;)o=-s+e*i+r[n],s=i,i=o;return Math.sin(t)*o}function i3(r){var t=Math.exp(r);return t=(t+1/t)/2,t}function G1(r,t,e){for(var n=Math.sin(t),i=Math.cos(t),s=k1(e),o=i3(e),a=2*i*o,l=-2*n*s,h=r.length-1,u=r[h],c=0,f=0,g=0,m,_;--h>=0;)m=f,_=c,f=u,c=g,u=-m+a*f-l*c+r[h],g=-_+l*f+a*c;return a=n*o,l=i*s,[a*u-l*g,a*g+l*u]}function s3(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(xl.init.apply(this),this.forward=xl.forward,this.inverse=xl.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var r=this.es/(1+Math.sqrt(1-this.es)),t=r/(2-r),e=t;this.cgb[0]=t*(2+t*(-2/3+t*(-2+t*(116/45+t*(26/45+t*(-2854/675)))))),this.cbg[0]=t*(-2+t*(2/3+t*(4/3+t*(-82/45+t*(32/45+t*(4642/4725)))))),e=e*t,this.cgb[1]=e*(7/3+t*(-8/5+t*(-227/45+t*(2704/315+t*(2323/945))))),this.cbg[1]=e*(5/3+t*(-16/15+t*(-13/9+t*(904/315+t*(-1522/945))))),e=e*t,this.cgb[2]=e*(56/15+t*(-136/35+t*(-1262/105+t*(73814/2835)))),this.cbg[2]=e*(-26/15+t*(34/21+t*(8/5+t*(-12686/2835)))),e=e*t,this.cgb[3]=e*(4279/630+t*(-332/35+t*(-399572/14175))),this.cbg[3]=e*(1237/630+t*(-12/5+t*(-24832/14175))),e=e*t,this.cgb[4]=e*(4174/315+t*(-144838/6237)),this.cbg[4]=e*(-734/315+t*(109598/31185)),e=e*t,this.cgb[5]=e*(601676/22275),this.cbg[5]=e*(444337/155925),e=Math.pow(t,2),this.Qn=this.k0/(1+t)*(1+e*(1/4+e*(1/64+e/256))),this.utg[0]=t*(-.5+t*(2/3+t*(-37/96+t*(1/360+t*(81/512+t*(-96199/604800)))))),this.gtu[0]=t*(.5+t*(-2/3+t*(5/16+t*(41/180+t*(-127/288+t*(7891/37800)))))),this.utg[1]=e*(-1/48+t*(-1/15+t*(437/1440+t*(-46/105+t*(1118711/3870720))))),this.gtu[1]=e*(13/48+t*(-3/5+t*(557/1440+t*(281/630+t*(-1983433/1935360))))),e=e*t,this.utg[2]=e*(-17/480+t*(37/840+t*(209/4480+t*(-5569/90720)))),this.gtu[2]=e*(61/240+t*(-103/140+t*(15061/26880+t*(167603/181440)))),e=e*t,this.utg[3]=e*(-4397/161280+t*(11/504+t*(830251/7257600))),this.gtu[3]=e*(49561/161280+t*(-179/168+t*(6601661/7257600))),e=e*t,this.utg[4]=e*(-4583/161280+t*(108847/3991680)),this.gtu[4]=e*(34729/80640+t*(-3418889/1995840)),e=e*t,this.utg[5]=e*(-20648693/638668800),this.gtu[5]=e*(212378941/319334400);var n=Xf(this.cbg,this.lat0);this.Zb=-this.Qn*(n+n3(this.gtu,2*n))}function o3(r){var t=rt(r.x-this.long0),e=r.y;e=Xf(this.cbg,e);var n=Math.sin(e),i=Math.cos(e),s=Math.sin(t),o=Math.cos(t);e=Math.atan2(n,o*i),t=Math.atan2(s*i,Mr(n,i*o)),t=r3(Math.tan(t));var a=G1(this.gtu,2*e,2*t);e=e+a[0],t=t+a[1];var l,h;return Math.abs(t)<=2.623395162778?(l=this.a*(this.Qn*t)+this.x0,h=this.a*(this.Qn*e+this.Zb)+this.y0):(l=1/0,h=1/0),r.x=l,r.y=h,r}function a3(r){var t=(r.x-this.x0)*(1/this.a),e=(r.y-this.y0)*(1/this.a);e=(e-this.Zb)/this.Qn,t=t/this.Qn;var n,i;if(Math.abs(t)<=2.623395162778){var s=G1(this.utg,2*e,2*t);e=e+s[0],t=t+s[1],t=Math.atan(k1(t));var o=Math.sin(e),a=Math.cos(e),l=Math.sin(t),h=Math.cos(t);e=Math.atan2(o*h,Mr(l,h*a)),t=Math.atan2(l,h*a),n=rt(t+this.long0),i=Xf(this.cgb,e)}else n=1/0,i=1/0;return r.x=n,r.y=i,r}var l3=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"];const vl={init:s3,forward:o3,inverse:a3,names:l3};function h3(r,t){if(r===void 0){if(r=Math.floor((rt(t)+Math.PI)*30/Math.PI)+1,r<0)return 0;if(r>60)return 60}return r}var u3="etmerc";function c3(){var r=h3(this.zone,this.long0);if(r===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(r)-183)*Pe,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,vl.init.apply(this),this.forward=vl.forward,this.inverse=vl.inverse}var d3=["Universal Transverse Mercator System","utm"];const f3={init:c3,names:d3,dependsOn:u3};function Wf(r,t){return Math.pow((1-r)/(1+r),t)}var g3=20;function p3(){var r=Math.sin(this.lat0),t=Math.cos(this.lat0);t*=t,this.rc=Math.sqrt(1-this.es)/(1-this.es*r*r),this.C=Math.sqrt(1+this.es*t*t/(1-this.es)),this.phic0=Math.asin(r/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+Zt)/(Math.pow(Math.tan(.5*this.lat0+Zt),this.C)*Wf(this.e*r,this.ratexp))}function m3(r){var t=r.x,e=r.y;return r.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*e+Zt),this.C)*Wf(this.e*Math.sin(e),this.ratexp))-V,r.x=this.C*t,r}function _3(r){for(var t=1e-14,e=r.x/this.C,n=r.y,i=Math.pow(Math.tan(.5*n+Zt)/this.K,1/this.C),s=g3;s>0&&(n=2*Math.atan(i*Wf(this.e*Math.sin(r.y),-.5*this.e))-V,!(Math.abs(n-r.y)<t));--s)r.y=n;return s?(r.x=e,r.y=n,r):null}var y3=["gauss"];const qf={init:p3,forward:m3,inverse:_3,names:y3};function x3(){qf.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function v3(r){var t,e,n,i;return r.x=rt(r.x-this.long0),qf.forward.apply(this,[r]),t=Math.sin(r.y),e=Math.cos(r.y),n=Math.cos(r.x),i=this.k0*this.R2/(1+this.sinc0*t+this.cosc0*e*n),r.x=i*e*Math.sin(r.x),r.y=i*(this.cosc0*t-this.sinc0*e*n),r.x=this.a*r.x+this.x0,r.y=this.a*r.y+this.y0,r}function w3(r){var t,e,n,i,s;if(r.x=(r.x-this.x0)/this.a,r.y=(r.y-this.y0)/this.a,r.x/=this.k0,r.y/=this.k0,s=Mr(r.x,r.y)){var o=2*Math.atan2(s,this.R2);t=Math.sin(o),e=Math.cos(o),i=Math.asin(e*this.sinc0+r.y*t*this.cosc0/s),n=Math.atan2(r.x*t,s*this.cosc0*e-r.y*this.sinc0*t)}else i=this.phic0,n=0;return r.x=n,r.y=i,qf.inverse.apply(this,[r]),r.x=rt(r.x+this.long0),r}var b3=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const S3={init:x3,forward:v3,inverse:w3,names:b3};function E3(r,t,e){return t*=e,Math.tan(.5*(V+r))*Math.pow((1-t)/(1+t),.5*e)}function T3(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=J&&(this.k0=.5*(1+ja(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=J&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=J&&Math.abs(Math.cos(this.lat_ts))>J&&(this.k0=.5*this.cons*dn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Ur(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=dn(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-V,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function M3(r){var t=r.x,e=r.y,n=Math.sin(e),i=Math.cos(e),s,o,a,l,h,u,c=rt(t-this.long0);return Math.abs(Math.abs(t-this.long0)-Math.PI)<=J&&Math.abs(e+this.lat0)<=J?(r.x=NaN,r.y=NaN,r):this.sphere?(s=2*this.k0/(1+this.sinlat0*n+this.coslat0*i*Math.cos(c)),r.x=this.a*s*i*Math.sin(c)+this.x0,r.y=this.a*s*(this.coslat0*n-this.sinlat0*i*Math.cos(c))+this.y0,r):(o=2*Math.atan(this.ssfn_(e,n,this.e))-V,l=Math.cos(o),a=Math.sin(o),Math.abs(this.coslat0)<=J?(h=Ur(this.e,e*this.con,this.con*n),u=2*this.a*this.k0*h/this.cons,r.x=this.x0+u*Math.sin(t-this.long0),r.y=this.y0-this.con*u*Math.cos(t-this.long0),r):(Math.abs(this.sinlat0)<J?(s=2*this.a*this.k0/(1+l*Math.cos(c)),r.y=s*a):(s=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*a+this.cosX0*l*Math.cos(c))),r.y=s*(this.cosX0*a-this.sinX0*l*Math.cos(c))+this.y0),r.x=s*l*Math.sin(c)+this.x0,r))}function R3(r){r.x-=this.x0,r.y-=this.y0;var t,e,n,i,s,o=Math.sqrt(r.x*r.x+r.y*r.y);if(this.sphere){var a=2*Math.atan(o/(2*this.a*this.k0));return t=this.long0,e=this.lat0,o<=J?(r.x=t,r.y=e,r):(e=Math.asin(Math.cos(a)*this.sinlat0+r.y*Math.sin(a)*this.coslat0/o),Math.abs(this.coslat0)<J?this.lat0>0?t=rt(this.long0+Math.atan2(r.x,-1*r.y)):t=rt(this.long0+Math.atan2(r.x,r.y)):t=rt(this.long0+Math.atan2(r.x*Math.sin(a),o*this.coslat0*Math.cos(a)-r.y*this.sinlat0*Math.sin(a))),r.x=t,r.y=e,r)}else if(Math.abs(this.coslat0)<=J){if(o<=J)return e=this.lat0,t=this.long0,r.x=t,r.y=e,r;r.x*=this.con,r.y*=this.con,n=o*this.cons/(2*this.a*this.k0),e=this.con*ga(this.e,n),t=this.con*rt(this.con*this.long0+Math.atan2(r.x,-1*r.y))}else i=2*Math.atan(o*this.cosX0/(2*this.a*this.k0*this.ms1)),t=this.long0,o<=J?s=this.X0:(s=Math.asin(Math.cos(i)*this.sinX0+r.y*Math.sin(i)*this.cosX0/o),t=rt(this.long0+Math.atan2(r.x*Math.sin(i),o*this.cosX0*Math.cos(i)-r.y*this.sinX0*Math.sin(i)))),e=-1*ga(this.e,Math.tan(.5*(V+s)));return r.x=t,r.y=e,r}var C3=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)","Polar_Stereographic"];const I3={init:T3,forward:M3,inverse:R3,names:C3,ssfn_:E3};function P3(){var r=this.lat0;this.lambda0=this.long0;var t=Math.sin(r),e=this.a,n=this.rf,i=1/n,s=2*i-Math.pow(i,2),o=this.e=Math.sqrt(s);this.R=this.k0*e*Math.sqrt(1-s)/(1-s*Math.pow(t,2)),this.alpha=Math.sqrt(1+s/(1-s)*Math.pow(Math.cos(r),4)),this.b0=Math.asin(t/this.alpha);var a=Math.log(Math.tan(Math.PI/4+this.b0/2)),l=Math.log(Math.tan(Math.PI/4+r/2)),h=Math.log((1+o*t)/(1-o*t));this.K=a-this.alpha*l+this.alpha*o/2*h}function A3(r){var t=Math.log(Math.tan(Math.PI/4-r.y/2)),e=this.e/2*Math.log((1+this.e*Math.sin(r.y))/(1-this.e*Math.sin(r.y))),n=-this.alpha*(t+e)+this.K,i=2*(Math.atan(Math.exp(n))-Math.PI/4),s=this.alpha*(r.x-this.lambda0),o=Math.atan(Math.sin(s)/(Math.sin(this.b0)*Math.tan(i)+Math.cos(this.b0)*Math.cos(s))),a=Math.asin(Math.cos(this.b0)*Math.sin(i)-Math.sin(this.b0)*Math.cos(i)*Math.cos(s));return r.y=this.R/2*Math.log((1+Math.sin(a))/(1-Math.sin(a)))+this.y0,r.x=this.R*o+this.x0,r}function L3(r){for(var t=r.x-this.x0,e=r.y-this.y0,n=t/this.R,i=2*(Math.atan(Math.exp(e/this.R))-Math.PI/4),s=Math.asin(Math.cos(this.b0)*Math.sin(i)+Math.sin(this.b0)*Math.cos(i)*Math.cos(n)),o=Math.atan(Math.sin(n)/(Math.cos(this.b0)*Math.cos(n)-Math.sin(this.b0)*Math.tan(i))),a=this.lambda0+o/this.alpha,l=0,h=s,u=-1e3,c=0;Math.abs(h-u)>1e-7;){if(++c>20)return;l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+s/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(h))/2)),u=h,h=2*Math.atan(Math.exp(l))-Math.PI/2}return r.x=a,r.y=h,r}var O3=["somerc"];const F3={init:P3,forward:A3,inverse:L3,names:O3};var ms=1e-7;function N3(r){var t=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],e=typeof r.PROJECTION=="object"?Object.keys(r.PROJECTION)[0]:r.PROJECTION;return"no_uoff"in r||"no_off"in r||t.indexOf(e)!==-1}function D3(){var r,t,e,n,i,s,o,a,l,h,u=0,c,f=0,g=0,m=0,_=0,x=0,v=0;this.no_off=N3(this),this.no_rot="no_rot"in this;var w=!1;"alpha"in this&&(w=!0);var S=!1;if("rectified_grid_angle"in this&&(S=!0),w&&(v=this.alpha),S&&(u=this.rectified_grid_angle*Pe),w||S)f=this.longc;else if(g=this.long1,_=this.lat1,m=this.long2,x=this.lat2,Math.abs(_-x)<=ms||(r=Math.abs(_))<=ms||Math.abs(r-V)<=ms||Math.abs(Math.abs(this.lat0)-V)<=ms||Math.abs(Math.abs(x)-V)<=ms)throw new Error;var E=1-this.es;t=Math.sqrt(E),Math.abs(this.lat0)>J?(a=Math.sin(this.lat0),e=Math.cos(this.lat0),r=1-this.es*a*a,this.B=e*e,this.B=Math.sqrt(1+this.es*this.B*this.B/E),this.A=this.B*this.k0*t/r,n=this.B*t/(e*Math.sqrt(r)),i=n*n-1,i<=0?i=0:(i=Math.sqrt(i),this.lat0<0&&(i=-i)),this.E=i+=n,this.E*=Math.pow(Ur(this.e,this.lat0,a),this.B)):(this.B=1/t,this.A=this.k0,this.E=n=i=1),w||S?(w?(c=Math.asin(Math.sin(v)/n),S||(u=v)):(c=u,v=Math.asin(n*Math.sin(c))),this.lam0=f-Math.asin(.5*(i-1/i)*Math.tan(c))/this.B):(s=Math.pow(Ur(this.e,_,Math.sin(_)),this.B),o=Math.pow(Ur(this.e,x,Math.sin(x)),this.B),i=this.E/s,l=(o-s)/(o+s),h=this.E*this.E,h=(h-o*s)/(h+o*s),r=g-m,r<-Math.pi?m-=da:r>Math.pi&&(m+=da),this.lam0=rt(.5*(g+m)-Math.atan(h*Math.tan(.5*this.B*(g-m))/l)/this.B),c=Math.atan(2*Math.sin(this.B*rt(g-this.lam0))/(i-1/i)),u=v=Math.asin(n*Math.sin(c))),this.singam=Math.sin(c),this.cosgam=Math.cos(c),this.sinrot=Math.sin(u),this.cosrot=Math.cos(u),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A*this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(n*n-1)/Math.cos(v))),this.lat0<0&&(this.u_0=-this.u_0)),i=.5*c,this.v_pole_n=this.ArB*Math.log(Math.tan(Zt-i)),this.v_pole_s=this.ArB*Math.log(Math.tan(Zt+i))}function k3(r){var t={},e,n,i,s,o,a,l,h;if(r.x=r.x-this.lam0,Math.abs(Math.abs(r.y)-V)>J){if(o=this.E/Math.pow(Ur(this.e,r.y,Math.sin(r.y)),this.B),a=1/o,e=.5*(o-a),n=.5*(o+a),s=Math.sin(this.B*r.x),i=(e*this.singam-s*this.cosgam)/n,Math.abs(Math.abs(i)-1)<J)throw new Error;h=.5*this.ArB*Math.log((1-i)/(1+i)),a=Math.cos(this.B*r.x),Math.abs(a)<ms?l=this.A*r.x:l=this.ArB*Math.atan2(e*this.cosgam+s*this.singam,a)}else h=r.y>0?this.v_pole_n:this.v_pole_s,l=this.ArB*r.y;return this.no_rot?(t.x=l,t.y=h):(l-=this.u_0,t.x=h*this.cosrot+l*this.sinrot,t.y=l*this.cosrot-h*this.sinrot),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t}function G3(r){var t,e,n,i,s,o,a,l={};if(r.x=(r.x-this.x0)*(1/this.a),r.y=(r.y-this.y0)*(1/this.a),this.no_rot?(e=r.y,t=r.x):(e=r.x*this.cosrot-r.y*this.sinrot,t=r.y*this.cosrot+r.x*this.sinrot+this.u_0),n=Math.exp(-this.BrA*e),i=.5*(n-1/n),s=.5*(n+1/n),o=Math.sin(this.BrA*t),a=(o*this.cosgam+i*this.singam)/s,Math.abs(Math.abs(a)-1)<J)l.x=0,l.y=a<0?-V:V;else{if(l.y=this.E/Math.sqrt((1+a)/(1-a)),l.y=ga(this.e,Math.pow(l.y,1/this.B)),l.y===1/0)throw new Error;l.x=-this.rB*Math.atan2(i*this.cosgam-o*this.singam,Math.cos(this.BrA*t))}return l.x+=this.lam0,l}var j3=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const z3={init:D3,forward:k3,inverse:G3,names:j3};function U3(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<J)){var r=this.b/this.a;this.e=Math.sqrt(1-r*r);var t=Math.sin(this.lat1),e=Math.cos(this.lat1),n=dn(this.e,t,e),i=Ur(this.e,this.lat1,t),s=Math.sin(this.lat2),o=Math.cos(this.lat2),a=dn(this.e,s,o),l=Ur(this.e,this.lat2,s),h=Ur(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>J?this.ns=Math.log(n/a)/Math.log(i/l):this.ns=t,isNaN(this.ns)&&(this.ns=t),this.f0=n/(this.ns*Math.pow(i,this.ns)),this.rh=this.a*this.f0*Math.pow(h,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function B3(r){var t=r.x,e=r.y;Math.abs(2*Math.abs(e)-Math.PI)<=J&&(e=ja(e)*(V-2*J));var n=Math.abs(Math.abs(e)-V),i,s;if(n>J)i=Ur(this.e,e,Math.sin(e)),s=this.a*this.f0*Math.pow(i,this.ns);else{if(n=e*this.ns,n<=0)return null;s=0}var o=this.ns*rt(t-this.long0);return r.x=this.k0*(s*Math.sin(o))+this.x0,r.y=this.k0*(this.rh-s*Math.cos(o))+this.y0,r}function X3(r){var t,e,n,i,s,o=(r.x-this.x0)/this.k0,a=this.rh-(r.y-this.y0)/this.k0;this.ns>0?(t=Math.sqrt(o*o+a*a),e=1):(t=-Math.sqrt(o*o+a*a),e=-1);var l=0;if(t!==0&&(l=Math.atan2(e*o,e*a)),t!==0||this.ns>0){if(e=1/this.ns,n=Math.pow(t/(this.a*this.f0),e),i=ga(this.e,n),i===-9999)return null}else i=-V;return s=rt(l/this.ns+this.long0),r.x=s,r.y=i,r}var W3=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const q3={init:U3,forward:B3,inverse:X3,names:W3};function Z3(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function $3(r){var t,e,n,i,s,o,a,l=r.x,h=r.y,u=rt(l-this.long0);return t=Math.pow((1+this.e*Math.sin(h))/(1-this.e*Math.sin(h)),this.alfa*this.e/2),e=2*(Math.atan(this.k*Math.pow(Math.tan(h/2+this.s45),this.alfa)/t)-this.s45),n=-u*this.alfa,i=Math.asin(Math.cos(this.ad)*Math.sin(e)+Math.sin(this.ad)*Math.cos(e)*Math.cos(n)),s=Math.asin(Math.cos(e)*Math.sin(n)/Math.cos(i)),o=this.n*s,a=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(i/2+this.s45),this.n),r.y=a*Math.cos(o)/1,r.x=a*Math.sin(o)/1,this.czech||(r.y*=-1,r.x*=-1),r}function V3(r){var t,e,n,i,s,o,a,l,h=r.x;r.x=r.y,r.y=h,this.czech||(r.y*=-1,r.x*=-1),o=Math.sqrt(r.x*r.x+r.y*r.y),s=Math.atan2(r.y,r.x),i=s/Math.sin(this.s0),n=2*(Math.atan(Math.pow(this.ro0/o,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),t=Math.asin(Math.cos(this.ad)*Math.sin(n)-Math.sin(this.ad)*Math.cos(n)*Math.cos(i)),e=Math.asin(Math.cos(n)*Math.sin(i)/Math.cos(t)),r.x=this.long0-e/this.alfa,a=t,l=0;var u=0;do r.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(t/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(a))/(1-this.e*Math.sin(a)),this.e/2))-this.s45),Math.abs(a-r.y)<1e-10&&(l=1),a=r.y,u+=1;while(l===0&&u<15);return u>=15?null:r}var Y3=["Krovak","krovak"];const H3={init:Z3,forward:$3,inverse:V3,names:Y3};function $e(r,t,e,n,i){return r*i-t*Math.sin(2*i)+e*Math.sin(4*i)-n*Math.sin(6*i)}function za(r){return 1-.25*r*(1+r/16*(3+1.25*r))}function Ua(r){return .375*r*(1+.25*r*(1+.46875*r))}function Ba(r){return .05859375*r*r*(1+.75*r)}function Xa(r){return r*r*r*(35/3072)}function Zs(r,t,e){var n=t*e;return r/Math.sqrt(1-n*n)}function ao(r){return Math.abs(r)<V?r:r-ja(r)*Math.PI}function nh(r,t,e,n,i){var s,o;s=r/t;for(var a=0;a<15;a++)if(o=(r-(t*s-e*Math.sin(2*s)+n*Math.sin(4*s)-i*Math.sin(6*s)))/(t-2*e*Math.cos(2*s)+4*n*Math.cos(4*s)-6*i*Math.cos(6*s)),s+=o,Math.abs(o)<=1e-10)return s;return NaN}function K3(){this.sphere||(this.e0=za(this.es),this.e1=Ua(this.es),this.e2=Ba(this.es),this.e3=Xa(this.es),this.ml0=this.a*$e(this.e0,this.e1,this.e2,this.e3,this.lat0))}function Q3(r){var t,e,n=r.x,i=r.y;if(n=rt(n-this.long0),this.sphere)t=this.a*Math.asin(Math.cos(i)*Math.sin(n)),e=this.a*(Math.atan2(Math.tan(i),Math.cos(n))-this.lat0);else{var s=Math.sin(i),o=Math.cos(i),a=Zs(this.a,this.e,s),l=Math.tan(i)*Math.tan(i),h=n*Math.cos(i),u=h*h,c=this.es*o*o/(1-this.es),f=this.a*$e(this.e0,this.e1,this.e2,this.e3,i);t=a*h*(1-u*l*(1/6-(8-l+8*c)*u/120)),e=f-this.ml0+a*s/o*u*(.5+(5-l+6*c)*u/24)}return r.x=t+this.x0,r.y=e+this.y0,r}function J3(r){r.x-=this.x0,r.y-=this.y0;var t=r.x/this.a,e=r.y/this.a,n,i;if(this.sphere){var s=e+this.lat0;n=Math.asin(Math.sin(s)*Math.cos(t)),i=Math.atan2(Math.tan(t),Math.cos(s))}else{var o=this.ml0/this.a+e,a=nh(o,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(a)-V)<=J)return r.x=this.long0,r.y=V,e<0&&(r.y*=-1),r;var l=Zs(this.a,this.e,Math.sin(a)),h=l*l*l/this.a/this.a*(1-this.es),u=Math.pow(Math.tan(a),2),c=t*this.a/l,f=c*c;n=a-l*Math.tan(a)/h*c*c*(.5-(1+3*u)*c*c/24),i=c*(1-f*(u/3+(1+3*u)*u*f/15))/Math.cos(a)}return r.x=rt(i+this.long0),r.y=ao(n),r}var tN=["Cassini","Cassini_Soldner","cass"];const eN={init:K3,forward:Q3,inverse:J3,names:tN};function ui(r,t){var e;return r>1e-7?(e=r*t,(1-r*r)*(t/(1-e*e)-.5/r*Math.log((1-e)/(1+e)))):2*t}var rN=1,nN=2,iN=3,sN=4;function oN(){var r=Math.abs(this.lat0);if(Math.abs(r-V)<J?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(r)<J?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var t;switch(this.qp=ui(this.e,1),this.mmf=.5/(1-this.es),this.apa=pN(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=ui(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function aN(r){var t,e,n,i,s,o,a,l,h,u,c=r.x,f=r.y;if(c=rt(c-this.long0),this.sphere){if(s=Math.sin(f),u=Math.cos(f),n=Math.cos(c),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(e=this.mode===this.EQUIT?1+u*n:1+this.sinph0*s+this.cosph0*u*n,e<=J)return null;e=Math.sqrt(2/e),t=e*u*Math.sin(c),e*=this.mode===this.EQUIT?s:this.cosph0*s-this.sinph0*u*n}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(n=-n),Math.abs(f+this.lat0)<J)return null;e=Zt-f*.5,e=2*(this.mode===this.S_POLE?Math.cos(e):Math.sin(e)),t=e*Math.sin(c),e*=n}}else{switch(a=0,l=0,h=0,n=Math.cos(c),i=Math.sin(c),s=Math.sin(f),o=ui(this.e,s),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(a=o/this.qp,l=Math.sqrt(1-a*a)),this.mode){case this.OBLIQ:h=1+this.sinb1*a+this.cosb1*l*n;break;case this.EQUIT:h=1+l*n;break;case this.N_POLE:h=V+f,o=this.qp-o;break;case this.S_POLE:h=f-V,o=this.qp+o;break}if(Math.abs(h)<J)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:h=Math.sqrt(2/h),this.mode===this.OBLIQ?e=this.ymf*h*(this.cosb1*a-this.sinb1*l*n):e=(h=Math.sqrt(2/(1+l*n)))*a*this.ymf,t=this.xmf*h*l*i;break;case this.N_POLE:case this.S_POLE:o>=0?(t=(h=Math.sqrt(o))*i,e=n*(this.mode===this.S_POLE?h:-h)):t=e=0;break}}return r.x=this.a*t+this.x0,r.y=this.a*e+this.y0,r}function lN(r){r.x-=this.x0,r.y-=this.y0;var t=r.x/this.a,e=r.y/this.a,n,i,s,o,a,l,h;if(this.sphere){var u=0,c,f=0;if(c=Math.sqrt(t*t+e*e),i=c*.5,i>1)return null;switch(i=2*Math.asin(i),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(f=Math.sin(i),u=Math.cos(i)),this.mode){case this.EQUIT:i=Math.abs(c)<=J?0:Math.asin(e*f/c),t*=f,e=u*c;break;case this.OBLIQ:i=Math.abs(c)<=J?this.lat0:Math.asin(u*this.sinph0+e*f*this.cosph0/c),t*=f*this.cosph0,e=(u-Math.sin(i)*this.sinph0)*c;break;case this.N_POLE:e=-e,i=V-i;break;case this.S_POLE:i-=V;break}n=e===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(t,e)}else{if(h=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(t/=this.dd,e*=this.dd,l=Math.sqrt(t*t+e*e),l<J)return r.x=this.long0,r.y=this.lat0,r;o=2*Math.asin(.5*l/this.rq),s=Math.cos(o),t*=o=Math.sin(o),this.mode===this.OBLIQ?(h=s*this.sinb1+e*o*this.cosb1/l,a=this.qp*h,e=l*this.cosb1*s-e*this.sinb1*o):(h=e*o/l,a=this.qp*h,e=l*s)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(e=-e),a=t*t+e*e,!a)return r.x=this.long0,r.y=this.lat0,r;h=1-a/this.qp,this.mode===this.S_POLE&&(h=-h)}n=Math.atan2(t,e),i=mN(Math.asin(h),this.apa)}return r.x=rt(this.long0+n),r.y=i,r}var hN=.3333333333333333,uN=.17222222222222222,cN=.10257936507936508,dN=.06388888888888888,fN=.0664021164021164,gN=.016415012942191543;function pN(r){var t,e=[];return e[0]=r*hN,t=r*r,e[0]+=t*uN,e[1]=t*dN,t*=r,e[0]+=t*cN,e[1]+=t*fN,e[2]=t*gN,e}function mN(r,t){var e=r+r;return r+t[0]*Math.sin(e)+t[1]*Math.sin(e+e)+t[2]*Math.sin(e+e+e)}var _N=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const yN={init:oN,forward:aN,inverse:lN,names:_N,S_POLE:rN,N_POLE:nN,EQUIT:iN,OBLIQ:sN};function pi(r){return Math.abs(r)>1&&(r=r>1?1:-1),Math.asin(r)}function xN(){Math.abs(this.lat1+this.lat2)<J||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=dn(this.e3,this.sin_po,this.cos_po),this.qs1=ui(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=dn(this.e3,this.sin_po,this.cos_po),this.qs2=ui(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=ui(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>J?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function vN(r){var t=r.x,e=r.y;this.sin_phi=Math.sin(e),this.cos_phi=Math.cos(e);var n=ui(this.e3,this.sin_phi),i=this.a*Math.sqrt(this.c-this.ns0*n)/this.ns0,s=this.ns0*rt(t-this.long0),o=i*Math.sin(s)+this.x0,a=this.rh-i*Math.cos(s)+this.y0;return r.x=o,r.y=a,r}function wN(r){var t,e,n,i,s,o;return r.x-=this.x0,r.y=this.rh-r.y+this.y0,this.ns0>=0?(t=Math.sqrt(r.x*r.x+r.y*r.y),n=1):(t=-Math.sqrt(r.x*r.x+r.y*r.y),n=-1),i=0,t!==0&&(i=Math.atan2(n*r.x,n*r.y)),n=t*this.ns0/this.a,this.sphere?o=Math.asin((this.c-n*n)/(2*this.ns0)):(e=(this.c-n*n)/this.ns0,o=this.phi1z(this.e3,e)),s=rt(i/this.ns0+this.long0),r.x=s,r.y=o,r}function bN(r,t){var e,n,i,s,o,a=pi(.5*t);if(r<J)return a;for(var l=r*r,h=1;h<=25;h++)if(e=Math.sin(a),n=Math.cos(a),i=r*e,s=1-i*i,o=.5*s*s/n*(t/(1-l)-e/s+.5/r*Math.log((1-i)/(1+i))),a=a+o,Math.abs(o)<=1e-7)return a;return null}var SN=["Albers_Conic_Equal_Area","Albers","aea"];const EN={init:xN,forward:vN,inverse:wN,names:SN,phi1z:bN};function TN(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function MN(r){var t,e,n,i,s,o,a,l,h=r.x,u=r.y;return n=rt(h-this.long0),t=Math.sin(u),e=Math.cos(u),i=Math.cos(n),o=this.sin_p14*t+this.cos_p14*e*i,s=1,o>0||Math.abs(o)<=J?(a=this.x0+this.a*s*e*Math.sin(n)/o,l=this.y0+this.a*s*(this.cos_p14*t-this.sin_p14*e*i)/o):(a=this.x0+this.infinity_dist*e*Math.sin(n),l=this.y0+this.infinity_dist*(this.cos_p14*t-this.sin_p14*e*i)),r.x=a,r.y=l,r}function RN(r){var t,e,n,i,s,o;return r.x=(r.x-this.x0)/this.a,r.y=(r.y-this.y0)/this.a,r.x/=this.k0,r.y/=this.k0,(t=Math.sqrt(r.x*r.x+r.y*r.y))?(i=Math.atan2(t,this.rc),e=Math.sin(i),n=Math.cos(i),o=pi(n*this.sin_p14+r.y*e*this.cos_p14/t),s=Math.atan2(r.x*e,t*this.cos_p14*n-r.y*this.sin_p14*e),s=rt(this.long0+s)):(o=this.phic0,s=0),r.x=s,r.y=o,r}var CN=["gnom"];const IN={init:TN,forward:MN,inverse:RN,names:CN};function PN(r,t){var e=1-(1-r*r)/(2*r)*Math.log((1-r)/(1+r));if(Math.abs(Math.abs(t)-e)<1e-6)return t<0?-1*V:V;for(var n=Math.asin(.5*t),i,s,o,a,l=0;l<30;l++)if(s=Math.sin(n),o=Math.cos(n),a=r*s,i=Math.pow(1-a*a,2)/(2*o)*(t/(1-r*r)-s/(1-a*a)+.5/r*Math.log((1-a)/(1+a))),n+=i,Math.abs(i)<=1e-10)return n;return NaN}function AN(){this.sphere||(this.k0=dn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function LN(r){var t=r.x,e=r.y,n,i,s=rt(t-this.long0);if(this.sphere)n=this.x0+this.a*s*Math.cos(this.lat_ts),i=this.y0+this.a*Math.sin(e)/Math.cos(this.lat_ts);else{var o=ui(this.e,Math.sin(e));n=this.x0+this.a*this.k0*s,i=this.y0+this.a*o*.5/this.k0}return r.x=n,r.y=i,r}function ON(r){r.x-=this.x0,r.y-=this.y0;var t,e;return this.sphere?(t=rt(this.long0+r.x/this.a/Math.cos(this.lat_ts)),e=Math.asin(r.y/this.a*Math.cos(this.lat_ts))):(e=PN(this.e,2*r.y*this.k0/this.a),t=rt(this.long0+r.x/(this.a*this.k0))),r.x=t,r.y=e,r}var FN=["cea"];const NN={init:AN,forward:LN,inverse:ON,names:FN};function DN(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function kN(r){var t=r.x,e=r.y,n=rt(t-this.long0),i=ao(e-this.lat0);return r.x=this.x0+this.a*n*this.rc,r.y=this.y0+this.a*i,r}function GN(r){var t=r.x,e=r.y;return r.x=rt(this.long0+(t-this.x0)/(this.a*this.rc)),r.y=ao(this.lat0+(e-this.y0)/this.a),r}var jN=["Equirectangular","Equidistant_Cylindrical","eqc"];const zN={init:DN,forward:kN,inverse:GN,names:jN};var Cm=20;function UN(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=za(this.es),this.e1=Ua(this.es),this.e2=Ba(this.es),this.e3=Xa(this.es),this.ml0=this.a*$e(this.e0,this.e1,this.e2,this.e3,this.lat0)}function BN(r){var t=r.x,e=r.y,n,i,s,o=rt(t-this.long0);if(s=o*Math.sin(e),this.sphere)Math.abs(e)<=J?(n=this.a*o,i=-1*this.a*this.lat0):(n=this.a*Math.sin(s)/Math.tan(e),i=this.a*(ao(e-this.lat0)+(1-Math.cos(s))/Math.tan(e)));else if(Math.abs(e)<=J)n=this.a*o,i=-1*this.ml0;else{var a=Zs(this.a,this.e,Math.sin(e))/Math.tan(e);n=a*Math.sin(s),i=this.a*$e(this.e0,this.e1,this.e2,this.e3,e)-this.ml0+a*(1-Math.cos(s))}return r.x=n+this.x0,r.y=i+this.y0,r}function XN(r){var t,e,n,i,s,o,a,l,h;if(n=r.x-this.x0,i=r.y-this.y0,this.sphere)if(Math.abs(i+this.a*this.lat0)<=J)t=rt(n/this.a+this.long0),e=0;else{o=this.lat0+i/this.a,a=n*n/this.a/this.a+o*o,l=o;var u;for(s=Cm;s;--s)if(u=Math.tan(l),h=-1*(o*(l*u+1)-l-.5*(l*l+a)*u)/((l-o)/u-1),l+=h,Math.abs(h)<=J){e=l;break}t=rt(this.long0+Math.asin(n*Math.tan(l)/this.a)/Math.sin(e))}else if(Math.abs(i+this.ml0)<=J)e=0,t=rt(this.long0+n/this.a);else{o=(this.ml0+i)/this.a,a=n*n/this.a/this.a+o*o,l=o;var c,f,g,m,_;for(s=Cm;s;--s)if(_=this.e*Math.sin(l),c=Math.sqrt(1-_*_)*Math.tan(l),f=this.a*$e(this.e0,this.e1,this.e2,this.e3,l),g=this.e0-2*this.e1*Math.cos(2*l)+4*this.e2*Math.cos(4*l)-6*this.e3*Math.cos(6*l),m=f/this.a,h=(o*(c*m+1)-m-.5*c*(m*m+a))/(this.es*Math.sin(2*l)*(m*m+a-2*o*m)/(4*c)+(o-m)*(c*g-2/Math.sin(2*l))-g),l-=h,Math.abs(h)<=J){e=l;break}c=Math.sqrt(1-this.es*Math.pow(Math.sin(e),2))*Math.tan(e),t=rt(this.long0+Math.asin(n*c/this.a)/Math.sin(e))}return r.x=t,r.y=e,r}var WN=["Polyconic","poly"];const qN={init:UN,forward:BN,inverse:XN,names:WN};function ZN(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function $N(r){var t,e=r.x,n=r.y,i=n-this.lat0,s=e-this.long0,o=i/Uo*1e-5,a=s,l=1,h=0;for(t=1;t<=10;t++)l=l*o,h=h+this.A[t]*l;var u=h,c=a,f=1,g=0,m,_,x=0,v=0;for(t=1;t<=6;t++)m=f*u-g*c,_=g*u+f*c,f=m,g=_,x=x+this.B_re[t]*f-this.B_im[t]*g,v=v+this.B_im[t]*f+this.B_re[t]*g;return r.x=v*this.a+this.x0,r.y=x*this.a+this.y0,r}function VN(r){var t,e=r.x,n=r.y,i=e-this.x0,s=n-this.y0,o=s/this.a,a=i/this.a,l=1,h=0,u,c,f=0,g=0;for(t=1;t<=6;t++)u=l*o-h*a,c=h*o+l*a,l=u,h=c,f=f+this.C_re[t]*l-this.C_im[t]*h,g=g+this.C_im[t]*l+this.C_re[t]*h;for(var m=0;m<this.iterations;m++){var _=f,x=g,v,w,S=o,E=a;for(t=2;t<=6;t++)v=_*f-x*g,w=x*f+_*g,_=v,x=w,S=S+(t-1)*(this.B_re[t]*_-this.B_im[t]*x),E=E+(t-1)*(this.B_im[t]*_+this.B_re[t]*x);_=1,x=0;var T=this.B_re[1],R=this.B_im[1];for(t=2;t<=6;t++)v=_*f-x*g,w=x*f+_*g,_=v,x=w,T=T+t*(this.B_re[t]*_-this.B_im[t]*x),R=R+t*(this.B_im[t]*_+this.B_re[t]*x);var C=T*T+R*R;f=(S*T+E*R)/C,g=(E*T-S*R)/C}var I=f,F=g,U=1,j=0;for(t=1;t<=9;t++)U=U*I,j=j+this.D[t]*U;var B=this.lat0+j*Uo*1e5,d=this.long0+F;return r.x=d,r.y=B,r}var YN=["New_Zealand_Map_Grid","nzmg"];const HN={init:ZN,forward:$N,inverse:VN,names:YN};function KN(){}function QN(r){var t=r.x,e=r.y,n=rt(t-this.long0),i=this.x0+this.a*n,s=this.y0+this.a*Math.log(Math.tan(Math.PI/4+e/2.5))*1.25;return r.x=i,r.y=s,r}function JN(r){r.x-=this.x0,r.y-=this.y0;var t=rt(this.long0+r.x/this.a),e=2.5*(Math.atan(Math.exp(.8*r.y/this.a))-Math.PI/4);return r.x=t,r.y=e,r}var tD=["Miller_Cylindrical","mill"];const eD={init:KN,forward:QN,inverse:JN,names:tD};var rD=20;function nD(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=N1(this.es)}function iD(r){var t,e,n=r.x,i=r.y;if(n=rt(n-this.long0),this.sphere){if(!this.m)i=this.n!==1?Math.asin(this.n*Math.sin(i)):i;else for(var s=this.n*Math.sin(i),o=rD;o;--o){var a=(this.m*i+Math.sin(i)-s)/(this.m+Math.cos(i));if(i-=a,Math.abs(a)<J)break}t=this.a*this.C_x*n*(this.m+Math.cos(i)),e=this.a*this.C_y*i}else{var l=Math.sin(i),h=Math.cos(i);e=this.a*Hh(i,l,h,this.en),t=this.a*n*h/Math.sqrt(1-this.es*l*l)}return r.x=t,r.y=e,r}function sD(r){var t,e,n,i;return r.x-=this.x0,n=r.x/this.a,r.y-=this.y0,t=r.y/this.a,this.sphere?(t/=this.C_y,n=n/(this.C_x*(this.m+Math.cos(t))),this.m?t=pi((this.m*t+Math.sin(t))/this.n):this.n!==1&&(t=pi(Math.sin(t)/this.n)),n=rt(n+this.long0),t=ao(t)):(t=D1(r.y/this.a,this.es,this.en),i=Math.abs(t),i<V?(i=Math.sin(t),e=this.long0+r.x*Math.sqrt(1-this.es*i*i)/(this.a*Math.cos(t)),n=rt(e)):i-J<V&&(n=this.long0)),r.x=n,r.y=t,r}var oD=["Sinusoidal","sinu"];const aD={init:nD,forward:iD,inverse:sD,names:oD};function lD(){}function hD(r){for(var t=r.x,e=r.y,n=rt(t-this.long0),i=e,s=Math.PI*Math.sin(e);;){var o=-(i+Math.sin(i)-s)/(1+Math.cos(i));if(i+=o,Math.abs(o)<J)break}i/=2,Math.PI/2-Math.abs(e)<J&&(n=0);var a=.900316316158*this.a*n*Math.cos(i)+this.x0,l=1.4142135623731*this.a*Math.sin(i)+this.y0;return r.x=a,r.y=l,r}function uD(r){var t,e;r.x-=this.x0,r.y-=this.y0,e=r.y/(1.4142135623731*this.a),Math.abs(e)>.999999999999&&(e=.999999999999),t=Math.asin(e);var n=rt(this.long0+r.x/(.900316316158*this.a*Math.cos(t)));n<-Math.PI&&(n=-Math.PI),n>Math.PI&&(n=Math.PI),e=(2*t+Math.sin(2*t))/Math.PI,Math.abs(e)>1&&(e=1);var i=Math.asin(e);return r.x=n,r.y=i,r}var cD=["Mollweide","moll"];const dD={init:lD,forward:hD,inverse:uD,names:cD};function fD(){Math.abs(this.lat1+this.lat2)<J||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=za(this.es),this.e1=Ua(this.es),this.e2=Ba(this.es),this.e3=Xa(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=dn(this.e,this.sinphi,this.cosphi),this.ml1=$e(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<J?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=dn(this.e,this.sinphi,this.cosphi),this.ml2=$e(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=$e(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function gD(r){var t=r.x,e=r.y,n;if(this.sphere)n=this.a*(this.g-e);else{var i=$e(this.e0,this.e1,this.e2,this.e3,e);n=this.a*(this.g-i)}var s=this.ns*rt(t-this.long0),o=this.x0+n*Math.sin(s),a=this.y0+this.rh-n*Math.cos(s);return r.x=o,r.y=a,r}function pD(r){r.x-=this.x0,r.y=this.rh-r.y+this.y0;var t,e,n,i;this.ns>=0?(e=Math.sqrt(r.x*r.x+r.y*r.y),t=1):(e=-Math.sqrt(r.x*r.x+r.y*r.y),t=-1);var s=0;if(e!==0&&(s=Math.atan2(t*r.x,t*r.y)),this.sphere)return i=rt(this.long0+s/this.ns),n=ao(this.g-e/this.a),r.x=i,r.y=n,r;var o=this.g-e/this.a;return n=nh(o,this.e0,this.e1,this.e2,this.e3),i=rt(this.long0+s/this.ns),r.x=i,r.y=n,r}var mD=["Equidistant_Conic","eqdc"];const _D={init:fD,forward:gD,inverse:pD,names:mD};function yD(){this.R=this.a}function xD(r){var t=r.x,e=r.y,n=rt(t-this.long0),i,s;Math.abs(e)<=J&&(i=this.x0+this.R*n,s=this.y0);var o=pi(2*Math.abs(e/Math.PI));(Math.abs(n)<=J||Math.abs(Math.abs(e)-V)<=J)&&(i=this.x0,e>=0?s=this.y0+Math.PI*this.R*Math.tan(.5*o):s=this.y0+Math.PI*this.R*-Math.tan(.5*o));var a=.5*Math.abs(Math.PI/n-n/Math.PI),l=a*a,h=Math.sin(o),u=Math.cos(o),c=u/(h+u-1),f=c*c,g=c*(2/h-1),m=g*g,_=Math.PI*this.R*(a*(c-m)+Math.sqrt(l*(c-m)*(c-m)-(m+l)*(f-m)))/(m+l);n<0&&(_=-_),i=this.x0+_;var x=l+c;return _=Math.PI*this.R*(g*x-a*Math.sqrt((m+l)*(l+1)-x*x))/(m+l),e>=0?s=this.y0+_:s=this.y0-_,r.x=i,r.y=s,r}function vD(r){var t,e,n,i,s,o,a,l,h,u,c,f,g;return r.x-=this.x0,r.y-=this.y0,c=Math.PI*this.R,n=r.x/c,i=r.y/c,s=n*n+i*i,o=-Math.abs(i)*(1+s),a=o-2*i*i+n*n,l=-2*o+1+2*i*i+s*s,g=i*i/l+(2*a*a*a/l/l/l-9*o*a/l/l)/27,h=(o-a*a/3/l)/l,u=2*Math.sqrt(-h/3),c=3*g/h/u,Math.abs(c)>1&&(c>=0?c=1:c=-1),f=Math.acos(c)/3,r.y>=0?e=(-u*Math.cos(f+Math.PI/3)-a/3/l)*Math.PI:e=-(-u*Math.cos(f+Math.PI/3)-a/3/l)*Math.PI,Math.abs(n)<J?t=this.long0:t=rt(this.long0+Math.PI*(s-1+Math.sqrt(1+2*(n*n-i*i)+s*s))/2/n),r.x=t,r.y=e,r}var wD=["Van_der_Grinten_I","VanDerGrinten","vandg"];const bD={init:yD,forward:xD,inverse:vD,names:wD};function SD(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)}function ED(r){var t=r.x,e=r.y,n=Math.sin(r.y),i=Math.cos(r.y),s=rt(t-this.long0),o,a,l,h,u,c,f,g,m,_,x,v,w,S,E,T,R,C,I,F,U,j,B;return this.sphere?Math.abs(this.sin_p12-1)<=J?(r.x=this.x0+this.a*(V-e)*Math.sin(s),r.y=this.y0-this.a*(V-e)*Math.cos(s),r):Math.abs(this.sin_p12+1)<=J?(r.x=this.x0+this.a*(V+e)*Math.sin(s),r.y=this.y0+this.a*(V+e)*Math.cos(s),r):(C=this.sin_p12*n+this.cos_p12*i*Math.cos(s),T=Math.acos(C),R=T?T/Math.sin(T):1,r.x=this.x0+this.a*R*i*Math.sin(s),r.y=this.y0+this.a*R*(this.cos_p12*n-this.sin_p12*i*Math.cos(s)),r):(o=za(this.es),a=Ua(this.es),l=Ba(this.es),h=Xa(this.es),Math.abs(this.sin_p12-1)<=J?(u=this.a*$e(o,a,l,h,V),c=this.a*$e(o,a,l,h,e),r.x=this.x0+(u-c)*Math.sin(s),r.y=this.y0-(u-c)*Math.cos(s),r):Math.abs(this.sin_p12+1)<=J?(u=this.a*$e(o,a,l,h,V),c=this.a*$e(o,a,l,h,e),r.x=this.x0+(u+c)*Math.sin(s),r.y=this.y0+(u+c)*Math.cos(s),r):(f=n/i,g=Zs(this.a,this.e,this.sin_p12),m=Zs(this.a,this.e,n),_=Math.atan((1-this.es)*f+this.es*g*this.sin_p12/(m*i)),x=Math.atan2(Math.sin(s),this.cos_p12*Math.tan(_)-this.sin_p12*Math.cos(s)),x===0?I=Math.asin(this.cos_p12*Math.sin(_)-this.sin_p12*Math.cos(_)):Math.abs(Math.abs(x)-Math.PI)<=J?I=-Math.asin(this.cos_p12*Math.sin(_)-this.sin_p12*Math.cos(_)):I=Math.asin(Math.sin(s)*Math.cos(_)/Math.sin(x)),v=this.e*this.sin_p12/Math.sqrt(1-this.es),w=this.e*this.cos_p12*Math.cos(x)/Math.sqrt(1-this.es),S=v*w,E=w*w,F=I*I,U=F*I,j=U*I,B=j*I,T=g*I*(1-F*E*(1-E)/6+U/8*S*(1-2*E)+j/120*(E*(4-7*E)-3*v*v*(1-7*E))-B/48*S),r.x=this.x0+T*Math.sin(x),r.y=this.y0+T*Math.cos(x),r))}function TD(r){r.x-=this.x0,r.y-=this.y0;var t,e,n,i,s,o,a,l,h,u,c,f,g,m,_,x,v,w,S,E,T,R,C,I;return this.sphere?(t=Math.sqrt(r.x*r.x+r.y*r.y),t>2*V*this.a?void 0:(e=t/this.a,n=Math.sin(e),i=Math.cos(e),s=this.long0,Math.abs(t)<=J?o=this.lat0:(o=pi(i*this.sin_p12+r.y*n*this.cos_p12/t),a=Math.abs(this.lat0)-V,Math.abs(a)<=J?this.lat0>=0?s=rt(this.long0+Math.atan2(r.x,-r.y)):s=rt(this.long0-Math.atan2(-r.x,r.y)):s=rt(this.long0+Math.atan2(r.x*n,t*this.cos_p12*i-r.y*this.sin_p12*n))),r.x=s,r.y=o,r)):(l=za(this.es),h=Ua(this.es),u=Ba(this.es),c=Xa(this.es),Math.abs(this.sin_p12-1)<=J?(f=this.a*$e(l,h,u,c,V),t=Math.sqrt(r.x*r.x+r.y*r.y),g=f-t,o=nh(g/this.a,l,h,u,c),s=rt(this.long0+Math.atan2(r.x,-1*r.y)),r.x=s,r.y=o,r):Math.abs(this.sin_p12+1)<=J?(f=this.a*$e(l,h,u,c,V),t=Math.sqrt(r.x*r.x+r.y*r.y),g=t-f,o=nh(g/this.a,l,h,u,c),s=rt(this.long0+Math.atan2(r.x,r.y)),r.x=s,r.y=o,r):(t=Math.sqrt(r.x*r.x+r.y*r.y),x=Math.atan2(r.x,r.y),m=Zs(this.a,this.e,this.sin_p12),v=Math.cos(x),w=this.e*this.cos_p12*v,S=-w*w/(1-this.es),E=3*this.es*(1-S)*this.sin_p12*this.cos_p12*v/(1-this.es),T=t/m,R=T-S*(1+S)*Math.pow(T,3)/6-E*(1+3*S)*Math.pow(T,4)/24,C=1-S*R*R/2-T*R*R*R/6,_=Math.asin(this.sin_p12*Math.cos(R)+this.cos_p12*Math.sin(R)*v),s=rt(this.long0+Math.asin(Math.sin(x)*Math.sin(R)/Math.cos(_))),I=Math.sin(_),o=Math.atan2((I-this.es*C*this.sin_p12)*Math.tan(_),I*(1-this.es)),r.x=s,r.y=o,r))}var MD=["Azimuthal_Equidistant","aeqd"];const RD={init:SD,forward:ED,inverse:TD,names:MD};function CD(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function ID(r){var t,e,n,i,s,o,a,l,h=r.x,u=r.y;return n=rt(h-this.long0),t=Math.sin(u),e=Math.cos(u),i=Math.cos(n),o=this.sin_p14*t+this.cos_p14*e*i,s=1,(o>0||Math.abs(o)<=J)&&(a=this.a*s*e*Math.sin(n),l=this.y0+this.a*s*(this.cos_p14*t-this.sin_p14*e*i)),r.x=a,r.y=l,r}function PD(r){var t,e,n,i,s,o,a;return r.x-=this.x0,r.y-=this.y0,t=Math.sqrt(r.x*r.x+r.y*r.y),e=pi(t/this.a),n=Math.sin(e),i=Math.cos(e),o=this.long0,Math.abs(t)<=J?(a=this.lat0,r.x=o,r.y=a,r):(a=pi(i*this.sin_p14+r.y*n*this.cos_p14/t),s=Math.abs(this.lat0)-V,Math.abs(s)<=J?(this.lat0>=0?o=rt(this.long0+Math.atan2(r.x,-r.y)):o=rt(this.long0-Math.atan2(-r.x,r.y)),r.x=o,r.y=a,r):(o=rt(this.long0+Math.atan2(r.x*n,t*this.cos_p14*i-r.y*this.sin_p14*n)),r.x=o,r.y=a,r))}var AD=["ortho"];const LD={init:CD,forward:ID,inverse:PD,names:AD};var oe={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},$t={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function OD(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=V-Zt/2?this.face=oe.TOP:this.lat0<=-(V-Zt/2)?this.face=oe.BOTTOM:Math.abs(this.long0)<=Zt?this.face=oe.FRONT:Math.abs(this.long0)<=V+Zt?this.face=this.long0>0?oe.RIGHT:oe.LEFT:this.face=oe.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function FD(r){var t={x:0,y:0},e,n,i,s,o,a,l={value:0};if(r.x-=this.long0,this.es!==0?e=Math.atan(this.one_minus_f_squared*Math.tan(r.y)):e=r.y,n=r.x,this.face===oe.TOP)s=V-e,n>=Zt&&n<=V+Zt?(l.value=$t.AREA_0,i=n-V):n>V+Zt||n<=-(V+Zt)?(l.value=$t.AREA_1,i=n>0?n-ge:n+ge):n>-(V+Zt)&&n<=-Zt?(l.value=$t.AREA_2,i=n+V):(l.value=$t.AREA_3,i=n);else if(this.face===oe.BOTTOM)s=V+e,n>=Zt&&n<=V+Zt?(l.value=$t.AREA_0,i=-n+V):n<Zt&&n>=-Zt?(l.value=$t.AREA_1,i=-n):n<-Zt&&n>=-(V+Zt)?(l.value=$t.AREA_2,i=-n-V):(l.value=$t.AREA_3,i=n>0?-n+ge:-n-ge);else{var h,u,c,f,g,m,_;this.face===oe.RIGHT?n=Ls(n,+V):this.face===oe.BACK?n=Ls(n,+ge):this.face===oe.LEFT&&(n=Ls(n,-V)),f=Math.sin(e),g=Math.cos(e),m=Math.sin(n),_=Math.cos(n),h=g*_,u=g*m,c=f,this.face===oe.FRONT?(s=Math.acos(h),i=cl(s,c,u,l)):this.face===oe.RIGHT?(s=Math.acos(u),i=cl(s,c,-h,l)):this.face===oe.BACK?(s=Math.acos(-h),i=cl(s,c,-u,l)):this.face===oe.LEFT?(s=Math.acos(-u),i=cl(s,c,h,l)):(s=i=0,l.value=$t.AREA_0)}return a=Math.atan(12/ge*(i+Math.acos(Math.sin(i)*Math.cos(Zt))-V)),o=Math.sqrt((1-Math.cos(s))/(Math.cos(a)*Math.cos(a))/(1-Math.cos(Math.atan(1/Math.cos(i))))),l.value===$t.AREA_1?a+=V:l.value===$t.AREA_2?a+=ge:l.value===$t.AREA_3&&(a+=1.5*ge),t.x=o*Math.cos(a),t.y=o*Math.sin(a),t.x=t.x*this.a+this.x0,t.y=t.y*this.a+this.y0,r.x=t.x,r.y=t.y,r}function ND(r){var t={lam:0,phi:0},e,n,i,s,o,a,l,h,u,c={value:0};if(r.x=(r.x-this.x0)/this.a,r.y=(r.y-this.y0)/this.a,n=Math.atan(Math.sqrt(r.x*r.x+r.y*r.y)),e=Math.atan2(r.y,r.x),r.x>=0&&r.x>=Math.abs(r.y)?c.value=$t.AREA_0:r.y>=0&&r.y>=Math.abs(r.x)?(c.value=$t.AREA_1,e-=V):r.x<0&&-r.x>=Math.abs(r.y)?(c.value=$t.AREA_2,e=e<0?e+ge:e-ge):(c.value=$t.AREA_3,e+=V),u=ge/12*Math.tan(e),o=Math.sin(u)/(Math.cos(u)-1/Math.sqrt(2)),a=Math.atan(o),i=Math.cos(e),s=Math.tan(n),l=1-i*i*s*s*(1-Math.cos(Math.atan(1/Math.cos(a)))),l<-1?l=-1:l>1&&(l=1),this.face===oe.TOP)h=Math.acos(l),t.phi=V-h,c.value===$t.AREA_0?t.lam=a+V:c.value===$t.AREA_1?t.lam=a<0?a+ge:a-ge:c.value===$t.AREA_2?t.lam=a-V:t.lam=a;else if(this.face===oe.BOTTOM)h=Math.acos(l),t.phi=h-V,c.value===$t.AREA_0?t.lam=-a+V:c.value===$t.AREA_1?t.lam=-a:c.value===$t.AREA_2?t.lam=-a-V:t.lam=a<0?-a-ge:-a+ge;else{var f,g,m;f=l,u=f*f,u>=1?m=0:m=Math.sqrt(1-u)*Math.sin(a),u+=m*m,u>=1?g=0:g=Math.sqrt(1-u),c.value===$t.AREA_1?(u=g,g=-m,m=u):c.value===$t.AREA_2?(g=-g,m=-m):c.value===$t.AREA_3&&(u=g,g=m,m=-u),this.face===oe.RIGHT?(u=f,f=-g,g=u):this.face===oe.BACK?(f=-f,g=-g):this.face===oe.LEFT&&(u=f,f=g,g=-u),t.phi=Math.acos(-m)-V,t.lam=Math.atan2(g,f),this.face===oe.RIGHT?t.lam=Ls(t.lam,-V):this.face===oe.BACK?t.lam=Ls(t.lam,-ge):this.face===oe.LEFT&&(t.lam=Ls(t.lam,+V))}if(this.es!==0){var _,x,v;_=t.phi<0?1:0,x=Math.tan(t.phi),v=this.b/Math.sqrt(x*x+this.one_minus_f_squared),t.phi=Math.atan(Math.sqrt(this.a*this.a-v*v)/(this.one_minus_f*v)),_&&(t.phi=-t.phi)}return t.lam+=this.long0,r.x=t.lam,r.y=t.phi,r}function cl(r,t,e,n){var i;return r<J?(n.value=$t.AREA_0,i=0):(i=Math.atan2(t,e),Math.abs(i)<=Zt?n.value=$t.AREA_0:i>Zt&&i<=V+Zt?(n.value=$t.AREA_1,i-=V):i>V+Zt||i<=-(V+Zt)?(n.value=$t.AREA_2,i=i>=0?i-ge:i+ge):(n.value=$t.AREA_3,i+=V)),i}function Ls(r,t){var e=r+t;return e<-ge?e+=da:e>+ge&&(e-=da),e}var DD=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const kD={init:OD,forward:FD,inverse:ND,names:DD};var Pc=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],Po=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],j1=.8487,z1=1.3523,U1=sn/5,GD=1/U1,Es=18,ih=function(r,t){return r[0]+t*(r[1]+t*(r[2]+t*r[3]))},jD=function(r,t){return r[1]+t*(2*r[2]+t*3*r[3])};function zD(r,t,e,n){for(var i=t;n;--n){var s=r(i);if(i-=s,Math.abs(s)<e)break}return i}function UD(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function BD(r){var t=rt(r.x-this.long0),e=Math.abs(r.y),n=Math.floor(e*U1);n<0?n=0:n>=Es&&(n=Es-1),e=sn*(e-GD*n);var i={x:ih(Pc[n],e)*t,y:ih(Po[n],e)};return r.y<0&&(i.y=-i.y),i.x=i.x*this.a*j1+this.x0,i.y=i.y*this.a*z1+this.y0,i}function XD(r){var t={x:(r.x-this.x0)/(this.a*j1),y:Math.abs(r.y-this.y0)/(this.a*z1)};if(t.y>=1)t.x/=Pc[Es][0],t.y=r.y<0?-V:V;else{var e=Math.floor(t.y*Es);for(e<0?e=0:e>=Es&&(e=Es-1);;)if(Po[e][0]>t.y)--e;else if(Po[e+1][0]<=t.y)++e;else break;var n=Po[e],i=5*(t.y-n[0])/(Po[e+1][0]-n[0]);i=zD(function(s){return(ih(n,s)-t.y)/jD(n,s)},i,J,100),t.x/=ih(Pc[e],i),t.y=(5*e+i)*Pe,r.y<0&&(t.y=-t.y)}return t.x=rt(t.x+this.long0),t}var WD=["Robinson","robin"];const qD={init:UD,forward:BD,inverse:XD,names:WD};function ZD(){this.name="geocent"}function $D(r){var t=M1(r,this.es,this.a);return t}function VD(r){var t=R1(r,this.es,this.a,this.b);return t}var YD=["Geocentric","geocentric","geocent","Geocent"];const HD={init:ZD,forward:$D,inverse:VD,names:YD};var ke={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},yo={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function KD(){if(Object.keys(yo).forEach(function(e){if(typeof this[e]>"u")this[e]=yo[e].def;else{if(yo[e].num&&isNaN(this[e]))throw new Error("Invalid parameter value, must be numeric "+e+" = "+this[e]);yo[e].num&&(this[e]=parseFloat(this[e]))}yo[e].degrees&&(this[e]=this[e]*Pe)}.bind(this)),Math.abs(Math.abs(this.lat0)-V)<J?this.mode=this.lat0<0?ke.S_POLE:ke.N_POLE:Math.abs(this.lat0)<J?this.mode=ke.EQUIT:(this.mode=ke.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var r=this.tilt,t=this.azi;this.cg=Math.cos(t),this.sg=Math.sin(t),this.cw=Math.cos(r),this.sw=Math.sin(r)}function QD(r){r.x-=this.long0;var t=Math.sin(r.y),e=Math.cos(r.y),n=Math.cos(r.x),i,s;switch(this.mode){case ke.OBLIQ:s=this.sinph0*t+this.cosph0*e*n;break;case ke.EQUIT:s=e*n;break;case ke.S_POLE:s=-t;break;case ke.N_POLE:s=t;break}switch(s=this.pn1/(this.p-s),i=s*e*Math.sin(r.x),this.mode){case ke.OBLIQ:s*=this.cosph0*t-this.sinph0*e*n;break;case ke.EQUIT:s*=t;break;case ke.N_POLE:s*=-(e*n);break;case ke.S_POLE:s*=e*n;break}var o,a;return o=s*this.cg+i*this.sg,a=1/(o*this.sw*this.h1+this.cw),i=(i*this.cg-s*this.sg)*this.cw*a,s=o*a,r.x=i*this.a,r.y=s*this.a,r}function JD(r){r.x/=this.a,r.y/=this.a;var t={x:r.x,y:r.y},e,n,i;i=1/(this.pn1-r.y*this.sw),e=this.pn1*r.x*i,n=this.pn1*r.y*this.cw*i,r.x=e*this.cg+n*this.sg,r.y=n*this.cg-e*this.sg;var s=Mr(r.x,r.y);if(Math.abs(s)<J)t.x=0,t.y=r.y;else{var o,a;switch(a=1-s*s*this.pfact,a=(this.p-Math.sqrt(a))/(this.pn1/s+s/this.pn1),o=Math.sqrt(1-a*a),this.mode){case ke.OBLIQ:t.y=Math.asin(o*this.sinph0+r.y*a*this.cosph0/s),r.y=(o-this.sinph0*Math.sin(t.y))*s,r.x*=a*this.cosph0;break;case ke.EQUIT:t.y=Math.asin(r.y*a/s),r.y=o*s,r.x*=a;break;case ke.N_POLE:t.y=Math.asin(o),r.y=-r.y;break;case ke.S_POLE:t.y=-Math.asin(o);break}t.x=Math.atan2(r.x,r.y)}return r.x=t.x+this.long0,r.y=t.y,r}var tk=["Tilted_Perspective","tpers"];const ek={init:KD,forward:QD,inverse:JD,names:tk};function rk(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var r=1-this.es,t=1/r;this.radius_p=Math.sqrt(r),this.radius_p2=r,this.radius_p_inv2=t,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function nk(r){var t=r.x,e=r.y,n,i,s,o;if(t=t-this.long0,this.shape==="ellipse"){e=Math.atan(this.radius_p2*Math.tan(e));var a=this.radius_p/Mr(this.radius_p*Math.cos(e),Math.sin(e));if(i=a*Math.cos(t)*Math.cos(e),s=a*Math.sin(t)*Math.cos(e),o=a*Math.sin(e),(this.radius_g-i)*i-s*s-o*o*this.radius_p_inv2<0)return r.x=Number.NaN,r.y=Number.NaN,r;n=this.radius_g-i,this.flip_axis?(r.x=this.radius_g_1*Math.atan(s/Mr(o,n)),r.y=this.radius_g_1*Math.atan(o/n)):(r.x=this.radius_g_1*Math.atan(s/n),r.y=this.radius_g_1*Math.atan(o/Mr(s,n)))}else this.shape==="sphere"&&(n=Math.cos(e),i=Math.cos(t)*n,s=Math.sin(t)*n,o=Math.sin(e),n=this.radius_g-i,this.flip_axis?(r.x=this.radius_g_1*Math.atan(s/Mr(o,n)),r.y=this.radius_g_1*Math.atan(o/n)):(r.x=this.radius_g_1*Math.atan(s/n),r.y=this.radius_g_1*Math.atan(o/Mr(s,n))));return r.x=r.x*this.a,r.y=r.y*this.a,r}function ik(r){var t=-1,e=0,n=0,i,s,o,a;if(r.x=r.x/this.a,r.y=r.y/this.a,this.shape==="ellipse"){this.flip_axis?(n=Math.tan(r.y/this.radius_g_1),e=Math.tan(r.x/this.radius_g_1)*Mr(1,n)):(e=Math.tan(r.x/this.radius_g_1),n=Math.tan(r.y/this.radius_g_1)*Mr(1,e));var l=n/this.radius_p;if(i=e*e+l*l+t*t,s=2*this.radius_g*t,o=s*s-4*i*this.C,o<0)return r.x=Number.NaN,r.y=Number.NaN,r;a=(-s-Math.sqrt(o))/(2*i),t=this.radius_g+a*t,e*=a,n*=a,r.x=Math.atan2(e,t),r.y=Math.atan(n*Math.cos(r.x)/t),r.y=Math.atan(this.radius_p_inv2*Math.tan(r.y))}else if(this.shape==="sphere"){if(this.flip_axis?(n=Math.tan(r.y/this.radius_g_1),e=Math.tan(r.x/this.radius_g_1)*Math.sqrt(1+n*n)):(e=Math.tan(r.x/this.radius_g_1),n=Math.tan(r.y/this.radius_g_1)*Math.sqrt(1+e*e)),i=e*e+n*n+t*t,s=2*this.radius_g*t,o=s*s-4*i*this.C,o<0)return r.x=Number.NaN,r.y=Number.NaN,r;a=(-s-Math.sqrt(o))/(2*i),t=this.radius_g+a*t,e*=a,n*=a,r.x=Math.atan2(e,t),r.y=Math.atan(n*Math.cos(r.x)/t)}return r.x=r.x+this.long0,r}var sk=["Geostationary Satellite View","Geostationary_Satellite","geos"];const ok={init:rk,forward:nk,inverse:ik,names:sk};var Bo=1.340264,Xo=-.081106,Wo=893e-6,qo=.003796,sh=Math.sqrt(3)/2;function ak(){this.es=0,this.long0=this.long0!==void 0?this.long0:0}function lk(r){var t=rt(r.x-this.long0),e=r.y,n=Math.asin(sh*Math.sin(e)),i=n*n,s=i*i*i;return r.x=t*Math.cos(n)/(sh*(Bo+3*Xo*i+s*(7*Wo+9*qo*i))),r.y=n*(Bo+Xo*i+s*(Wo+qo*i)),r.x=this.a*r.x+this.x0,r.y=this.a*r.y+this.y0,r}function hk(r){r.x=(r.x-this.x0)/this.a,r.y=(r.y-this.y0)/this.a;var t=1e-9,e=12,n=r.y,i,s,o,a,l,h;for(h=0;h<e&&(i=n*n,s=i*i*i,o=n*(Bo+Xo*i+s*(Wo+qo*i))-r.y,a=Bo+3*Xo*i+s*(7*Wo+9*qo*i),n-=l=o/a,!(Math.abs(l)<t));++h);return i=n*n,s=i*i*i,r.x=sh*r.x*(Bo+3*Xo*i+s*(7*Wo+9*qo*i))/Math.cos(n),r.y=Math.asin(Math.sin(n)/sh),r.x=rt(r.x+this.long0),r}var uk=["eqearth","Equal Earth","Equal_Earth"];const ck={init:ak,forward:lk,inverse:hk,names:uk};function dk(r){r.Proj.projections.add(xl),r.Proj.projections.add(vl),r.Proj.projections.add(f3),r.Proj.projections.add(S3),r.Proj.projections.add(I3),r.Proj.projections.add(F3),r.Proj.projections.add(z3),r.Proj.projections.add(q3),r.Proj.projections.add(H3),r.Proj.projections.add(eN),r.Proj.projections.add(yN),r.Proj.projections.add(EN),r.Proj.projections.add(IN),r.Proj.projections.add(NN),r.Proj.projections.add(zN),r.Proj.projections.add(qN),r.Proj.projections.add(HN),r.Proj.projections.add(eD),r.Proj.projections.add(aD),r.Proj.projections.add(dD),r.Proj.projections.add(_D),r.Proj.projections.add(bD),r.Proj.projections.add(RD),r.Proj.projections.add(LD),r.Proj.projections.add(kD),r.Proj.projections.add(qD),r.Proj.projections.add(HD),r.Proj.projections.add(ek),r.Proj.projections.add(ok),r.Proj.projections.add(ck)}vr.defaultDatum="WGS84";vr.Proj=ln;vr.WGS84=new vr.Proj("WGS84");vr.Point=qs;vr.toPoint=C1;vr.defs=We;vr.nadgrid=pF;vr.transform=rh;vr.mgrs=AF;vr.version="__VERSION__";dk(vr);y1(vr);window.eoxMapAdvancedOlLayers={...aP,STAC:zf};function fk(r){const t=r[0],e=new Array(t);let n=1<<t-1,i,s;for(i=0;i<t;++i)s=48,r[1]&n&&(s+=1),r[2]&n&&(s+=2),e[i]=String.fromCharCode(s),n>>=1;return e.join("")}const gk='<a class="ol-attribution-bing-tos" href="https://www.microsoft.com/maps/product/terms.html" target="_blank">Terms of Use</a>';class pk extends Ar{constructor(t){const e=t.hidpi!==void 0?t.hidpi:!1;super({cacheSize:t.cacheSize,crossOrigin:"anonymous",interpolate:t.interpolate,opaque:!0,projection:tt("EPSG:3857"),reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:"loading",tileLoadFunction:t.tileLoadFunction,tilePixelRatio:e?2:1,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,zDirection:t.zDirection}),this.hidpi_=e,this.culture_=t.culture!==void 0?t.culture:"en-us",this.maxZoom_=t.maxZoom!==void 0?t.maxZoom:-1,this.apiKey_=t.key,this.imagerySet_=t.imagerySet,this.placeholderTiles_=t.placeholderTiles;const n="https://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.imagerySet_+"?uriScheme=https&include=ImageryProviders&key="+this.apiKey_+"&c="+this.culture_;fetch(n).then(i=>i.json()).then(i=>this.handleImageryMetadataResponse(i))}getApiKey(){return this.apiKey_}getImagerySet(){return this.imagerySet_}handleImageryMetadataResponse(t){if(t.statusCode!=200||t.statusDescription!="OK"||t.authenticationResultCode!="ValidCredentials"||t.resourceSets.length!=1||t.resourceSets[0].resources.length!=1){this.setState("error");return}const e=t.resourceSets[0].resources[0],n=this.maxZoom_==-1?e.zoomMax:this.maxZoom_,i=this.getProjection(),s=Wn(i),o=this.hidpi_?2:1,a=e.imageWidth==e.imageHeight?e.imageWidth/o:[e.imageWidth/o,e.imageHeight/o],l=Hi({extent:s,minZoom:e.zoomMin,maxZoom:n,tileSize:a});this.tileGrid=l;const h=this.culture_,u=this.hidpi_,c=this.placeholderTiles_;if(this.tileUrlFunction=Ws(e.imageUrlSubdomains.map(function(f){const g=[0,0,0],m=e.imageUrl.replace("{subdomain}",f).replace("{culture}",h);return function(_,x,v){if(!_)return;ha(_[0],_[1],_[2],g);const w=new URL(m.replace("{quadkey}",fk(g))),S=w.searchParams;return u&&(S.set("dpi","d1"),S.set("device","mobile")),c===!0?S.delete("n"):c===!1&&S.set("n","z"),w.toString()}})),e.imageryProviders){const f=$i(tt("EPSG:4326"),this.getProjection());this.setAttributions(g=>{const m=[],_=g.viewState,x=this.getTileGrid(),v=x.getZForResolution(_.resolution,this.zDirection),w=x.getTileCoordForCoordAndZ(_.center,v)[0];return e.imageryProviders.map(function(S){let E=!1;const T=S.coverageAreas;for(let R=0,C=T.length;R<C;++R){const I=T[R];if(w>=I.zoomMin&&w<=I.zoomMax){const F=I.bbox,U=[F[1],F[0],F[3],F[2]],j=Fs(U,f);if(Qt(j,g.extent)){E=!0;break}}}E&&m.push(S.attribution)}),m.push(gk),m})}this.setState("ready")}}const mk=pk;class _k extends Ui{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,maxZoom:t.maxZoom!==void 0?t.maxZoom:18,minZoom:t.minZoom,projection:t.projection,transition:t.transition,wrapX:t.wrapX,zDirection:t.zDirection}),this.account_=t.account,this.mapId_=t.map||"",this.config_=t.config||{},this.templateCache_={},this.initializeMap_()}getConfig(){return this.config_}updateConfig(t){Object.assign(this.config_,t),this.initializeMap_()}setConfig(t){this.config_=t||{},this.initializeMap_()}initializeMap_(){const t=JSON.stringify(this.config_);if(this.templateCache_[t]){this.applyTemplate_(this.templateCache_[t]);return}let e="https://"+this.account_+".carto.com/api/v1/map";this.mapId_&&(e+="/named/"+this.mapId_);const n=new XMLHttpRequest;n.addEventListener("load",this.handleInitResponse_.bind(this,t)),n.addEventListener("error",this.handleInitError_.bind(this)),n.open("POST",e),n.setRequestHeader("Content-type","application/json"),n.send(JSON.stringify(this.config_))}handleInitResponse_(t,e){const n=e.target;if(!n.status||n.status>=200&&n.status<300){let i;try{i=JSON.parse(n.responseText)}catch{this.setState("error");return}this.applyTemplate_(i),this.templateCache_[t]=i,this.setState("ready")}else this.setState("error")}handleInitError_(t){this.setState("error")}applyTemplate_(t){const e="https://"+t.cdn_url.https+"/"+this.account_+"/api/v1/map/"+t.layergroupid+"/{z}/{x}/{y}.png";this.setUrl(e)}}const yk=_k;class xk extends Fh{constructor(t){super({attributions:t.attributions,wrapX:t.wrapX}),this.resolution=void 0,this.distance=t.distance!==void 0?t.distance:20,this.minDistance=t.minDistance||0,this.interpolationRatio=0,this.features=[],this.geometryFunction=t.geometryFunction||function(e){const n=e.getGeometry();return At(!n||n.getType()==="Point","The default `geometryFunction` can only handle `Point` or null geometries"),n},this.createCustomCluster_=t.createCluster,this.source=null,this.boundRefresh_=this.refresh.bind(this),this.updateDistance(this.distance,this.minDistance),this.setSource(t.source||null)}clear(t){this.features.length=0,super.clear(t)}getDistance(){return this.distance}getSource(){return this.source}loadFeatures(t,e,n){this.source.loadFeatures(t,e,n),e!==this.resolution&&(this.resolution=e,this.refresh())}setDistance(t){this.updateDistance(t,this.minDistance)}setMinDistance(t){this.updateDistance(this.distance,t)}getMinDistance(){return this.minDistance}setSource(t){this.source&&this.source.removeEventListener(Lt.CHANGE,this.boundRefresh_),this.source=t,t&&t.addEventListener(Lt.CHANGE,this.boundRefresh_),this.refresh()}refresh(){this.clear(),this.cluster(),this.addFeatures(this.features)}updateDistance(t,e){const n=t===0?0:Math.min(e,t)/t,i=t!==this.distance||this.interpolationRatio!==n;this.distance=t,this.minDistance=e,this.interpolationRatio=n,i&&this.refresh()}cluster(){if(this.resolution===void 0||!this.source)return;const t=ze(),e=this.distance*this.resolution,n=this.source.getFeatures(),i={};for(let s=0,o=n.length;s<o;s++){const a=n[s];if(!(it(a)in i)){const l=this.geometryFunction(a);if(l){const h=l.getCoordinates();zc(h,t),Ir(t,e,t);const u=this.source.getFeaturesInExtent(t).filter(function(c){const f=it(c);return f in i?!1:(i[f]=!0,!0)});this.features.push(this.createCluster(u,t))}}}}createCluster(t,e){const n=[0,0];for(let a=t.length-1;a>=0;--a){const l=this.geometryFunction(t[a]);l?$m(n,l.getCoordinates()):t.splice(a,1)}av(n,1/t.length);const i=Ce(e),s=this.interpolationRatio,o=new Re([n[0]*(1-s)+i[0]*s,n[1]*(1-s)+i[1]*s]);return this.createCustomCluster_?this.createCustomCluster_(o,t):new Se({geometry:o,features:t})}}const vk=xk,wk="https://tile.googleapis.com/v1/createSession",bk="https://tile.googleapis.com/v1/2dtiles",Sk="https://tile.googleapis.com/tile/v1/viewport",Ek=22;class Tk extends Ar{constructor(t){const e=!!t.highDpi,n=t.overlay!==!0;super({attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:"anonymous",interpolate:t.interpolate,opaque:n,projection:"EPSG:3857",reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:"loading",tileLoadFunction:t.tileLoadFunction,tilePixelRatio:e?2:1,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,zDirection:t.zDirection}),this.apiKey_=t.key,this.error_=null;const i={mapType:t.mapType||"roadmap",language:t.language||"en-US",region:t.region||"US"};t.imageFormat&&(i.imageFormat=t.imageFormat),t.scale&&(i.scale=t.scale),e&&(i.highDpi=!0),t.layerTypes&&(i.layerTypes=t.layerTypes),t.styles&&(i.styles=t.styles),t.overlay===!0&&(i.overlay=!0),this.sessionTokenRequest_=i,this.sessionTokenValue_,this.sessionRefreshId_,this.previousViewportAttribution_,this.previousViewportExtent_,this.createSession_()}getError(){return this.error_}fetchSessionToken(t,e){return fetch(t,e)}async createSession_(){const t=wk+"?key="+this.apiKey_,e={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.sessionTokenRequest_)},n=await this.fetchSessionToken(t,e);if(!n.ok){try{const c=await n.json();this.error_=new Error(c.error.message)}catch{this.error_=new Error("Error fetching session token")}this.setState("error");return}const i=await n.json(),s=this.getTilePixelRatio(1),o=[i.tileWidth/s,i.tileHeight/s];this.tileGrid=Hi({extent:Wn(this.getProjection()),maxZoom:Ek,tileSize:o});const a=i.session;this.sessionTokenValue_=a;const l=this.apiKey_;this.tileUrlFunction=function(c,f,g){const m=c[0],_=c[1],x=c[2];return`${bk}/${m}/${_}/${x}?session=${a}&key=${l}`};const h=parseInt(i.expiry,10)*1e3,u=Math.max(h-Date.now()-60*1e3,1);this.sessionRefreshId_=setTimeout(()=>this.createSession_(),u),this.setAttributions(this.fetchAttributions_.bind(this)),this.setState("ready")}async fetchAttributions_(t){if(t.viewHints[ee.ANIMATING]||t.viewHints[ee.INTERACTING]||t.animate)return this.previousViewportAttribution_;const[e,n]=gg(xa(t.extent),t.viewState.projection),[i,s]=gg(va(t.extent),t.viewState.projection),o=`zoom=${this.getTileGrid().getZForResolution(t.viewState.resolution,this.zDirection)}&north=${s}&south=${n}&east=${i}&west=${e}`;if(this.previousViewportExtent_==o)return this.previousViewportAttribution_;this.previousViewportExtent_=o;const a=this.sessionTokenValue_,l=this.apiKey_,h=`${Sk}?session=${a}&key=${l}&${o}`;return this.previousViewportAttribution_=await fetch(h).then(u=>u.json()).then(u=>u.copyright),this.previousViewportAttribution_}disposeInternal(){clearTimeout(this.sessionRefreshId_),super.disposeInternal()}}const Mk=Tk;let B1=class extends Fa{constructor(r,t,e,n,i,s,o){super(t,e,n,i,s,o),this.zoomifyImage_=null,this.tileSize_=r}getImage(){if(this.zoomifyImage_)return this.zoomifyImage_;const r=super.getImage();if(this.state==W.LOADED){const t=this.tileSize_;if(r.width==t[0]&&r.height==t[1])return this.zoomifyImage_=r,r;const e=Jt(t[0],t[1]);return e.drawImage(r,0,0),this.zoomifyImage_=e.canvas,e.canvas}return r}};class Rk extends Ar{constructor(t){const e=t.size,n=t.tierSizeCalculation!==void 0?t.tierSizeCalculation:"default",i=t.tilePixelRatio||1,s=e[0],o=e[1],a=[],l=t.tileSize||zs;let h=l*i;switch(n){case"default":for(;s>h||o>h;)a.push([Math.ceil(s/h),Math.ceil(o/h)]),h+=h;break;case"truncated":let R=s,C=o;for(;R>h||C>h;)a.push([Math.ceil(R/h),Math.ceil(C/h)]),R>>=1,C>>=1;break;default:throw new Error("Unknown `tierSizeCalculation` configured")}a.push([1,1]),a.reverse();const u=[i],c=[0];for(let R=1,C=a.length;R<C;R++)u.push(i<<R),c.push(a[R-1][0]*a[R-1][1]+c[R-1]);u.reverse();const f=new _i({tileSize:l,extent:t.extent||[0,-o,s,0],resolutions:u});let g=t.url;g&&!g.includes("{TileGroup}")&&!g.includes("{tileIndex}")&&(g+="{TileGroup}/{z}-{x}-{y}.jpg");const m=If(g);let _=l*i;function x(R){return function(C,I,F){if(!C)return;const U=C[0],j=C[1],B=C[2],d=j+B*a[U][0],p=(d+c[U])/_|0,y={z:U,x:j,y:B,tileIndex:d,TileGroup:"TileGroup"+p};return R.replace(/\{(\w+?)\}/g,function(b,M){return y[M]})}}const v=Ws(m.map(x)),w=B1.bind(null,ie(l*i));super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,tilePixelRatio:i,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:w,tileGrid:f,tileUrlFunction:v,transition:t.transition}),this.zDirection=t.zDirection;const S=f.getTileCoordForCoordAndResolution(Ce(f.getExtent()),u[u.length-1]),E=v(S,1,null),T=new Image;T.addEventListener("error",()=>{_=l,this.changed()}),T.src=E}}const Ck=Rk;function xo(r){return r.toLocaleString("en",{maximumFractionDigits:10})}class Ik extends Ar{constructor(t){const e=t||{};let n=e.url||"";n=n+(n.lastIndexOf("/")===n.length-1||n===""?"":"/");const i=e.version||_e.VERSION2,s=e.sizes||[],o=e.size;At(o!=null&&Array.isArray(o)&&o.length==2&&!isNaN(o[0])&&o[0]>0&&!isNaN(o[1])&&o[1]>0,"Missing or invalid `size`");const a=o[0],l=o[1],h=e.tileSize,u=e.tilePixelRatio||1,c=e.format||"jpg",f=e.quality||(e.version==_e.VERSION1?"native":"default");let g=e.resolutions||[];const m=e.supports||[],_=e.extent||[0,-l,a,0],x=s!=null&&Array.isArray(s)&&s.length>0,v=h!==void 0&&(typeof h=="number"&&Number.isInteger(h)&&h>0||Array.isArray(h)&&h.length>0),w=m!=null&&Array.isArray(m)&&(m.includes("regionByPx")||m.includes("regionByPct"))&&(m.includes("sizeByWh")||m.includes("sizeByH")||m.includes("sizeByW")||m.includes("sizeByPct"));let S,E,T;if(g.sort(function(F,U){return U-F}),v||w)if(h!=null&&(typeof h=="number"&&Number.isInteger(h)&&h>0?(S=h,E=h):Array.isArray(h)&&h.length>0&&((h.length==1||h[1]==null&&Number.isInteger(h[0]))&&(S=h[0],E=h[0]),h.length==2&&(Number.isInteger(h[0])&&Number.isInteger(h[1])?(S=h[0],E=h[1]):h[0]==null&&Number.isInteger(h[1])&&(S=h[1],E=h[1])))),(S===void 0||E===void 0)&&(S=zs,E=zs),g.length==0){T=Math.max(Math.ceil(Math.log(a/S)/Math.LN2),Math.ceil(Math.log(l/E)/Math.LN2));for(let F=T;F>=0;F--)g.push(Math.pow(2,F))}else{const F=Math.max(...g);T=Math.round(Math.log(F)/Math.LN2)}else if(S=a,E=l,g=[],x){s.sort(function(U,j){return U[0]-j[0]}),T=-1;const F=[];for(let U=0;U<s.length;U++){const j=a/s[U][0];if(g.length>0&&g[g.length-1]==j){F.push(U);continue}g.push(j),T++}if(F.length>0)for(let U=0;U<F.length;U++)s.splice(F[U]-U,1)}else g.push(1),s.push([a,l]),T=0;const R=new _i({tileSize:[S,E],extent:_,origin:zn(_),resolutions:g}),C=function(F,U,j){let B,d;const p=F[0];if(p>T)return;const y=F[1],b=F[2],M=g[p];if(!(y===void 0||b===void 0||M===void 0||y<0||Math.ceil(a/M/S)<=y||b<0||Math.ceil(l/M/E)<=b)){if(w||v){const P=y*S*M,A=b*E*M;let L=S*M,D=E*M,X=S,K=E;if(P+L>a&&(L=a-P),A+D>l&&(D=l-A),P+S*M>a&&(X=Math.floor((a-P+M-1)/M)),A+E*M>l&&(K=Math.floor((l-A+M-1)/M)),P==0&&L==a&&A==0&&D==l)B="full";else if(!w||m.includes("regionByPx"))B=P+","+A+","+L+","+D;else if(m.includes("regionByPct")){const G=xo(P/a*100),H=xo(A/l*100),Q=xo(L/a*100),nt=xo(D/l*100);B="pct:"+G+","+H+","+Q+","+nt}i==_e.VERSION3&&(!w||m.includes("sizeByWh"))?d=X+","+K:!w||m.includes("sizeByW")?d=X+",":m.includes("sizeByH")?d=","+K:m.includes("sizeByWh")?d=X+","+K:m.includes("sizeByPct")&&(d="pct:"+xo(100/M))}else if(B="full",x){const P=s[p][0],A=s[p][1];i==_e.VERSION3?P==a&&A==l?d="max":d=P+","+A:P==a?d="full":d=P+","}else d=i==_e.VERSION3?"max":"full";return n+B+"/"+d+"/0/"+f+"."+c}},I=B1.bind(null,ie(h||256).map(function(F){return F*u}));super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:e.state,tileClass:I,tileGrid:R,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:C,transition:e.transition}),this.zDirection=e.zDirection}}const Pk=Ik;function X1(r,t,e,n,i,s){const o=i.getCode().split(/:(?=\d+$)/).pop(),a=e/n,l=[bl(yt(t)/a,nn),bl(Vt(t)/a,nn)];s.SIZE=l[0]+","+l[1],s.BBOX=t.join(","),s.BBOXSR=o,s.IMAGESR=o,s.DPI=Math.round(s.DPI?s.DPI*n:90*n);const h=r.replace(/MapServer\/?$/,"MapServer/export").replace(/ImageServer\/?$/,"ImageServer/exportImage");return Gn(h,s)}function W1(r){const t=r.load?r.load:mi,e=tt(r.projection||"EPSG:3857");return function(n,i,s){s=r.hidpi?s:1;const o={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};Object.assign(o,r.params),n=qh(n,i,s,r.ratio);const a=X1(r.url,n,i,s,e,o),l=new Image;return r.crossOrigin!==null&&(l.crossOrigin=r.crossOrigin),t(l,a).then(h=>{const u=yt(n)/h.width*s;return{image:h,extent:n,resolution:u,pixelRatio:s}})}}class Ak extends xi{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:t.interpolate,projection:t.projection,resolutions:t.resolutions}),this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null,this.hidpi_=t.hidpi!==void 0?t.hidpi:!0,this.url_=t.url,this.imageLoadFunction_=t.imageLoadFunction!==void 0?t.imageLoadFunction:Wh,this.params_=Object.assign({},t.params),this.imageSize_=[0,0],this.renderedRevision_=0,this.ratio_=t.ratio!==void 0?t.ratio:1.5,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(t,e,n,i){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==i)&&(this.loaderProjection_=i,this.loader=W1({crossOrigin:this.crossOrigin_,params:this.params_,projection:i,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(s,o)=>(this.image.setImage(s),this.imageLoadFunction_(this.image,o),mi(s))})),super.getImageInternal(t,e,n,i))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(t){this.imageLoadFunction_=t,this.changed()}setUrl(t){t!=this.url_&&(this.url_=t,this.loader=null,this.changed())}updateParams(t){Object.assign(this.params_,t),this.changed()}changed(){this.image=null,super.changed()}}const Lk=Ak;class Ok extends xi{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:t.interpolate,projection:t.projection,resolutions:t.resolutions,state:t.state}),this.canvasFunction_=t.canvasFunction,this.canvas_=null,this.renderedRevision_=0,this.ratio_=t.ratio!==void 0?t.ratio:1.5}getImageInternal(t,e,n,i){e=this.findNearestResolution(e);let s=this.canvas_;if(s&&this.renderedRevision_==this.getRevision()&&s.getResolution()==e&&s.getPixelRatio()==n&&Ze(s.getExtent(),t))return s;t=t.slice(),Wm(t,this.ratio_);const o=yt(t)/e,a=Vt(t)/e,l=[o*n,a*n],h=this.canvasFunction_.call(this,t,e,n,l,i);return h&&(s=new rf(t,e,n,h)),this.canvas_=s,this.renderedRevision_=this.getRevision(),s}}const Fk=Ok;function Nk(r,t,e,n){const i=yt(r),s=Vt(r),o=t[0],a=t[1],l=.0254/n;return a*i>o*s?i*e/(o*l):s*e/(a*l)}function Dk(r,t,e,n,i,s,o){const a=Nk(e,n,s,o),l=Ce(e),h={OPERATION:i?"GETDYNAMICMAPOVERLAYIMAGE":"GETMAPIMAGE",VERSION:"2.0.0",LOCALE:"en",CLIENTAGENT:"ol/source/ImageMapGuide source",CLIP:"1",SETDISPLAYDPI:o,SETDISPLAYWIDTH:Math.round(n[0]),SETDISPLAYHEIGHT:Math.round(n[1]),SETVIEWSCALE:a,SETVIEWCENTERX:l[0],SETVIEWCENTERY:l[1]};return Object.assign(h,t),Gn(r,h)}function q1(r){const t=r.load||mi;return function(e,n,i){const s=new Image;r.crossOrigin!==null&&(s.crossOrigin=r.crossOrigin),e=qh(e,n,i,r.ratio);const o=yt(e)/n,a=Vt(e)/n,l=[o*i,a*i],h=Dk(r.url,r.params,e,l,r.useOverlay,r.metersPerUnit||1,r.displayDpi||96);return t(s,h).then(u=>({image:u,extent:e,pixelRatio:i}))}}class kk extends xi{constructor(t){super({interpolate:t.interpolate,projection:t.projection,resolutions:t.resolutions}),this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null,this.displayDpi_=t.displayDpi!==void 0?t.displayDpi:96,this.params_=Object.assign({},t.params),this.url_=t.url,this.imageLoadFunction_=t.imageLoadFunction!==void 0?t.imageLoadFunction:Wh,this.hidpi_=t.hidpi!==void 0?t.hidpi:!0,this.metersPerUnit_=t.metersPerUnit!==void 0?t.metersPerUnit:1,this.ratio_=t.ratio!==void 0?t.ratio:1,this.useOverlay_=t.useOverlay!==void 0?t.useOverlay:!1,this.renderedRevision_=0,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(t,e,n,i){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==i)&&(this.loaderProjection_=i,this.loader=q1({crossOrigin:this.crossOrigin_,params:this.params_,hidpi:this.hidpi_,metersPerUnit:this.metersPerUnit_,url:this.url_,useOverlay:this.useOverlay_,ratio:this.ratio_,load:(s,o)=>(this.image.setImage(s),this.imageLoadFunction_(this.image,o),mi(s))})),super.getImageInternal(t,e,n,i))}getImageLoadFunction(){return this.imageLoadFunction_}updateParams(t){Object.assign(this.params_,t),this.changed()}setImageLoadFunction(t){this.imageLoadFunction_=t,this.changed()}changed(){this.image=null,super.changed()}}const Gk=kk;class jk extends xi{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:t.interpolate,projection:t.projection,resolutions:t.resolutions}),this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null,this.url_=t.url,this.imageLoadFunction_=t.imageLoadFunction!==void 0?t.imageLoadFunction:Wh,this.params_=Object.assign({},t.params),this.serverType_=t.serverType,this.hidpi_=t.hidpi!==void 0?t.hidpi:!0,this.renderedRevision_=0,this.ratio_=t.ratio!==void 0?t.ratio:1.5,this.loaderProjection_=null}getFeatureInfoUrl(t,e,n,i){const s=tt(n),o=this.getProjection();o&&o!==s&&(e=la(o,s,t,e),t=dh(t,s,o));const a={url:this.url_,params:{...this.params_,...i},projection:o||s};return QL(a,t,e)}getLegendUrl(t,e){return JL({url:this.url_,params:{...this.params_,...e}},t)}getParams(){return this.params_}getImageInternal(t,e,n,i){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==i)&&(this.loaderProjection_=i,this.loader=Ky({crossOrigin:this.crossOrigin_,params:this.params_,projection:i,serverType:this.serverType_,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(s,o)=>(this.image.setImage(s),this.imageLoadFunction_(this.image,o),mi(s))})),super.getImageInternal(t,e,n,i))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(t){this.imageLoadFunction_=t,this.changed()}setUrl(t){t!=this.url_&&(this.url_=t,this.loader=null,this.changed())}updateParams(t){Object.assign(this.params_,t),this.changed()}changed(){this.image=null,super.changed()}}const zk=jk,Uk={"image/png":!0,"image/jpeg":!0,"image/gif":!0,"image/webp":!0},Bk={"application/vnd.mapbox-vector-tile":!0,"application/geo+json":!0};function Xk(r,t){let e,n;for(let i=0;i<r.length;++i){const s=r[i];if(s.rel==="item"){if(s.type===t){e=s.href;break}(Uk[s.type]||!n&&s.type.startsWith("image/"))&&(n=s.href)}}if(!e)if(n)e=n;else throw new Error('Could not find "item" link');return e}function Wk(r,t,e){let n,i;const s={};for(let o=0;o<r.length;++o){const a=r[o];if(s[a.type]=a.href,a.rel==="item"){if(a.type===t){n=a.href;break}Bk[a.type]&&(i=a.href)}}if(!n&&e)for(let o=0;o<e.length;++o){const a=e[o];if(s[a]){n=s[a];break}}if(!n)if(i)n=i;else throw new Error('Could not find "item" link');return n}function Im(r,t,e,n){let i=r.projection;if(!i&&(i=tt(t.crs),!i))throw new Error(`Unsupported CRS: ${t.crs}`);const s=t.orderedAxes,o=(s?s.slice(0,2).map(T=>T.replace(/E|X|Lon/i,"e").replace(/N|Y|Lat/i,"n")).join(""):i.getAxisOrientation().substr(0,2))!=="en",a=t.tileMatrices,l={};for(let T=0;T<a.length;++T){const R=a[T];l[R.id]=R}const h={},u=[];if(n)for(let T=0;T<n.length;++T){const R=n[T],C=R.tileMatrix;u.push(C),h[C]=R}else for(let T=0;T<a.length;++T){const R=a[T].id;u.push(R)}const c=u.length,f=new Array(c),g=new Array(c),m=new Array(c),_=new Array(c),x=[-1/0,-1/0,1/0,1/0];for(let T=0;T<c;++T){const R=u[T],C=l[R],I=C.pointOfOrigin;o?f[T]=[I[1],I[0]]:f[T]=I,g[T]=C.cellSize,m[T]=[C.matrixWidth,C.matrixHeight],_[T]=[C.tileWidth,C.tileHeight];const F=h[R];if(F){const U=C.cellSize*C.tileWidth,j=f[T][0]+F.minTileCol*U,B=f[T][0]+(F.maxTileCol+1)*U,d=C.cellSize*C.tileHeight,p=C.cornerOfOrigin==="bottomLeft";let y,b;p?(y=f[T][1]+F.minTileRow*d,b=f[T][1]+(F.maxTileRow+1)*d):(y=f[T][1]-(F.maxTileRow+1)*d,b=f[T][1]-F.minTileRow*d),we(x,[j,y,B,b],x)}}const v=new _i({origins:f,resolutions:g,sizes:m,tileSizes:_,extent:n?x:void 0}),w=r.context,S=r.url;function E(T,R,C){if(!T)return;const I=u[T[0]],F=l[I],U=F.cornerOfOrigin==="bottomLeft",j={tileMatrix:I,tileCol:T[1],tileRow:U?-T[2]-1:T[2]};if(n){const d=h[F.id];if(j.tileCol<d.minTileCol||j.tileCol>d.maxTileCol||j.tileRow<d.minTileRow||j.tileRow>d.maxTileRow)return}Object.assign(j,w);const B=e.replace(/\{(\w+?)\}/g,function(d,p){return j[p]});return $y(S,B)}return{grid:v,urlTemplate:e,urlFunction:E}}function qk(r,t){const e=t.tileMatrixSetLimits;let n;if(t.dataType==="map")n=Xk(t.links,r.mediaType);else if(t.dataType==="vector")n=Wk(t.links,r.mediaType,r.supportedMediaTypes);else throw new Error('Expected tileset data type to be "map" or "vector"');if(t.tileMatrixSet)return Im(r,t.tileMatrixSet,n,e);const i=t.links.find(a=>a.rel==="http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme");if(!i)throw new Error("Expected http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme link or tileMatrixSet");const s=i.href,o=$y(r.url,s);return Zy(o).then(function(a){return Im(r,a,n,e)})}function Z1(r){return Zy(r.url).then(function(t){return qk(r,t)})}class Zk extends Ar{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:"loading",tileLoadFunction:t.tileLoadFunction,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition});const e={url:t.url,projection:this.getProjection(),mediaType:t.mediaType,context:t.context||null};Z1(e).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(t){this.tileGrid=t.grid,this.setTileUrlFunction(t.urlFunction,t.urlTemplate),this.setState("ready")}handleError_(t){El(t),this.setState("error")}}const $k=Zk;class Vk extends Zh{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,format:t.format,overlaps:t.overlaps,projection:t.projection,tileClass:t.tileClass,transition:t.transition,wrapX:t.wrapX,zDirection:t.zDirection,state:"loading"});const e={url:t.url,projection:this.getProjection(),mediaType:t.mediaType,supportedMediaTypes:t.format.supportedMediaTypes,context:t.context||null};Z1(e).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(t){this.tileGrid=t.grid,this.setTileUrlFunction(t.urlFunction,t.urlTemplate),this.setState("ready")}handleError_(t){El(t),this.setState("error")}}const Yk=Vk,$1='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class Hk extends Ui{constructor(t){t=t||{};let e;t.attributions!==void 0?e=t.attributions:e=[$1];const n=t.crossOrigin!==void 0?t.crossOrigin:"anonymous",i=t.url!==void 0?t.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:e,attributionsCollapsible:!1,cacheSize:t.cacheSize,crossOrigin:n,interpolate:t.interpolate,maxZoom:t.maxZoom!==void 0?t.maxZoom:19,opaque:t.opaque!==void 0?t.opaque:!0,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileLoadFunction:t.tileLoadFunction,transition:t.transition,url:i,wrapX:t.wrapX,zDirection:t.zDirection})}}const Kk=Hk,Pm=1/0;class Qk{constructor(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,$s(this.queuedElements_)}dequeue(){const t=this.elements_,e=this.priorities_,n=t[0];t.length==1?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));const i=this.keyFunction_(n);return delete this.queuedElements_[i],n}enqueue(t){At(!(this.keyFunction_(t)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const e=this.priorityFunction_(t);return e!=Pm?(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(t){return t*2+1}getRightChildIndex_(t){return t*2+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return this.elements_.length===0}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){const e=this.elements_,n=this.priorities_,i=e.length,s=e[t],o=n[t],a=t;for(;t<i>>1;){const l=this.getLeftChildIndex_(t),h=this.getRightChildIndex_(t),u=h<i&&n[h]<n[l]?h:l;e[t]=e[u],n[t]=n[u],t=u}e[t]=s,n[t]=o,this.siftDown_(a,t)}siftDown_(t,e){const n=this.elements_,i=this.priorities_,s=n[e],o=i[e];for(;e>t;){const a=this.getParentIndex_(e);if(i[a]>o)n[e]=n[a],i[e]=i[a],e=a;else break}n[e]=s,i[e]=o}reprioritize(){const t=this.priorityFunction_,e=this.elements_,n=this.priorities_;let i=0;const s=e.length;let o,a,l;for(a=0;a<s;++a)o=e[a],l=t(o),l==Pm?delete this.queuedElements_[this.keyFunction_(o)]:(n[i]=l,e[i++]=o);e.length=i,n.length=i,this.heapify_()}}class Jk extends Qk{constructor(t,e){super(function(n){return t.apply(null,n)},function(n){return n[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=e,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){const e=super.enqueue(t);return e&&t[0].addEventListener(Lt.CHANGE,this.boundHandleTileChange_),e}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){const e=t.target,n=e.getState();if(n===W.LOADED||n===W.ERROR||n===W.EMPTY){n!==W.ERROR&&e.removeEventListener(Lt.CHANGE,this.boundHandleTileChange_);const i=e.getKey();i in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[i],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,e){let n=0,i,s,o;for(;this.tilesLoading_<t&&n<e&&this.getCount()>0;)s=this.dequeue()[0],o=s.getKey(),i=s.getState(),i===W.IDLE&&!(o in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[o]=!0,++this.tilesLoading_,++n,s.load())}}let V1=!0;try{new ImageData(10,10)}catch{V1=!1}let Uu;function t5(r,t,e){if(V1)return new ImageData(r,t,e);Uu||(Uu=document.createElement("canvas").getContext("2d"));const n=Uu.createImageData(t,e);return n.data.set(r),n}function Y1(r){let t=!0;try{new ImageData(10,10)}catch{t=!1}function e(n,i,s){return t?new ImageData(n,i,s):{data:n,width:i,height:s}}return function(n){const i=n.buffers,s=n.meta,o=n.imageOps,a=n.width,l=n.height,h=i.length,u=i[0].byteLength;if(o){const m=new Array(h);for(let _=0;_<h;++_)m[_]=e(new Uint8ClampedArray(i[_]),a,l);return r(m,s).data.buffer}const c=new Uint8ClampedArray(u),f=new Array(h),g=new Array(h);for(let m=0;m<h;++m)f[m]=new Uint8ClampedArray(i[m]),g[m]=[0,0,0,0];for(let m=0;m<u;m+=4){for(let x=0;x<h;++x){const v=f[x];g[x][0]=v[m],g[x][1]=v[m+1],g[x][2]=v[m+2],g[x][3]=v[m+3]}const _=r(g,s);c[m]=_[0],c[m+1]=_[1],c[m+2]=_[2],c[m+3]=_[3]}return c.buffer}}function e5(r,t){const e=Object.keys(r.lib||{}).map(function(i){return"const "+i+" = "+r.lib[i].toString()+";"}).concat(["const __minion__ = ("+Y1.toString()+")(",r.operation.toString(),");",'self.addEventListener("message", function(event) {',"  const buffer = __minion__(event.data);","  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);","});"]),n=new Worker(typeof Blob>"u"?"data:text/javascript;base64,"+Buffer.from(e.join(`
`),"binary").toString("base64"):URL.createObjectURL(new Blob(e,{type:"text/javascript"})));return n.addEventListener("message",t),n}function r5(r,t){const e=Y1(r.operation);let n=!1;return{postMessage:function(i){setTimeout(function(){n||t({data:{buffer:e(i),meta:i.meta}})},0)},terminate:function(){n=!0}}}class n5 extends Nc{constructor(t){super(),this._imageOps=!!t.imageOps;let e;t.threads===0?e=0:this._imageOps?e=1:e=t.threads||1;const n=new Array(e);if(e)for(let i=0;i<e;++i)n[i]=e5(t,this._onWorkerMessage.bind(this,i));else n[0]=r5(t,this._onWorkerMessage.bind(this,0));this._workers=n,this._queue=[],this._maxQueueLength=t.queue||1/0,this._running=0,this._dataLookup={},this._job=null}process(t,e,n){this._enqueue({inputs:t,meta:e,callback:n}),this._dispatch()}_enqueue(t){for(this._queue.push(t);this._queue.length>this._maxQueueLength;)this._queue.shift().callback(null,null)}_dispatch(){if(this._running||this._queue.length===0)return;const t=this._queue.shift();this._job=t;const e=t.inputs[0].width,n=t.inputs[0].height,i=t.inputs.map(function(l){return l.data.buffer}),s=this._workers.length;if(this._running=s,s===1){this._workers[0].postMessage({buffers:i,meta:t.meta,imageOps:this._imageOps,width:e,height:n},i);return}const o=t.inputs[0].data.length,a=4*Math.ceil(o/4/s);for(let l=0;l<s;++l){const h=l*a,u=[];for(let c=0,f=i.length;c<f;++c)u.push(i[c].slice(h,h+a));this._workers[l].postMessage({buffers:u,meta:t.meta,imageOps:this._imageOps,width:e,height:n},u)}}_onWorkerMessage(t,e){this.disposed||(this._dataLookup[t]=e.data,--this._running,this._running===0&&this._resolveJob())}_resolveJob(){const t=this._job,e=this._workers.length;let n,i;if(e===1)n=new Uint8ClampedArray(this._dataLookup[0].buffer),i=this._dataLookup[0].meta;else{const s=t.inputs[0].data.length;n=new Uint8ClampedArray(s),i=new Array(e);const o=4*Math.ceil(s/4/e);for(let a=0;a<e;++a){const l=this._dataLookup[a].buffer,h=a*o;n.set(new Uint8ClampedArray(l),h),i[a]=this._dataLookup[a].meta}}this._job=null,this._dataLookup={},t.callback(null,t5(n,t.inputs[0].width,t.inputs[0].height),i),this._dispatch()}disposeInternal(){for(let t=0;t<this._workers.length;++t)this._workers[t].terminate();this._workers.length=0}}const Am={BEFOREOPERATIONS:"beforeoperations",AFTEROPERATIONS:"afteroperations"};class Lm extends fn{constructor(t,e,n){super(t),this.extent=e.extent,this.resolution=e.viewState.resolution/e.pixelRatio,this.data=n}}class H1 extends xi{constructor(t){super({projection:null}),this.on,this.once,this.un,this.processor_=null,this.operationType_=t.operationType!==void 0?t.operationType:"pixel",this.threads_=t.threads!==void 0?t.threads:1,this.layers_=o5(t.sources);const e=this.changed.bind(this);for(let n=0,i=this.layers_.length;n<i;++n)this.layers_[n].addEventListener(Lt.CHANGE,e);this.useResolutions_=t.resolutions!==null,this.tileQueue_=new Jk(function(){return 1},this.processSources_.bind(this)),this.requestedFrameState_,this.renderedImageCanvas_=null,this.renderedRevision_,this.frameState_={animate:!1,coordinateToPixelTransform:pe(),declutter:null,extent:null,index:0,layerIndex:0,layerStatesArray:s5(this.layers_),pixelRatio:1,pixelToCoordinateTransform:pe(),postRenderFunctions:[],size:[0,0],tileQueue:this.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{},mapId:it(this),renderTargets:{}},this.setAttributions(function(n){const i=[];for(let s=0,o=t.sources.length;s<o;++s){const a=t.sources[s],l=a instanceof ro?a:a.getSource();if(!l)continue;const h=l.getAttributions();if(typeof h=="function"){const u=h(n);i.push.apply(i,u)}}return i.length!==0?i:null}),t.operation!==void 0&&this.setOperation(t.operation,t.lib)}setOperation(t,e){this.processor_&&this.processor_.dispose(),this.processor_=new n5({operation:t,imageOps:this.operationType_==="image",queue:1,lib:e,threads:this.threads_}),this.changed()}updateFrameState_(t,e,n){const i=Object.assign({},this.frameState_);i.viewState=Object.assign({},i.viewState);const s=Ce(t);i.size[0]=Math.ceil(yt(t)/e),i.size[1]=Math.ceil(Vt(t)/e),i.extent=[s[0]-i.size[0]*e/2,s[1]-i.size[1]*e/2,s[0]+i.size[0]*e/2,s[1]+i.size[1]*e/2],i.time=Date.now();const o=i.viewState;return o.center=s,o.projection=n,o.resolution=e,i}allSourcesReady_(){let t=!0,e;for(let n=0,i=this.layers_.length;n<i;++n)if(e=this.layers_[n].getSource(),!e||e.getState()!=="ready"){t=!1;break}return t}getImage(t,e,n,i){if(!this.allSourcesReady_())return null;this.tileQueue_.loadMoreTiles(16,16),e=this.findNearestResolution(e);const s=this.updateFrameState_(t,e,i);if(this.requestedFrameState_=s,this.renderedImageCanvas_){const o=this.renderedImageCanvas_.getResolution(),a=this.renderedImageCanvas_.getExtent();(e!==o||!Nn(s.extent,a))&&(this.renderedImageCanvas_=null)}return(!this.renderedImageCanvas_||this.getRevision()!==this.renderedRevision_)&&this.processSources_(),s.animate&&requestAnimationFrame(this.changed.bind(this)),this.renderedImageCanvas_}processSources_(){const t=this.requestedFrameState_,e=this.layers_.length,n=new Array(e);for(let s=0;s<e;++s){t.layerIndex=s,t.renderTargets={};const o=i5(this.layers_[s],t);if(o)n[s]=o;else return}const i={};this.dispatchEvent(new Lm(Am.BEFOREOPERATIONS,t,i)),this.processor_.process(n,i,this.onWorkerComplete_.bind(this,t))}onWorkerComplete_(t,e,n,i){if(e||!n)return;const s=t.extent,o=t.viewState.resolution;if(o!==this.requestedFrameState_.viewState.resolution||!Nn(s,this.requestedFrameState_.extent))return;let a;if(this.renderedImageCanvas_)a=this.renderedImageCanvas_.getImage().getContext("2d");else{const l=Math.round(yt(s)/o),h=Math.round(Vt(s)/o);a=Jt(l,h),this.renderedImageCanvas_=new rf(s,o,1,a.canvas)}a.putImageData(n,0,0),t.animate?requestAnimationFrame(this.changed.bind(this)):this.changed(),this.renderedRevision_=this.getRevision(),this.dispatchEvent(new Lm(Am.AFTEROPERATIONS,t,i))}getResolutions(t){if(!this.useResolutions_)return null;let e=super.getResolutions();if(!e)for(let n=0,i=this.layers_.length;n<i&&(e=this.layers_[n].getSource().getResolutions(t),!e);++n);return e}disposeInternal(){this.processor_&&this.processor_.dispose(),super.disposeInternal()}}H1.prototype.dispose;let Si=null;function i5(r,t){const e=r.getRenderer();if(!e)throw new Error("Unsupported layer type: "+r);if(!e.prepareFrame(t))return null;const n=t.size[0],i=t.size[1];if(n===0||i===0)return null;const s=e.renderFrame(t,null);let o;if(s instanceof HTMLCanvasElement)o=s;else{if(s&&(o=s.firstElementChild),!(o instanceof HTMLCanvasElement))throw new Error("Unsupported rendered element: "+o);if(o.width===n&&o.height===i)return o.getContext("2d").getImageData(0,0,n,i)}if(!Si)Si=Jt(n,i,void 0,{willReadFrequently:!0});else{const a=Si.canvas;a.width!==n||a.height!==i?Si=Jt(n,i,void 0,{willReadFrequently:!0}):Si.clearRect(0,0,n,i)}return Si.drawImage(o,0,0,n,i),Si.getImageData(0,0,n,i)}function s5(r){return r.map(function(t){return t.getLayerState()})}function o5(r){const t=r.length,e=new Array(t);for(let n=0;n<t;++n)e[n]=a5(r[n]);return e}function a5(r){let t;return r instanceof ro?r instanceof Da?t=new $l({source:r}):r instanceof xi&&(t=new ef({source:r})):t=r,t}const l5=H1,h5='&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a>',u5='&copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a>',c5='&copy; <a href="https://stamen.com/" target="_blank">Stamen Design</a>',d5={stamen_terrain:{extension:"png",opaque:!0},stamen_terrain_background:{extension:"png",opaque:!0},stamen_terrain_labels:{extension:"png",opaque:!1},stamen_terrain_lines:{extension:"png",opaque:!1},stamen_toner_background:{extension:"png",opaque:!0},stamen_toner:{extension:"png",opaque:!0},stamen_toner_labels:{extension:"png",opaque:!1},stamen_toner_lines:{extension:"png",opaque:!1},stamen_toner_lite:{extension:"png",opaque:!0},stamen_watercolor:{extension:"jpg",opaque:!0},alidade_smooth:{extension:"png",opaque:!0},alidade_smooth_dark:{extension:"png",opaque:!0},alidade_satellite:{extension:"png",opaque:!0},outdoors:{extension:"png",opaque:!0},osm_bright:{extension:"png",opaque:!0}},f5={stamen_terrain:{minZoom:0,maxZoom:18,retina:!0},stamen_toner:{minZoom:0,maxZoom:20,retina:!0},stamen_watercolor:{minZoom:1,maxZoom:18,retina:!1}};class g5 extends Ui{constructor(t){const e=t.layer.indexOf("-"),n=e==-1?t.layer:t.layer.slice(0,e),i=f5[n]||{minZoom:0,maxZoom:20,retina:!0},s=d5[t.layer],o=t.apiKey?"?api_key="+t.apiKey:"",a=i.retina&&t.retina?"@2x":"",l=t.url!==void 0?t.url:"https://tiles.stadiamaps.com/tiles/"+t.layer+"/{z}/{x}/{y}"+a+"."+s.extension+o,h=[h5,u5,$1];t.layer.startsWith("stamen_")&&h.splice(1,0,c5),super({attributions:h,cacheSize:t.cacheSize,crossOrigin:"anonymous",interpolate:t.interpolate,maxZoom:t.maxZoom!==void 0?t.maxZoom:i.maxZoom,minZoom:t.minZoom!==void 0?t.minZoom:i.minZoom,opaque:s.opaque,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileLoadFunction:t.tileLoadFunction,transition:t.transition,url:l,tilePixelRatio:a?2:1,wrapX:t.wrapX,zDirection:t.zDirection})}}const p5=g5;class m5 extends Ar{constructor(t){t=t||{},super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,zDirection:t.zDirection}),this.params_=Object.assign({},t.params),this.hidpi_=t.hidpi!==void 0?t.hidpi:!0,this.tmpExtent_=ze(),this.setKey(this.getKeyForParams_())}getKeyForParams_(){let t=0;const e=[];for(const n in this.params_)e[t++]=n+"-"+this.params_[n];return e.join("/")}getParams(){return this.params_}getRequestUrl_(t,e,n,i,s,o){const a=this.urls;if(!a)return;let l;if(a.length==1)l=a[0];else{const h=an(Kd(t),a.length);l=a[h]}return X1(l,n,(this.tileGrid||this.getTileGridForProjection(s)).getResolution(t[0]),i,s,o)}getTilePixelRatio(t){return this.hidpi_?t:1}updateParams(t){Object.assign(this.params_,t),this.setKey(this.getKeyForParams_())}tileUrlFunction(t,e,n){let i=this.getTileGrid();if(i||(i=this.getTileGridForProjection(n)),i.getResolutions().length<=t[0])return;e!=1&&!this.hidpi_&&(e=1);const s=i.getTileCoordExtent(t,this.tmpExtent_);let o=ie(i.getTileSize(t[0]),this.tmpSize);e!=1&&(o=E0(o,e,this.tmpSize));const a={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};return Object.assign(a,this.params_),this.getRequestUrl_(t,o,s,e,n,a)}}const _5=m5;class y5 extends Ui{constructor(t){t=t||{},super({opaque:!1,projection:t.projection,tileGrid:t.tileGrid,wrapX:t.wrapX!==void 0?t.wrapX:!0,zDirection:t.zDirection,url:t.template||"z:{z} x:{x} y:{y}",tileLoadFunction:(e,n)=>{const i=e.getTileCoord()[0],s=ie(this.tileGrid.getTileSize(i)),o=Jt(s[0],s[1]);o.strokeStyle="grey",o.strokeRect(.5,.5,s[0]+.5,s[1]+.5),o.fillStyle="grey",o.strokeStyle="white",o.textAlign="center",o.textBaseline="middle",o.font="24px sans-serif",o.lineWidth=4,o.strokeText(n,s[0]/2,s[1]/2,s[0]),o.fillText(n,s[0]/2,s[1]/2,s[0]),e.setImage(o.canvas)}})}}const x5=y5;class v5 extends no{constructor(t,e,n,i,s,o){super(t,e),this.src_=n,this.extent_=i,this.preemptive_=s,this.grid_=null,this.keys_=null,this.data_=null,this.jsonp_=o}getImage(){return null}getData(t){if(!this.grid_||!this.keys_)return null;const e=(t[0]-this.extent_[0])/(this.extent_[2]-this.extent_[0]),n=(t[1]-this.extent_[1])/(this.extent_[3]-this.extent_[1]),i=this.grid_[Math.floor((1-n)*this.grid_.length)];if(typeof i!="string")return null;let s=i.charCodeAt(Math.floor(e*i.length));s>=93&&s--,s>=35&&s--,s-=32;let o=null;if(s in this.keys_){const a=this.keys_[s];this.data_&&a in this.data_?o=this.data_[a]:o=a}return o}forDataAtCoordinate(t,e,n){this.state==W.EMPTY&&n===!0?(this.state=W.IDLE,Vo(this,Lt.CHANGE,function(i){e(this.getData(t))},this),this.loadInternal_()):n===!0?setTimeout(()=>{e(this.getData(t))},0):e(this.getData(t))}getKey(){return this.src_}handleError_(){this.state=W.ERROR,this.changed()}handleLoad_(t){this.grid_=t.grid,this.keys_=t.keys,this.data_=t.data,this.state=W.LOADED,this.changed()}loadInternal_(){if(this.state==W.IDLE)if(this.state=W.LOADING,this.jsonp_)Lf(this.src_,this.handleLoad_.bind(this),this.handleError_.bind(this));else{const t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this)),t.addEventListener("error",this.onXHRError_.bind(this)),t.open("GET",this.src_),t.send()}}onXHRLoad_(t){const e=t.target;if(!e.status||e.status>=200&&e.status<300){let n;try{n=JSON.parse(e.responseText)}catch{this.handleError_();return}this.handleLoad_(n)}else this.handleError_()}onXHRError_(t){this.handleError_()}load(){this.preemptive_?this.loadInternal_():this.setState(W.EMPTY)}}class w5 extends Da{constructor(t){if(super({projection:tt("EPSG:3857"),state:"loading",wrapX:t.wrapX!==void 0?t.wrapX:!0,zDirection:t.zDirection}),this.preemptive_=t.preemptive!==void 0?t.preemptive:!0,this.tileUrlFunction_=qL,this.template_=void 0,this.jsonp_=t.jsonp||!1,t.url)if(this.jsonp_)Lf(t.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const e=new XMLHttpRequest;e.addEventListener("load",this.onXHRLoad_.bind(this)),e.addEventListener("error",this.onXHRError_.bind(this)),e.open("GET",t.url),e.send()}else if(t.tileJSON)this.handleTileJSONResponse(t.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(t){const e=t.target;if(!e.status||e.status>=200&&e.status<300){let n;try{n=JSON.parse(e.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(n)}else this.handleTileJSONError()}onXHRError_(t){this.handleTileJSONError()}getTemplate(){return this.template_}forDataAtCoordinateAndResolution(t,e,n,i){if(this.tileGrid){const s=this.tileGrid.getZForResolution(e,this.zDirection),o=this.tileGrid.getTileCoordForCoordAndZ(t,s);this.getTile(o[0],o[1],o[2],1,this.getProjection()).forDataAtCoordinate(t,n,i)}else i===!0?setTimeout(function(){n(null)},0):n(null)}handleTileJSONError(){this.setState("error")}handleTileJSONResponse(t){const e=tt("EPSG:4326"),n=this.getProjection();let i;if(t.bounds!==void 0){const u=$i(e,n);i=Fs(t.bounds,u)}const s=Wn(n),o=t.minzoom||0,a=t.maxzoom||22,l=Hi({extent:s,maxZoom:a,minZoom:o});this.tileGrid=l,this.template_=t.template;const h=t.grids;if(!h){this.setState("error");return}if(this.tileUrlFunction_=Cf(h,l),t.attribution){const u=i!==void 0?i:s;this.setAttributions(function(c){return Qt(u,c.extent)?[t.attribution]:null})}this.setState("ready")}getTile(t,e,n,i,s){const o=cn(t,e,n);if(this.tileCache.containsKey(o))return this.tileCache.get(o);const a=[t,e,n],l=this.getTileCoordForTileUrlFunction(a,s),h=this.tileUrlFunction_(l,i,s),u=new v5(a,h!==void 0?W.IDLE:W.EMPTY,h!==void 0?h:"",this.tileGrid.getTileCoordExtent(a),this.preemptive_,this.jsonp_);return this.tileCache.set(o,u),u}useTile(t,e,n){const i=cn(t,e,n);this.tileCache.containsKey(i)&&this.tileCache.get(i)}}const b5=w5;function S5(r,t){const e=new Hd(32),n=r.getExtent();return function(i,s){e.expireCache(),n&&(i=we(n,i));const o=r.getZForResolution(s),a=[];return r.forEachTileCoord(i,o,l=>{const h=l.toString();if(!e.containsKey(h)){const u=t(l);e.set(h,u)}a.push(e.get(h))}),a}}const E5=Object.freeze(Object.defineProperty({__proto__:null,BingMaps:mk,CartoDB:yk,Cluster:vk,DataTile:uf,GeoTIFF:Rf,Google:Mk,IIIF:Pk,Image:xi,ImageArcGISRest:Lk,ImageCanvas:Fk,ImageMapGuide:Gk,ImageStatic:qy,ImageWMS:zk,OGCMapTile:$k,OGCVectorTile:Yk,OSM:Kk,Raster:l5,Source:ro,StadiaMaps:p5,Tile:Da,TileArcGISRest:_5,TileDebug:x5,TileImage:Ar,TileJSON:Vy,TileWMS:Qy,UTFGrid:b5,UrlTile:Af,Vector:Fh,VectorTile:Zh,WMTS:Jy,XYZ:Ui,Zoomify:Ck,createArcGISRestLoader:W1,createMapGuideLoader:q1,createStaticLoader:Wy,createWMSLoader:Ky,sourcesFromTileGrid:S5},Symbol.toStringTag,{value:"Module"}));class T5 extends Ar{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,tilePixelRatio:t.tilePixelRatio,transition:t.transition,interpolate:t.interpolate!==void 0?t.interpolate:!0,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection,wrapX:t.wrapX}),this.version_=t.version!==void 0?t?.version:"1.0.0",this.dimensions_=t.dimensions!==void 0?t.dimensions:{},this.layer_=t.layer,fetch(t.url).then(e=>e.text()).then(e=>new window.DOMParser().parseFromString(e,"application/xml")).then(e=>{this.handleCapabilitiesResponse(e,t)})}handleCapabilitiesResponse(t,e){const n=new Fd().read(t),i=t1(n,e);this.crossOrigin=i.crossOrigin,this.projection=i.projection,this.tileGrid=i.tileGrid,this.requestEncoding_=i.requestEncoding,this.matrixSet_=i.matrixSet,this.style_=i.style,this.format_=i.format,this.dimensions_=i.dimensions,this.setUrls(i.urls),this.urls&&this.urls.length>0&&(this.tileUrlFunction=Ws(this.urls.map(this.createFromWMTSTemplate.bind(this)))),this.setState("ready")}createFromWMTSTemplate(t){const e=this.requestEncoding_,n={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};e=="KVP"&&Object.assign(n,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),t=e=="KVP"?Gn(t,n):t.replace(/\{(\w+?)\}/g,function(o,a){return a.toLowerCase()in n?n[a.toLowerCase()]:o});const i=this.tileGrid,s=this.dimensions_;return function(o){if(!o)return;const a={TileMatrix:i.getMatrixId(o[0]),TileCol:o[1],TileRow:o[2]};Object.assign(a,s);let l=t;return e=="KVP"?l=Gn(l,a):l=l.replace(/\{(\w+?)\}/g,function(h,u){return a[u]}),l}}}window.eoxMapAdvancedOlSources={...E5,WMTSCapabilities:T5};const M5={__name:"EodashMap",setup(r){const t=tx(nx),e={class:"fill-height fill-width overflow-none",center:[15,48],layers:[{type:"Tile",source:{type:"OSM"}}]};wi&&wi.value&&wi.value.length===3&&(e.center=[wi.value?.[0],wi.value[1]],e.zoom=wi.value[2]);const n=()=>jn(()=>import("./eox-map-D_hDglwG.js"),[]),i=a=>{const l=a.map,[h,u]=l?.getView().getCenter()??[0,0],c=l?.getView().getZoom();!Number.isNaN(h)&&!Number.isNaN(u)&&!Number.isNaN(c)&&(wi.value=[h,u,c])},s=(a,l)=>{a?.map?.on("moveend",i);const{selectedStac:h}=ix(l);sx([h,ox],async([u,c])=>{if(u){const f=wl(`./${u.id}/collection.json`,t.stacEndpoint),g=wl(u.links[1].href,f),m=new Cx(g);c?a.layers=await m.createLayersJson(new Date(c)):a.layers=await m.createLayersJson()}},{immediate:!0})},o=(a,l)=>{a?.map?.un("moveend",i)};return(a,l)=>(ex(),rx(lx,{link:n,"tag-name":"eox-map",properties:e,"on-mounted":s,"on-unmounted":o}))}},B5=Object.freeze(Object.defineProperty({__proto__:null,default:M5},Symbol.toStringTag,{value:"Module"}));export{z5 as D,B5 as E,U5 as G,Ks as V};
